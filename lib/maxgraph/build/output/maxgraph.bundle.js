/*! For license information please see maxgraph.bundle.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.maxgraph=e():t.maxgraph=e()}(self,(()=>(()=>{"use strict";var __webpack_modules__={7773:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(1532);class n{}n.VERSION="0.14.0",n.basePath=".",n.setBasePath=t=>{void 0!==t&&t.length>0?("/"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),n.basePath=t):n.basePath="."},n.imageBasePath=".",n.setImageBasePath=t=>{void 0!==t&&t.length>0?("/"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),n.imageBasePath=t):n.imageBasePath=`${n.basePath}/images`},n.language="undefined"!=typeof window?navigator.language:"en",n.setLanguage=t=>{n.language=void 0!==t&&null!=t?t:navigator.language},n.defaultLanguage="en",n.setDefaultLanguage=t=>{n.defaultLanguage=void 0!==t&&null!=t?t:"en"},n.languages=null,n.setLanguages=t=>{void 0!==t&&null!=t&&(n.languages=t)},n.IS_EDGE="undefined"!=typeof window&&null!=navigator.userAgent&&!!navigator.userAgent.match(/Edge\//),n.IS_NS="undefined"!=typeof window&&null!=navigator.userAgent&&navigator.userAgent.indexOf("Mozilla/")>=0&&navigator.userAgent.indexOf("MSIE")<0&&navigator.userAgent.indexOf("Edge/")<0,n.IS_SF="undefined"!=typeof window&&/Apple Computer, Inc/.test(navigator.vendor),n.IS_ANDROID="undefined"!=typeof window&&navigator.appVersion.indexOf("Android")>=0,n.IS_IOS="undefined"!=typeof window&&/iP(hone|od|ad)/.test(navigator.platform),n.IS_GC="undefined"!=typeof window&&/Google Inc/.test(navigator.vendor),n.IS_CHROMEAPP="undefined"!=typeof window&&null!=window.chrome&&null!=chrome.app&&null!=chrome.app.runtime,n.IS_FF=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,n.IS_MT="undefined"!=typeof window&&(navigator.userAgent.indexOf("Firefox/")>=0&&navigator.userAgent.indexOf("Firefox/1.")<0&&navigator.userAgent.indexOf("Firefox/2.")<0||navigator.userAgent.indexOf("Iceweasel/")>=0&&navigator.userAgent.indexOf("Iceweasel/1.")<0&&navigator.userAgent.indexOf("Iceweasel/2.")<0||navigator.userAgent.indexOf("SeaMonkey/")>=0&&navigator.userAgent.indexOf("SeaMonkey/1.")<0||navigator.userAgent.indexOf("Iceape/")>=0&&navigator.userAgent.indexOf("Iceape/1.")<0),n.IS_SVG="undefined"!=typeof window&&"MICROSOFT INTERNET EXPLORER"!==navigator.appName.toUpperCase(),n.NO_FO="undefined"!=typeof window&&(!document.createElementNS||"[object SVGForeignObjectElement]"!==document.createElementNS(s.NS_SVG,"foreignObject").toString()||navigator.userAgent.indexOf("Opera/")>=0),n.IS_WIN="undefined"!=typeof window&&navigator.appVersion.indexOf("Win")>0,n.IS_MAC="undefined"!=typeof window&&navigator.appVersion.indexOf("Mac")>0,n.IS_CHROMEOS="undefined"!=typeof window&&/\bCrOS\b/.test(navigator.appVersion),n.IS_TOUCH="undefined"!=typeof window&&"ontouchstart"in document.documentElement,n.IS_POINTER="undefined"!=typeof window&&null!=window.PointerEvent&&!(navigator.appVersion.indexOf("Mac")>0),n.IS_LOCAL="undefined"!=typeof window&&document.location.href.indexOf("http://")<0&&document.location.href.indexOf("https://")<0,n.isBrowserSupported=()=>n.IS_SVG;const l=n},5474:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,j:()=>EditorPopupMenu});var _util_domUtils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4532),_util_Translations__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2593);class EditorPopupMenu{constructor(t=null){this.imageBasePath=null,this.config=t}createMenu(t,e,i=null,s=null){if(null!=this.config){const n=this.createConditions(t,i,s),l=this.config.firstChild;this.addItems(t,e,i,s,n,l,null)}}addItems(editor,menu,cell=null,evt=null,conditions,item,parent=null){let addSeparator=!1;for(;null!=item;){if("add"===item.nodeName){const condition=item.getAttribute("if");if(null==condition||conditions[condition]){let as=item.getAttribute("as");as=_util_Translations__WEBPACK_IMPORTED_MODULE_0__.A.get(as)||as;const funct=eval((0,_util_domUtils__WEBPACK_IMPORTED_MODULE_1__.getTextContent)(item)),action=item.getAttribute("action");let icon=item.getAttribute("icon");const iconCls=item.getAttribute("iconCls"),enabledCond=item.getAttribute("enabled-if"),enabled=null==enabledCond||conditions[enabledCond];addSeparator&&(menu.addSeparator(parent),addSeparator=!1),null!=icon&&this.imageBasePath&&(icon=this.imageBasePath+icon);const row=this.addAction(menu,editor,as,icon,funct,action,cell,parent,iconCls,enabled);this.addItems(editor,menu,cell,evt,conditions,item.firstChild,row)}}else"separator"===item.nodeName&&(addSeparator=!0);item=item.nextSibling}}addAction(t,e,i,s=null,n=null,l=null,r=null,a=null,o=null,h=!0){return t.addItem(i,s||null,(t=>{"function"==typeof n&&n.call(e,e,r,t),null!=l&&e.execute(l,r,t)}),a,o,h)}createConditions(editor,cell=null,evt=null){const model=editor.graph.getDataModel(),childCount=cell?cell.getChildCount():0,conditions={};conditions.nocell=null==cell,conditions.ncells=editor.graph.getSelectionCount()>1,conditions.notRoot=model.getRoot()!==editor.graph.getDefaultParent().getParent(),conditions.cell=null!=cell;const isCell=null!=cell&&1===editor.graph.getSelectionCount();conditions.nonEmpty=isCell&&childCount>0,conditions.expandable=isCell&&editor.graph.isCellFoldable(cell,!1),conditions.collapsable=isCell&&editor.graph.isCellFoldable(cell,!0),conditions.validRoot=isCell&&editor.graph.isValidRoot(cell),conditions.emptyValidRoot=conditions.validRoot&&0===childCount,conditions.swimlane=isCell&&editor.graph.isSwimlane(cell);const condNodes=this.config.getElementsByTagName("condition");for(let i=0;i<condNodes.length;i+=1){const funct=eval((0,_util_domUtils__WEBPACK_IMPORTED_MODULE_1__.getTextContent)(condNodes[i])),name=condNodes[i].getAttribute("name");null!=name&&"function"==typeof funct&&(conditions[name]=funct(editor,cell,evt))}return conditions}}const __WEBPACK_DEFAULT_EXPORT__=EditorPopupMenu},1244:(t,e,i)=>{i.d(e,{t:()=>h});var s=i(7773),n=i(5015),l=i(6381),r=i(9155),a=i(7620),o=i(5524);i(5309);class h{constructor(t=null,e=null){this.toolbar=null,this.resetHandler=null,this.spacing=4,this.connectOnDrop=!1,this.editor=e,null!=t&&null!=e&&this.init(t)}init(t){null!=t&&(this.toolbar=new n.A(t),this.toolbar.addListener(a.A.SELECT,((e,i)=>{const s=i.getProperty("function");this.editor.insertFunction=null!=s?()=>{s.apply(this,[t]),this.toolbar.resetMode()}:null})),this.resetHandler=()=>{null!=this.toolbar&&this.toolbar.resetMode(!0)},this.editor.graph.addListener(a.A.DOUBLE_CLICK,this.resetHandler),this.editor.addListener(a.A.ESCAPE,this.resetHandler))}addItem(t,e,i,s){return this.toolbar.addItem(t,e,(()=>{null!=i&&i.length>0&&this.editor.execute(i)}),s)}addSeparator(t){t=t||`${s.A.imageBasePath}/separator.gif`,this.toolbar.addSeparator(t)}addCombo(){return this.toolbar.addCombo()}addActionCombo(t){return this.toolbar.addActionCombo(t)}addActionOption(t,e,i){this.addOption(t,e,(()=>{this.editor.execute(i)}))}addOption(t,e,i){return this.toolbar.addOption(t,e,i)}addMode(t,e,i,s=null,n=null){return this.toolbar.addSwitchMode(t,e,(()=>{this.editor.setMode(i),null!=n&&n(this.editor)}),s)}addPrototype(t,e,i,s,n,l=!0){const r=()=>"function"==typeof i?i():null!=i?this.editor.graph.cloneCell(i):null,o=(t,e)=>{"function"==typeof n?n(this.editor,r(),t,e):this.drop(r(),t,e),this.toolbar.resetMode(),a.A.consume(t)},h=this.toolbar.addMode(t,e,o,s,null,l);return this.installDropHandler(h,((t,e,i)=>{o(e,i)})),h}drop(t,e,i=null){const{graph:s}=this.editor;if(s.getDataModel(),null!=i&&!i.isEdge()&&this.connectOnDrop&&i.isConnectable())this.connect(t,e,i);else{for(;null!=i&&!s.isValidDropTarget(i,[t],e);)i=i.getParent();this.insert(t,e,i)}}insert(t,e,i=null){const{graph:s}=this.editor;if(s.canImportCell(t)){const n=(0,o.getClientX)(e),l=(0,o.getClientY)(e),a=(0,r.convertPoint)(s.container,n,l);return i&&s.isSplitEnabled()&&s.isSplitTarget(i,[t],e)?s.splitEdge(i,[t],null,a.x,a.y):this.editor.addVertex(i,t,a.x,a.y)}return null}connect(t,e,i=null){const{graph:s}=this.editor,n=s.getDataModel();if(null!=i&&t.isConnectable()&&s.isEdgeValid(null,i,t)){let e=null;n.beginUpdate();try{const r=i.getGeometry(),a=t.getGeometry().clone();a.x=r.x+(r.width-a.width)/2,a.y=r.y+(r.height-a.height)/2;const o=this.spacing*s.gridSize,h=20*i.getDirectedEdgeCount(!0);this.editor.horizontalFlow?a.x+=(a.width+r.width)/2+o+h:a.y+=(a.height+r.height)/2+o+h,t.setGeometry(a);const d=i.getParent();if(s.addCell(t,d),s.constrainChild(t),e=this.editor.createEdge(i,t),null==e.getGeometry()){const t=new l.A;t.relative=!0,n.setGeometry(e,t)}s.addEdge(e,d,i,t)}finally{n.endUpdate()}s.setSelectionCells([t,e]),s.scrollCellToVisible(t)}}installDropHandler(t,e){document.createElement("img").setAttribute("src",t.getAttribute("src"))}destroy(){null!=this.resetHandler&&(this.editor.graph.removeListener(this.resetHandler),this.editor.removeListener(this.resetHandler),this.resetHandler=null),null!=this.toolbar&&(this.toolbar.destroy(),this.toolbar=null)}}},8437:(t,e,i)=>{i.d(e,{A:()=>c});var s=i(2354),n=i(9155),l=i(4432),r=i(7773),a=i(7620),o=i(4532),h=i(5524);class d extends s.A{constructor(t){super(),this.activeRow=null,this.eventReceiver=null,this.submenuImage=`${r.A.imageBasePath}/submenu.gif`,this.zIndex=10006,this.useLeftButtonForPopup=!1,this.enabled=!0,this.itemCount=0,this.autoExpand=!1,this.smartSeparators=!1,this.labels=!0,this.willAddSeparator=!1,this.containsItems=!1,t&&(this.factoryMethod=t),this.table=document.createElement("table"),this.table.className="mxPopupMenu",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.div=document.createElement("div"),this.div.className="mxPopupMenu",this.div.style.display="inline",this.div.style.zIndex=String(this.zIndex),this.div.appendChild(this.table),a.A.disableContextMenu(this.div)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isPopupTrigger(t){return t.isPopupTrigger()||this.useLeftButtonForPopup&&(0,h.isLeftMouseButton)(t.getEvent())}addItem(t,e,i,s=null,n=null,l=!0,r=!0,h=!1){s=s??this,this.itemCount++,s.willAddSeparator&&(s.containsItems&&this.addSeparator(s,!0),s.willAddSeparator=!1),s.containsItems=!0;const d=document.createElement("tr");d.className="mxPopupMenuItem";const c=document.createElement("td");if(c.className="mxPopupMenuIcon",e){const t=document.createElement("img");t.src=e,c.appendChild(t)}else if(n){const t=document.createElement("div");t.className=n,c.appendChild(t)}if(d.appendChild(c),this.labels){const e=document.createElement("td");e.className="mxPopupMenuItem"+(l?"":" mxDisabled"),(0,o.write)(e,t),e.align="left",d.appendChild(e);const i=document.createElement("td");i.className="mxPopupMenuItem"+(l?"":" mxDisabled"),i.style.paddingRight="6px",i.style.textAlign="right",d.appendChild(i),null==s.div&&this.createSubmenu(s)}return s.tbody?.appendChild(d),r&&l&&(a.A.addGestureListeners(d,(t=>{this.eventReceiver=d,s&&s.activeRow!=d&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),d.div&&(this.showSubmenu(s,d),s.activeRow=d)),a.A.consume(t)}),(t=>{s&&s.activeRow!=d&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),this.autoExpand&&d.div&&(this.showSubmenu(s,d),s.activeRow=d)),h||(d.className="mxPopupMenuItemHover")}),(t=>{this.eventReceiver==d&&(s&&s.activeRow!=d&&this.hideMenu(),i?.(t)),this.eventReceiver=null,a.A.consume(t)})),h||a.A.addListener(d,"mouseout",(t=>{d.className="mxPopupMenuItem"}))),d}addCheckmark(t,e){if(t.firstChild){const i=t.firstChild.nextSibling;i.style.backgroundImage=`url('${e}')`,i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="2px 50%"}}createSubmenu(t){t.table=document.createElement("table"),t.table.className="mxPopupMenu",t.tbody=document.createElement("tbody"),t.table.appendChild(t.tbody),t.div=document.createElement("div"),t.div.className="mxPopupMenu",t.div.style.position="absolute",t.div.style.display="inline",t.div.style.zIndex=String(this.zIndex),t.div.appendChild(t.table);const e=document.createElement("img");e.setAttribute("src",this.submenuImage),t.firstChild?.nextSibling?.nextSibling&&t.firstChild.nextSibling.nextSibling.appendChild(e)}showSubmenu(t,e){if(e.div){e.div.style.left=t.div.offsetLeft+e.offsetLeft+e.offsetWidth-1+"px",e.div.style.top=`${t.div.offsetTop+e.offsetTop}px`,document.body.appendChild(e.div);const i=e.div.offsetLeft,s=e.div.offsetWidth,l=(0,n.getDocumentScrollOrigin)(document),r=document.body,a=document.documentElement;i+s>l.x+(r.clientWidth||a.clientWidth)&&(e.div.style.left=`${Math.max(0,t.div.offsetLeft-s-6)}px`),(0,n.fit)(e.div)}}addSeparator(t=null,e=!1){if(t=t||this,this.smartSeparators&&!e)t.willAddSeparator=!0;else if(t.tbody){t.willAddSeparator=!1;const e=document.createElement("tr"),i=document.createElement("td");i.className="mxPopupMenuIcon",i.style.padding="0 0 0 0px",e.appendChild(i);const s=document.createElement("td");s.style.padding="0 0 0 0px",s.setAttribute("colSpan","2");const n=document.createElement("hr");n.setAttribute("size","1"),s.appendChild(n),e.appendChild(s),t.tbody.appendChild(e)}}popup(t,e,i,s){if(this.div&&this.tbody&&this.factoryMethod){for(this.div.style.left=`${t}px`,this.div.style.top=`${e}px`;this.tbody.firstChild;)a.A.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0,this.factoryMethod(this,i,s),this.itemCount>0&&(this.showMenu(),this.fireEvent(new l.A(a.A.SHOW)))}}isMenuShowing(){return this.div&&this.div.parentNode==document.body}showMenu(){document.body.appendChild(this.div),(0,n.fit)(this.div)}hideMenu(){this.div&&(this.div.parentNode?.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new l.A(a.A.HIDE)))}hideSubmenu(t){t.activeRow&&(this.hideSubmenu(t.activeRow),t.activeRow.div.parentNode?.removeChild(t.activeRow.div),t.activeRow=null)}destroy(){this.div&&(a.A.release(this.div),this.div.parentNode?.removeChild(this.div))}}const c=d},5015:(t,e,i)=>{i.d(e,{A:()=>c});var s=i(7620),n=i(9447),l=i(8437),r=i(2354),a=i(4432),o=i(7773),h=i(4532);class d extends r.A{constructor(t){super(),this.menu=null,this.currentImg=null,this.selectedMode=null,this.defaultMode=null,this.defaultFunction=null,this.enabled=!0,this.noReset=!1,this.updateDefaultMode=!0,this.container=t}addItem(t=null,e=null,i=null,r=null,a=null,d=null){const c=document.createElement(null!=e?"img":"button"),u=a||(d?"mxToolbarMode":"mxToolbarItem");c.className=u,e&&c.setAttribute("src",e),null!=t&&(null!=e?c.setAttribute("title",t):(0,h.write)(c,t)),this.container.appendChild(c),null!=i&&(s.A.addListener(c,"click",i),o.A.IS_TOUCH&&s.A.addListener(c,"touchend",i));const g=t=>{null!=r?c.setAttribute("src",e):c.style.backgroundColor=""};return s.A.addGestureListeners(c,(t=>{if(null!=r?c.setAttribute("src",r):c.style.backgroundColor="gray",d){null==this.menu&&(this.menu=new l.A);const e=this.currentImg;if(this.menu.isMenuShowing()&&this.menu.hideMenu(),e!=c){this.currentImg=c,this.menu.factoryMethod=d;const e=new n.A(c.offsetLeft,c.offsetTop+c.offsetHeight);if(this.menu.popup(e.x,e.y,null,t),this.menu.isMenuShowing()){c.className=`${u}Selected`;const t=this.menu.hideMenu;this.menu.hideMenu=()=>{t.apply(this),c.className=u,this.currentImg=null}}}}}),null,g),s.A.addListener(c,"mouseout",g),c}addCombo(t){const e=document.createElement("div");e.style.display="inline",e.className="mxToolbarComboContainer";const i=document.createElement("select");return i.className=t||"mxToolbarCombo",e.appendChild(i),this.container.appendChild(e),i}addActionCombo(t,e){const i=document.createElement("select");return i.className=e||"mxToolbarCombo",this.addOption(i,t,null),s.A.addListener(i,"change",(t=>{const e=i.options[i.selectedIndex];i.selectedIndex=0,null!=e.funct&&e.funct(t)})),this.container.appendChild(i),i}addOption(t,e,i=null){const s=document.createElement("option");return(0,h.writeln)(s,e),"function"==typeof i?s.funct=i:s.setAttribute("value",i),t.appendChild(s),s}addSwitchMode(t,e,i,n=null,l="mxToolbarMode"){const r=document.createElement("img");return r.initialClassName=l,r.className=r.initialClassName,r.setAttribute("src",e),r.altIcon=n,null!=t&&r.setAttribute("title",t),s.A.addListener(r,"click",(t=>{const e=this.selectedMode;let n=e.altIcon;null!=n?(e.altIcon=e.getAttribute("src"),e.setAttribute("src",n)):e.className=e.initialClassName,this.updateDefaultMode&&(this.defaultMode=r),this.selectedMode=r,n=r.altIcon,null!=n?(r.altIcon=r.getAttribute("src"),r.setAttribute("src",n)):r.className=`${r.initialClassName}Selected`,this.fireEvent(new a.A(s.A.SELECT)),i()})),this.container.appendChild(r),null==this.defaultMode&&(this.defaultMode=r,this.selectMode(r),i()),r}addMode(t=null,e=null,i,n,l=null,r=!1){r=null==r||r;const a=document.createElement(null!=e?"img":"button");return a.initialClassName=l||"mxToolbarMode",a.className=a.initialClassName,e&&a.setAttribute("src",e),a.altIcon=n,null!=t&&a.setAttribute("title",t),this.enabled&&r&&(s.A.addListener(a,"click",(t=>{this.selectMode(a,i),this.noReset=!1})),s.A.addListener(a,"dblclick",(t=>{this.selectMode(a,i),this.noReset=!0})),null==this.defaultMode&&(this.defaultMode=a,this.defaultFunction=i,this.selectMode(a,i))),this.container.appendChild(a),a}selectMode(t,e=null){if(this.selectedMode!=t){if(null!=this.selectedMode){const t=this.selectedMode.altIcon;null!=t?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",t)):this.selectedMode.className=this.selectedMode.initialClassName}this.selectedMode=t;const i=this.selectedMode.altIcon;null!=i?(this.selectedMode.altIcon=this.selectedMode.getAttribute("src"),this.selectedMode.setAttribute("src",i)):this.selectedMode.className=`${this.selectedMode.initialClassName}Selected`,this.fireEvent(new a.A(s.A.SELECT,{function:e}))}}resetMode(t=!1){!t&&this.noReset||this.selectedMode==this.defaultMode||this.selectMode(this.defaultMode,this.defaultFunction)}addSeparator(t){return this.addItem(null,t,null)}addBreak(){(0,h.br)(this.container)}addLine(){const t=document.createElement("hr");t.style.marginRight="6px",t.setAttribute("size","1"),this.container.appendChild(t)}destroy(){s.A.release(this.container),this.container=null,this.defaultMode=null,this.defaultFunction=null,this.selectedMode=null,null!=this.menu&&this.menu.destroy()}}const c=d},8761:(t,e,i)=>{i.d(e,{A:()=>c});var s=i(6498),n=i(1814),l=i(1532),r=i(8981),a=i(9639),o=i(3215),h=i(4532);const d=()=>document.implementation.createDocument("","",null),c=class{constructor(t=d()){this.elements=null,this.encodeDefaults=!1,this.document=t,this.objects={}}putObject(t,e){return this.objects[t]=e,e}getObject(t){let e=null;if(null!=t&&(e=this.objects[t],null==e&&(e=this.lookup(t),null==e))){const i=this.getElementById(t);null!=i&&(e=this.decode(i))}return e}lookup(t){return null}getElementById(t){return this.updateElements(),this.elements[t]}updateElements(){null==this.elements&&(this.elements={},null!=this.document.documentElement&&this.addElement(this.document.documentElement))}addElement(t){if(t.nodeType===l.NODETYPE.ELEMENT){const e=t.getAttribute("id");if(null!=e)if(null==this.elements[e])this.elements[e]=t;else if(this.elements[e]!==t)throw new Error(`${e}: Duplicate ID`)}let e=t.firstChild;for(;null!=e;)this.addElement(e),e=e.nextSibling}getId(t){let e=null;return null!=t&&(e=this.reference(t),null==e&&t instanceof r.A&&(e=t.getId(),null==e&&(e=s.A.create(t),0===e.length&&(e="root")))),e}reference(t){return null}encode(t){let e=null;if(null!=t&&null!=t.constructor){const i=n.A.getCodec(t.constructor);null!=i?e=i.encode(this,t):(0,h.isNode)(t)?e=(0,h.importNode)(this.document,t,!0):a.eo.logger.warn(`Codec.encode: No codec for ${(0,o.getFunctionName)(t.constructor)}`)}return e}decode(t,e){this.updateElements();let i=null;if(null!=t&&t.nodeType===l.NODETYPE.ELEMENT){const s=n.A.getCodecByName(t.nodeName);null!=s?i=s.decode(this,t,e):(i=t.cloneNode(!0),i.removeAttribute("as"))}return i}encodeCell(t,e,i){const s=this.encode(t);if(s&&e.appendChild(s),null==i||i){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.encodeCell(t.getChildAt(s),e)}}isCellCodec(t){return null!=t&&"isCellCodec"in t&&t.isCellCodec()}decodeCell(t,e=!0){if(t?.nodeType!==l.NODETYPE.ELEMENT)return null;let i=n.A.getCodec(t.nodeName);if(!this.isCellCodec(i)){let e=t.firstChild;for(;null!=e&&!this.isCellCodec(i);)i=n.A.getCodec(e.nodeName),e=e.nextSibling}this.isCellCodec(i)||(i=n.A.getCodec(r.A));const s=i?.decode(this,t);return e&&this.insertIntoGraph(s),s}insertIntoGraph(t){const{parent:e}=t,i=t.getTerminal(!0),s=t.getTerminal(!1);if(t.setTerminal(null,!1),t.setTerminal(null,!0),t.parent=null,null!=e){if(e===t)throw new Error(`${e.id}: Self Reference`);e.insert(t)}null!=i&&i.insertEdge(t,!0),null!=s&&s.insertEdge(t,!1)}setAttribute(t,e,i){null!=e&&null!=i&&t.setAttribute(e,i)}}},1814:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(3456);class n{static register(t,e=!0){if(null!=t){const i=t.getName();n.codecs[i]=t;const s=t.template.constructor.name;e&&s!==i&&n.addAlias(s,i)}return t}static addAlias(t,e){n.aliases[t]=e}static getCodec(t){if(null==t)return null;let e=null,i="string"==typeof t?t:t.name;const l=n.aliases[i];if(null!=l&&(i=l),e=n.codecs[i]??null,null==e)try{e=new s.A(new t),n.register(e)}catch(t){}return e}static getCodecByName(t){let e=n.codecs[t];if(!e){const i=n.aliases[t];i&&(e=n.codecs[i])}return e??null}}n.codecs={},n.aliases={};const l=n},3456:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _util_ObjectIdentity__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(6232),_util_config__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(9639),_view_geometry_Geometry__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(6381),_view_geometry_Point__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9447),_util_Constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(1532),_util_mathUtils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(3514),_util_domUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(4532),_util_MaxXmlRequest__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(5673);class ObjectCodec{constructor(t,e=[],i=[],s={}){this.template=t,this.exclude=e,this.idrefs=i,this.mapping=s,this.reverse={};for(const t in this.mapping)this.reverse[this.mapping[t]]=t}getName(){return this.name??this.template.constructor.name}setName(t){this.name=t}cloneTemplate(){return new this.template.constructor}getFieldName(t){if(null!=t){const e=this.reverse[t];null!=e&&(t=e)}return t}getAttributeName(t){if(null!=t){const e=this.mapping[t];null!=e&&(t=e)}return t}isExcluded(t,e,i,s){return e==_util_ObjectIdentity__WEBPACK_IMPORTED_MODULE_0__.A.FIELD_NAME||this.exclude.indexOf(e)>=0}isReference(t,e,i,s){return this.idrefs.indexOf(e)>=0}encode(t,e){const i=t.document.createElement(this.getName());return e=this.beforeEncode(t,e,i),this.encodeObject(t,e,i),this.afterEncode(t,e,i)}encodeObject(t,e,i){t.setAttribute(i,"id",t.getId(e));for(const s in e){let n=s;const l=e[n];null==l||this.isExcluded(e,n,l,!0)||((0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_1__.isInteger)(n)&&(n=null),this.encodeValue(t,e,n,l,i))}}encodeValue(t,e,i,s,n){if(null!=s){if(null!=i&&this.isReference(e,i,s,!0)){const e=t.getId(s);if(null==e)return void _util_config__WEBPACK_IMPORTED_MODULE_2__.eo.logger.warn(`ObjectCodec.encode: No ID for ${this.getName()}.${i}=${s}`);s=e}(null==i||t.encodeDefaults||this.template[i]!=s)&&(i=this.getAttributeName(i),this.writeAttribute(t,e,i,s,n))}}writeAttribute(t,e,i,s,n){"object"!=typeof s?this.writePrimitiveAttribute(t,e,i,s,n):this.writeComplexAttribute(t,e,i,s,n)}writePrimitiveAttribute(t,e,i,s,n){if(s=this.convertAttributeToXml(t,e,i,s,n),null==i){const e=t.document.createElement("add");"function"==typeof s?e.appendChild(t.document.createTextNode(s)):t.setAttribute(e,"value",s),n.appendChild(e)}else"function"!=typeof s&&t.setAttribute(n,i,s)}writeComplexAttribute(t,e,i,s,n){const l=t.encode(s);null!=l?(null!=i&&l.setAttribute("as",i),n.appendChild(l)):_util_config__WEBPACK_IMPORTED_MODULE_2__.eo.logger.warn(`ObjectCodec.encode: No node for ${this.getName()}.${i}: ${s}`)}convertAttributeToXml(t,e,i,s,n){return this.isBooleanAttribute(t,e,i,s)&&(s=1==s?"1":"0"),s}isBooleanAttribute(t,e,i,s){return void 0===s.length&&(1==s||0==s)}convertAttributeFromXml(t,e,i){let{value:s}=e;return this.isNumericAttribute(t,e,i)&&(s=parseFloat(s),!Number.isNaN(s)&&Number.isFinite(s)||(s=0)),s}isNumericAttribute(t,e,i){return i.constructor===_view_geometry_Geometry__WEBPACK_IMPORTED_MODULE_3__.A&&("x"===e.name||"y"===e.name||"width"===e.name||"height"===e.name)||i.constructor===_view_geometry_Point__WEBPACK_IMPORTED_MODULE_4__.A&&("x"===e.name||"y"===e.name)||(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_1__.isNumeric)(e.value)}beforeEncode(t,e,i){return e}afterEncode(t,e,i){return i}decode(t,e,i){const s=e.getAttribute("id");let n=t.objects[s];null==n&&(n=i||this.cloneTemplate(),null!=s&&t.putObject(s,n));const l=this.beforeDecode(t,e,n);return this.decodeNode(t,l,n),this.afterDecode(t,l,n)}decodeNode(t,e,i){null!=e&&(this.decodeAttributes(t,e,i),this.decodeChildren(t,e,i))}decodeAttributes(t,e,i){const s=e.attributes;if(null!=s)for(let e=0;e<s.length;e+=1)this.decodeAttribute(t,s[e],i)}isIgnoredAttribute(t,e,i){return"as"===e.nodeName||"id"===e.nodeName}decodeAttribute(t,e,i){if(!this.isIgnoredAttribute(t,e,i)){const s=e.nodeName;let n=this.convertAttributeFromXml(t,e,i);const l=this.getFieldName(s);if(this.isReference(i,l,n,!1)){const e=t.getObject(n);if(null==e)return void _util_config__WEBPACK_IMPORTED_MODULE_2__.eo.logger.warn(`ObjectCodec.decode: No object for ${this.getName()}.${s}=${n}`);n=e}this.isExcluded(i,s,n,!1)||(i[s]=n)}}decodeChildren(t,e,i){let s=e.firstChild;for(;null!=s;){const e=s.nextSibling;s.nodeType!==_util_Constants__WEBPACK_IMPORTED_MODULE_5__.NODETYPE.ELEMENT||this.processInclude(t,s,i)||this.decodeChild(t,s,i),s=e}}decodeChild(dec,child,obj){const fieldname=this.getFieldName(child.getAttribute("as"));if(null==fieldname||!this.isExcluded(obj,fieldname,child,!1)){const template=this.getFieldTemplate(obj,fieldname,child);let value=null;"add"===child.nodeName?(value=child.getAttribute("value"),null==value&&ObjectCodec.allowEval&&(value=eval((0,_util_domUtils__WEBPACK_IMPORTED_MODULE_6__.getTextContent)(child)))):value=dec.decode(child,template);try{this.addObjectValue(obj,fieldname,value,template)}catch(t){throw new Error(`${t.message} for ${child.nodeName}`)}}}getFieldTemplate(t,e,i){let s=t[e];return s instanceof Array&&s.length>0&&(s=null),s}addObjectValue(t,e,i,s){null!=i&&i!==s&&(null!=e&&e.length>0?t[e]=i:t.push(i))}processInclude(t,e,i){if("include"===e.nodeName){const s=e.getAttribute("name");if(null!=s)try{const e=(0,_util_MaxXmlRequest__WEBPACK_IMPORTED_MODULE_7__.Hh)(s).getDocumentElement();null!=e&&t.decode(e,i)}catch(t){}return!0}return!1}beforeDecode(t,e,i){return e}afterDecode(t,e,i){return i}}ObjectCodec.allowEval=!1;const __WEBPACK_DEFAULT_EXPORT__=ObjectCodec},6557:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{X:()=>StylesheetCodec});var _ObjectCodec__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3456),_view_style_Stylesheet__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(7648),_view_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(2628),_util_cloneUtils__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(8291),_util_config__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9639),_util_Constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(1532),_util_mathUtils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(3514),_util_domUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(4532);class StylesheetCodec extends _ObjectCodec__WEBPACK_IMPORTED_MODULE_0__.A{constructor(){super(new _view_style_Stylesheet__WEBPACK_IMPORTED_MODULE_1__.n)}encode(t,e){const i=t.document.createElement(this.getName());for(const s in e.styles){const n=e.styles[s],l=t.document.createElement("add");if(null!=s){l.setAttribute("as",s);for(const e in n){const i=this.getStringValue(e,n[e]);if(null!=i){const s=t.document.createElement("add");s.setAttribute("value",i),s.setAttribute("as",e),l.appendChild(s)}}l.childNodes.length>0&&i.appendChild(l)}}return i}getStringValue(t,e){const i=typeof e;return"function"===i?e=_view_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_2__.A.getName(e):"object"===i&&(e=null),e}decode(dec,_node,into){const obj=into||new this.template.constructor,id=_node.getAttribute("id");null!=id&&(dec.objects[id]=obj);let node=_node.firstChild;for(;null!=node;){if(!this.processInclude(dec,node,obj)&&"add"===node.nodeName){const as=node.getAttribute("as");if(null!=as){const extend=node.getAttribute("extend");let style=null!=extend?(0,_util_cloneUtils__WEBPACK_IMPORTED_MODULE_3__.clone)(obj.styles[extend]):null;null==style&&(null!=extend&&_util_config__WEBPACK_IMPORTED_MODULE_4__.eo.logger.warn(`StylesheetCodec.decode: stylesheet ${extend} not found to extend`),style={});let entry=node.firstChild;for(;null!=entry;){if(entry.nodeType===_util_Constants__WEBPACK_IMPORTED_MODULE_5__.NODETYPE.ELEMENT){const key=entry.getAttribute("as");if("add"===entry.nodeName){const text=(0,_util_domUtils__WEBPACK_IMPORTED_MODULE_6__.getTextContent)(entry);let value=null;null!=text&&text.length>0&&StylesheetCodec.allowEval?value=eval(text):(value=entry.getAttribute("value"),(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_7__.isNumeric)(value)&&(value=parseFloat(value))),null!=value&&(style[key]=value)}else"remove"===entry.nodeName&&delete style[key]}entry=entry.nextSibling}obj.putCellStyle(as,style)}}node=node.nextSibling}return obj}}StylesheetCodec.allowEval=!0},1523:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{f:()=>EditorToolbarCodec});var _ObjectCodec__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(3456),_editor_EditorToolbar__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(1244),_util_Constants__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(1532),_util_config__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(9639),_util_styleUtils__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(9155),_util_EventUtils__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(5524),_view_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7620),_util_domUtils__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(4532),_util_Translations__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2593);class EditorToolbarCodec extends _ObjectCodec__WEBPACK_IMPORTED_MODULE_0__.A{constructor(){super(new _editor_EditorToolbar__WEBPACK_IMPORTED_MODULE_1__.t)}encode(t,e){return null}decode(dec,_node,into){if(null!=into){const editor=into.editor;let node=_node.firstChild;for(;null!=node;){if(node.nodeType===_util_Constants__WEBPACK_IMPORTED_MODULE_2__.NODETYPE.ELEMENT&&!this.processInclude(dec,node,into))if("separator"===node.nodeName)into.addSeparator();else if("br"===node.nodeName)into.toolbar.addBreak();else if("hr"===node.nodeName)into.toolbar.addLine();else if("add"===node.nodeName){let as=node.getAttribute("as");as=_util_Translations__WEBPACK_IMPORTED_MODULE_3__.A.get(as)||as;const icon=node.getAttribute("icon"),pressedIcon=node.getAttribute("pressedIcon"),action=node.getAttribute("action"),mode=node.getAttribute("mode"),template=node.getAttribute("template"),toggle="0"!=node.getAttribute("toggle"),text=(0,_util_domUtils__WEBPACK_IMPORTED_MODULE_4__.getTextContent)(node);let elt=null,funct;if(null!=action)elt=into.addItem(as,icon,action,pressedIcon);else if(null!=mode)funct=EditorToolbarCodec.allowEval?eval(text):null,elt=into.addMode(as,icon,mode,pressedIcon,funct);else if(null!=template||null!=text&&text.length>0){let cell=template?editor.templates[template]:null;const style=node.getAttribute("style");null!=cell&&null!=style&&(cell=editor.graph.cloneCell(cell),cell.setStyle(style));let insertFunction=null;null!=text&&text.length>0&&EditorToolbarCodec.allowEval&&(insertFunction=eval(text)),elt=into.addPrototype(as,icon,cell,pressedIcon,insertFunction,toggle)}else{const t=(0,_util_domUtils__WEBPACK_IMPORTED_MODULE_4__.getChildNodes)(node);if(t.length>0)if(null==icon){const e=into.addActionCombo(as);for(let i=0;i<t.length;i+=1){const s=t[i];if("separator"===s.nodeName)into.addOption(e,"---");else if("add"===s.nodeName){const t=s.getAttribute("as"),i=s.getAttribute("action");into.addActionOption(e,t,i)}}}else{const e=into.addCombo(),i=()=>{const t=editor.templates[e.value];if(null!=t){const i=t.clone(),s=e.options[e.selectedIndex].cellStyle;return null!=s&&i.setStyle(s),i}return _util_config__WEBPACK_IMPORTED_MODULE_5__.eo.logger.warn(`Template ${t} not found`),null},s=into.addPrototype(as,icon,i,null,null,toggle);_view_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"change",(()=>{into.toolbar.selectMode(s,(t=>{const e=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_7__.convertPoint)(editor.graph.container,(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_8__.getClientX)(t),(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_8__.getClientY)(t));return editor.addVertex(null,funct(),e.x,e.y)})),into.toolbar.noReset=!1}));for(let i=0;i<t.length;i+=1){const s=t[i];if("separator"===s.nodeName)into.addOption(e,"---");else if("add"===s.nodeName){const t=s.getAttribute("as"),i=s.getAttribute("template"),n=into.addOption(e,t,i||template);n.cellStyle=s.getAttribute("style")}}}}if(null!=elt){const t=node.getAttribute("id");null!=t&&t.length>0&&elt.setAttribute("id",t)}}node=node.nextSibling}}return into}}},1532:(t,e,i)=>{i.r(e),i.d(e,{ABSOLUTE_LINE_HEIGHT:()=>et,ALIGN:()=>yt,ARROW:()=>ft,ARROW_SIZE:()=>ct,ARROW_SPACING:()=>ht,ARROW_WIDTH:()=>dt,CONNECT_HANDLE_FILLCOLOR:()=>Y,CONNECT_TARGET_COLOR:()=>x,CURSOR:()=>S,DEFAULT_FONTFAMILY:()=>j,DEFAULT_FONTSIZE:()=>Z,DEFAULT_FONTSTYLE:()=>it,DEFAULT_HOTSPOT:()=>s,DEFAULT_IMAGESIZE:()=>lt,DEFAULT_INVALID_COLOR:()=>f,DEFAULT_MARKERSIZE:()=>nt,DEFAULT_STARTSIZE:()=>st,DEFAULT_TEXT_DIRECTION:()=>J,DEFAULT_VALID_COLOR:()=>m,DIALECT:()=>a,DIRECTION:()=>vt,DIRECTION_MASK:()=>_t,DROP_TARGET_COLOR:()=>M,EDGESTYLE:()=>St,EDGE_SELECTION_COLOR:()=>O,EDGE_SELECTION_DASHED:()=>H,EDGE_SELECTION_STROKEWIDTH:()=>D,ELBOW:()=>bt,ENTITY_SEGMENT:()=>rt,FONT:()=>mt,GUIDE_COLOR:()=>k,GUIDE_STROKEWIDTH:()=>U,HANDLE_FILLCOLOR:()=>z,HANDLE_SIZE:()=>G,HANDLE_STROKECOLOR:()=>W,HIGHLIGHT_COLOR:()=>w,HIGHLIGHT_OPACITY:()=>b,HIGHLIGHT_SIZE:()=>_,HIGHLIGHT_STROKEWIDTH:()=>A,IDENTITY_FIELD_NAME:()=>o,INVALID_COLOR:()=>I,INVALID_CONNECT_TARGET_COLOR:()=>T,LABEL_HANDLE_FILLCOLOR:()=>X,LABEL_HANDLE_SIZE:()=>F,LINE_ARCSIZE:()=>ot,LINE_HEIGHT:()=>Q,LOCKED_HANDLE_FILLCOLOR:()=>K,MAX_HOTSPOT_SIZE:()=>l,MIN_HOTSPOT_SIZE:()=>n,NODETYPE:()=>E,NONE:()=>Ct,NS_SVG:()=>h,NS_XLINK:()=>d,OUTLINE_COLOR:()=>V,OUTLINE_HANDLE_FILLCOLOR:()=>$,OUTLINE_HANDLE_STROKECOLOR:()=>q,OUTLINE_HIGHLIGHT_COLOR:()=>y,OUTLINE_HIGHLIGHT_STROKEWIDTH:()=>v,OUTLINE_STROKEWIDTH:()=>B,PAGE_FORMAT_A4_LANDSCAPE:()=>gt,PAGE_FORMAT_A4_PORTRAIT:()=>ut,PAGE_FORMAT_LETTER_LANDSCAPE:()=>Et,PAGE_FORMAT_LETTER_PORTRAIT:()=>pt,PERIMETER:()=>wt,RECTANGLE_ROUNDING_FACTOR:()=>at,RENDERING_HINT:()=>r,SHADOWCOLOR:()=>c,SHADOW_OFFSET_X:()=>u,SHADOW_OFFSET_Y:()=>g,SHADOW_OPACITY:()=>p,SHAPE:()=>xt,TEXT_DIRECTION:()=>At,TOOLTIP_VERTICAL_OFFSET:()=>C,VALID_COLOR:()=>P,VERTEX_SELECTION_COLOR:()=>L,VERTEX_SELECTION_DASHED:()=>N,VERTEX_SELECTION_STROKEWIDTH:()=>R,WORD_WRAP:()=>tt});const s=.3,n=8,l=0;var r,a;!function(t){t.EXACT="exact",t.FASTER="faster",t.FASTEST="fastest"}(r||(r={})),function(t){t.SVG="svg",t.MIXEDHTML="mixedHtml",t.PREFERHTML="preferHtml",t.STRICTHTML="strictHtml"}(a||(a={}));const o="mxObjectId",h="http://www.w3.org/2000/svg",d="http://www.w3.org/1999/xlink",c="gray",u=2,g=3,p=1;var E;!function(t){t[t.ELEMENT=1]="ELEMENT",t[t.ATTRIBUTE=2]="ATTRIBUTE",t[t.TEXT=3]="TEXT",t[t.CDATA=4]="CDATA",t[t.ENTITY_REFERENCE=5]="ENTITY_REFERENCE",t[t.ENTITY=6]="ENTITY",t[t.PROCESSING_INSTRUCTION=7]="PROCESSING_INSTRUCTION",t[t.COMMENT=8]="COMMENT",t[t.DOCUMENT=9]="DOCUMENT",t[t.DOCUMENTTYPE=10]="DOCUMENTTYPE",t[t.DOCUMENT_FRAGMENT=11]="DOCUMENT_FRAGMENT",t[t.NOTATION=12]="NOTATION"}(E||(E={}));const C=16,m="#00FF00",f="#FF0000",y="#00FF00",v=5,A=3,_=2,b=100;var S;!function(t){t.MOVABLE_VERTEX="move",t.MOVABLE_EDGE="move",t.LABEL_HANDLE="default",t.TERMINAL_HANDLE="pointer",t.BEND_HANDLE="crosshair",t.VIRTUAL_BEND_HANDLE="crosshair",t.CONNECT="pointer"}(S||(S={}));const w="#00FF00",x="#0000FF",T="#FF0000",M="#0000FF",P="#00FF00",I="#FF0000",O="#00FF00",L="#00FF00",R=1,D=1,N=!0,H=!0,k="#FF0000",U=1,V="#0099FF",B=3,G=6,F=4,z="#00FF00",W="black",X="yellow",Y="#0000FF",K="#FF0000",$="#00FFFF",q="#0033FF",j="Arial,Helvetica",Z=11,J="",Q=1.2,tt="normal",et=!1,it=0,st=40,nt=6,lt=24,rt=30,at=.15,ot=20,ht=0,dt=30,ct=30,ut=[0,0,827,1169],gt=[0,0,1169,827],pt=[0,0,850,1100],Et=[0,0,1100,850],Ct="none";var mt,ft,yt,vt,At;!function(t){t[t.BOLD=1]="BOLD",t[t.ITALIC=2]="ITALIC",t[t.UNDERLINE=4]="UNDERLINE",t[t.STRIKETHROUGH=8]="STRIKETHROUGH"}(mt||(mt={})),function(t){t.CLASSIC="classic",t.CLASSIC_THIN="classicThin",t.BLOCK="block",t.BLOCK_THIN="blockThin",t.OPEN="open",t.OPEN_THIN="openThin",t.OVAL="oval",t.DIAMOND="diamond",t.DIAMOND_THIN="diamondThin"}(ft||(ft={})),function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom"}(yt||(yt={})),function(t){t.NORTH="north",t.SOUTH="south",t.EAST="east",t.WEST="west"}(vt||(vt={})),function(t){t.DEFAULT="",t.AUTO="auto",t.LTR="ltr",t.RTL="rtl"}(At||(At={}));const _t={NONE:0,WEST:1,NORTH:2,SOUTH:4,EAST:8,ALL:15};var bt,St,wt,xt;!function(t){t.VERTICAL="vertical",t.HORIZONTAL="horizontal"}(bt||(bt={})),function(t){t.ELBOW="elbowEdgeStyle",t.ENTITY_RELATION="entityRelationEdgeStyle",t.LOOP="loopEdgeStyle",t.SIDETOSIDE="sideToSideEdgeStyle",t.TOPTOBOTTOM="topToBottomEdgeStyle",t.ORTHOGONAL="orthogonalEdgeStyle",t.SEGMENT="segmentEdgeStyle",t.MANHATTAN="manhattanEdgeStyle"}(St||(St={})),function(t){t.ELLIPSE="ellipsePerimeter",t.RECTANGLE="rectanglePerimeter",t.RHOMBUS="rhombusPerimeter",t.HEXAGON="hexagonPerimeter",t.TRIANGLE="trianglePerimeter"}(wt||(wt={})),function(t){t.RECTANGLE="rectangle",t.ELLIPSE="ellipse",t.DOUBLE_ELLIPSE="doubleEllipse",t.RHOMBUS="rhombus",t.LINE="line",t.IMAGE="image",t.ARROW="arrow",t.ARROW_CONNECTOR="arrowConnector",t.LABEL="label",t.CYLINDER="cylinder",t.SWIMLANE="swimlane",t.CONNECTOR="connector",t.ACTOR="actor",t.CLOUD="cloud",t.TRIANGLE="triangle",t.HEXAGON="hexagon"}(xt||(xt={}))},5525:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(6232);const n=class{constructor(){this.map={},this.clear()}clear(){this.map={}}get(t){const e=s.A.get(t);return this.map[e]??null}put(t,e){const i=s.A.get(t),n=this.map[i];return this.map[i]=e,n??null}remove(t){const e=s.A.get(t),i=this.map[e];return delete this.map[e],i??null}getKeys(){const t=[];for(const e in this.map)t.push(e);return t}getValues(){const t=[];for(const e in this.map)t.push(this.map[e]);return t}visit(t){for(const e in this.map)t(e,this.map[e])}}},5524:(t,e,i)=>{i.r(e),i.d(e,{getClientX:()=>l,getClientY:()=>r,getMainEvent:()=>n,getSource:()=>a,isAltDown:()=>f,isConsumed:()=>o,isControlDown:()=>y,isLeftMouseButton:()=>g,isMetaDown:()=>v,isMiddleMouseButton:()=>p,isMouseEvent:()=>u,isMultiTouchEvent:()=>c,isPenEvent:()=>d,isPopupTrigger:()=>C,isRightMouseButton:()=>E,isShiftDown:()=>m,isTouchEvent:()=>h});var s=i(7773);const n=t=>{let e=t;return("touchstart"===e.type||"touchmove"===e.type)&&e.touches&&e.touches[0]?e=e.touches[0]:"touchend"===e.type&&e.changedTouches&&e.changedTouches[0]&&(e=e.changedTouches[0]),e},l=t=>n(t).clientX,r=t=>n(t).clientY,a=t=>t.target,o=t=>{const e=t;return void 0!==e.isConsumed&&e.isConsumed},h=t=>{const e=t;return e.pointerType?"touch"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH:void 0!==e.mozInputSource?5===e.mozInputSource:0===e.type.indexOf("touch")},d=t=>{const e=t;return e.pointerType?"pen"==e.pointerType||e.pointerType===e.MSPOINTER_TYPE_PEN:void 0!==e.mozInputSource?2===e.mozInputSource:0===e.type.indexOf("pen")},c=t=>{const e=t;return e.type&&0==e.type.indexOf("touch")&&void 0!==e.touches&&e.touches.length>1},u=t=>{const e=t;return e.pointerType?"mouse"==e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE:void 0!==e.mozInputSource?1===e.mozInputSource:0===e.type.indexOf("mouse")},g=t=>!("buttons"in t)||"mousedown"!==t.type&&"mousemove"!==t.type?void 0!==t.which?1===t.which:1===t.button:1===t.buttons,p=t=>4===t.button,E=t=>2===t.button,C=t=>E(t)||s.A.IS_MAC&&y(t)&&!m(t)&&!v(t)&&!f(t),m=t=>t.shiftKey,f=t=>t.altKey,y=t=>t.ctrlKey,v=t=>t.metaKey},5673:(t,e,i)=>{i.d(e,{Ay:()=>d,Hh:()=>l,Jt:()=>r,UK:()=>a,bE:()=>o,tA:()=>h});var s=i(4532);class n{constructor(t,e=null,i="POST",s=!0,n=null,l=null){this.binary=!1,this.withCredentials=!1,this.request=null,this.decodeSimulateValues=!1,this.url=t,this.params=e,this.method=i||"POST",this.async=s,this.username=n,this.password=l}isBinary(){return this.binary}setBinary(t){this.binary=t}getText(){return this.request.responseText}isReady(){return 4===this.request.readyState}getDocumentElement(){const t=this.getXml();return null!=t?t.documentElement:null}getXml(){let t=this.request.responseXML;return null!=t&&null!=t.documentElement||(t=(new DOMParser).parseFromString(this.request.responseText,"text/xml")),t}getStatus(){return null!=this.request?this.request.status:null}create(){const t=new XMLHttpRequest;return this.isBinary()&&t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),t}send(t=null,e=null,i=null,s=null){this.request=this.create(),null!=this.request&&(null!=t&&(this.request.onreadystatechange=()=>{this.isReady()&&(t(this),this.request.onreadystatechange=null)}),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),window.XMLHttpRequest&&null!=i&&null!=s&&(this.request.timeout=i,this.request.ontimeout=s),this.request.send(this.params))}setRequestHeaders(t,e){null!=e&&t.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}simulate(t,e=null){let i=null;(t=t||document)===document&&(i=window.onbeforeunload,window.onbeforeunload=null);const n=t.createElement("form");n.setAttribute("method",this.method),n.setAttribute("action",this.url),null!=e&&n.setAttribute("target",e),n.style.display="none",n.style.visibility="hidden";const l=this.params,r=l.indexOf("&")>0?l.split("&"):l.split(" ");for(let e=0;e<r.length;e+=1){const i=r[e].indexOf("=");if(i>0){const l=r[e].substring(0,i);let a=r[e].substring(i+1);this.decodeSimulateValues&&(a=decodeURIComponent(a));const o=t.createElement("textarea");o.setAttribute("wrap","off"),o.setAttribute("name",l),(0,s.write)(o,a),n.appendChild(o)}}t.body.appendChild(n),n.submit(),null!=n.parentNode&&n.parentNode.removeChild(n),null!=i&&(window.onbeforeunload=i)}}const l=t=>{const e=new n(t,null,"GET",!1);return e.send(),e},r=(t,e=null,i=null,s=!1,l=null,r=null,a=null)=>{const o=new n(t,null,"GET"),{setRequestHeaders:h}=o;return a&&(o.setRequestHeaders=(t,e)=>{h.apply(void 0,[t,e]);for(const e in a)t.setRequestHeader(e,a[e])}),null!=s&&o.setBinary(s),o.send(e,i,l,r),o},a=(t,e,i)=>{let s=t.length;const n=[];let l=0;const a=()=>{0==l&&null!=i&&i(),l++};for(let i=0;i<t.length;i+=1)((t,i)=>{r(t,(t=>{const l=t.getStatus();l<200||l>299?a():(n[i]=t,s--,0==s&&e(n))}),a)})(t[i],i);0==s&&e(n)},o=(t,e=null,i,s=null)=>new n(t,e).send(i,s),h=(t,e,i,s)=>new n(t,e).simulate(i,s),d=n},6232:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(1532),n=i(3215);class l{static get(t){if(t){if(null===t[s.IDENTITY_FIELD_NAME]||void 0===t[s.IDENTITY_FIELD_NAME])if("object"==typeof t){const e=(0,n.getFunctionName)(t.constructor);t[s.IDENTITY_FIELD_NAME]=`${e}#${l.counter++}`}else"function"==typeof t&&(t[s.IDENTITY_FIELD_NAME]="Function#"+l.counter++);return t[s.IDENTITY_FIELD_NAME]}return null}static clear(t){delete t[s.IDENTITY_FIELD_NAME]}}l.FIELD_NAME=s.IDENTITY_FIELD_NAME,l.counter=0;const r=l},3215:(t,e,i)=>{i.r(e),i.d(e,{getColor:()=>p,getFunctionName:()=>o,getNumber:()=>g,getStringValue:()=>u,htmlEntities:()=>c,ltrim:()=>l,removeWhitespace:()=>d,replaceTrailingNewlines:()=>h,rtrim:()=>r,toString:()=>E,trim:()=>a});var s=i(1532),n=i(4532);const l=(t,e="\\s")=>null!=t?t.replace(new RegExp(`^[${e}]+`,"g"),""):null,r=(t,e="\\s")=>null!=t?t.replace(new RegExp(`[${e}]+$`,"g"),""):null,a=(t,e)=>l(r(t,e),e),o=t=>{let e=null;if(null!=t)if(null!=t.name)e=t.name;else if(e=a(t.toString()),null!==e&&/^function\s/.test(e)&&(e=l(e.substring(9)),null!==e)){const t=e.indexOf("(");t>0&&(e=e.substring(0,t))}return e},h=(t,e)=>{let i="";for(;t.length>0&&"\n"==t.charAt(t.length-1);)t=t.substring(0,t.length-1),i+=e;return t+i},d=(t,e)=>{let i=e?t.previousSibling:t.nextSibling;for(;null!=i&&i.nodeType===s.NODETYPE.TEXT;){const t=e?i.previousSibling:i.nextSibling,s=(0,n.getTextContent)(i);0===a(s)?.length&&i.parentNode?.removeChild(i),i=t}},c=(t,e=!0)=>(t=(t=(t=(t=(t=(t=String(t||"")).replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#39;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e&&(t=t.replace(/\n/g,"&#xa;")),t),u=(t,e,i)=>{let s=null!=t?t[e]:null;return null==s&&(s=i),null==s?null:String(s)},g=(t,e,i)=>{let s=null!=t?t[e]:null;return null==s&&(s=i||0),Number(s)},p=(t,e,i)=>{let n=null!=t?t[e]:null;return null==n?n=i:n===s.NONE&&(n=null),n},E=t=>{let e="";for(const i in t)try{null==t[i]?e+=`${i} = [null]\n`:"function"==typeof t[i]?e+=`${i} => [Function]\n`:"object"==typeof t[i]?e+=`${i} => [${o(t[i].constructor)}]\n`:e+=`${i} = ${t[i]}\n`}catch(t){e+=`${i}=${t.message}`}return e}},2593:(t,e,i)=>{i.d(e,{A:()=>a});var s=i(7773),n=i(1532),l=i(5673);class r{}r.resources={},r.extension=".txt",r.resourcesEncoded=!1,r.loadDefaultBundle=!0,r.loadSpecialBundle=!0,r.isLanguageSupported=t=>null==s.A.languages||s.A.languages.indexOf(t)>=0,r.getDefaultBundle=(t,e)=>r.loadDefaultBundle||!r.isLanguageSupported(e)?t+r.extension:null,r.getSpecialBundle=(t,e)=>{if(null==s.A.languages||!r.isLanguageSupported(e)){const t=e.indexOf("-");t>0&&(e=e.substring(0,t))}return r.loadSpecialBundle&&r.isLanguageSupported(e)&&e!=s.A.defaultLanguage?`${t}_${e}${r.extension}`:null},r.add=(t,e=null,i=null)=>{if((e=null!=e?e:null!=s.A.language?s.A.language.toLowerCase():n.NONE)!==n.NONE){const s=r.getDefaultBundle(t,e),n=r.getSpecialBundle(t,e),a=()=>{if(null!=n)if(i)(0,l.Jt)(n,(t=>{r.parse(t.getText()),i()}),(()=>{i()}));else try{const t=(0,l.Hh)(n);t.isReady()&&r.parse(t.getText())}catch(t){}else null!=i&&i()};if(null!=s)if(i)(0,l.Jt)(s,(t=>{r.parse(t.getText()),a()}),(()=>{a()}));else try{const t=(0,l.Hh)(s);t.isReady()&&r.parse(t.getText()),a()}catch(t){}else a()}},r.parse=t=>{if(null!=t){const e=t.split("\n");for(let t=0;t<e.length;t+=1)if("#"!==e[t].charAt(0)){const i=e[t].indexOf("=");if(i>0){const s=e[t].substring(0,i);let n=e[t].length;13===e[t].charCodeAt(n-1)&&n--;let l=e[t].substring(i+1,n);r.resourcesEncoded?(l=l.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),r.resources[s]=unescape(l)):r.resources[s]=l}}}},r.get=(t,e=null,i=null)=>{let s=r.resources[t];return null==s&&(s=i),null!=s&&null!=e&&(s=r.replacePlaceholders(s,e)),s},r.replacePlaceholders=(t,e)=>{const i=[];let s=null;for(let n=0;n<t.length;n+=1){const l=t.charAt(n);"{"===l?s="":null!=s&&"}"===l?(s=parseInt(s)-1,s>=0&&s<e.length&&i.push(e[s]),s=null):null!=s?s+=l:i.push(l)}return i.join("")},r.loadResources=t=>{r.add(`${s.A.basePath}/resources/editor`,null,(()=>{r.add(`${s.A.basePath}/resources/graph`,null,t)}))};const a=r},6126:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(){this.enabled=!0,this.baseUrl=null,this.baseDomain=null}updateBaseUrl(){this.baseDomain=`${location.protocol}//${location.host}`,this.baseUrl=this.baseDomain+location.pathname;const t=this.baseUrl.lastIndexOf("/");t>0&&(this.baseUrl=this.baseUrl.substring(0,t+1))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getBaseUrl(){return this.baseUrl}setBaseUrl(t){this.baseUrl=t}getBaseDomain(){return this.baseDomain}setBaseDomain(t){this.baseDomain=t}isRelativeUrl(t){return t&&"//"!==t.substring(0,2)&&"http://"!==t.substring(0,7)&&"https://"!==t.substring(0,8)&&"data:image"!==t.substring(0,10)&&"file://"!==t.substring(0,7)}convert(t){return this.isEnabled()&&this.isRelativeUrl(t)&&(this.getBaseUrl()||this.updateBaseUrl(),t="/"===t.charAt(0)?this.getBaseDomain()+t:this.getBaseUrl()+t),t}}},6960:(t,e,i)=>{i.r(e),i.d(e,{copyTextToClipboard:()=>d,getElapseMillisecondsMessage:()=>u,getValue:()=>h,isNotNullish:()=>a,isNullish:()=>r,mixInto:()=>o,utils:()=>l});var s=i(7773),n=i(9639);const l={errorResource:"error",closeResource:"close",errorImage:`${s.A.imageBasePath}/error.gif`},r=t=>null==t,a=t=>!r(t),o=t=>e=>{const i=Reflect.ownKeys(e);try{for(const s of i)Object.defineProperty(t.prototype,s,{value:e[s],writable:!0})}catch(t){n.eo.logger.error("Error while mixing",t)}},h=(t,e,i)=>{let s=null!=t?t[e]:null;return null==s&&(s=i),s},d=t=>{navigator.clipboard?navigator.clipboard.writeText(t).then((function(){n.eo.logger.info("Async: Copying to clipboard was successful!")}),(function(t){n.eo.logger.error("Async: Could not copy text: ",t)})):c(t)},c=t=>{const e=document.createElement("textarea");e.value=t,e.style.top="0",e.style.left="0",e.style.position="fixed",document.body.appendChild(e),e.focus(),e.select();try{const t=document.execCommand("copy")?"successful":"unsuccessful";n.eo.logger.info(`Fallback: Copying text command was ${t}`)}catch(t){n.eo.logger.error("Fallback: Oops, unable to copy",t)}document.body.removeChild(e)},u=t=>t?` (${(new Date).getTime()-t} ms)`:""},1847:(t,e,i)=>{i.d(e,{FG:()=>r,R3:()=>a,TF:()=>n,s7:()=>l});var s=i(5525);const n=(t,e)=>{let i=null;if("object"==typeof e){let s=e.indexOf(t);for(;s>=0;)e.splice(s,1),i=t,s=e.indexOf(t)}for(const s in e)e[s]==t&&(delete e[s],i=t);return i},l=(t,e)=>{if(!t&&e||t&&!e||t&&e&&t.length!=e.length)return!1;if(t&&e)for(let i=0;i<t.length;i+=1){const s=t[i];if(!s||s&&!s.equals(e[i]))return!1}return!0},r=(t,e)=>{let i=0;if(!t&&e||t&&!e||t&&e&&t.length!=e.length)return!1;if(t&&e){for(const t in e)i++;for(const s in t)if(i--,!(Number.isNaN(t[s])&&Number.isNaN(e[s])||t[s]===e[s]))return!1}return 0===i},a=t=>{const e=new s.A,i=[];for(let s=0;s<t.length;s+=1)e.get(t[s])||(i.push(t[s]),e.put(t[s],!0));return i}},8291:(t,e,i)=>{i.r(e),i.d(e,{clone:()=>n,shallowCopy:()=>l});var s=i(6232);const n=function t(e,i=null,n=!1){n=null!=n&&n;let l=null;if(null!=e&&"function"==typeof e.constructor){l=new e.constructor;for(const r in e)r!=s.A.FIELD_NAME&&(null==i||i.indexOf(r)<0)&&(n||"object"!=typeof e[r]?l[r]=e[r]:l[r]=t(e[r]))}return l},l=(t,e)=>{for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}},9639:(t,e,i)=>{i.d(e,{Nu:()=>h,eo:()=>r,m5:()=>a});var s=i(5981),n=i(1532),l=i(8291);const r={logger:new s.N},a={shadowColor:n.SHADOWCOLOR,shadowOffsetX:n.SHADOW_OFFSET_X,shadowOffsetY:n.SHADOW_OFFSET_Y,shadowOpacity:n.SHADOW_OPACITY},o={...a},h=()=>{(0,l.shallowCopy)(o,a)}},4532:(t,e,i)=>{i.r(e),i.d(e,{addLinkToHead:()=>v,br:()=>c,clearSelection:()=>f,createImage:()=>y,extractTextWithWhitespace:()=>n,getChildNodes:()=>E,getInnerHtml:()=>a,getOuterHtml:()=>o,getTextContent:()=>l,importNode:()=>C,importNodeImplementation:()=>m,isAncestorNode:()=>p,isNode:()=>g,para:()=>u,setTextContent:()=>r,write:()=>h,writeln:()=>d});var s=i(1532);const n=t=>{const e=["BLOCKQUOTE","DIV","H1","H2","H3","H4","H5","H6","OL","P","PRE","TABLE","UL"],i=[];return function t(s){if(1!=s.length||"BR"!=s[0].nodeName&&"\n"!=s[0].innerHTML)for(let n=0;n<s.length;n+=1){const l=s[n];"BR"==l.nodeName||"\n"==l.innerHTML||(1==s.length||0==n)&&"DIV"==l.nodeName&&"<br>"==l.innerHTML.toLowerCase()?i.push("\n"):(3===l.nodeType||4===l.nodeType?l.nodeValue&&l.nodeValue.length>0&&i.push(l.nodeValue):8!==l.nodeType&&l.childNodes.length>0&&t(Array.from(l.childNodes)),n<s.length-1&&e.indexOf(s[n+1].nodeName)>=0&&i.push("\n"))}}(t),i.join("")},l=t=>null!=t&&t.textContent?t.textContent:"",r=(t,e)=>{"innerText"in t?t.innerText=e:t.textContent=e},a=t=>null!=t?(new XMLSerializer).serializeToString(t):"",o=t=>null!=t?(new XMLSerializer).serializeToString(t):"",h=(t,e)=>{const i=t.ownerDocument.createTextNode(e);return null!=t&&t.appendChild(i),i},d=(t,e)=>{const i=t.ownerDocument.createTextNode(e);return null!=t&&(t.appendChild(i),t.appendChild(document.createElement("br"))),i},c=(t,e=1)=>{let i=null;for(let s=0;s<e;s+=1)null!=t&&(i=t.ownerDocument.createElement("br"),t.appendChild(i));return i},u=(t,e)=>{const i=document.createElement("p");return h(i,e),null!=t&&t.appendChild(i),i},g=(t,e=null,i,s)=>!(null==t||isNaN(t.nodeType)||null!=e&&t.nodeName.toLowerCase()!=e.toLowerCase()||null!=i&&t.getAttribute(i)!=s),p=(t,e)=>{let i=e;for(;null!=i;){if(i===t)return!0;i=i.parentNode}return!1},E=(t,e=s.NODETYPE.ELEMENT)=>{e=e||s.NODETYPE.ELEMENT;const i=[];let n=t.firstChild;for(;null!=n;)n.nodeType===e&&i.push(n),n=n.nextSibling;return i},C=(t,e,i)=>t.importNode(e,i),m=(t,e,i)=>{switch(e.nodeType){case 1:{const s=t.createElement(e.nodeName);if(e.attributes&&e.attributes.length>0)for(let t=0;t<e.attributes.length;t+=1)s.setAttribute(e.attributes[t].nodeName,e.getAttribute(e.attributes[t].nodeName));if(i&&e.childNodes&&e.childNodes.length>0)for(let n=0;n<e.childNodes.length;n+=1)s.appendChild(m(t,e.childNodes[n],i));return s}case 3:case 4:case 8:return t.createTextNode(e.nodeValue||"")}},f=()=>{const t=window.getSelection?window.getSelection():document.selection;t&&(t.removeAllRanges?t.removeAllRanges():t.empty&&t.empty())},y=t=>{let e=null;return e=document.createElement("img"),e.setAttribute("src",t),e.setAttribute("border","0"),e},v=(t,e,i=null,s=null)=>{const n=(i=i||document).createElement("link");n.setAttribute("rel",t),n.setAttribute("href",e),n.setAttribute("charset","UTF-8"),n.setAttribute("type","text/css"),s&&n.setAttribute("id",s),i.getElementsByTagName("head")[0].appendChild(n)}},5309:(t,e,i)=>{i.r(e),i.d(e,{makeDraggable:()=>r});var s=i(3538),n=i(9447),l=i(1532);const r=(t,e,i,r=null,a=null,o=null,h=null,d=!1,c=!0,u=null)=>{const g=new s.A(t,i);return g.dragOffset=new n.A(null!=a?a:0,null!=o?o:l.TOOLTIP_VERTICAL_OFFSET),null!=h&&(g.autoscroll=h),g.setGuidesEnabled(!1),null!=c&&(g.highlightDropTargets=c),null!=u&&(g.getDropTarget=u),g.getGraphForEvent=t=>"function"==typeof e?e(t):e,null!=r&&(g.createDragElement=()=>r.cloneNode(!0),d&&(g.createPreviewElement=t=>{const e=r.cloneNode(!0),i=parseInt(e.style.width),s=parseInt(e.style.height);return e.style.width=`${Math.round(i*t.view.scale)}px`,e.style.height=`${Math.round(s*t.view.scale)}px`,e})),g}},5981:(t,e,i)=>{i.d(e,{C:()=>l,N:()=>n});var s=i(6960);class n{debug(t){}enter(t){}error(t,...e){}info(t){}leave(t,e){}show(){}trace(t){}warn(t){}}class l{constructor(){this.debugEnabled=!1,this.infoEnabled=!1,this.traceEnabled=!1}enter(t){if(this.traceEnabled)return console.trace(`Entering ${t}`),(new Date).getTime()}leave(t,e){if(this.traceEnabled){const i=(0,s.getElapseMillisecondsMessage)(e);console.trace(`Leaving ${t}${i}`)}}show(){}trace(t){this.traceEnabled&&console.trace(t)}debug(t){this.debugEnabled&&console.debug(t)}info(t){this.infoEnabled&&console.info(t)}warn(t){console.warn(t)}error(t,...e){console.error(t,...e)}}},3514:(t,e,i)=>{i.r(e),i.d(e,{arcToCurves:()=>h,contains:()=>f,findNearestSegment:()=>p,getBoundingBox:()=>d,getDirectedBounds:()=>E,getPerimeterPoint:()=>C,getPortConstraints:()=>u,getRotatedPoint:()=>c,intersection:()=>S,intersects:()=>y,intersectsHotspot:()=>v,isInteger:()=>_,isNumeric:()=>A,mod:()=>b,ptLineDist:()=>x,ptSegDistSq:()=>w,rectangleIntersectsSegment:()=>m,relativeCcw:()=>T,reversePortConstraints:()=>g,toDegree:()=>o,toRadians:()=>a});var s=i(1532),n=i(9447),l=i(1508),r=i(6960);const a=t=>Math.PI*t/180,o=t=>180*t/Math.PI,h=(t,e,i,s,n,l,r,a,o)=>{if(a-=t,o-=e,0===i||0===s)return[];const h=r,d=n;i=Math.abs(i),s=Math.abs(s);const c=-a/2,u=-o/2,g=Math.cos(d*Math.PI/180),p=Math.sin(d*Math.PI/180),E=g*c+p*u,C=-1*p*c+g*u,m=E*E,f=C*C,y=i*i,v=s*s,A=m/y+f/v;let _;if(A>1)i=Math.sqrt(A)*i,s=Math.sqrt(A)*s,_=0;else{let t=1;l===h&&(t=-1),_=t*Math.sqrt((y*v-y*f-v*m)/(y*f+v*m))}const b=_*i*C/s,S=-1*_*s*E/i,w=g*b-p*S+a/2,x=p*b+g*S+o/2;let T=Math.atan2((C-S)/s,(E-b)/i)-Math.atan2(0,1),M=T>=0?T:2*Math.PI+T;T=Math.atan2((-C-S)/s,(-E-b)/i)-Math.atan2((C-S)/s,(E-b)/i);let P=T>=0?T:2*Math.PI+T;!h&&P>0?P-=2*Math.PI:h&&P<0&&(P+=2*Math.PI);const I=2*P/Math.PI,O=Math.ceil(I<0?-1*I:I),L=P/O,R=8/3*Math.sin(L/4)*Math.sin(L/4)/Math.sin(L/2),D=g*i,N=g*s,H=p*i,k=p*s;let U=Math.cos(M),V=Math.sin(M),B=-R*(D*V+k*U),G=-R*(H*V-N*U),F=0,z=0;const W=[];for(let i=0;i<O;++i){M+=L,U=Math.cos(M),V=Math.sin(M),F=D*U-k*V+w,z=H*U+N*V+x;const s=-R*(D*V+k*U),n=-R*(H*V-N*U),l=6*i;W[l]=Number(B+t),W[l+1]=Number(G+e),W[l+2]=Number(F-s+t),W[l+3]=Number(z-n+e),W[l+4]=Number(F+t),W[l+5]=Number(z+e),B=F+s,G=z+n}return W},d=(t,e,i=null)=>{let s=null;if(t&&0!==e){const r=a(e),o=Math.cos(r),h=Math.sin(r);i=null!=i?i:new n.A(t.x+t.width/2,t.y+t.height/2);let d=new n.A(t.x,t.y),u=new n.A(t.x+t.width,t.y),g=new n.A(u.x,t.y+t.height),p=new n.A(t.x,g.y);d=c(d,o,h,i),u=c(u,o,h,i),g=c(g,o,h,i),p=c(p,o,h,i),s=new l.A(d.x,d.y,0,0),s.add(new l.A(u.x,u.y,0,0)),s.add(new l.A(g.x,g.y,0,0)),s.add(new l.A(p.x,p.y,0,0))}return s},c=(t,e,i,s=new n.A)=>{const l=t.x-s.x,r=t.y-s.y,a=l*e-r*i,o=r*e+l*i;return new n.A(a+s.x,o+s.y)},u=(t,e,i,n)=>{const l=(0,r.getValue)(t.style,"portConstraint",(0,r.getValue)(e.style,i?"sourcePortConstraint":"targetPortConstraint",null));if((0,r.isNullish)(l))return n;const a=l.toString();let o=s.DIRECTION_MASK.NONE,h=0;t.style.portConstraintRotation&&(h=t.style.rotation??0);let d=0;if(h>45?(d=1,h>=135&&(d=2)):h<-45&&(d=3,h<=-135&&(d=2)),a.indexOf(s.DIRECTION.NORTH)>=0)switch(d){case 0:o|=s.DIRECTION_MASK.NORTH;break;case 1:o|=s.DIRECTION_MASK.EAST;break;case 2:o|=s.DIRECTION_MASK.SOUTH;break;case 3:o|=s.DIRECTION_MASK.WEST}if(a.indexOf(s.DIRECTION.WEST)>=0)switch(d){case 0:o|=s.DIRECTION_MASK.WEST;break;case 1:o|=s.DIRECTION_MASK.NORTH;break;case 2:o|=s.DIRECTION_MASK.EAST;break;case 3:o|=s.DIRECTION_MASK.SOUTH}if(a.indexOf(s.DIRECTION.SOUTH)>=0)switch(d){case 0:o|=s.DIRECTION_MASK.SOUTH;break;case 1:o|=s.DIRECTION_MASK.WEST;break;case 2:o|=s.DIRECTION_MASK.NORTH;break;case 3:o|=s.DIRECTION_MASK.EAST}if(a.indexOf(s.DIRECTION.EAST)>=0)switch(d){case 0:o|=s.DIRECTION_MASK.EAST;break;case 1:o|=s.DIRECTION_MASK.SOUTH;break;case 2:o|=s.DIRECTION_MASK.WEST;break;case 3:o|=s.DIRECTION_MASK.NORTH}return o},g=t=>{let e=0;return e=(t&s.DIRECTION_MASK.WEST)<<3,e|=(t&s.DIRECTION_MASK.NORTH)<<1,e|=(t&s.DIRECTION_MASK.SOUTH)>>1,e|=(t&s.DIRECTION_MASK.EAST)>>3,e},p=(t,e,i)=>{let s=-1;if(t.absolutePoints.length>0){let n=t.absolutePoints[0],l=null;for(let r=1;r<t.absolutePoints.length;r+=1){const a=t.absolutePoints[r];if(!n||!a)continue;const o=w(n.x,n.y,a.x,a.y,e,i);(null==l||o<l)&&(l=o,s=r-1),n=a}}return s},E=(t,e,i,n,a)=>{const o=(0,r.getValue)(i,"direction",s.DIRECTION.EAST);if(n=null!=n?n:(0,r.getValue)(i,"flipH",!1),a=null!=a?a:(0,r.getValue)(i,"flipV",!1),e.x=Math.round(Math.max(0,Math.min(t.width,e.x))),e.y=Math.round(Math.max(0,Math.min(t.height,e.y))),e.width=Math.round(Math.max(0,Math.min(t.width,e.width))),e.height=Math.round(Math.max(0,Math.min(t.height,e.height))),a&&(o===s.DIRECTION.SOUTH||o===s.DIRECTION.NORTH)||n&&(o===s.DIRECTION.EAST||o===s.DIRECTION.WEST)){const t=e.x;e.x=e.width,e.width=t}if(n&&(o===s.DIRECTION.SOUTH||o===s.DIRECTION.NORTH)||a&&(o===s.DIRECTION.EAST||o===s.DIRECTION.WEST)){const t=e.y;e.y=e.height,e.height=t}const h=l.A.fromRectangle(e);return o===s.DIRECTION.SOUTH?(h.y=e.x,h.x=e.height,h.width=e.y,h.height=e.width):o===s.DIRECTION.WEST?(h.y=e.height,h.x=e.width,h.width=e.x,h.height=e.y):o===s.DIRECTION.NORTH&&(h.y=e.width,h.x=e.y,h.width=e.height,h.height=e.x),new l.A(t.x+h.x,t.y+h.y,t.width-h.width-h.x,t.height-h.height-h.y)},C=(t,e,i)=>{let s=null;for(let n=0;n<t.length-1;n+=1){const l=S(t[n].x,t[n].y,t[n+1].x,t[n+1].y,e.x,e.y,i.x,i.y);if(null!=l){const t=i.x-l.x,e=i.y-l.y,n={p:l,distSq:e*e+t*t};null!=n&&(null==s||s.distSq>n.distSq)&&(s=n)}}return null!=s?s.p:null},m=(t,e,i)=>{const s=t.y,n=t.x,l=s+t.height,r=n+t.width;let a=e.x,o=i.x;if(e.x>i.x&&(a=i.x,o=e.x),o>r&&(o=r),a<n&&(a=n),a>o)return!1;let h=e.y,d=i.y;const c=i.x-e.x;if(Math.abs(c)>1e-7){const t=(i.y-e.y)/c,s=e.y-t*e.x;h=t*a+s,d=t*o+s}if(h>d){const t=d;d=h,h=t}return d>l&&(d=l),h<s&&(h=s),!(h>d)},f=(t,e,i)=>t.x<=e&&t.x+t.width>=e&&t.y<=i&&t.y+t.height>=i,y=(t,e)=>{let i=t.width,s=t.height,n=e.width,l=e.height;if(n<=0||l<=0||i<=0||s<=0)return!1;const r=t.x,a=t.y,o=e.x,h=e.y;return n+=o,l+=h,i+=r,s+=a,(n<o||n>r)&&(l<h||l>a)&&(i<r||i>o)&&(s<a||s>h)},v=(t,e,i,s,o,h)=>{if(o=null!=o?o:0,h=null!=h?h:0,(s=null!=s?s:1)>0){let d=t.getCenterX(),u=t.getCenterY(),g=t.width,p=t.height;const E=(0,r.getValue)(t.style,"startSize")*t.view.scale;E>0&&((0,r.getValue)(t.style,"horizontal",!0)?(u=t.y+E/2,p=E):(d=t.x+E/2,g=E)),g=Math.max(o,g*s),p=Math.max(o,p*s),h>0&&(g=Math.min(g,h),p=Math.min(p,h));const C=new l.A(d-g/2,u-p/2,g,p),m=a((0,r.getValue)(t.style,"rotation")||0);if(0!=m){const s=Math.cos(-m),l=Math.sin(-m),r=new n.A(t.getCenterX(),t.getCenterY()),a=c(new n.A(e,i),s,l,r);e=a.x,i=a.y}return f(C,e,i)}return!0},A=t=>!Number.isNaN(parseFloat(t))&&isFinite(+t)&&("string"!=typeof t||t.toLowerCase().indexOf("0x")<0),_=t=>String(parseInt(t))===String(t),b=(t,e)=>(t%e+e)%e,S=(t,e,i,s,l,r,a,o)=>{const h=(o-r)*(i-t)-(a-l)*(s-e),d=((a-l)*(e-r)-(o-r)*(t-l))/h,c=((i-t)*(e-r)-(s-e)*(t-l))/h;if(d>=0&&d<=1&&c>=0&&c<=1){const l=t+d*(i-t),r=e+d*(s-e);return new n.A(l,r)}return null},w=(t,e,i,s,n,l)=>{let r,a=(n-=t)*(i-=t)+(l-=e)*(s-=e);a<=0?r=0:(a=(n=i-n)*i+(l=s-l)*s,r=a<=0?0:a*a/(i*i+s*s));let o=n*n+l*l-r;return o<0&&(o=0),o},x=(t,e,i,s,n,l)=>Math.abs((s-e)*n-(i-t)*l+i*e-s*t)/Math.sqrt((s-e)*(s-e)+(i-t)*(i-t)),T=(t,e,i,s,n,l)=>{let r=(n-=t)*(s-=e)-(l-=e)*(i-=t);return 0==r&&(r=n*i+l*s,r>0&&(r=(n-=i)*i+(l-=s)*s,r<0&&(r=0))),r<0?-1:r>0?1:0}},9155:(t,e,i)=>{i.r(e),i.d(e,{convertPoint:()=>y,fit:()=>E,getAlignmentAsPoint:()=>T,getCurrentStyle:()=>d,getDocumentScrollOrigin:()=>m,getDocumentSize:()=>p,getOffset:()=>C,getScrollOrigin:()=>f,getSizeForString:()=>w,hasScrollbars:()=>g,matchBinaryMask:()=>S,parseCssNumber:()=>c,removeCursors:()=>h,setCellStyleFlags:()=>A,setCellStyles:()=>v,setOpacity:()=>b,setPrefixedStyle:()=>u,setStyleFlag:()=>_,sortCells:()=>x});var s=i(7773),n=i(1532),l=i(9447),r=i(5525),a=i(6498),o=i(1508);const h=t=>{t.style&&(t.style.cursor="");const e=t.children;if(e){const t=e.length;for(let i=0;i<t;i+=1)h(e[i])}},d=t=>t&&"[object ShadowRoot]"!==t.toString()?window.getComputedStyle(t,""):null,c=t=>{"thin"===t?t="2":"medium"===t?t="4":"thick"===t&&(t="6");let e=parseFloat(t);return Number.isNaN(e)&&(e=0),e},u=(t,e,i)=>{let n=null;s.A.IS_SF||s.A.IS_GC?n="Webkit":s.A.IS_MT&&(n="Moz"),t.setProperty(e,i),null!==n&&e.length>0&&(e=n+e.substring(0,1).toUpperCase()+e.substring(1),t.setProperty(e,i))},g=t=>{const e=d(t);return!!e&&("scroll"===e.overflow||"auto"===e.overflow)},p=()=>{const t=document.body,e=document.documentElement;try{return new o.A(0,0,t.clientWidth??e.clientWidth,Math.max(t.clientHeight??0,e.clientHeight))}catch(t){return new o.A}},E=t=>{const e=p(),i=t.offsetLeft,s=t.offsetWidth,n=m(t.ownerDocument),l=n.x,r=n.y,a=l+e.width;i+s>a&&(t.style.left=`${Math.max(l,a-s)}px`);const o=t.offsetTop,h=t.offsetHeight,d=r+e.height;o+h>d&&(t.style.top=`${Math.max(r,d-h)}px`)},C=(t,e=!1)=>{let i=0,s=0,n=!1,r=t;const a=document.body,o=document.documentElement;for(;null!=r&&r!=a&&r!=o&&!n;){const t=d(r);null!=t&&(n=n||"fixed"==t.position),r=r.parentNode}if(!e&&!n){const e=m(t.ownerDocument);i+=e.x,s+=e.y}const h=t.getBoundingClientRect();return null!=h&&(i+=h.left,s+=h.top),new l.A(i,s)},m=t=>{const e=t.defaultView||t.parentWindow,i=null!=e&&void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,s=null!=e&&void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return new l.A(i,s)},f=(t=null,e=!1,i=!0)=>{const s=null!=t?t.ownerDocument:document,n=s.body,r=s.documentElement,a=new l.A;let o=!1;for(;null!=t&&t!=n&&t!=r;){Number.isNaN(t.scrollLeft)||Number.isNaN(t.scrollTop)||(a.x+=t.scrollLeft,a.y+=t.scrollTop);const i=d(t);null!=i&&(o=o||"fixed"==i.position),t=e?t.parentNode:null}if(!o&&i){const t=m(s);a.x+=t.x,a.y+=t.y}return a},y=(t,e,i)=>{const s=f(t,!1),n=C(t);return n.x-=s.x,n.y-=s.y,new l.A(e-n.x,i-n.y)},v=(t,e,i,s)=>{e.length>0&&t.batchUpdate((()=>{for(let n=0;n<e.length;n+=1){const l=e[n];if(l){const e=l.getClonedStyle();e[i]=s,t.setStyle(l,e)}}}))},A=(t,e,i,s,n)=>{e.length>0&&t.batchUpdate((()=>{for(let l=0;l<e.length;l+=1){const r=e[l];if(r){const e=_(r.getClonedStyle(),i,s,n);t.setStyle(r,e)}}}))},_=(t,e,i,s)=>{const n=t[e];return t[e]=void 0===n?void 0===s||s?i:0:void 0===s?n^i:s?n|i:n&~i,t},b=(t,e)=>{t.style.opacity=String(e/100)},S=(t,e)=>(t&e)===e,w=(t,e=n.DEFAULT_FONTSIZE,i=n.DEFAULT_FONTFAMILY,s=null,l=null)=>{const r=document.createElement("div");if(r.style.fontFamily=i,r.style.fontSize=`${Math.round(e)}px`,r.style.lineHeight=`${Math.round(e*n.LINE_HEIGHT)}px`,null!==l){S(l,n.FONT.BOLD)&&(r.style.fontWeight="bold"),S(l,n.FONT.ITALIC)&&(r.style.fontWeight="italic");const t=[];S(l,n.FONT.UNDERLINE)&&t.push("underline"),S(l,n.FONT.STRIKETHROUGH)&&t.push("line-through"),t.length>0&&(r.style.textDecoration=t.join(" "))}r.style.position="absolute",r.style.visibility="hidden",r.style.display="inline-block",null!==s?(r.style.width=`${s}px`,r.style.whiteSpace="normal"):r.style.whiteSpace="nowrap",r.innerHTML=t,document.body.appendChild(r);const a=new o.A(0,0,r.offsetWidth,r.offsetHeight);return document.body.removeChild(r),a},x=(t,e=!0)=>{const i=new r.A;return t.sort(((t,s)=>{let n=i.get(t);null==n&&(n=a.A.create(t).split(a.A.PATH_SEPARATOR),i.put(t,n));let l=i.get(s);null==l&&(l=a.A.create(s).split(a.A.PATH_SEPARATOR),i.put(s,l));const r=a.A.compare(n,l);return 0==r?0:r>0==e?1:-1})),t},T=(t,e)=>{let i=-.5,s=-.5;return t===n.ALIGN.LEFT?i=0:t===n.ALIGN.RIGHT&&(i=-1),e===n.ALIGN.TOP?s=0:e===n.ALIGN.BOTTOM&&(s=-1),new l.A(i,s)}},9547:(t,e,i)=>{i.r(e),i.d(e,{createXmlDocument:()=>h,findNode:()=>p,getPrettyXml:()=>g,getViewXml:()=>c,getXml:()=>u,parseXml:()=>d});var s=i(1532),n=i(9447),l=i(3215),r=i(4440),a=i(4532),o=i(8761);const h=()=>document.implementation.createDocument("","",null),d=t=>(new DOMParser).parseFromString(t,"text/xml"),c=(t,e=1,i=null,l=0,a=0)=>{null==i&&(i=[t.getDataModel().getRoot()]);const h=t.getView();let d=null;const c=h.isEventsEnabled();h.setEventsEnabled(!1);const{drawPane:u}=h,{overlayPane:g}=h;t.dialect===s.DIALECT.SVG?(h.drawPane=document.createElementNS(s.NS_SVG,"g"),h.canvas.appendChild(h.drawPane),h.overlayPane=document.createElementNS(s.NS_SVG,"g"),h.canvas.appendChild(h.overlayPane)):(h.drawPane=h.drawPane.cloneNode(!1),h.canvas.appendChild(h.drawPane),h.overlayPane=h.overlayPane.cloneNode(!1),h.canvas.appendChild(h.overlayPane));const p=h.getTranslate();h.translate=new n.A(l,a);const E=new r.A(t.getView(),e,i);try{d=(new o.A).encode(t.getView())}finally{E.destroy(),h.translate=p,h.canvas.removeChild(h.drawPane),h.canvas.removeChild(h.overlayPane),h.drawPane=u,h.overlayPane=g,h.setEventsEnabled(c)}return d},u=(t,e="&#xa;")=>{let i=(new XMLSerializer).serializeToString(t);return i=i.replace(/\n/g,e),i},g=(t,e="  ",i="",n="\n",r=null)=>{const o=[];if(null!=t)if(null!=t.namespaceURI&&t.namespaceURI!==r&&(r=t.namespaceURI,null==t.getAttribute("xmlns")&&t.setAttribute("xmlns",t.namespaceURI)),t.nodeType===s.NODETYPE.DOCUMENT)o.push(g(t.documentElement,e,i,n,r));else if(t.nodeType===s.NODETYPE.DOCUMENT_FRAGMENT){let s=t.firstChild;if(null!=s)for(;null!=s;)o.push(g(s,e,i,n,r)),s=s.nextSibling}else if(t.nodeType===s.NODETYPE.COMMENT){const e=(0,a.getTextContent)(t);e.length>0&&o.push(`${i}\x3c!--${e}--\x3e${n}`)}else if(t.nodeType===s.NODETYPE.TEXT){const e=(0,l.trim)((0,a.getTextContent)(t));e&&e.length>0&&o.push(i+(0,l.htmlEntities)(e,!1)+n)}else if(t.nodeType===s.NODETYPE.CDATA){const e=(0,a.getTextContent)(t);e.length>0&&o.push(`${i}<![CDATA[${e}]]${n}`)}else{o.push(`${i}<${t.nodeName}`);const s=t.attributes;if(null!=s)for(let t=0;t<s.length;t+=1){const e=(0,l.htmlEntities)(s[t].value);o.push(` ${s[t].nodeName}="${e}"`)}let a=t.firstChild;if(null!=a){for(o.push(`>${n}`);null!=a;)o.push(g(a,e,i+e,n,r)),a=a.nextSibling;o.push(`${i}</${t.nodeName}>${n}`)}else o.push(` />${n}`)}return o.join("")},p=(t,e,i)=>{if(t.nodeType===s.NODETYPE.ELEMENT){const s=t.getAttribute(e);if(s&&s===i)return t}for(t=t.firstChild;t;){const s=p(t,e,i);if(s)return s;t=t.nextSibling}return null}},2537:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,w:()=>GraphView});var _geometry_Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(9447),_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(1508),_util_Dictionary__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(5525),_event_EventSource__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(2354),_event_EventObject__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(4432),_geometry_node_RectangleShape__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(3082),_util_Constants__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(1532),_Client__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(7773),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(7620),_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(9155),_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(3514),_util_config__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(9639),_cell_CellState__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(5364),_undoable_changes_UndoableEdit__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(1323),_geometry_node_ImageShape__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(1898),_event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(2387),_undoable_changes_CurrentRootChange__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(3816),_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(5524),_util_cloneUtils__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(8291),_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(2628);class GraphView extends _event_EventSource__WEBPACK_IMPORTED_MODULE_0__.A{constructor(t){super(),this.backgroundImage=null,this.backgroundPageShape=null,this.EMPTY_POINT=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A,this.doneResource="none"!==_Client__WEBPACK_IMPORTED_MODULE_2__.A.language?"done":"",this.updatingDocumentResource="none"!==_Client__WEBPACK_IMPORTED_MODULE_2__.A.language?"updatingDocument":"",this.allowEval=!1,this.captureDocumentGesture=!0,this.rendering=!0,this.currentRoot=null,this.graphBounds=new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A,this.scale=1,this.translate=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A,this.states=new _util_Dictionary__WEBPACK_IMPORTED_MODULE_4__.A,this.updateStyle=!1,this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null,this.endHandler=null,this.moveHandler=null,this.graph=t}getGraphBounds(){return this.graphBounds}setGraphBounds(t){this.graphBounds=t}getScale(){return this.scale}setScale(t){const e=this.scale;e!==t&&(this.scale=t,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.A(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.SCALE,{scale:t,previousScale:e}))}getTranslate(){return this.translate}isRendering(){return this.rendering}setRendering(t){this.rendering=t}setTranslate(t,e){const i=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(this.translate.x,this.translate.y);this.translate.x===t&&this.translate.y===e||(this.translate.x=t,this.translate.y=e,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.A(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.TRANSLATE,{translate:this.translate,previousTranslate:i}))}isAllowEval(){return this.allowEval}setAllowEval(t){this.allowEval=t}getStates(){return this.states}setStates(t){this.states=t}getCanvas(){return this.canvas}getBackgroundPane(){return this.backgroundPane}getDrawPane(){return this.drawPane}getOverlayPane(){return this.overlayPane}getDecoratorPane(){return this.decoratorPane}getBounds(t){let e=null;if(t.length>0)for(let i=0;i<t.length;i+=1)if(t[i].isVertex()||t[i].isEdge()){const s=this.getState(t[i]);s&&(e?e.add(s):e=_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A.fromRectangle(s))}return e}setCurrentRoot(t){if(this.currentRoot!==t){const e=new _undoable_changes_CurrentRootChange__WEBPACK_IMPORTED_MODULE_7__.A(this,t);e.execute();const i=new _undoable_changes_UndoableEdit__WEBPACK_IMPORTED_MODULE_8__.A(this,!0);i.add(e),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.A(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.UNDO,{edit:i})),this.graph.sizeDidChange(),this.currentRoot=t}return t}scaleAndTranslate(t,e,i){const s=this.scale,n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(this.translate.x,this.translate.y);this.scale===t&&this.translate.x===e&&this.translate.y===i||(this.scale=t,this.translate.x=e,this.translate.y=i,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.A(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.SCALE_AND_TRANSLATE,{scale:t,previousScale:s,translate:this.translate,previousTranslate:n}))}viewStateChanged(){this.revalidate(),this.graph.sizeDidChange()}refresh(){this.currentRoot&&this.clear(),this.revalidate()}revalidate(){this.invalidate(),this.validate()}clear(t,e=!1,i=!0){if(t||(t=this.graph.getDataModel().getRoot()),t)if(this.removeState(t),i&&(e||t!==this.currentRoot)){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.clear(t.getChildAt(s),e)}else this.invalidate(t)}invalidate(t=null,e=!0,i=!0){const s=this.graph.getDataModel();if(t=t??s.getRoot()){const s=this.getState(t);if(s&&(s.invalid=!0),!t.invalidating){if(t.invalidating=!0,e){const s=t.getChildCount();for(let n=0;n<s;n+=1){const s=t.getChildAt(n);this.invalidate(s,e,i)}}if(i){const s=t.getEdgeCount();for(let n=0;n<s;n+=1)this.invalidate(t.getEdgeAt(n),e,i)}t.invalidating=!1}}}validate(t=null){const e=_util_config__WEBPACK_IMPORTED_MODULE_9__.eo.logger.enter("GraphView.validate");this.resetValidationState();const i=t||(this.currentRoot??this.graph.getDataModel().getRoot());if(i){const t=this.getBoundingBox(this.validateCellState(i?this.validateCell(i):null));this.setGraphBounds(t??this.getEmptyBounds()),this.validateBackground(),this.resetValidationState()}_util_config__WEBPACK_IMPORTED_MODULE_9__.eo.logger.leave("GraphView.validate",e)}getEmptyBounds(){return new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A(this.translate.x*this.scale,this.translate.y*this.scale)}getBoundingBox(t=null,e=!0){let i=null;if(t&&(t.shape&&t.shape.boundingBox&&(i=t.shape.boundingBox.clone()),t.text&&t.text.boundingBox&&(i?i.add(t.text.boundingBox):i=t.text.boundingBox.clone()),e)){const e=t.cell.getChildCount();for(let s=0;s<e;s+=1){const e=this.getBoundingBox(this.getState(t.cell.getChildAt(s)));e&&(i?i.add(e):i=e)}}return i}createBackgroundPageShape(t){return new _geometry_node_RectangleShape__WEBPACK_IMPORTED_MODULE_10__.A(t,"white","black")}validateBackground(){this.validateBackgroundImage(),this.validateBackgroundPage()}validateBackgroundImage(){const t=this.graph.getBackgroundImage();if(t){if(!this.backgroundImage||this.backgroundImage.imageSrc!==t.src){this.backgroundImage&&this.backgroundImage.destroy();const e=new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A(0,0,1,1);this.backgroundImage=new _geometry_node_ImageShape__WEBPACK_IMPORTED_MODULE_11__.A(e,t.src),this.backgroundImage.dialect=this.graph.dialect,this.backgroundImage.init(this.backgroundPane),this.backgroundImage.redraw()}this.redrawBackgroundImage(this.backgroundImage,t)}else this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)}validateBackgroundPage(){const t=this.graph;if(t.pageVisible){const e=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(e),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.backgroundPageShape.node&&(t.isNativeDblClickEnabled()&&_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(this.backgroundPageShape.node,"dblclick",(e=>{t.dblClick(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addGestureListeners(this.backgroundPageShape.node,(e=>{t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_DOWN,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))}),(e=>{const i=t.getPlugin("TooltipHandler");i&&i.isHideOnHover()&&i.hide(),t.isMouseDown&&!(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.isConsumed)(e)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))}),(e=>{t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))})))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=e,this.backgroundPageShape.redraw())}else this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)}getBackgroundPageBounds(){const t=this.graph.pageFormat,e=this.scale*this.graph.pageScale;return new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A(this.scale*this.translate.x,this.scale*this.translate.y,t.width*e,t.height*e)}redrawBackgroundImage(t,e){if(t.scale=this.scale,t.bounds){const i=t.bounds;i.x=this.scale*this.translate.x,i.y=this.scale*this.translate.y,i.width=this.scale*e.width,i.height=this.scale*e.height}t.redraw()}validateCell(t,e=!0){if(e=e&&t.isVisible(),this.getState(t,e)&&!e)this.removeState(t);else{const i=t.getChildCount();for(let s=0;s<i;s+=1)this.validateCell(t.getChildAt(s),e&&(!t.isCollapsed()||t===this.currentRoot))}return t}validateCellState(t,e=!0){let i=null;if(t&&(i=this.getState(t),i&&(i.invalid&&(i.invalid=!1,i.style&&!i.invalidStyle||(i.style=this.graph.getCellStyle(i.cell),i.invalidStyle=!1),t!==this.currentRoot&&this.validateCellState(t.getParent(),!1),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!0),!1),!0),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!1),!1),!1),this.updateCellState(i),t===this.currentRoot||i.invalid||(this.graph.cellRenderer.redraw(i,!1,this.isRendering()),i.updateCachedBounds())),e&&!i.invalid))){i.shape&&this.stateValidated(i);const e=t.getChildCount();for(let i=0;i<e;i+=1)this.validateCellState(t.getChildAt(i))}return i}updateCellState(t){const e=t.absoluteOffset,i=t.origin;if(e.x=0,e.y=0,i.x=0,i.y=0,t.length=0,t.cell!==this.currentRoot){const s=t.cell.getParent(),n=s?this.getState(s):null;n&&n.cell!==this.currentRoot&&(i.x+=n.origin.x,i.y+=n.origin.y);let l=this.graph.getChildOffsetForCell(t.cell);l&&(i.x+=l.x,i.y+=l.y);const r=t.cell.getGeometry();if(r){if(!t.cell.isEdge())if(l=r.offset?r.offset:this.EMPTY_POINT,r.relative&&n)if(n.cell.isEdge()){const t=this.getPoint(n,r);t&&(i.x+=t.x/this.scale-n.origin.x-this.translate.x,i.y+=t.y/this.scale-n.origin.y-this.translate.y)}else i.x+=r.x*n.unscaledWidth+l.x,i.y+=r.y*n.unscaledHeight+l.y;else e.x=this.scale*l.x,e.y=this.scale*l.y,i.x+=r.x,i.y+=r.y;t.x=this.scale*(this.translate.x+i.x),t.y=this.scale*(this.translate.y+i.y),t.width=this.scale*r.width,t.unscaledWidth=r.width,t.height=this.scale*r.height,t.unscaledHeight=r.height,t.cell.isVertex()&&this.updateVertexState(t,r),t.cell.isEdge()&&this.updateEdgeState(t,r)}}t.updateCachedBounds()}updateVertexState(t,e){const i=t.cell.getParent(),s=i?this.getState(i):null;if(e.relative&&s&&!s.cell.isEdge()){const e=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.toRadians)(s.style.rotation??0);if(0!==e){const i=Math.cos(e),n=Math.sin(e),l=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(t.getCenterX(),t.getCenterY()),r=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(s.getCenterX(),s.getCenterY()),a=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.getRotatedPoint)(l,i,n,r);t.x=a.x-t.width/2,t.y=a.y-t.height/2}}this.updateVertexLabelOffset(t)}updateEdgeState(t,e){const i=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1);if(t.cell.getTerminal(!0)&&!i||!i&&!e.getTerminalPoint(!0)||t.cell.getTerminal(!1)&&!s||!s&&!e.getTerminalPoint(!1))this.clear(t.cell,!0);else{this.updateFixedTerminalPoints(t,i,s),this.updatePoints(t,e.points,i,s),this.updateFloatingTerminalPoints(t,i,s);const n=t.absolutePoints;t.cell!==this.currentRoot&&(null==n||n.length<2||null==n[0]||null==n[n.length-1])?this.clear(t.cell,!0):(this.updateEdgeBounds(t),this.updateEdgeLabelOffset(t))}}updateVertexLabelOffset(t){const e=t.style.labelPosition??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.CENTER;if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.LEFT){let e=t.style.labelWidth??null;null!=e?e*=this.scale:e=t.width,t.absoluteOffset.x-=e}else if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.RIGHT)t.absoluteOffset.x+=t.width;else if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.CENTER){const e=t.style.labelWidth??null;if(null!=e){const i=t.style.align??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.CENTER;let s=0;i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.CENTER?s=.5:i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.RIGHT&&(s=1),0!==s&&(t.absoluteOffset.x-=(e*this.scale-t.width)*s)}}const i=t.style.verticalLabelPosition??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.MIDDLE;i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.TOP?t.absoluteOffset.y-=t.height:i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.BOTTOM&&(t.absoluteOffset.y+=t.height)}resetValidationState(){this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null}stateValidated(t){const e=this.graph,i=t.cell.isEdge()&&e.keepEdgesInForeground||t.cell.isVertex()&&e.keepEdgesInBackground,s=i&&this.lastForegroundHtmlNode||this.lastHtmlNode,n=i&&this.lastForegroundNode||this.lastNode,l=e.cellRenderer.insertStateAfter(t,n,s);i?(this.lastForegroundHtmlNode=l[1],this.lastForegroundNode=l[0]):(this.lastHtmlNode=l[1],this.lastNode=l[0])}updateFixedTerminalPoints(t,e,i){this.updateFixedTerminalPoint(t,e,!0,this.graph.getConnectionConstraint(t,e,!0)),this.updateFixedTerminalPoint(t,i,!1,this.graph.getConnectionConstraint(t,i,!1))}updateFixedTerminalPoint(t,e,i,s){t.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(t,e,i,s),i)}getFixedTerminalPoint(t,e,i,s){let n=null;if(s&&e&&(n=this.graph.getConnectionPoint(e,s,!1)),!n&&!e){const e=this.scale,s=this.translate,l=t.origin;n=t.cell.getGeometry().getTerminalPoint(i),n&&(n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(e*(s.x+n.x+l.x),e*(s.y+n.y+l.y)))}return n}updateBoundsFromStencil(t){let e=null;if(t&&t.shape&&t.shape.stencil&&"fixed"===t.shape.stencil.aspect){e=_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.A.fromRectangle(t);const i=t.shape.stencil.computeAspect(null,t.x,t.y,t.width,t.height);t.setRect(i.x,i.y,t.shape.stencil.w0*i.width,t.shape.stencil.h0*i.height)}return e}updatePoints(t,e,i,s){const n=[];n.push(t.absolutePoints[0]);const l=this.getEdgeStyle(t,e,i,s);if(l&&i){const r=this.getTerminalPort(t,i,!0),a=s?this.getTerminalPort(t,s,!1):null,o=this.updateBoundsFromStencil(r),h=this.updateBoundsFromStencil(a);l(t,r,a,e,n),r&&o&&r.setRect(o.x,o.y,o.width,o.height),a&&h&&a.setRect(h.x,h.y,h.width,h.height)}else if(e)for(let i=0;i<e.length;i+=1)if(e[i]){const s=(0,_util_cloneUtils__WEBPACK_IMPORTED_MODULE_16__.clone)(e[i]);n.push(this.transformControlPoint(t,s))}const r=t.absolutePoints;n.push(r[r.length-1]),t.absolutePoints=n}transformControlPoint(t,e,i=!1){if(t&&e){const s=t.origin,n=i?1:this.scale;return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(n*(e.x+this.translate.x+s.x),n*(e.y+this.translate.y+s.y))}return null}isLoopStyleEnabled(t,e=[],i=null,s=null){const n=this.graph.getConnectionConstraint(t,i,!0),l=this.graph.getConnectionConstraint(t,s,!1);return(null==e||e.length<2)&&!t.style.orthogonalLoop&&(null!=n&&null!=n.point||null!=l&&null!=l.point)&&null!=i&&i===s}getEdgeStyle(edge,points=[],source=null,target=null){let edgeStyle=this.isLoopStyleEnabled(edge,points,source,target)?edge.style.loopStyle??this.graph.defaultLoopStyle:edge.style.noEdgeStyle?null:edge.style.edgeStyle;if("string"==typeof edgeStyle){let tmp=_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__.A.getValue(edgeStyle);!tmp&&this.isAllowEval()&&(tmp=eval(edgeStyle)),edgeStyle=tmp}return"function"==typeof edgeStyle?edgeStyle:null}updateFloatingTerminalPoints(t,e,i){const s=t.absolutePoints,n=s[0];!s[s.length-1]&&i&&this.updateFloatingTerminalPoint(t,i,e,!1),!n&&e&&this.updateFloatingTerminalPoint(t,e,i,!0)}updateFloatingTerminalPoint(t,e,i,s){t.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(t,e,i,s),s)}getFloatingTerminalPoint(t,e,i,s){e=this.getTerminalPort(t,e,s);let n=this.getNextPoint(t,i,s);const l=this.graph.isOrthogonal(t),r=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.toRadians)(e.style.rotation??0),a=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(e.getCenterX(),e.getCenterY());if(0!==r){const t=Math.cos(-r),e=Math.sin(-r);n=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.getRotatedPoint)(n,t,e,a)}let o=t.style.perimeterSpacing??0;o+=t.style[s?"sourcePerimeterSpacing":"targetPerimeterSpacing"]??0;let h=this.getPerimeterPoint(e,n,0===r&&l,o);if(h&&0!==r){const t=Math.cos(r),e=Math.sin(r);h=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.getRotatedPoint)(h,t,e,a)}return h}getTerminalPort(t,e,i=!1){const s=i?"sourcePort":"targetPort",n=t.style[s];if(n){const t=this.graph.getDataModel().getCell(n);if(t){const i=this.getState(t,!1);i&&(e=i)}}return e}getPerimeterPoint(t,e,i,s=0){let n=null;if(null!=t){const l=this.getPerimeterFunction(t);if(null!=l&&null!=e){const r=this.getPerimeterBounds(t,s);if(r.width>0||r.height>0){n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(e.x,e.y);let s=!1,a=!1;t.cell.isVertex()&&(s=!!t.style.flipH,a=!!t.style.flipV,s&&(n.x=2*r.getCenterX()-n.x),a&&(n.y=2*r.getCenterY()-n.y)),n=l(r,t,n,i),null!=n&&(s&&(n.x=2*r.getCenterX()-n.x),a&&(n.y=2*r.getCenterY()-n.y))}}null==n&&(n=this.getPoint(t))}return n}getRoutingCenterX(t){const e=t.style?t.style.routingCenterX??0:0;return t.getCenterX()+e*t.width}getRoutingCenterY(t){const e=t.style?t.style.routingCenterY??0:0;return t.getCenterY()+e*t.height}getPerimeterBounds(t,e=0){return e+=t.style.perimeterSpacing??0,t.getPerimeterBounds(e*this.scale)}getPerimeterFunction(state){let perimeter=state.style.perimeter;if("string"==typeof perimeter){let tmp=_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__.A.getValue(perimeter);null==tmp&&this.isAllowEval()&&(tmp=eval(perimeter)),perimeter=tmp}return"function"==typeof perimeter?perimeter:null}getNextPoint(t,e,i=!1){const s=t.absolutePoints;let n=null;if(s.length>=2){const t=s.length;n=s[i?Math.min(1,t-1):Math.max(0,t-2)]}return!n&&e&&(n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(e.getCenterX(),e.getCenterY())),n}getVisibleTerminal(t,e){const i=this.graph.getDataModel();let s=t.getTerminal(e),n=s;for(;s&&s!==this.currentRoot;)(n&&!n.isVisible()||s.isCollapsed())&&(n=s),s=s.getParent();return!n||i.contains(n)&&n.getParent()!==i.getRoot()&&n!==this.currentRoot||(n=null),n}updateEdgeBounds(t){const e=t.absolutePoints,i=e[0],s=e[e.length-1];if(i&&s&&(i.x!==s.x||i.y!==s.y)){const e=s.x-i.x,n=s.y-i.y;t.terminalDistance=Math.sqrt(e*e+n*n)}else t.terminalDistance=0;let n=0;const l=[];let r=i;if(r){let i=r.x,s=r.y,a=i,o=s;for(let t=1;t<e.length;t+=1){const h=e[t];if(h){const t=r.x-h.x,e=r.y-h.y,d=Math.sqrt(t*t+e*e);l.push(d),n+=d,r=h,i=Math.min(r.x,i),s=Math.min(r.y,s),a=Math.max(r.x,a),o=Math.max(r.y,o)}}t.length=n,t.segments=l;const h=1;t.x=i,t.y=s,t.width=Math.max(h,a-i),t.height=Math.max(h,o-s)}}getPoint(t,e=null){let i=t.getCenterX(),s=t.getCenterY();if(null==t.segments||null!=e&&!e.relative){if(null!=e){const{offset:t}=e;null!=t&&(i+=t.x,s+=t.y)}}else{const n=null!=e?e.x/2:0,l=t.absolutePoints.length,r=Math.round((n+.5)*t.length);let a=t.segments[0],o=0,h=1;for(;r>=Math.round(o+a)&&h<l-1;)o+=a,a=t.segments[h++];const d=0===a?0:(r-o)/a,c=t.absolutePoints[h-1],u=t.absolutePoints[h];if(null!=c&&null!=u){let t=0,n=0,l=0;if(null!=e){t=e.y;const{offset:i}=e;null!=i&&(n=i.x,l=i.y)}const r=u.x-c.x,o=u.y-c.y,h=0===a?0:o/a,g=0===a?0:r/a;i=c.x+r*d+(h*t+n)*this.scale,s=c.y+o*d-(g*t-l)*this.scale}}return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(i,s)}getRelativePoint(t,e,i){const s=t.cell.getGeometry();if(s){const n=t.absolutePoints,l=n.length;if(s.relative&&l>1){const s=t.length,{segments:r}=t;let a=n[0],o=n[1],h=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.ptSegDistSq)(a.x,a.y,o.x,o.y,e,i),d=0,c=0,u=0;for(let t=2;t<l;t+=1){a=o,o=n[t];const s=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.ptSegDistSq)(a.x,a.y,o.x,o.y,e,i);u+=r[t-2],s<=h&&(h=s,c=t-1,d=u)}const g=r[c];a=n[c],o=n[c+1];const p=a.x,E=a.y,C=o.x,m=o.y;let f=e,y=i;const v=p-C,A=E-m;f-=C,y-=m;let _=0;f=v-f,y=A-y;const b=f*v+y*A;_=b<=0?0:b*b/(v*v+A*A);let S=Math.sqrt(_);S>g&&(S=g);let w=Math.sqrt((0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.ptSegDistSq)(a.x,a.y,o.x,o.y,e,i));return-1===(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.relativeCcw)(a.x,a.y,o.x,o.y,e,i)&&(w=-w),new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A((s/2-d-S)/s*-2,w/this.scale)}}return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A}updateEdgeLabelOffset(t){const e=t.absolutePoints,i=t.absoluteOffset;if(i.x=t.getCenterX(),i.y=t.getCenterY(),e.length>0&&t.segments){const s=t.cell.getGeometry();if(s)if(s.relative){const e=this.getPoint(t,s);t.absoluteOffset=e}else{const t=e[0],n=e[e.length-1];if(t&&n){const e=n.x-t.x,l=n.y-t.y;let r=0,a=0;const o=s.offset;o&&(r=o.x,a=o.y);const h=t.x+e/2+r*this.scale,d=t.y+l/2+a*this.scale;i.x=h,i.y=d}}}}getState(t,e=!1){let i=this.states.get(t);return e&&(!i||this.updateStyle)&&t.isVisible()&&(i?i.style=this.graph.getCellStyle(t):(i=this.createState(t),this.states.put(t,i))),i}getCellStates(t=null){if(!t)return this.states.getValues();const e=[];for(const i of t){const t=this.getState(i);t&&e.push(t)}return e}removeState(t){const e=this.states.remove(t);return e&&(this.graph.cellRenderer.destroy(e),e.invalid=!0,e.destroy()),e}createState(t){return new _cell_CellState__WEBPACK_IMPORTED_MODULE_18__.A(this,t,this.graph.getCellStyle(t))}isContainerEvent(t){const e=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.getSource)(t);return e&&(e===this.graph.container||e.parentNode===this.backgroundPane||e.parentNode&&e.parentNode.parentNode===this.backgroundPane||e===this.canvas.parentNode||e===this.canvas||e===this.backgroundPane||e===this.drawPane||e===this.overlayPane||e===this.decoratorPane)}isScrollEvent(t){const e=this.graph,i=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.getOffset)(e.container),s=t instanceof MouseEvent?[t.clientX,t.clientY]:[t.touches[0].clientX,t.touches[0].clientY],n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.A(s[0]-i.x,s[1]-i.y),l=e.container,r=l.offsetWidth,a=l.clientWidth;if(r>a&&n.x>a+2&&n.x<=r)return!0;const o=l.offsetHeight,h=l.clientHeight;return o>h&&n.y>h+2&&n.y<=o}init(){this.installListeners(),this.createSvg()}installListeners(){const t=this.graph,{container:e}=t;_Client__WEBPACK_IMPORTED_MODULE_2__.A.IS_TOUCH&&(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"gesturestart",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.consume(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"gesturechange",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.consume(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"gestureend",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.consume(e)})));let i=null;_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addGestureListeners(e,(e=>{!this.isContainerEvent(e)||(_Client__WEBPACK_IMPORTED_MODULE_2__.A.IS_GC||_Client__WEBPACK_IMPORTED_MODULE_2__.A.IS_SF)&&this.isScrollEvent(e)||(t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_DOWN,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e)),i=e.pointerId)}),(e=>{!this.isContainerEvent(e)||null!==i&&e.pointerId!==i||t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))}),(e=>{this.isContainerEvent(e)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e)),i=null})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addListener(e,"dblclick",(e=>{this.isContainerEvent(e)&&t.dblClick(e)})),t.addMouseListener({mouseDown:(e,i)=>{const s=t.getPlugin("PopupMenuHandler");s?.hideMenu()},mouseMove:()=>{},mouseUp:()=>{}}),this.moveHandler=i=>{const s=t.getPlugin("TooltipHandler");s&&s.isHideOnHover()&&s.hide(),this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(i)&&"none"!==t.container.style.display&&"hidden"!==t.container.style.visibility&&!(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.isConsumed)(i)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(i,(i=>{let s=null;if(_Client__WEBPACK_IMPORTED_MODULE_2__.A.IS_TOUCH){const n=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.getClientX)(i),l=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.getClientY)(i),r=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.convertPoint)(e,n,l),a=t.getCellAt(r.x,r.y);a&&(s=t.view.getState(a))}return s})(i)))},this.endHandler=e=>{this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(e)&&"none"!==t.container.style.display&&"hidden"!==t.container.style.visibility&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.A(e))},_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.addGestureListeners(document,null,this.moveHandler,this.endHandler)}createSvg(){const{container:t}=this.graph,e=this.canvas=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g");this.backgroundPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g"),e.appendChild(this.backgroundPane),this.drawPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g"),e.appendChild(this.drawPane),this.overlayPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g"),e.appendChild(this.overlayPane),this.decoratorPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g"),e.appendChild(this.decoratorPane);const i=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"svg");i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="100%",i.style.display="block",i.appendChild(this.canvas),null!=t&&(t.appendChild(i),this.updateContainerStyle(t))}createHtml(){const t=this.graph.container;null!=t&&(this.canvas=this.createHtmlPane("100%","100%"),this.canvas.style.overflow="hidden",this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),t.appendChild(this.canvas),this.updateContainerStyle(t))}updateHtmlCanvasSize(t,e){if(null!=this.graph.container){const i=this.graph.container.offsetWidth,s=this.graph.container.offsetHeight;this.canvas.style.width=i<t?t+"px":"100%",this.canvas.style.height=s<e?e+"px":"100%"}}createHtmlPane(t,e){const i=document.createElement("DIV");return null!=t&&null!=e?(i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.width=t,i.style.height=e):i.style.position="relative",i}updateContainerStyle(t){const e=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.getCurrentStyle)(t);null!=e&&"static"==e.position&&(t.style.position="relative"),_Client__WEBPACK_IMPORTED_MODULE_2__.A.IS_POINTER&&(t.style.touchAction="none")}destroy(){let t=null;this.canvas&&this.canvas instanceof SVGElement&&(t=this.canvas.ownerSVGElement),t||(t=this.canvas),t&&t.parentNode&&(this.clear(this.currentRoot,!0),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.removeGestureListeners(document,null,this.moveHandler,this.endHandler),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.A.release(this.graph.container),t.parentNode.removeChild(t),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)}}const __WEBPACK_DEFAULT_EXPORT__=GraphView},3473:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(3514),n=i(1532),l=i(6126),r=i(9447),a=i(8291),o=i(9639);const h=class{constructor(){this.state=this.createState(),this.states=[],this.path=[],this.rotateHtml=!0,this.lastX=0,this.lastY=0,this.moveOp="M",this.lineOp="L",this.quadOp="Q",this.curveOp="C",this.closeOp="Z",this.pointerEvents=!1,this.pointerEventsValue=null,this.addOp=(t,...e)=>{if(this.path.push(t),e.length>1){const t=this.state;for(let i=1;i<e.length;i+=2)this.lastX=e[i-1],this.lastY=e[i],this.path.push(this.format((this.lastX+t.dx)*t.scale)),this.path.push(this.format((this.lastY+t.dy)*t.scale))}},this.converter=this.createUrlConverter(),this.reset()}createUrlConverter(){return new l.A}reset(){this.state=this.createState(),this.states=[]}createState(){return{dx:0,dy:0,scale:1,alpha:1,fillAlpha:1,strokeAlpha:1,fillColor:n.NONE,gradientFillAlpha:1,gradientColor:n.NONE,gradientAlpha:1,gradientDirection:n.DIRECTION.EAST,strokeColor:n.NONE,strokeWidth:1,dashed:!1,dashPattern:"3 3",fixDash:!1,lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:n.NONE,fontBorderColor:n.NONE,fontSize:n.DEFAULT_FONTSIZE,fontFamily:n.DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:o.m5.shadowColor,shadowAlpha:o.m5.shadowOpacity,shadowDx:o.m5.shadowOffsetX,shadowDy:o.m5.shadowOffsetY,rotation:0,rotationCx:0,rotationCy:0}}format(t){return Math.round(t)}rotatePoint(t,e,i,n,l){const a=i*(Math.PI/180);return(0,s.getRotatedPoint)(new r.A(t,e),Math.cos(a),Math.sin(a),new r.A(n,l))}save(){this.states.push(this.state),this.state=(0,a.clone)(this.state)}restore(){const t=this.states.pop();t&&(this.state=t)}setLink(t){}scale(t){this.state.scale*=t,null!==this.state.strokeWidth&&(this.state.strokeWidth*=t)}translate(t,e){this.state.dx+=t,this.state.dy+=e}rotate(t,e,i,s,n){}setAlpha(t){this.state.alpha=t}setFillAlpha(t){this.state.fillAlpha=t}setStrokeAlpha(t){this.state.strokeAlpha=t}setFillColor(t){this.state.fillColor=t??n.NONE,this.state.gradientColor=n.NONE}setGradient(t,e,i,s,n,l,r,a=1,o=1){const h=this.state;h.fillColor=t,h.gradientFillAlpha=a,h.gradientColor=e,h.gradientAlpha=o,h.gradientDirection=r}setStrokeColor(t){this.state.strokeColor=t??n.NONE}setStrokeWidth(t){this.state.strokeWidth=t}setDashed(t,e=!1){this.state.dashed=t,this.state.fixDash=e}setDashPattern(t){this.state.dashPattern=t}setLineCap(t){this.state.lineCap=t}setLineJoin(t){this.state.lineJoin=t}setMiterLimit(t){this.state.miterLimit=t}setFontColor(t){this.state.fontColor=t??n.NONE}setFontBackgroundColor(t){this.state.fontBackgroundColor=t??n.NONE}setFontBorderColor(t){this.state.fontBorderColor=t??n.NONE}setFontSize(t){this.state.fontSize=t}setFontFamily(t){this.state.fontFamily=t}setFontStyle(t){this.state.fontStyle=t}setShadow(t){this.state.shadow=t}setShadowColor(t){this.state.shadowColor=t??n.NONE}setShadowAlpha(t){this.state.shadowAlpha=t}setShadowOffset(t,e){this.state.shadowDx=t,this.state.shadowDy=e}begin(){this.lastX=0,this.lastY=0,this.path=[]}moveTo(t,e){this.addOp(this.moveOp,t,e)}lineTo(t,e){this.addOp(this.lineOp,t,e)}quadTo(t,e,i,s){this.addOp(this.quadOp,t,e,i,s)}curveTo(t,e,i,s,n,l){this.addOp(this.curveOp,t,e,i,s,n,l)}arcTo(t,e,i,n,l,r,a){const o=(0,s.arcToCurves)(this.lastX,this.lastY,t,e,i,n,l,r,a);if(null!=o)for(let t=0;t<o.length;t+=6)this.curveTo(o[t],o[t+1],o[t+2],o[t+3],o[t+4],o[t+5])}close(t,e,i,s,n,l){this.addOp(this.closeOp)}}},4881:(t,e,i)=>{i.d(e,{A:()=>E});var s=i(6960),n=i(3514),l=i(9155),r=i(7773),a=i(1532),o=i(1508),h=i(3473),d=i(9547),c=i(4532),u=i(3215);const g="function"==typeof DOMParser&&!r.A.IS_CHROMEAPP&&!r.A.IS_EDGE&&document.getElementsByTagName("base").length>0;class p extends h.A{constructor(t,e){super(),this.defs=null,this.styleEnabled=!0,this.node=null,this.matchHtmlAlignment=!0,this.textEnabled=!0,this.foEnabled=!0,this.foAltText="[Object]",this.foOffset=0,this.textOffset=0,this.imageOffset=0,this.strokeTolerance=0,this.minStrokeWidth=1,this.refCount=0,this.lineHeightCorrection=1,this.pointerEventsValue="all",this.fontMetricsPadding=10,this.cacheOffsetSize=!0,this.originalRoot=null,this.root=t,this.gradients={},this.defs=null,this.styleEnabled=null!=e&&e;let i=null;if(t.ownerDocument!==document){let e=t;for(;e&&"svg"!==e.nodeName;)e=e.parentElement;i=e}i&&(i.getElementsByTagName("defs").length>0&&(this.defs=i.getElementsByTagName("defs")[0]),this.defs||(this.defs=this.createElement("defs"),null!=i.firstChild?i.insertBefore(this.defs,i.firstChild):i.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}format(t){return parseFloat(t.toFixed(2))}getBaseUrl(){let{href:t}=window.location;const e=t.lastIndexOf("#");return e>0&&(t=t.substring(0,e)),t}reset(){super.reset(),this.gradients={}}end(){}createStyle(){const t=this.createElement("style");return t.setAttribute("type","text/css"),(0,c.write)(t,`svg{font-family:${a.DEFAULT_FONTFAMILY};font-size:${a.DEFAULT_FONTSIZE};fill:none;stroke-miterlimit:10}`),t}createElement(t,e){return this.root?.ownerDocument.createElementNS(e||a.NS_SVG,t)}getAlternateText(t,e,i,n,l,r,a,o,h,d,c,u,g){return(0,s.isNotNullish)(r)?this.foAltText:null}createAlternateContent(t,e,i,n,r,o,h,d,u,g,p,E,C){const m=this.getAlternateText(t,e,i,n,r,o,h,d,u,g,p,E,C),f=this.state;if((0,s.isNotNullish)(m)&&f.fontSize>0){const t=d===a.ALIGN.TOP?1:d===a.ALIGN.BOTTOM?0:.3,s=h===a.ALIGN.RIGHT?"end":h===a.ALIGN.LEFT?"start":"middle",n=this.createElement("text");n.setAttribute("x",String(Math.round(e+f.dx))),n.setAttribute("y",String(Math.round(i+f.dy+t*f.fontSize))),n.setAttribute("fill",f.fontColor||"black"),n.setAttribute("font-family",f.fontFamily),n.setAttribute("font-size",`${Math.round(f.fontSize)}px`),"start"!==s&&n.setAttribute("text-anchor",s);const r=f.fontStyle;(0,l.matchBinaryMask)(r,a.FONT.BOLD)&&n.setAttribute("font-weight","bold"),(0,l.matchBinaryMask)(r,a.FONT.ITALIC)&&n.setAttribute("font-style","italic");const o=[];return(0,l.matchBinaryMask)(r,a.FONT.UNDERLINE)&&o.push("underline"),(0,l.matchBinaryMask)(r,a.FONT.STRIKETHROUGH)&&o.push("line-through"),o.length>0&&n.setAttribute("text-decoration",o.join(" ")),(0,c.write)(n,m),n}return null}createGradientId(t,e,i,s,n){"#"===t.charAt(0)&&(t=t.substring(1)),"#"===e.charAt(0)&&(e=e.substring(1)),t=`${t.toLowerCase()}-${i}`,e=`${e.toLowerCase()}-${s}`;let l=null;if(null==n||n===a.DIRECTION.SOUTH)l="s";else if(n===a.DIRECTION.EAST)l="e";else{const i=t;t=e,e=i,n===a.DIRECTION.NORTH?l="s":n===a.DIRECTION.WEST&&(l="e")}return`mx-gradient-${t}-${e}-${l}`}getSvgGradient(t,e,i,s,n){const l=this.createGradientId(t,e,i,s,n);let r=this.gradients[l];if(!r){const a=this.root.ownerSVGElement;let o=0,h=`${l}-${o}`;if(a)for(r=a.ownerDocument.getElementById(h);r&&r.ownerSVGElement!==a;)h=`${l}-${o++}`,r=a.ownerDocument.getElementById(h);else h="id"+ ++this.refCount;r||(r=this.createSvgGradient(t,e,i,s,n),r.setAttribute("id",h),this.defs?this.defs.appendChild(r):a&&a.appendChild(r)),this.gradients[l]=r}return r.getAttribute("id")}createSvgGradient(t,e,i,s,n){const l=this.createElement("linearGradient");l.setAttribute("x1","0%"),l.setAttribute("y1","0%"),l.setAttribute("x2","0%"),l.setAttribute("y2","0%"),null==n||n===a.DIRECTION.SOUTH?l.setAttribute("y2","100%"):n===a.DIRECTION.EAST?l.setAttribute("x2","100%"):n===a.DIRECTION.NORTH?l.setAttribute("y1","100%"):n===a.DIRECTION.WEST&&l.setAttribute("x1","100%");let r=i<1?`;stop-opacity:${i}`:"",o=this.createElement("stop");return o.setAttribute("offset","0%"),o.setAttribute("style",`stop-color:${t}${r}`),l.appendChild(o),r=s<1?`;stop-opacity:${s}`:"",o=this.createElement("stop"),o.setAttribute("offset","100%"),o.setAttribute("style",`stop-color:${e}${r}`),l.appendChild(o),l}addNode(t,e){const{node:i}=this,s=this.state;if(i){if("path"===i.nodeName){if(!(this.path&&this.path.length>0))return;i.setAttribute("d",this.path.join(" "))}t&&s.fillColor!==a.NONE?this.updateFill():this.styleEnabled||("ellipse"===i.nodeName&&r.A.IS_FF?i.setAttribute("fill","transparent"):i.setAttribute("fill",a.NONE),t=!1),e&&s.strokeColor!==a.NONE?this.updateStroke():this.styleEnabled||i.setAttribute("stroke",a.NONE),s.transform&&s.transform.length>0&&i.setAttribute("transform",s.transform),s.shadow&&this.root.appendChild(this.createShadow(i)),this.strokeTolerance>0&&!t&&this.root.appendChild(this.createTolerance(i)),this.pointerEvents?i.setAttribute("pointer-events",this.pointerEventsValue):this.pointerEvents||this.originalRoot||i.setAttribute("pointer-events",a.NONE),("rect"!==i.nodeName&&"path"!==i.nodeName&&"ellipse"!==i.nodeName||i.getAttribute("fill")!==a.NONE&&"transparent"!==i.getAttribute("fill")||i.getAttribute("stroke")!==a.NONE||i.getAttribute("pointer-events")!==a.NONE)&&this.root.appendChild(i),this.node=null}}updateFill(){const t=this.state;if((t.alpha<1||t.fillAlpha<1)&&this.node.setAttribute("fill-opacity",String(t.alpha*t.fillAlpha)),t.fillColor!==a.NONE)if(t.gradientColor!==a.NONE){const e=this.getSvgGradient(t.fillColor,t.gradientColor,t.gradientFillAlpha,t.gradientAlpha,t.gradientDirection);if(this.root?.ownerDocument===document&&g){const t=this.getBaseUrl().replace(/([()])/g,"\\$1");this.node.setAttribute("fill",`url(${t}#${e})`)}else this.node.setAttribute("fill",`url(#${e})`)}else this.node.setAttribute("fill",t.fillColor.toLowerCase())}getCurrentStrokeWidth(){return Math.max(this.minStrokeWidth,Math.max(.01,this.format(this.state.strokeWidth*this.state.scale)))}updateStroke(){const t=this.state;t.strokeColor&&t.strokeColor!==a.NONE&&this.node.setAttribute("stroke",t.strokeColor.toLowerCase()),(t.alpha<1||t.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",String(t.alpha*t.strokeAlpha));const e=this.getCurrentStrokeWidth();1!==e&&this.node.setAttribute("stroke-width",String(e)),"path"===this.node.nodeName&&this.updateStrokeAttributes(),t.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((t.fixDash?1:t.strokeWidth)*t.scale))}updateStrokeAttributes(){const t=this.state;if(t.lineJoin&&"miter"!==t.lineJoin&&this.node.setAttribute("stroke-linejoin",t.lineJoin),t.lineCap){let e=t.lineCap;"flat"===e&&(e="butt"),"butt"!==e&&this.node.setAttribute("stroke-linecap",e)}null==t.miterLimit||this.styleEnabled&&10===t.miterLimit||this.node.setAttribute("stroke-miterlimit",String(t.miterLimit))}createDashPattern(t){const e=[];if("string"==typeof this.state.dashPattern){const i=this.state.dashPattern.split(" ");if(i.length>0)for(let s=0;s<i.length;s+=1)e[s]=Number(i[s])*t}return e.join(" ")}createTolerance(t){const e=t.cloneNode(!0),i=parseFloat(e.getAttribute("stroke-width")||"1")+this.strokeTolerance;return e.setAttribute("pointer-events","stroke"),e.setAttribute("visibility","hidden"),e.removeAttribute("stroke-dasharray"),e.setAttribute("stroke-width",String(i)),e.setAttribute("fill","none"),e.setAttribute("stroke","white"),e}createShadow(t){const e=t.cloneNode(!0),i=this.state;return"none"===e.getAttribute("fill")||r.A.IS_FF&&"transparent"===e.getAttribute("fill")||e.setAttribute("fill",i.shadowColor),"none"!==e.getAttribute("stroke")&&i.shadowColor&&i.shadowColor!==a.NONE&&e.setAttribute("stroke",i.shadowColor),e.setAttribute("transform",`translate(${this.format(i.shadowDx*i.scale)},${this.format(i.shadowDy*i.scale)})${i.transform||""}`),e.setAttribute("opacity",String(i.shadowAlpha)),e}setLink(t){if(t){this.originalRoot=this.root;const e=this.createElement("a");null==e.setAttributeNS||this.root.ownerDocument!==document?e.setAttribute("xlink:href",t):e.setAttributeNS(a.NS_XLINK,"xlink:href",t),this.root.appendChild(e),this.root=e}else this.root=this.originalRoot}rotate(t,e,i,s,n){if(0!==t||e||i){const l=this.state;if(s+=l.dx,n+=l.dy,s*=l.scale,n*=l.scale,l.transform=l.transform||"",e&&i)t+=180;else if(e!==i){const t=e?s:0,r=e?-1:1,a=i?n:0,o=i?-1:1;l.transform+=`translate(${this.format(t)},${this.format(a)})scale(${this.format(r)},${this.format(o)})translate(${this.format(-t)},${this.format(-a)})`}(e?!i:i)&&(t*=-1),0!==t&&(l.transform+=`rotate(${this.format(t)},${this.format(s)},${this.format(n)})`),l.rotation+=t,l.rotationCx=s,l.rotationCy=n}}begin(){super.begin(),this.node=this.createElement("path")}rect(t,e,i,s){const n=this.state,l=this.createElement("rect");l.setAttribute("x",String(this.format((t+n.dx)*n.scale))),l.setAttribute("y",String(this.format((e+n.dy)*n.scale))),l.setAttribute("width",String(this.format(i*n.scale))),l.setAttribute("height",String(this.format(s*n.scale))),this.node=l}roundrect(t,e,i,s,n,l){this.rect(t,e,i,s),n>0&&this.node.setAttribute("rx",String(this.format(n*this.state.scale))),l>0&&this.node.setAttribute("ry",String(this.format(l*this.state.scale)))}ellipse(t,e,i,s){const n=this.state,l=this.createElement("ellipse");l.setAttribute("cx",String(this.format((t+i/2+n.dx)*n.scale))),l.setAttribute("cy",String(this.format((e+s/2+n.dy)*n.scale))),l.setAttribute("rx",String(i/2*n.scale)),l.setAttribute("ry",String(s/2*n.scale)),this.node=l}image(t,e,i,s,n,l=!0,r=!1,o=!1){n=this.converter.convert(n);const h=this.state;t+=h.dx,e+=h.dy;const d=this.createElement("image");d.setAttribute("x",String(this.format(t*h.scale)+this.imageOffset)),d.setAttribute("y",String(this.format(e*h.scale)+this.imageOffset)),d.setAttribute("width",String(this.format(i*h.scale))),d.setAttribute("height",String(this.format(s*h.scale))),d.setAttributeNS?d.setAttributeNS(a.NS_XLINK,"xlink:href",n):d.setAttribute("xlink:href",n),l||d.setAttribute("preserveAspectRatio","none"),(h.alpha<1||h.fillAlpha<1)&&d.setAttribute("opacity",String(h.alpha*h.fillAlpha));let c=this.state.transform||"";if(r||o){let n=1,l=1,a=0,d=0;r&&(n=-1,a=-i-2*t),o&&(l=-1,d=-s-2*e),c+=`scale(${n},${l})translate(${a*h.scale},${d*h.scale})`}c.length>0&&d.setAttribute("transform",c),this.pointerEvents||d.setAttribute("pointer-events","none"),this.root.appendChild(d)}convertHtml(t){const e=(new DOMParser).parseFromString(t,"text/html");return null!=e&&("<body"===(t=(new XMLSerializer).serializeToString(e.body)).substring(0,5)&&(t=t.substring(t.indexOf(">",5)+1)),"</body>"===t.substring(t.length-7,t.length)&&(t=t.substring(0,t.length-7))),t}createDiv(t){let e=t;if((0,c.isNode)(e)||(e=`<div><div>${this.convertHtml(e)}</div></div>`),document.createElementNS){const t=document.createElementNS("http://www.w3.org/1999/xhtml","div");if((0,c.isNode)(e)){const i=e,s=document.createElement("div"),n=s.cloneNode(!1);this.root.ownerDocument!==document?s.appendChild(i.cloneNode(!0)):s.appendChild(i),n.appendChild(s),t.appendChild(n)}else t.innerHTML=e;return t}return(0,c.isNode)(e)&&(e=`<div><div>${(0,d.getXml)(e)}</div></div>`),e=`<div xmlns="http://www.w3.org/1999/xhtml">${e}</div>`,(new DOMParser).parseFromString(e,"text/xml").documentElement}updateText(t,e,i,s,n,l,r,a,o,h,d){d&&d.firstChild&&d.firstChild.firstChild&&this.updateTextNodes(t,e,i,s,n,l,r,a,o,h,d.firstChild)}addForeignObject(t,e,i,s,n,l,r,a,o,h,d,c,u,g,p){const E=this.createElement("g"),C=this.createElement("foreignObject");if(C.setAttribute("style","overflow: visible; text-align: left;"),C.setAttribute("pointer-events","none"),C.appendChild(g),E.appendChild(C),this.updateTextNodes(t,e,i,s,l,r,a,h,d,c,E),this.root?.ownerDocument!==document){const u=this.createAlternateContent(C,t,e,i,s,n,l,r,a,o,h,d,c);if(null!=u){C.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility");const t=this.createElement("switch");t.appendChild(C),t.appendChild(u),E.appendChild(t)}}p.appendChild(E)}updateTextNodes(t,e,i,s,n,l,r,o,h,d,c){const u=this.state.scale;p.createCss(i+2,s,n,l,r,o,h,null!=this.state.fontBackgroundColor?this.state.fontBackgroundColor:null,null!=this.state.fontBorderColor?this.state.fontBorderColor:null,`display: flex; align-items: unsafe ${l===a.ALIGN.TOP?"flex-start":l===a.ALIGN.BOTTOM?"flex-end":"center"}; justify-content: unsafe ${n===a.ALIGN.LEFT?"flex-start":n===a.ALIGN.RIGHT?"flex-end":"center"}; `,this.getTextCss(),u,((i,s,n,l,r)=>{t+=this.state.dx,e+=this.state.dy;const a=c.firstChild,o=a.firstChild,h=o.firstChild,g=h.firstChild,p=(this.rotateHtml?this.state.rotation:0)+(null!=d?d:0);let E=(0!==this.foOffset?`translate(${this.foOffset} ${this.foOffset})`:"")+(1!==u?`scale(${u})`:"");g.setAttribute("style",r),h.setAttribute("style",l),a.setAttribute("width",`${Math.ceil(1/Math.min(1,u)*100)}%`),a.setAttribute("height",`${Math.ceil(1/Math.min(1,u)*100)}%`);const C=Math.round(e+s);C<0?a.setAttribute("y",String(C)):(a.removeAttribute("y"),n+=`padding-top: ${C}px; `),o.setAttribute("style",`${n}margin-left: ${Math.round(t+i)}px;`),E+=0!==p?`rotate(${p} ${t} ${e})`:"",""!==E?c.setAttribute("transform",E):c.removeAttribute("transform"),1!==this.state.alpha?c.setAttribute("opacity",String(this.state.alpha)):c.removeAttribute("opacity")}))}getTextCss(){const t=this.state,e=a.ABSOLUTE_LINE_HEIGHT?t.fontSize*a.LINE_HEIGHT+"px":a.LINE_HEIGHT*this.lineHeightCorrection;let i=`display: inline-block; font-size: ${t.fontSize}px; font-family: ${t.fontFamily}; color: ${t.fontColor}; line-height: ${e}; pointer-events: ${this.pointerEvents?this.pointerEventsValue:"none"}; `;const s=t.fontStyle;(0,l.matchBinaryMask)(s,a.FONT.BOLD)&&(i+="font-weight: bold; "),(0,l.matchBinaryMask)(s,a.FONT.ITALIC)&&(i+="font-style: italic; ");const n=[];return(0,l.matchBinaryMask)(s,a.FONT.UNDERLINE)&&n.push("underline"),(0,l.matchBinaryMask)(s,a.FONT.STRIKETHROUGH)&&n.push("line-through"),n.length>0&&(i+=`text-decoration: ${n.join(" ")}; `),i}text(t,e,i,s,n,l,r,a,o,h,d,c=0,u){if(this.textEnabled&&null!=n)if(c=null!=c?c:0,this.foEnabled&&"html"===o){const g=this.createDiv(n);null!=g&&(null!=u&&g.setAttribute("dir",u),this.addForeignObject(t,e,i,s,n,l,r,a,o,h,d,c,u,g,this.root))}else this.plainText(t+this.state.dx,e+this.state.dy,i,s,n,l,r,a,h,d,c,u)}createClip(t,e,i,s){const n=`mx-clip-${t=Math.round(t)}-${e=Math.round(e)}-${i=Math.round(i)}-${s=Math.round(s)}`;let l=0,r=`${n}-${l}`;for(;null!=document.getElementById(r);)r=`${n}-${++l}`;const a=this.createElement("clipPath");a.setAttribute("id",r);const o=this.createElement("rect");return o.setAttribute("x",String(t)),o.setAttribute("y",String(e)),o.setAttribute("width",String(i)),o.setAttribute("height",String(s)),a.appendChild(o),a}plainText(t,e,i,s,n,l,o,h,d,g,p=0,E){const C=this.state,m=C.fontSize,f=this.createElement("g");let y=C.transform||"";if(this.updateFont(f),this.pointerEvents||null!=this.originalRoot||f.setAttribute("pointer-events","none"),0!==p&&(y+=`rotate(${p},${this.format(t*C.scale)},${this.format(e*C.scale)})`),null!=E&&f.setAttribute("direction",E),g&&i>0&&s>0){let n=t,h=e;l===a.ALIGN.CENTER?n-=i/2:l===a.ALIGN.RIGHT&&(n-=i),"fill"!==d&&(o===a.ALIGN.MIDDLE?h-=s/2:o===a.ALIGN.BOTTOM&&(h-=s));const c=this.createClip(n*C.scale-2,h*C.scale-2,i*C.scale+4,s*C.scale+4);if(null!=this.defs?this.defs.appendChild(c):this.root.appendChild(c),r.A.IS_CHROMEAPP||r.A.IS_EDGE||this.root.ownerDocument!==document)f.setAttribute("clip-path",`url(#${c.getAttribute("id")})`);else{const t=this.getBaseUrl().replace(/([()])/g,"\\$1");f.setAttribute("clip-path",`url(${t}#${c.getAttribute("id")})`)}}const v=l===a.ALIGN.RIGHT?"end":l===a.ALIGN.CENTER?"middle":"start";"start"!==v&&f.setAttribute("text-anchor",v),this.styleEnabled&&m===a.DEFAULT_FONTSIZE||f.setAttribute("font-size",m*C.scale+"px"),y.length>0&&f.setAttribute("transform",y),C.alpha<1&&f.setAttribute("opacity",String(C.alpha));const A=n.split("\n"),_=Math.round(m*a.LINE_HEIGHT),b=m+(A.length-1)*_;let S=e+m-1;o===a.ALIGN.MIDDLE?S-="fill"===d?s/2:(this.matchHtmlAlignment&&g&&s>0?Math.min(b,s):b)/2:o===a.ALIGN.BOTTOM&&(S-="fill"===d?s:(this.matchHtmlAlignment&&g&&s>0?Math.min(b,s):b)+1);for(let e=0;e<A.length;e+=1){const i=(0,u.trim)(A[e]);if(i){const e=this.createElement("text");e.setAttribute("x",String(this.format(t*C.scale)+this.textOffset)),e.setAttribute("y",String(this.format(S*C.scale)+this.textOffset)),(0,c.write)(e,i),f.appendChild(e)}S+=_}this.root.appendChild(f),this.addTextBackground(f,n,t,e,i,"fill"===d?s:b,l,o,d)}updateFont(t){const e=this.state;e.fontColor&&e.fontColor!==a.NONE&&t.setAttribute("fill",e.fontColor),this.styleEnabled&&e.fontFamily===a.DEFAULT_FONTFAMILY||t.setAttribute("font-family",e.fontFamily);const i=e.fontStyle;(0,l.matchBinaryMask)(i,a.FONT.BOLD)&&t.setAttribute("font-weight","bold"),(0,l.matchBinaryMask)(i,a.FONT.ITALIC)&&t.setAttribute("font-style","italic");const s=[];(0,l.matchBinaryMask)(i,a.FONT.UNDERLINE)&&s.push("underline"),(0,l.matchBinaryMask)(i,a.FONT.STRIKETHROUGH)&&s.push("line-through"),s.length>0&&t.setAttribute("text-decoration",s.join(" "))}addTextBackground(t,e,i,s,r,h,d,c,g){const p=this.state;if(null!=p.fontBackgroundColor||null!=p.fontBorderColor){let E=null;if("fill"===g||"width"===g)d===a.ALIGN.CENTER?i-=r/2:d===a.ALIGN.RIGHT&&(i-=r),c===a.ALIGN.MIDDLE?s-=h/2:c===a.ALIGN.BOTTOM&&(s-=h),E=new o.A((i+1)*p.scale,s*p.scale,(r-2)*p.scale,(h+2)*p.scale);else if(null!=t.getBBox&&this.root.ownerDocument===document)try{E=t.getBBox(),E=new o.A(E.x,E.y+1,E.width,E.height+0)}catch(t){}if(null==E||0===E.width||0===E.height){const t=document.createElement("div");t.style.lineHeight=a.ABSOLUTE_LINE_HEIGHT?p.fontSize*a.LINE_HEIGHT+"px":String(a.LINE_HEIGHT),t.style.fontSize=`${p.fontSize}px`,t.style.fontFamily=p.fontFamily,t.style.whiteSpace="nowrap",t.style.position="absolute",t.style.visibility="hidden",t.style.display="inline-block",(0,l.matchBinaryMask)(p.fontStyle,a.FONT.BOLD)&&(t.style.fontWeight="bold"),(0,l.matchBinaryMask)(p.fontStyle,a.FONT.ITALIC)&&(t.style.fontStyle="italic"),e=(0,u.htmlEntities)(e,!1),t.innerHTML=e.replace(/\n/g,"<br/>"),document.body.appendChild(t);const n=t.offsetWidth,r=t.offsetHeight;document.body.removeChild(t),d===a.ALIGN.CENTER?i-=n/2:d===a.ALIGN.RIGHT&&(i-=n),c===a.ALIGN.MIDDLE?s-=r/2:c===a.ALIGN.BOTTOM&&(s-=r),E=new o.A((i+1)*p.scale,(s+2)*p.scale,n*p.scale,(r+1)*p.scale)}if(null!=E){const e=this.createElement("rect");e.setAttribute("fill",p.fontBackgroundColor||"none"),e.setAttribute("stroke",p.fontBorderColor||"none"),e.setAttribute("x",String(Math.floor(E.x-1))),e.setAttribute("y",String(Math.floor(E.y-1))),e.setAttribute("width",String(Math.ceil(E.width+2))),e.setAttribute("height",String(Math.ceil(E.height)));const i=p.fontBorderColor?Math.max(1,this.format(p.scale)):0;e.setAttribute("stroke-width",String(i)),this.root?.ownerDocument===document&&1===(0,n.mod)(i,2)&&e.setAttribute("transform","translate(0.5, 0.5)"),t.insertBefore(e,t.firstChild)}}}stroke(){this.addNode(!1,!0)}fill(){this.addNode(!0,!1)}fillAndStroke(){this.addNode(!0,!0)}}p.createCss=(t,e,i,s,n,r,o,h,d,c,u,g,p)=>{let E=`box-sizing: border-box; font-size: 0; text-align: ${i===a.ALIGN.LEFT?"left":i===a.ALIGN.RIGHT?"right":"center"}; `;const C=(0,l.getAlignmentAsPoint)(i,s);let m="overflow: hidden; ",f="width: 1px; ",y="height: 1px; ",v=C.x*t,A=C.y*e;o?(f=`width: ${Math.round(t)}px; `,E+=`max-height: ${Math.round(e)}px; `,A=0):"fill"===r?(f=`width: ${Math.round(t)}px; `,y=`height: ${Math.round(e)}px; `,u+="width: 100%; height: 100%; ",E+=f+y):"width"===r?(f=`width: ${Math.round(t)}px; `,u+="width: 100%; ",E+=f,A=0,e>0&&(E+=`max-height: ${Math.round(e)}px; `)):(m="",A=0);let _="";h&&(_+=`background-color: ${h}; `),d&&(_+=`border: 1px solid ${d}; `),""==m||o?u+=_:E+=_,n&&t>0?(u+=`white-space: normal; word-wrap: ${a.WORD_WRAP}; `,f=`width: ${Math.round(t)}px; `,""!==m&&"fill"!==r&&(A=0)):(u+="white-space: nowrap; ",""===m&&(v=0)),p(v,A,c+f+y,E+m,u,m)};const E=p},8981:(t,e,i)=>{i.d(e,{A:()=>h,f:()=>o});var s=i(1532),n=i(8291),l=i(9447),r=i(6498),a=i(6960);class o{constructor(t=null,e=null,i={}){this.invalidating=!1,this.onInit=null,this.overlays=[],this.id=null,this.value=null,this.geometry=null,this.style={},this.vertex=!1,this.edge=!1,this.connectable=!0,this.visible=!0,this.collapsed=!1,this.parent=null,this.source=null,this.target=null,this.children=[],this.edges=[],this.mxTransient=["id","value","parent","source","target","children","edges"],this.value=t,this.setGeometry(e),this.setStyle(i),this.onInit&&this.onInit()}getChildren(){return this.children||[]}getId(){return this.id}setId(t){this.id=t}getValue(){return this.value}setValue(t){this.value=t}valueChanged(t){const e=this.getValue();return this.setValue(t),e}getGeometry(){return this.geometry}setGeometry(t){this.geometry=t}getStyle(){return this.style}getClonedStyle(){return(0,n.clone)(this.getStyle())}setStyle(t){this.style=t}isVertex(){return this.vertex}setVertex(t){this.vertex=t}isEdge(){return this.edge}setEdge(t){this.edge=t}isConnectable(){return this.connectable}setConnectable(t){this.connectable=t}isVisible(){return this.visible}setVisible(t){this.visible=t}isCollapsed(){return this.collapsed}setCollapsed(t){this.collapsed=t}getParent(){return this.parent}setParent(t){this.parent=t}getTerminal(t=!1){return t?this.source:this.target}setTerminal(t,e){return e?this.source=t:this.target=t,t}getChildCount(){return this.children.length}getIndex(t){return null===t?-1:this.children.indexOf(t)}getChildAt(t){return this.children[t]}insert(t,e){return void 0===e&&(e=this.getChildCount(),t.getParent()===this&&e--),t.removeFromParent(),t.setParent(this),this.children.splice(e,0,t),t}remove(t){let e=null;return t>=0&&(e=this.getChildAt(t),e&&(this.children.splice(t,1),e.setParent(null))),e}removeFromParent(){if(this.parent){const t=this.parent.getIndex(this);this.parent.remove(t)}}getEdgeCount(){return this.edges.length}getEdgeIndex(t){return this.edges.indexOf(t)}getEdgeAt(t){return this.edges[t]}insertEdge(t,e=!1){return t.removeFromTerminal(e),t.setTerminal(this,e),(0===this.edges.length||t.getTerminal(!e)!==this||this.edges.indexOf(t)<0)&&this.edges.push(t),t}removeEdge(t,e=!1){if(null!=t){if(t.getTerminal(!e)!==this&&null!=this.edges){const e=this.getEdgeIndex(t);e>=0&&this.edges.splice(e,1)}t.setTerminal(null,e)}return t}removeFromTerminal(t){const e=this.getTerminal(t);e&&e.removeEdge(this,t)}hasAttribute(t){const e=this.getValue();return(0,a.isNotNullish)(e)&&(e.nodeType===s.NODETYPE.ELEMENT&&e.hasAttribute?e.hasAttribute(t):(0,a.isNotNullish)(e.getAttribute?.(t)))}getAttribute(t,e){const i=this.getValue();return((0,a.isNotNullish)(i)&&i.nodeType===s.NODETYPE.ELEMENT?i.getAttribute?.(t):null)??e}setAttribute(t,e){const i=this.getValue();(0,a.isNotNullish)(i)&&i.nodeType===s.NODETYPE.ELEMENT&&i.setAttribute?.(t,e)}clone(){const t=(0,n.clone)(this,this.mxTransient);return t.setValue(this.cloneValue()),t}cloneValue(){let t=this.getValue();return(0,a.isNotNullish)(t)&&("function"==typeof t.clone?t=t.clone():(0,a.isNotNullish)(t.nodeType)&&t.cloneNode&&(t=t.cloneNode(!0))),t}getNearestCommonAncestor(t){let e=r.A.create(t);if(e.length>0){let i=this,s=r.A.create(i);if(e.length<s.length){i=t;const n=s;s=e,e=n}for(;i&&s;){const t=i.getParent();if(0===e.indexOf(s+r.A.PATH_SEPARATOR)&&t)return i;s=r.A.getParentPath(s),i=t}}return null}isAncestor(t){for(;t&&t!==this;)t=t.getParent();return t===this}getChildVertices(){return this.getChildCells(!0,!1)}getChildEdges(){return this.getChildCells(!1,!0)}getChildCells(t=!1,e=!1){const i=this.getChildCount(),s=[];for(let n=0;n<i;n+=1){const i=this.getChildAt(n);(!e&&!t||e&&i.isEdge()||t&&i.isVertex())&&s.push(i)}return s}getDirectedEdgeCount(t,e=null){let i=0;const s=this.getEdgeCount();for(let n=0;n<s;n+=1){const s=this.getEdgeAt(n);s!==e&&s&&s.getTerminal(t)===this&&(i+=1)}return i}getConnections(){return this.getEdges(!0,!0,!1)}getIncomingEdges(){return this.getEdges(!0,!1,!1)}getOutgoingEdges(){return this.getEdges(!1,!0,!1)}getEdges(t=!0,e=!0,i=!0){const s=this.getEdgeCount(),n=[];for(let l=0;l<s;l+=1){const s=this.getEdgeAt(l),r=s.getTerminal(!0),a=s.getTerminal(!1);(i&&r===a||r!==a&&(t&&a===this||e&&r===this))&&n.push(s)}return n}getOrigin(){let t=new l.A;const e=this.getParent();if(e&&(t=e.getOrigin(),!this.isEdge())){const e=this.getGeometry();e&&(t.x+=e.x,t.y+=e.y)}return t}getDescendants(){return this.filterDescendants(null)}filterDescendants(t){let e=[];(null===t||t(this))&&e.push(this);const i=this.getChildCount();for(let s=0;s<i;s+=1){const i=this.getChildAt(s);e=e.concat(i.filterDescendants(t))}return e}getRoot(){let t=this,e=t;for(;t;)e=t,t=t.getParent();return e}}const h=o},4113:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(1532),n=i(7620),l=i(1508);const r=class{constructor(t,e,i,l){this.strokeWidth=0,this.dashed=!1,this.opacity=100,this.shape=null,this.keepOnTop=!1,this.state=null,this.spacing=2,this.graph=t,this.highlightColor=e??s.DEFAULT_VALID_COLOR,this.strokeWidth=i??s.HIGHLIGHT_STROKEWIDTH,this.dashed=l??!1,this.opacity=s.HIGHLIGHT_OPACITY,this.repaintHandler=()=>{if(this.state){const t=this.graph.view.getState(this.state.cell);t?(this.state=t,this.repaint()):this.hide()}},this.graph.getView().addListener(n.A.SCALE,this.repaintHandler),this.graph.getView().addListener(n.A.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(n.A.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getDataModel().addListener(n.A.CHANGE,this.repaintHandler),this.resetHandler=()=>{this.hide()},this.graph.getView().addListener(n.A.DOWN,this.resetHandler),this.graph.getView().addListener(n.A.UP,this.resetHandler)}setHighlightColor(t){this.highlightColor=t,this.shape&&(this.shape.stroke=t)}drawHighlight(){if(this.shape=this.createShape(),this.repaint(),this.shape){const t=this.shape.node;!this.keepOnTop&&t?.parentNode?.firstChild!==t&&t.parentNode&&t.parentNode.insertBefore(t,t.parentNode.firstChild)}}createShape(){if(!this.state)return null;const t=this.graph.cellRenderer.createShape(this.state);return t.svgStrokeTolerance=this.graph.getEventTolerance(),t.points=this.state.absolutePoints,t.apply(this.state),t.stroke=this.highlightColor,t.opacity=this.opacity,t.isDashed=this.dashed,t.isShadow=!1,t.dialect=s.DIALECT.SVG,t.init(this.graph.getView().getOverlayPane()),n.A.redirectMouseEvents(t.node,this.graph,this.state),this.graph.dialect!==s.DIALECT.SVG?t.pointerEvents=!1:t.svgPointerEvents="stroke",t}getStrokeWidth(t=null){return this.strokeWidth}repaint(){this.state&&this.shape&&(this.shape.scale=this.state.view.scale,this.state.cell.isEdge()?(this.shape.strokeWidth=this.getStrokeWidth(),this.shape.points=this.state.absolutePoints,this.shape.outline=!1):(this.shape.bounds=new l.A(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=this.state.style.rotation??0,this.shape.strokeWidth=this.getStrokeWidth()/this.state.view.scale,this.shape.outline=!0),this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())}hide(){this.highlight(null)}highlight(t=null){this.state!==t&&(this.shape&&(this.shape.destroy(),this.shape=null),this.state=t,this.state&&this.drawHighlight())}isHighlightAt(t,e){let i=!1;if(this.shape&&document.elementFromPoint){let s=document.elementFromPoint(t,e);for(;s;){if(s===this.shape.node){i=!0;break}s=s.parentNode}}return i}destroy(){const t=this.graph;t.getView().removeListener(this.resetHandler),t.getView().removeListener(this.repaintHandler),t.getDataModel().removeListener(this.repaintHandler),this.shape&&(this.shape.destroy(),this.shape=null)}}},6498:(t,e,i)=>{i.d(e,{A:()=>n});class s{constructor(){throw new Error("Static class can't be instantiated!")}static create(t){let e="",i=t.getParent();for(;i;)e=i.getIndex(t)+s.PATH_SEPARATOR+e,i=(t=i).getParent();const n=e.length;return n>1&&(e=e.substring(0,n-1)),e}static getParentPath(t){const e=t.lastIndexOf(s.PATH_SEPARATOR);return e>=0?t.substring(0,e):t.length>0?"":null}static resolve(t,e){let i=t;const n=e.split(s.PATH_SEPARATOR);for(let t=0;t<n.length;t+=1)i=i.getChildAt(parseInt(n[t]));return i}static compare(t,e){const i=Math.min(t.length,e.length);let s=0;for(let n=0;n<i;n+=1)if(t[n]!==e[n]){if(0===t[n].length||0===e[n].length)s=t[n]===e[n]?0:t[n]>e[n]?1:-1;else{const i=parseInt(t[n]),l=parseInt(e[n]);s=i===l?0:i>l?1:-1}break}if(0===s){const i=t.length,n=e.length;i!==n&&(s=i>n?1:-1)}return s}}s.PATH_SEPARATOR=".";const n=s},5364:(t,e,i)=>{i.d(e,{A:()=>o});var s=i(9447),n=i(1508),l=i(5525),r=i(1532);class a extends n.A{constructor(t=null,e=null,i=null){super(),this.node=null,this.cellBounds=null,this.paintBounds=null,this.boundingBox=null,this.control=null,this.overlays=new l.A,this.invalidStyle=!1,this.invalid=!0,this.absolutePoints=[],this.visibleSourceState=null,this.visibleTargetState=null,this.terminalDistance=0,this.length=0,this.segments=[],this.shape=null,this.text=null,this.unscaledWidth=0,this.unscaledHeight=0,this.parentHighlight=null,this.point=null,t&&(this.view=t),e&&(this.cell=e),this.style=i??{},this.origin=new s.A,this.absoluteOffset=new s.A}getPerimeterBounds(t=0,e=new n.A(this.x,this.y,this.width,this.height)){if("fixed"===this.shape?.stencil?.aspect){const t=this.shape.stencil.computeAspect(this.shape,e.x,e.y,e.width,e.height);e.x=t.x,e.y=t.y,e.width=this.shape.stencil.w0*t.width,e.height=this.shape.stencil.h0*t.height}return 0!==t&&e.grow(t),e}setAbsoluteTerminalPoint(t,e=!1){e?0===this.absolutePoints.length?this.absolutePoints.push(t):this.absolutePoints[0]=t:0===this.absolutePoints.length?(this.absolutePoints.push(null),this.absolutePoints.push(t)):1===this.absolutePoints.length?this.absolutePoints.push(t):this.absolutePoints[this.absolutePoints.length-1]=t}setCursor(t){this.shape&&this.shape.setCursor(t),this.text&&this.text.setCursor(t)}getVisibleTerminal(t=!1){return this.getVisibleTerminalState(t)?.cell??null}getVisibleTerminalState(t=!1){return t?this.visibleSourceState:this.visibleTargetState}setVisibleTerminalState(t,e=!1){e?this.visibleSourceState=t:this.visibleTargetState=t}getCellBounds(){return this.cellBounds}getPaintBounds(){return this.paintBounds}updateCachedBounds(){const t=this.view,e=t.translate,i=t.scale;this.cellBounds=new n.A(this.x/i-e.x,this.y/i-e.y,this.width/i,this.height/i),this.paintBounds=n.A.fromRectangle(this.cellBounds),this.shape&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()}setState(t){this.view=t.view,this.cell=t.cell,this.style=t.style,this.absolutePoints=t.absolutePoints,this.origin=t.origin,this.absoluteOffset=t.absoluteOffset,this.boundingBox=t.boundingBox,this.terminalDistance=t.terminalDistance,this.segments=t.segments,this.length=t.length,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.unscaledWidth=t.unscaledWidth,this.unscaledHeight=t.unscaledHeight}clone(){const t=new a(this.view,this.cell,this.style);for(let e=0;e<this.absolutePoints.length;e+=1){const i=this.absolutePoints[e];t.absolutePoints[e]=i?i.clone():null}return this.origin&&(t.origin=this.origin.clone()),this.absoluteOffset&&(t.absoluteOffset=this.absoluteOffset.clone()),this.boundingBox&&(t.boundingBox=this.boundingBox.clone()),t.terminalDistance=this.terminalDistance,t.segments=this.segments,t.length=this.length,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.unscaledWidth=this.unscaledWidth,t.unscaledHeight=this.unscaledHeight,t}destroy(){this.view.graph.cellRenderer.destroy(this)}isLoop(t){const e=this.getVisibleTerminalState(!0);return e&&e===this.getVisibleTerminalState(!1)}getVerticalAlign(){return this.style.verticalAlign??r.ALIGN.MIDDLE}isTransparentState(){return(this.style.strokeColor??r.NONE)===r.NONE&&(this.style.fillColor??r.NONE)===r.NONE&&!this.getImageSrc()}getImageSrc(){return this.style.image||null}getIndicatorColor(){return this.style.indicatorColor||null}getIndicatorGradientColor(){return this.style.gradientColor||null}getIndicatorShape(){return this.style.indicatorShape||null}getIndicatorImageSrc(){return this.style.indicatorImage||null}}const o=a},4440:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(1508),n=i(5525);const l=class{constructor(t,e=1,i,l=null,r=null){this.view=t,this.oldValidateCellState=t.validateCellState,this.oldBounds=t.getGraphBounds(),this.oldStates=t.getStates(),this.oldScale=t.getScale(),this.oldDoRedrawShape=t.graph.cellRenderer.doRedrawShape,null!=r&&(t.graph.cellRenderer.doRedrawShape=e=>{const i=e?.shape,s=i.paint;i.paint=t=>{const n=r(e);null!=n&&t.setLink(n),s.apply(i,[t]),null!=n&&t.setLink(null)},this.oldDoRedrawShape.apply(t.graph.cellRenderer,[e]),i.paint=s}),t.validateCellState=(e,i)=>null==e||null==l||l(e)?this.oldValidateCellState.apply(t,[e,i]):null,t.setStates(new n.A),t.setScale(e),t.resetValidationState();let a=null;for(const e of i){const i=t.getBoundingBox(t.validateCellState(t.validateCell(e)));null==a?a=i:a.add(i)}t.setGraphBounds(a||new s.A)}destroy(){const t=this.view;t.setScale(this.oldScale),t.setStates(this.oldStates),t.setGraphBounds(this.oldBounds),t.validateCellState=this.oldValidateCellState,t.graph.cellRenderer.doRedrawShape=this.oldDoRedrawShape}}},4432:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t="",...e){if(this.consumed=!1,this.name=t,this.properties={},e[0]&&e[0].constructor===Object)for(const[t,i]of Object.entries(e[0]))this.properties[t]=i;else for(let t=0;t<e.length;t+=2)null!==e[t+1]&&(this.properties[e[t]]=e[t+1])}getName(){return this.name}getProperties(){return this.properties}getProperty(t){return this.properties[t]}isConsumed(){return this.consumed}consume(){this.consumed=!0}}},2354:(t,e,i)=>{i.d(e,{A:()=>n});var s=i(4432);const n=class{constructor(t=null){this.eventListeners=[],this.eventsEnabled=!0,this.eventSource=null,this.eventSource=t}isEventsEnabled(){return this.eventsEnabled}setEventsEnabled(t){this.eventsEnabled=t}getEventSource(){return this.eventSource}setEventSource(t){this.eventSource=t}addListener(t,e){this.eventListeners.push({name:t,funct:e})}removeListener(t){let e=0;for(;e<this.eventListeners.length;)this.eventListeners[e].funct===t?this.eventListeners.splice(e,1):e+=1}fireEvent(t,e=null){if(this.isEventsEnabled()){t||(t=new s.A("")),e||(e=this.getEventSource()),e||(e=this);for(const i of this.eventListeners)null!==i.name&&i.name!==t.getName()||i.funct.apply(this,[e,t])}}}},7620:(t,e,i)=>{i.d(e,{A:()=>o});var s=i(2387),n=i(7773),l=i(5524);let r=!1;try{document.addEventListener("test",(()=>{}),Object.defineProperty&&Object.defineProperty({},"passive",{get:()=>{r=!0}}))}catch(t){}class a{static addListener(t,e,i){t.addEventListener(e,i,!!r&&{passive:!1}),t.mxListenerList||(t.mxListenerList=[]);const s={name:e,f:i};t.mxListenerList.push(s)}static removeListener(t,e,i){if(t.removeEventListener(e,i,!1),t.mxListenerList){const e=t.mxListenerList.length;for(let s=0;s<e;s+=1)if(t.mxListenerList[s].f===i){t.mxListenerList.splice(s,1);break}}}static removeAllListeners(t){const e=t.mxListenerList;if(e)for(;e.length>0;){const i=e[0];a.removeListener(t,i.name,i.f)}}static addGestureListeners(t,e=null,i=null,s=null){e&&a.addListener(t,n.A.IS_POINTER?"pointerdown":"mousedown",e),i&&a.addListener(t,n.A.IS_POINTER?"pointermove":"mousemove",i),s&&a.addListener(t,n.A.IS_POINTER?"pointerup":"mouseup",s),!n.A.IS_POINTER&&n.A.IS_TOUCH&&(e&&a.addListener(t,"touchstart",e),i&&a.addListener(t,"touchmove",i),s&&a.addListener(t,"touchend",s))}static removeGestureListeners(t,e,i,s){e&&a.removeListener(t,n.A.IS_POINTER?"pointerdown":"mousedown",e),i&&a.removeListener(t,n.A.IS_POINTER?"pointermove":"mousemove",i),s&&a.removeListener(t,n.A.IS_POINTER?"pointerup":"mouseup",s),!n.A.IS_POINTER&&n.A.IS_TOUCH&&(e&&a.removeListener(t,"touchstart",e),i&&a.removeListener(t,"touchmove",i),s&&a.removeListener(t,"touchend",s))}static redirectMouseEvents(t,e,i=null,n=null,r=null,o=null,h=null){const d=t=>"function"==typeof i?i(t):i;a.addGestureListeners(t,(t=>{n?n(t):(0,l.isConsumed)(t)||e.fireMouseEvent(a.MOUSE_DOWN,new s.A(t,d(t)))}),(t=>{r?r(t):(0,l.isConsumed)(t)||e.fireMouseEvent(a.MOUSE_MOVE,new s.A(t,d(t)))}),(t=>{o?o(t):(0,l.isConsumed)(t)||e.fireMouseEvent(a.MOUSE_UP,new s.A(t,d(t)))})),a.addListener(t,"dblclick",(t=>{if(h)h(t);else if(!(0,l.isConsumed)(t)){const i=d(t);e.dblClick(t,i?.cell)}}))}static release(t){try{a.removeAllListeners(t);const e=t.childNodes;if(void 0!==e){const t=e.length;for(let i=0;i<t;i+=1)a.release(e[i])}}catch(t){}}static addMouseWheelListener(t,e){if(null!=t){const i=e=>{e.ctrlKey&&e.preventDefault(),(Math.abs(e.deltaX)>.5||Math.abs(e.deltaY)>.5)&&t(e,0==e.deltaY?-e.deltaX>0:-e.deltaY>0)};if(e=null!=e?e:window,n.A.IS_SF&&!n.A.IS_TOUCH){let i=1;a.addListener(e,"gesturestart",(t=>{a.consume(t),i=1})),a.addListener(e,"gesturechange",(e=>{if(a.consume(e),"number"==typeof e.scale){const s=i-e.scale;Math.abs(s)>.2&&(t(e,s<0,!0),i=e.scale)}})),a.addListener(e,"gestureend",(t=>{a.consume(t)}))}else{let i=[],s=0,n=0;a.addGestureListeners(e,(t=>{(0,l.isMouseEvent)(t)||null==t.pointerId||i.push(t)}),(e=>{if(!(0,l.isMouseEvent)(e)&&2==i.length){for(let t=0;t<i.length;t+=1)if(e.pointerId==i[t].pointerId){i[t]=e;break}const l=Math.abs(i[0].clientX-i[1].clientX),r=Math.abs(i[0].clientY-i[1].clientY),o=Math.abs(l-s),h=Math.abs(r-n);if(o>a.PINCH_THRESHOLD||h>a.PINCH_THRESHOLD){const e=i[0].clientX+(i[1].clientX-i[0].clientX)/2,a=i[0].clientY+(i[1].clientY-i[0].clientY)/2;t(i[0],o>h?l>s:r>n,!0,e,a),s=l,n=r}}}),(t=>{i=[],s=0,n=0}))}a.addListener(e,"wheel",i)}}static disableContextMenu(t){a.addListener(t,"contextmenu",(t=>(t.preventDefault&&t.preventDefault(),!1)))}static consume(t,e=!0,i=!0){e&&(t.preventDefault?(i&&t.stopPropagation(),t.preventDefault()):i&&(t.cancelBubble=!0)),t.isConsumed=!0,t.preventDefault||(t.returnValue=!1)}}a.LABEL_HANDLE=-1,a.ROTATION_HANDLE=-2,a.CUSTOM_HANDLE=-100,a.VIRTUAL_HANDLE=-1e5,a.MOUSE_DOWN="mouseDown",a.MOUSE_MOVE="mouseMove",a.MOUSE_UP="mouseUp",a.ACTIVATE="activate",a.RESIZE_START="resizeStart",a.RESIZE="resize",a.RESIZE_END="resizeEnd",a.MOVE_START="moveStart",a.MOVE="move",a.MOVE_END="moveEnd",a.PAN_START="panStart",a.PAN="pan",a.PAN_END="panEnd",a.MINIMIZE="minimize",a.NORMALIZE="normalize",a.MAXIMIZE="maximize",a.HIDE="hide",a.SHOW="show",a.CLOSE="close",a.DESTROY="destroy",a.REFRESH="refresh",a.SIZE="size",a.SELECT="select",a.FIRED="fired",a.FIRE_MOUSE_EVENT="fireMouseEvent",a.GESTURE="gesture",a.TAP_AND_HOLD="tapAndHold",a.GET="get",a.RECEIVE="receive",a.CONNECT="connect",a.DISCONNECT="disconnect",a.SUSPEND="suspend",a.RESUME="resume",a.MARK="mark",a.ROOT="root",a.POST="post",a.OPEN="open",a.SAVE="save",a.BEFORE_ADD_VERTEX="beforeAddVertex",a.ADD_VERTEX="addVertex",a.AFTER_ADD_VERTEX="afterAddVertex",a.DONE="done",a.EXECUTE="execute",a.EXECUTED="executed",a.BEGIN_UPDATE="beginUpdate",a.START_EDIT="startEdit",a.END_UPDATE="endUpdate",a.END_EDIT="endEdit",a.BEFORE_UNDO="beforeUndo",a.UNDO="undo",a.REDO="redo",a.CHANGE="change",a.NOTIFY="notify",a.LAYOUT_CELLS="layoutCells",a.CLICK="click",a.SCALE="scale",a.TRANSLATE="translate",a.SCALE_AND_TRANSLATE="scaleAndTranslate",a.UP="up",a.DOWN="down",a.ADD="add",a.REMOVE="remove",a.CLEAR="clear",a.ADD_CELLS="addCells",a.CELLS_ADDED="cellsAdded",a.MOVE_CELLS="moveCells",a.CELLS_MOVED="cellsMoved",a.RESIZE_CELLS="resizeCells",a.CELLS_RESIZED="cellsResized",a.TOGGLE_CELLS="toggleCells",a.CELLS_TOGGLED="cellsToggled",a.ORDER_CELLS="orderCells",a.CELLS_ORDERED="cellsOrdered",a.REMOVE_CELLS="removeCells",a.CELLS_REMOVED="cellsRemoved",a.GROUP_CELLS="groupCells",a.UNGROUP_CELLS="ungroupCells",a.REMOVE_CELLS_FROM_PARENT="removeCellsFromParent",a.FOLD_CELLS="foldCells",a.CELLS_FOLDED="cellsFolded",a.ALIGN_CELLS="alignCells",a.LABEL_CHANGED="labelChanged",a.CONNECT_CELL="connectCell",a.CELL_CONNECTED="cellConnected",a.SPLIT_EDGE="splitEdge",a.FLIP_EDGE="flipEdge",a.START_EDITING="startEditing",a.EDITING_STARTED="editingStarted",a.EDITING_STOPPED="editingStopped",a.ADD_OVERLAY="addOverlay",a.REMOVE_OVERLAY="removeOverlay",a.UPDATE_CELL_SIZE="updateCellSize",a.ESCAPE="escape",a.DOUBLE_CLICK="doubleClick",a.START="start",a.RESET="reset",a.PINCH_THRESHOLD=10;const o=a},2387:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(5524),n=i(4532);const l=class{constructor(t,e=null){this.consumed=!1,this.evt=t,this.state=e,this.sourceState=e,this.graphX=0,this.graphY=0}getEvent(){return this.evt}getSource(){return(0,s.getSource)(this.evt)}isSource(t){return!!t&&(0,n.isAncestorNode)(t.node,this.getSource())}getX(){return(0,s.getClientX)(this.getEvent())}getY(){return(0,s.getClientY)(this.getEvent())}getGraphX(){return this.graphX}getGraphY(){return this.graphY}getState(){return this.state}getCell(){const t=this.getState();return t?t.cell:null}isPopupTrigger(){return(0,s.isPopupTrigger)(this.getEvent())}isConsumed(){return this.consumed}consume(t){(t=t||window.TouchEvent&&this.evt instanceof TouchEvent||(0,s.isMouseEvent)(this.evt))&&this.evt.preventDefault&&this.evt.preventDefault(),this.consumed=!0}}},6381:(t,e,i)=>{i.d(e,{A:()=>h});var s=i(9447),n=i(1508),l=i(3514),r=i(1847),a=i(8291);class o extends n.A{constructor(t=0,e=0,i=0,s=0){super(t,e,i,s),this.TRANSLATE_CONTROL_POINTS=!0,this.alternateBounds=null,this.sourcePoint=null,this.targetPoint=null,this.points=null,this.offset=null,this.relative=!1}setRelative(t){this.relative=t}swap(){if(this.alternateBounds){const t=new n.A(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x,this.y=this.alternateBounds.y,this.width=this.alternateBounds.width,this.height=this.alternateBounds.height,this.alternateBounds=t}}getTerminalPoint(t){return t?this.sourcePoint:this.targetPoint}setTerminalPoint(t,e){return e?this.sourcePoint=t:this.targetPoint=t,t}rotate(t,e){const i=(0,l.toRadians)(t),n=Math.cos(i),r=Math.sin(i);if(!this.relative){const t=new s.A(this.getCenterX(),this.getCenterY()),i=(0,l.getRotatedPoint)(t,n,r,e);this.x=Math.round(i.x-this.width/2),this.y=Math.round(i.y-this.height/2)}if(this.sourcePoint){const t=(0,l.getRotatedPoint)(this.sourcePoint,n,r,e);this.sourcePoint.x=Math.round(t.x),this.sourcePoint.y=Math.round(t.y)}if(this.targetPoint){const t=(0,l.getRotatedPoint)(this.targetPoint,n,r,e);this.targetPoint.x=Math.round(t.x),this.targetPoint.y=Math.round(t.y)}if(this.points)for(let t=0;t<this.points.length;t+=1)if(this.points[t]){const i=(0,l.getRotatedPoint)(this.points[t],n,r,e);this.points[t].x=Math.round(i.x),this.points[t].y=Math.round(i.y)}}translate(t,e){if(this.relative||(this.x+=t,this.y+=e),this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x+t,this.sourcePoint.y=this.sourcePoint.y+e),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x+t,this.targetPoint.y=this.targetPoint.y+e),this.TRANSLATE_CONTROL_POINTS&&this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x+t,this.points[i].y=this.points[i].y+e)}scale(t,e,i){if(this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x*t,this.sourcePoint.y=this.sourcePoint.y*e),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x*t,this.targetPoint.y=this.targetPoint.y*e),this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x*t,this.points[i].y=this.points[i].y*e);this.relative||(this.x*=t,this.y*=e,i&&(e=t=Math.min(t,e)),this.width*=t,this.height*=e)}equals(t){return!!t&&super.equals(t)&&this.relative===t.relative&&(null===this.sourcePoint&&null===t.sourcePoint||!!this.sourcePoint?.equals(t.sourcePoint))&&(null===this.targetPoint&&null===t.targetPoint||!!this.targetPoint?.equals(t.targetPoint))&&(0,r.s7)(this.points,t.points)&&(null===this.alternateBounds&&null===t.alternateBounds||!!this.alternateBounds?.equals(t.alternateBounds))&&(null===this.offset&&null===t.offset||!!this.offset?.equals(t.offset))}clone(){return(0,a.clone)(this)}}const h=o},9447:(t,e,i)=>{i.d(e,{A:()=>n});class s{constructor(t=0,e=0){this._x=0,this._y=0,this.x=t,this.y=e}get x(){return this._x}set x(t){if(Number.isNaN(t))throw new Error("Invalid x supplied.");this._x=t}get y(){return this._y}set y(t){if(Number.isNaN(t))throw new Error("Invalid y supplied.");this._y=t}equals(t){return!!t&&t.x===this.x&&t.y===this.y}clone(){return new s(this.x,this.y)}}const n=s},1508:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(9447);class n extends s.A{constructor(t=0,e=0,i=0,s=0){super(t,e),this._width=0,this._height=0,this.width=i,this.height=s}get width(){return this._width}set width(t){if(Number.isNaN(t))throw new Error("Invalid width supplied.");this._width=t}get height(){return this._height}set height(t){if(Number.isNaN(t))throw new Error("Invalid height supplied.");this._height=t}setRect(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}add(t){const e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),s=Math.max(this.x+this.width,t.x+t.width),n=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.y=i,this.width=s-e,this.height=n-i}intersect(t){const e=this.x+this.width,i=t.x+t.width,s=this.y+this.height,n=t.y+t.height;this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.width=Math.min(e,i)-this.x,this.height=Math.min(s,n)-this.y}grow(t){this.x-=t,this.y-=t,this.width+=2*t,this.height+=2*t}getPoint(){return new s.A(this.x,this.y)}rotate90(){const t=(this.width-this.height)/2;this.x+=t,this.y-=t;const e=this.width;this.width=this.height,this.height=e}equals(t){return!!t&&t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}clone(){return new n(this.x,this.y,this.width,this.height)}}n.fromRectangle=t=>new n(t.x,t.y,t.width,t.height);const l=n},8760:(t,e,i)=>{i.d(e,{A:()=>u});var s=i(1508),n=i(6960),l=i(3514),r=i(1532),a=i(9447),o=i(4881),h=i(7620),d=i(7773),c=i(9639);const u=class{constructor(t=null){this.preserveImageAspect=!1,this.overlay=null,this.indicator=null,this.indicatorShape=null,this.opacity=100,this.isDashed=!1,this.fill=r.NONE,this.gradient=r.NONE,this.gradientDirection=r.DIRECTION.EAST,this.fillOpacity=100,this.strokeOpacity=100,this.stroke=r.NONE,this.strokeWidth=1,this.spacing=0,this.startSize=1,this.endSize=1,this.startArrow=r.NONE,this.endArrow=r.NONE,this.direction=r.DIRECTION.EAST,this.flipH=!1,this.flipV=!1,this.isShadow=!1,this.isRounded=!1,this.rotation=0,this.cursor="",this.verticalTextRotation=0,this.oldGradients={},this.glass=!1,this.dialect=null,this.scale=1,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.bounds=null,this.points=[],this.state=null,this.style=null,this.boundingBox=null,this.stencil=null,this.svgStrokeTolerance=8,this.pointerEvents=!0,this.originalPointerEvents=null,this.svgPointerEvents="all",this.shapePointerEvents=!1,this.stencilPointerEvents=!1,this.outline=!1,this.visible=!0,this.useSvgBoundingBox=!0,this.image=null,this.imageSrc=null,this.indicatorColor=r.NONE,this.indicatorStrokeColor=r.NONE,this.indicatorGradientColor=r.NONE,this.indicatorDirection=r.DIRECTION.EAST,this.indicatorImageSrc=null,t&&(this.stencil=t),this.node=this.create()}init(t){this.node.parentNode||t.appendChild(this.node)}initStyles(){this.strokeWidth=1,this.rotation=0,this.opacity=100,this.fillOpacity=100,this.strokeOpacity=100,this.flipH=!1,this.flipV=!1}isHtmlAllowed(){return!1}getSvgScreenOffset(){const t=this.stencil&&"inherit"!==this.stencil.strokeWidthValue?Number(this.stencil.strokeWidthValue):this.strokeWidth??0;return 1===(0,l.mod)(Math.max(1,Math.round(t*this.scale)),2)?.5:0}create(){return document.createElementNS(r.NS_SVG,"g")}redraw(){this.updateBoundsFromPoints(),this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)}clear(){for(;this.node.lastChild;)this.node.removeChild(this.node.lastChild)}updateBoundsFromPoints(){const t=this.points;if(t.length>0&&t[0]){this.bounds=new s.A(Math.round(t[0].x),Math.round(t[0].y),1,1);for(const e of t)e&&this.bounds.add(new s.A(Math.round(e.x),Math.round(e.y),1,1))}}getLabelBounds(t){const e=this.style?.direction??r.DIRECTION.EAST;let i=t.clone();e!==r.DIRECTION.SOUTH&&e!==r.DIRECTION.NORTH&&this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()&&(i=i.clone(),[i.width,i.height]=[i.height,i.width]);let s=this.getLabelMargins(i);if(s){s=s.clone();let e=this.style?.flipH??!1,i=this.style?.flipV??!1;if(this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()){const t=s.x;s.x=s.height,s.height=s.width,s.width=s.y,s.y=t,[e,i]=[i,e]}return(0,l.getDirectedBounds)(t,s,this.style,e,i)}return t}getLabelMargins(t){return null}checkBounds(){return!Number.isNaN(this.scale)&&Number.isFinite(this.scale)&&this.scale>0&&this.bounds&&!Number.isNaN(this.bounds.x)&&!Number.isNaN(this.bounds.y)&&!Number.isNaN(this.bounds.width)&&!Number.isNaN(this.bounds.height)&&this.bounds.width>0&&this.bounds.height>0}redrawShape(){const t=this.createCanvas();t&&(t.pointerEvents=this.pointerEvents,this.beforePaint(t),this.paint(t),this.afterPaint(t),this.node!==t.root&&t.root&&this.node.insertAdjacentHTML("beforeend",t.root.outerHTML),this.destroyCanvas(t))}createCanvas(){const t=this.createSvgCanvas();return t&&this.outline&&(t.setStrokeWidth(this.strokeWidth),t.setStrokeColor(this.stroke),this.isDashed&&t.setDashed(this.isDashed),t.setStrokeWidth=()=>{},t.setStrokeColor=()=>{},t.setFillColor=()=>{},t.setGradient=()=>{},t.setDashed=()=>{},t.text=()=>{}),t}createSvgCanvas(){if(!this.node)return null;const t=new o.A(this.node,!1);t.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0,t.pointerEventsValue=this.svgPointerEvents;const e=this.getSvgScreenOffset();return 0!==e?this.node.setAttribute("transform",`translate(${e},${e})`):this.node.removeAttribute("transform"),t.minStrokeWidth=this.minSvgStrokeWidth,this.antiAlias||(t.format=t=>Math.round(t)),t}destroyCanvas(t){if(t instanceof o.A){for(const e in t.gradients){const i=t.gradients[e];i&&(i.mxRefCount=(i.mxRefCount||0)+1)}this.releaseSvgGradients(this.oldGradients),this.oldGradients=t.gradients}}beforePaint(t){}afterPaint(t){}paint(t){let e=!1;if(t&&this.outline){const{stroke:i}=t;t.stroke=(...s)=>{e=!0,i.apply(t,s)};const{fillAndStroke:s}=t;t.fillAndStroke=(...i)=>{e=!0,s.apply(t,i)}}const i=this.scale,s=this.bounds;if(s){let l=s.x/i,r=s.y/i,o=s.width/i,h=s.height/i;if(this.isPaintBoundsInverted()){const t=(o-h)/2;l+=t,r-=t;const e=o;o=h,h=e}this.updateTransform(t,l,r,o,h),this.configureCanvas(t,l,r,o,h);let d=null;if(!this.stencil&&0===this.points.length&&this.shapePointerEvents||this.stencil&&this.stencilPointerEvents){const t=this.createBoundingBox();t&&this.node&&(d=this.createTransparentSvgRectangle(t.x,t.y,t.width,t.height),this.node.appendChild(d))}if(this.stencil)this.stencil.drawShape(t,this,l,r,o,h);else if(t.setStrokeWidth(this.strokeWidth),this.points.length>0){const e=[];for(let t=0;t<this.points.length;t+=1){const s=this.points[t];s&&e.push(new a.A(s.x/i,s.y/i))}this.paintEdgeShape(t,e)}else this.paintVertexShape(t,l,r,o,h);d&&t.state&&(0,n.isNotNullish)(t.state.transform)&&d.setAttribute("transform",t.state.transform),t&&this.outline&&!e&&(t.rect(l,r,o,h),t.stroke())}}configureCanvas(t,e,i,s,n){let l=null;if(this.style&&null!=this.style.dashPattern&&(l=this.style.dashPattern),t.setAlpha(this.opacity/100),t.setFillAlpha(this.fillOpacity/100),t.setStrokeAlpha(this.strokeOpacity/100),this.isShadow&&t.setShadow(this.isShadow),this.isDashed&&t.setDashed(this.isDashed,this.style?.fixDash??!1),l&&t.setDashPattern(l),this.fill!==r.NONE&&this.gradient!==r.NONE){const l=this.getGradientBounds(t,e,i,s,n);t.setGradient(this.fill,this.gradient,l.x,l.y,l.width,l.height,this.gradientDirection)}else t.setFillColor(this.fill);t.setStrokeColor(this.stroke)}getGradientBounds(t,e,i,n,l){return new s.A(e,i,n,l)}updateTransform(t,e,i,s,n){t.scale(this.scale),t.rotate(this.getShapeRotation(),this.flipH,this.flipV,e+s/2,i+n/2)}paintVertexShape(t,e,i,s,n){this.paintBackground(t,e,i,s,n),this.outline&&this.style&&this.style.backgroundOutline||(t.setShadow(!1),this.paintForeground(t,e,i,s,n))}paintBackground(t,e,i,s,n){}paintForeground(t,e,i,s,n){}paintEdgeShape(t,e){}getArcSize(t,e){let i=0;if(this.style?.absoluteArcSize)i=Math.min(t/2,Math.min(e/2,(this.style?.arcSize??r.LINE_ARCSIZE)/2));else{const s=(this.style?.arcSize??100*r.RECTANGLE_ROUNDING_FACTOR)/100;i=Math.min(t*s,e*s)}return i}paintGlassEffect(t,e,i,s,n,l){const r=Math.ceil((this.strokeWidth??0)/2),a=.4;t.setGradient("#ffffff","#ffffff",e,i,s,.6*n,"south",.9,.1),t.begin(),l+=2*r,this.isRounded?(t.moveTo(e-r+l,i-r),t.quadTo(e-r,i-r,e-r,i-r+l),t.lineTo(e-r,i+n*a),t.quadTo(e+.5*s,i+.7*n,e+s+r,i+n*a),t.lineTo(e+s+r,i-r+l),t.quadTo(e+s+r,i-r,e+s+r-l,i-r)):(t.moveTo(e-r,i-r),t.lineTo(e-r,i+n*a),t.quadTo(e+.5*s,i+.7*n,e+s+r,i+n*a),t.lineTo(e+s+r,i-r)),t.close(),t.fill()}addPoints(t,e,i=!1,s,n=!1,r=[],o=!0){if(e.length>0){const h=e[e.length-1];if(n&&i){const t=(e=e.slice())[0],i=new a.A(h.x+(t.x-h.x)/2,h.y+(t.y-h.y)/2);e.splice(0,0,i)}let d=e[0],c=1;for(o?t.moveTo(d.x,d.y):t.lineTo(d.x,d.y);c<(n?e.length:e.length-1);){let n=e[(0,l.mod)(c,e.length)],o=d.x-n.x,h=d.y-n.y;if(i&&(0!==o||0!==h)&&r.indexOf(c-1)<0){let i=Math.sqrt(o*o+h*h);const r=o*Math.min(s,i/2)/i,d=h*Math.min(s,i/2)/i,u=n.x+r,g=n.y+d;t.lineTo(u,g);let p=e[(0,l.mod)(c+1,e.length)];for(;c<e.length-2&&0===Math.round(p.x-n.x)&&0===Math.round(p.y-n.y);)p=e[(0,l.mod)(c+2,e.length)],c++;o=p.x-n.x,h=p.y-n.y,i=Math.max(1,Math.sqrt(o*o+h*h));const E=o*Math.min(s,i/2)/i,C=h*Math.min(s,i/2)/i,m=n.x+E,f=n.y+C;t.quadTo(n.x,n.y,m,f),n=new a.A(m,f)}else t.lineTo(n.x,n.y);d=n,c+=1}n?t.close():t.lineTo(h.x,h.y)}}resetStyles(){this.initStyles(),this.spacing=0,this.fill=r.NONE,this.gradient=r.NONE,this.gradientDirection=r.DIRECTION.EAST,this.stroke=r.NONE,this.startSize=1,this.endSize=1,this.startArrow=r.NONE,this.endArrow=r.NONE,this.direction=r.DIRECTION.EAST,this.isShadow=!1,this.isDashed=!1,this.isRounded=!1,this.glass=!1}apply(t){if(this.state=t,this.style=t.style,this.style){if(this.fill=this.style.fillColor??this.fill,this.gradient=this.style.gradientColor??this.gradient,this.gradientDirection=this.style.gradientDirection??this.gradientDirection,this.opacity=this.style.opacity??this.opacity,this.fillOpacity=this.style.fillOpacity??this.fillOpacity,this.strokeOpacity=this.style.strokeOpacity??this.strokeOpacity,this.stroke=this.style.strokeColor??this.stroke,this.strokeWidth=this.style.strokeWidth??this.strokeWidth,this.spacing=this.style.spacing??this.spacing,this.startSize=this.style.startSize??this.startSize,this.endSize=this.style.endSize??this.endSize,this.startArrow=this.style.startArrow??this.startArrow,this.endArrow=this.style.endArrow??this.endArrow,this.rotation=this.style.rotation??this.rotation,this.direction=this.style.direction??this.direction,this.flipH=!!this.style.flipH,this.flipV=!!this.style.flipV,this.direction===r.DIRECTION.NORTH||this.direction===r.DIRECTION.SOUTH){const t=this.flipH;this.flipH=this.flipV,this.flipV=t}this.isShadow=this.style.shadow??this.isShadow,this.isDashed=this.style.dashed??this.isDashed,this.isRounded=this.style.rounded??this.isRounded,this.glass=this.style.glass??this.glass}}setCursor(t){this.cursor=t,this.node.style.cursor=t}getCursor(){return this.cursor}isRoundable(t,e,i,s,n){return!1}updateBoundingBox(){if(this.useSvgBoundingBox&&this.node.ownerSVGElement)try{const t=this.node.getBBox();if(t.width>0&&t.height>0)return this.boundingBox=new s.A(t.x,t.y,t.width,t.height),void this.boundingBox.grow((this.strokeWidth??0)*this.scale/2)}catch(t){}if(this.bounds){let t=this.createBoundingBox();if(t){this.augmentBoundingBox(t);const e=this.getShapeRotation();0!==e&&(t=(0,l.getBoundingBox)(t,e))}this.boundingBox=t}}createBoundingBox(){if(!this.bounds)return null;const t=this.bounds.clone();return(this.stencil&&(this.direction===r.DIRECTION.NORTH||this.direction===r.DIRECTION.SOUTH)||this.isPaintBoundsInverted())&&t.rotate90(),t}augmentBoundingBox(t){this.isShadow&&(t.width+=Math.ceil(c.m5.shadowOffsetX*this.scale),t.height+=Math.ceil(c.m5.shadowOffsetX*this.scale)),t.grow((this.strokeWidth??0)*this.scale/2)}isPaintBoundsInverted(){return!this.stencil&&(this.direction===r.DIRECTION.NORTH||this.direction===r.DIRECTION.SOUTH)}getRotation(){return this.rotation??0}getTextRotation(){let t=this.getRotation();return(this.style?.horizontal??1)||(t+=this.verticalTextRotation||-90),t}getShapeRotation(){let t=this.getRotation();return this.direction===r.DIRECTION.NORTH?t+=270:this.direction===r.DIRECTION.WEST?t+=180:this.direction===r.DIRECTION.SOUTH&&(t+=90),t}createTransparentSvgRectangle(t,e,i,s){const n=document.createElementNS(r.NS_SVG,"rect");return n.setAttribute("x",String(t)),n.setAttribute("y",String(e)),n.setAttribute("width",String(i)),n.setAttribute("height",String(s)),n.setAttribute("fill",r.NONE),n.setAttribute("stroke",r.NONE),n.setAttribute("pointer-events","all"),n}redrawHtmlShape(){}setTransparentBackgroundImage(t){t.style.backgroundImage=`url('${d.A.imageBasePath}/transparent.gif')`}releaseSvgGradients(t){for(const e in t){const i=t[e];i&&(i.mxRefCount=(i.mxRefCount||0)-1,0===i.mxRefCount&&i.parentNode&&i.parentNode.removeChild(i))}}destroy(){h.A.release(this.node),this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node.innerHTML="",this.releaseSvgGradients(this.oldGradients),this.oldGradients={}}}},1626:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(8760),n=i(1532);class l extends s.A{constructor(t,e,i=1){super(),this.points=t,this.stroke=e,this.strokeWidth=i}getRotation(){return 0}getShapeRotation(){return 0}isPaintBoundsInverted(){return!1}paintEdgeShape(t,e){const i=t.pointerEventsValue;t.pointerEventsValue="stroke",this.style&&this.style.curved?this.paintCurvedLine(t,e):this.paintLine(t,e,this.isRounded),t.pointerEventsValue=i}paintLine(t,e,i){const s=this.style?.arcSize??n.LINE_ARCSIZE;t.begin(),this.addPoints(t,e,i,s,!1),t.stroke()}paintCurvedLine(t,e){t.begin();const i=e[0],s=e.length;t.moveTo(i.x,i.y);for(let i=1;i<s-2;i+=1){const s=e[i],n=e[i+1],l=(s.x+n.x)/2,r=(s.y+n.y)/2;t.quadTo(s.x,s.y,l,r)}const n=e[s-2],l=e[s-1];t.quadTo(n.x,n.y,l.x,l.y),t.stroke()}}const r=l},1898:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(3082),n=i(1532);class l extends s.A{constructor(t,e,i="#FFFFFF",s="#000000",n=1){super(t,i,s,n),this.overlay=null,this.preserveImageAspect=!0,this.imageSrc=e,this.shadow=!1}getSvgScreenOffset(){return 0}apply(t){super.apply(t),this.fill=n.NONE,this.stroke=n.NONE,this.gradient=n.NONE,this.style&&null!=this.style.imageAspect&&(this.preserveImageAspect=this.style.imageAspect)}isHtmlAllowed(){return!this.preserveImageAspect}isRoundable(t,e,i,s,n){return!1}paintVertexShape(t,e,i,s,l){if(this.imageSrc){const r=this.style?.imageBackground??n.NONE,a=this.style?.imageBorder??n.NONE;r!==n.NONE&&(t.setFillColor(r),t.setStrokeColor(a),t.rect(e,i,s,l),t.fillAndStroke()),t.image(e,i,s,l,this.imageSrc,this.preserveImageAspect,!1,!1),a!==n.NONE&&(t.setShadow(!1),t.setStrokeColor(a),t.rect(e,i,s,l),t.stroke())}else this.paintBackground(t,e,i,s,l)}}const r=l},3082:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(1532),n=i(8760);class l extends n.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isHtmlAllowed(){let t=!0;return this.style&&null!=this.style.pointerEvents&&(t=this.style.pointerEvents),!this.isRounded&&!this.glass&&0===this.rotation&&(t||this.fill!==s.NONE)}paintBackground(t,e,i,n,l){let r=!0;if(this.style&&null!=this.style.pointerEvents&&(r=this.style.pointerEvents),r||this.fill!==s.NONE||this.stroke!==s.NONE){if(r||this.fill!==s.NONE||(t.pointerEvents=!1),this.isRounded){let r=0;if(this.style?.absoluteArcSize)r=Math.min(n/2,Math.min(l/2,(this.style?.arcSize??s.LINE_ARCSIZE)/2));else{const t=(this.style?.arcSize??100*s.RECTANGLE_ROUNDING_FACTOR)/100;r=Math.min(n*t,l*t)}t.roundrect(e,i,n,l,r,r)}else t.rect(e,i,n,l);t.fillAndStroke()}}isRoundable(t,e,i,s,n){return!0}paintForeground(t,e,i,n,l){this.glass&&!this.outline&&this.fill!==s.NONE&&this.paintGlassEffect(t,e,i,n,l,this.getArcSize(n+this.strokeWidth,l+this.strokeWidth))}}const r=l},3201:(__unused_webpack___webpack_module__,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,U:()=>StencilShapeConfig});var _other_ConnectionConstraint__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(2342),_Rectangle__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(1508),_Shape__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(8760),_util_Translations__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(2593),_util_Utils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(6960),_util_Constants__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(1532),_StencilShapeRegistry__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(3950),_util_domUtils__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(4532),_Point__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(9447),_util_StringUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(3215);const StencilShapeConfig={allowEval:!1,defaultLocalized:!1};class StencilShape extends _Shape__WEBPACK_IMPORTED_MODULE_0__.A{constructor(t){super(),this.constraints=[],this.aspect="auto",this.w0=100,this.h0=100,this.bgNode=null,this.fgNode=null,this.strokeWidthValue=null,this.desc=t,this.parseDescription(),this.parseConstraints()}parseDescription(){this.fgNode=this.desc.getElementsByTagName("foreground")[0],this.bgNode=this.desc.getElementsByTagName("background")[0],this.w0=Number(this.desc.getAttribute("w")||100),this.h0=Number(this.desc.getAttribute("h")||100);const t=this.desc.getAttribute("aspect");this.aspect=t??"variable";const e=this.desc.getAttribute("strokewidth");this.strokeWidthValue=(0,_util_Utils__WEBPACK_IMPORTED_MODULE_1__.isNotNullish)(e)?e:"1"}parseConstraints(){const t=this.desc.getElementsByTagName("connections")[0];if(t){const e=(0,_util_domUtils__WEBPACK_IMPORTED_MODULE_2__.getChildNodes)(t);if(e.length>0){this.constraints=[];for(let t=0;t<e.length;t+=1)this.constraints.push(this.parseConstraint(e[t]))}}}parseConstraint(t){const e=Number(t.getAttribute("x")),i=Number(t.getAttribute("y")),s="1"===t.getAttribute("perimeter"),n=t.getAttribute("name");return new _other_ConnectionConstraint__WEBPACK_IMPORTED_MODULE_3__.A(new _Point__WEBPACK_IMPORTED_MODULE_4__.A(e,i),s,n)}evaluateTextAttribute(t,e,i){let s=this.evaluateAttribute(t,e,i);const n=t.getAttribute("localized");return(StencilShapeConfig.defaultLocalized&&!n||"1"===n)&&(s=_util_Translations__WEBPACK_IMPORTED_MODULE_5__.A.get(s)),s}evaluateAttribute(node,attribute,shape){let result=node.getAttribute(attribute);if(!result){const text=(0,_util_domUtils__WEBPACK_IMPORTED_MODULE_2__.getTextContent)(node);if(text&&StencilShapeConfig.allowEval){const funct=eval(text);"function"==typeof funct&&(result=funct(shape))}}return result}drawShape(t,e,i,s,n,l){const r=t.states.slice(),a=(0,_util_Utils__WEBPACK_IMPORTED_MODULE_1__.getValue)(e.style,"direction",null),o=this.computeAspect(e,i,s,n,l,a),h=Math.min(o.width,o.height),d="inherit"===this.strokeWidthValue?Number((0,_util_StringUtils__WEBPACK_IMPORTED_MODULE_6__.getNumber)(e.style,"strokeWidth",1)):Number(this.strokeWidthValue)*h;t.setStrokeWidth(d),e.style?.pointerEvents&&(t.setStrokeColor(_util_Constants__WEBPACK_IMPORTED_MODULE_7__.NONE),t.rect(i,s,n,l),t.stroke(),t.setStrokeColor(e.stroke)),this.drawChildren(t,e,i,s,n,l,this.bgNode,o,!1,!0),this.drawChildren(t,e,i,s,n,l,this.fgNode,o,!0,!e.outline||null==e.style||!e.style.backgroundOutline),t.states.length!=r.length&&(t.states=r)}drawChildren(t,e,i,s,n,l,r,a,o,h){if(r&&n>0&&l>0){let i=r.firstChild;for(;i;)i.nodeType===_util_Constants__WEBPACK_IMPORTED_MODULE_7__.NODETYPE.ELEMENT&&this.drawNode(t,e,i,a,o,h),i=i.nextSibling}}computeAspect(t=null,e,i,s,n,l){let r=e,a=i,o=s/this.w0,h=n/this.h0;const d=l===_util_Constants__WEBPACK_IMPORTED_MODULE_7__.DIRECTION.NORTH||l===_util_Constants__WEBPACK_IMPORTED_MODULE_7__.DIRECTION.SOUTH;if(d){h=s/this.h0,o=n/this.w0;const t=(s-n)/2;r+=t,a-=t}return"fixed"===this.aspect&&(h=Math.min(o,h),o=h,d?(r+=(n-this.w0*o)/2,a+=(s-this.h0*h)/2):(r+=(s-this.w0*o)/2,a+=(n-this.h0*h)/2)),new _Rectangle__WEBPACK_IMPORTED_MODULE_8__.A(r,a,o,h)}drawNode(t,e,i,s,n,l){const r=i.nodeName,a=s.x,o=s.y,h=s.width,d=s.height,c=Math.min(h,d);if("save"===r)t.save();else if("restore"===r)t.restore();else if(l){if("path"===r){t.begin();let r=!0;if("1"==i.getAttribute("rounded")){r=!1;const e=Number(i.getAttribute("arcSize"));let s=0;const n=[];let l=i.firstChild;for(;null!=l;){if(l.nodeType===_util_Constants__WEBPACK_IMPORTED_MODULE_7__.NODETYPE.ELEMENT){const t=l.nodeName;if("move"!==t&&"line"!==t){r=!0;break}"move"!==t&&0!==n.length||n.push([]),n[n.length-1].push(new _Point__WEBPACK_IMPORTED_MODULE_4__.A(a+Number(l.getAttribute("x"))*h,o+Number(l.getAttribute("y"))*d)),s++}l=l.nextSibling}if(!r&&s>0)for(let i=0;i<n.length;i+=1){let s=!1;const l=n[i][0],r=n[i][n[i].length-1];l.x===r.x&&l.y===r.y&&(n[i].pop(),s=!0),this.addPoints(t,n[i],!0,e,s)}else r=!0}if(r){let r=i.firstChild;for(;r;)r.nodeType===_util_Constants__WEBPACK_IMPORTED_MODULE_7__.NODETYPE.ELEMENT&&this.drawNode(t,e,r,s,n,l),r=r.nextSibling}}else if("close"===r)t.close();else if("move"===r)t.moveTo(a+Number(i.getAttribute("x"))*h,o+Number(i.getAttribute("y"))*d);else if("line"===r)t.lineTo(a+Number(i.getAttribute("x"))*h,o+Number(i.getAttribute("y"))*d);else if("quad"===r)t.quadTo(a+Number(i.getAttribute("x1"))*h,o+Number(i.getAttribute("y1"))*d,a+Number(i.getAttribute("x2"))*h,o+Number(i.getAttribute("y2"))*d);else if("curve"===r)t.curveTo(a+Number(i.getAttribute("x1"))*h,o+Number(i.getAttribute("y1"))*d,a+Number(i.getAttribute("x2"))*h,o+Number(i.getAttribute("y2"))*d,a+Number(i.getAttribute("x3"))*h,o+Number(i.getAttribute("y3"))*d);else if("arc"===r)t.arcTo(Number(i.getAttribute("rx"))*h,Number(i.getAttribute("ry"))*d,Number(i.getAttribute("x-axis-rotation")),Boolean(i.getAttribute("large-arc-flag")),Boolean(i.getAttribute("sweep-flag")),a+Number(i.getAttribute("x"))*h,o+Number(i.getAttribute("y"))*d);else if("rect"===r)t.rect(a+Number(i.getAttribute("x"))*h,o+Number(i.getAttribute("y"))*d,Number(i.getAttribute("w"))*h,Number(i.getAttribute("h"))*d);else if("roundrect"===r){let e=Number(i.getAttribute("arcsize"));0===e&&(e=100*_util_Constants__WEBPACK_IMPORTED_MODULE_7__.RECTANGLE_ROUNDING_FACTOR);const s=Number(i.getAttribute("w"))*h,n=Number(i.getAttribute("h"))*d,l=Number(e)/100,r=Math.min(s*l,n*l);t.roundrect(a+Number(i.getAttribute("x"))*h,o+Number(i.getAttribute("y"))*d,s,n,r,r)}else if("ellipse"===r)t.ellipse(a+Number(i.getAttribute("x"))*h,o+Number(i.getAttribute("y"))*d,Number(i.getAttribute("w"))*h,Number(i.getAttribute("h"))*d);else if("image"===r){if(!e.outline){const s=this.evaluateAttribute(i,"src",e);t.image(a+Number(i.getAttribute("x"))*h,o+Number(i.getAttribute("y"))*d,Number(i.getAttribute("w"))*h,Number(i.getAttribute("h"))*d,s,!1,"1"===i.getAttribute("flipH"),"1"===i.getAttribute("flipV"))}}else if("text"===r){if(!e.outline){const s=this.evaluateTextAttribute(i,"str",e);let n="1"==i.getAttribute("vertical")?-90:0;if("0"===i.getAttribute("align-shape")){const t=e.rotation,i=1==(0,_util_Utils__WEBPACK_IMPORTED_MODULE_1__.getValue)(e.style,"flipH",0),s=1==(0,_util_Utils__WEBPACK_IMPORTED_MODULE_1__.getValue)(e.style,"flipV",0);i&&s?n-=t:i||s?n+=t:n-=t}n-=Number(i.getAttribute("rotation")),t.text(a+Number(i.getAttribute("x"))*h,o+Number(i.getAttribute("y"))*d,0,0,s,i.getAttribute("align")||_util_Constants__WEBPACK_IMPORTED_MODULE_7__.ALIGN.LEFT,i.getAttribute("valign")||_util_Constants__WEBPACK_IMPORTED_MODULE_7__.ALIGN.TOP,!1,"","auto",!1,n,_util_Constants__WEBPACK_IMPORTED_MODULE_7__.TEXT_DIRECTION.AUTO)}}else if("include-shape"===r){const s=_StencilShapeRegistry__WEBPACK_IMPORTED_MODULE_9__.A.getStencil(i.getAttribute("name"));if(s){const n=a+Number(i.getAttribute("x"))*h,l=o+Number(i.getAttribute("y"))*d,r=Number(i.getAttribute("w"))*h,c=Number(i.getAttribute("h"))*d;s.drawShape(t,e,n,l,r,c)}}else if("fillstroke"===r)t.fillAndStroke();else if("fill"===r)t.fill();else if("stroke"===r)t.stroke();else if("strokewidth"===r){const e="1"===i.getAttribute("fixed")?1:c;t.setStrokeWidth(Number(i.getAttribute("width"))*e)}else if("dashed"===r)t.setDashed("1"===i.getAttribute("dashed"));else if("dashpattern"===r){let e=i.getAttribute("pattern");if(null!=e){const i=e.split(" "),s=[];for(let t=0;t<i.length;t+=1)i[t].length>0&&s.push(Number(i[t])*c);e=s.join(" "),t.setDashPattern(e)}}else"strokecolor"===r?t.setStrokeColor(i.getAttribute("color")):"linecap"===r?t.setLineCap(i.getAttribute("cap")):"linejoin"===r?t.setLineJoin(i.getAttribute("join")):"miterlimit"===r?t.setMiterLimit(Number(i.getAttribute("limit"))):"fillcolor"===r?t.setFillColor(i.getAttribute("color")):"alpha"===r||"fillalpha"===r||"strokealpha"===r?t.setAlpha(Number(i.getAttribute("alpha"))):"fontcolor"===r?t.setFontColor(i.getAttribute("color")):"fontstyle"===r?t.setFontStyle(Number(i.getAttribute("style"))):"fontfamily"===r?t.setFontFamily(i.getAttribute("family")):"fontsize"===r&&t.setFontSize(Number(i.getAttribute("size"))*c);!n||"fillstroke"!==r&&"fill"!==r&&"stroke"!==r||(n=!1,t.setShadow(!1))}}}const __WEBPACK_DEFAULT_EXPORT__=StencilShape},3950:(t,e,i)=>{i.d(e,{A:()=>n});class s{static addStencil(t,e){s.stencils[t]=e}static getStencil(t){return s.stencils[t]}}s.stencils={};const n=s},2342:(t,e,i)=>{i.d(e,{A:()=>s});const s=class{constructor(t,e=!0,i=null,s=0,n=0){this.perimeter=!0,this.name=null,this.dx=0,this.dy=0,this.point=t,this.perimeter=e,this.name=i,this.dx=s,this.dy=n}}},3538:(t,e,i)=>{i.d(e,{A:()=>u});var s=i(1508),n=i(4113),l=i(9155),r=i(7620),a=i(7773),o=i(1205),h=i(1532),d=i(9447),c=i(5524);const u=class{constructor(t,e){this.dragOffset=null,this.dragElement=null,this.previewElement=null,this.previewOffset=null,this.enabled=!0,this.currentGraph=null,this.currentDropTarget=null,this.currentPoint=null,this.currentGuide=null,this.currentHighlight=null,this.autoscroll=!0,this.guidesEnabled=!0,this.gridEnabled=!0,this.highlightDropTargets=!0,this.dragElementZIndex=100,this.dragElementOpacity=70,this.checkEventSource=!0,this.mouseMoveHandler=null,this.mouseUpHandler=null,this.eventSource=null,this.element=t,this.dropHandler=e,r.A.addGestureListeners(t,(t=>{this.mouseDown(t)})),r.A.addListener(t,"dragstart",(t=>{r.A.consume(t)})),this.eventConsumer=(t,e)=>{const i=e.getProperty("eventName"),s=e.getProperty("event");i!==r.A.MOUSE_DOWN&&s.consume()}}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isGuidesEnabled(){return this.guidesEnabled}setGuidesEnabled(t){this.guidesEnabled=t}isGridEnabled(){return this.gridEnabled}setGridEnabled(t){this.gridEnabled=t}getGraphForEvent(t){return null}getDropTarget(t,e,i,s){return t.getCellAt(e,i)}createDragElement(t){return this.element.cloneNode(!0)}createPreviewElement(t){return null}isActive(){return!!this.mouseMoveHandler}reset(){this.currentGraph&&(this.dragExit(this.currentGraph),this.currentGraph=null),this.removeDragElement(),this.removeListeners(),this.stopDrag()}mouseDown(t){this.enabled&&!(0,c.isConsumed)(t)&&null==this.mouseMoveHandler&&(this.startDrag(t),this.mouseMoveHandler=this.mouseMove.bind(this),this.mouseUpHandler=this.mouseUp.bind(this),r.A.addGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),a.A.IS_TOUCH&&!(0,c.isMouseEvent)(t)&&(this.eventSource=(0,c.getSource)(t),this.eventSource&&r.A.addGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler)))}startDrag(t){this.dragElement=this.createDragElement(t),this.dragElement.style.position="absolute",this.dragElement.style.zIndex=String(this.dragElementZIndex),(0,l.setOpacity)(this.dragElement,this.dragElementOpacity),this.checkEventSource&&a.A.IS_SVG&&(this.dragElement.style.pointerEvents="none")}stopDrag(){this.removeDragElement()}removeDragElement(){this.dragElement&&(this.dragElement.parentNode&&this.dragElement.parentNode.removeChild(this.dragElement),this.dragElement=null)}getElementForEvent(t){return(0,c.isTouchEvent)(t)||(0,c.isPenEvent)(t)?document.elementFromPoint((0,c.getClientX)(t),(0,c.getClientY)(t)):(0,c.getSource)(t)}graphContainsEvent(t,e){const i=(0,c.getClientX)(e),s=(0,c.getClientY)(e),n=(0,l.getOffset)(t.container),r=(0,l.getScrollOrigin)();let a=this.getElementForEvent(e);if(this.checkEventSource)for(;a&&a!==t.container;)a=a.parentNode;return!!a&&i>=n.x-r.x&&s>=n.y-r.y&&i<=n.x-r.x+t.container.offsetWidth&&s<=n.y-r.y+t.container.offsetHeight}mouseMove(t){let e=this.getGraphForEvent(t);if(e&&!this.graphContainsEvent(e,t)&&(e=null),e!==this.currentGraph&&(this.currentGraph&&this.dragExit(this.currentGraph,t),this.currentGraph=e,this.currentGraph&&this.dragEnter(this.currentGraph,t)),this.currentGraph&&this.dragOver(this.currentGraph,t),!this.dragElement||this.previewElement&&"visible"===this.previewElement.style.visibility)this.dragElement&&(this.dragElement.style.visibility="hidden");else{let e=(0,c.getClientX)(t),i=(0,c.getClientY)(t);null==this.dragElement.parentNode&&document.body.appendChild(this.dragElement),this.dragElement.style.visibility="visible",this.dragOffset&&(e+=this.dragOffset.x,i+=this.dragOffset.y);const s=(0,l.getDocumentScrollOrigin)(document);this.dragElement.style.left=`${e+s.x}px`,this.dragElement.style.top=`${i+s.y}px`}r.A.consume(t)}mouseUp(t){if(this.currentGraph){if(this.currentPoint&&(!this.previewElement||"hidden"!==this.previewElement.style.visibility)){const{scale:e}=this.currentGraph.view,i=this.currentGraph.view.translate,s=this.currentPoint.x/e-i.x,n=this.currentPoint.y/e-i.y;this.drop(this.currentGraph,t,this.currentDropTarget,s,n)}this.dragExit(this.currentGraph),this.currentGraph=null}this.stopDrag(),this.removeListeners(),r.A.consume(t)}removeListeners(){this.eventSource&&(r.A.removeGestureListeners(this.eventSource,null,this.mouseMoveHandler,this.mouseUpHandler),this.eventSource=null),r.A.removeGestureListeners(document,null,this.mouseMoveHandler,this.mouseUpHandler),this.mouseMoveHandler=null,this.mouseUpHandler=null}dragEnter(t,e){if(t.isMouseDown=!0,t.isMouseTrigger=(0,c.isMouseEvent)(e),this.previewElement=this.createPreviewElement(t),this.previewElement&&this.checkEventSource&&a.A.IS_SVG&&(this.previewElement.style.pointerEvents="none"),this.isGuidesEnabled()&&this.previewElement){const e=t.getPlugin("SelectionHandler");this.currentGuide=new o.A(t,e?.getGuideStates())}this.highlightDropTargets&&(this.currentHighlight=new n.A(t,h.DROP_TARGET_COLOR)),t.addListener(r.A.FIRE_MOUSE_EVENT,this.eventConsumer)}dragExit(t,e){this.currentDropTarget=null,this.currentPoint=null,t.isMouseDown=!1,t.removeListener(this.eventConsumer),this.previewElement&&(this.previewElement.parentNode&&this.previewElement.parentNode.removeChild(this.previewElement),this.previewElement=null),this.currentGuide&&(this.currentGuide.destroy(),this.currentGuide=null),this.currentHighlight&&(this.currentHighlight.destroy(),this.currentHighlight=null)}dragOver(t,e){const i=(0,l.getOffset)(t.container),n=(0,l.getScrollOrigin)(t.container);let r=(0,c.getClientX)(e)-i.x+n.x-t.getPanDx(),a=(0,c.getClientY)(e)-i.y+n.y-t.getPanDy();if(!t.isAutoScroll()||this.autoscroll&&!this.autoscroll||t.scrollPointToVisible(r,a,t.isAutoExtend()),this.currentHighlight&&t.isDropEnabled()&&(this.currentDropTarget=this.getDropTarget(t,r,a,e),this.currentDropTarget)){const e=t.getView().getState(this.currentDropTarget);this.currentHighlight.highlight(e)}if(this.previewElement){this.previewElement.parentNode||(t.container.appendChild(this.previewElement),this.previewElement.style.zIndex="3",this.previewElement.style.position="absolute");const i=this.isGridEnabled()&&t.isGridEnabledEvent(e);let n=!0;if(this.currentGuide&&this.currentGuide.isEnabledForEvent(e)){const t=parseInt(this.previewElement.style.width),e=parseInt(this.previewElement.style.height),l=new s.A(0,0,t,e);let o=new d.A(r,a);o=this.currentGuide.move(l,o,i,!0),n=!1,r=o.x,a=o.y}else if(i){const{scale:e}=t.view,i=t.view.translate,s=t.getGridSize()/2;r=(t.snap(r/e-i.x-s)+i.x)*e,a=(t.snap(a/e-i.y-s)+i.y)*e}this.currentGuide&&n&&this.currentGuide.hide(),this.previewOffset&&(r+=this.previewOffset.x,a+=this.previewOffset.y),this.previewElement.style.left=`${Math.round(r)}px`,this.previewElement.style.top=`${Math.round(a)}px`,this.previewElement.style.visibility="visible"}this.currentPoint=new d.A(r,a)}drop(t,e,i=null,s,n){this.dropHandler(t,e,i,s,n),"hidden"!==t.container.style.visibility&&t.container.focus()}}},1205:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(1532),n=i(9447),l=i(1626);const r=class{constructor(t,e){this.states=[],this.horizontal=!0,this.vertical=!0,this.guideX=null,this.guideY=null,this.rounded=!1,this.tolerance=2,this.graph=t,this.setStates(e)}setStates(t){this.states=t}isEnabledForEvent(t){return!0}getGuideTolerance(t=!1){return t&&this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.tolerance}createGuideShape(t=!1){const e=new l.A([],s.GUIDE_COLOR,s.GUIDE_STROKEWIDTH);return e.isDashed=!0,e}isStateIgnored(t){return!1}move(t=null,e,i=!1,l=!1){if((this.horizontal||this.vertical)&&t){const{scale:l}=this.graph.getView(),r=this.getGuideTolerance(i)*l,a=t.clone();a.x+=e.x,a.y+=e.y;let o=!1,h=null,d=null,c=!1,u=null,g=null,p=r,E=r;const C=a.x,m=a.x+a.width,f=a.getCenterX(),y=a.y,v=a.y+a.height,A=a.getCenterY(),_=(i,n,l)=>{let r=!1;l&&Math.abs(i-f)<p?(e.x=i-t.getCenterX(),p=Math.abs(i-f),r=!0):l||(Math.abs(i-C)<p?(e.x=i-t.x,p=Math.abs(i-C),r=!0):Math.abs(i-m)<p&&(e.x=i-t.x-t.width,p=Math.abs(i-m),r=!0)),r&&(h=n,d=i,this.guideX||(this.guideX=this.createGuideShape(!0),this.guideX.dialect=s.DIALECT.SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()))),o=o||r},b=(i,n,l)=>{let r=!1;l&&Math.abs(i-A)<E?(e.y=i-t.getCenterY(),E=Math.abs(i-A),r=!0):l||(Math.abs(i-y)<E?(e.y=i-t.y,E=Math.abs(i-y),r=!0):Math.abs(i-v)<E&&(e.y=i-t.y-t.height,E=Math.abs(i-v),r=!0)),r&&(u=n,g=i,this.guideY||(this.guideY=this.createGuideShape(!1),this.guideY.dialect=s.DIALECT.SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()))),c=c||r};for(let t=0;t<this.states.length;t+=1){const e=this.states[t];e&&!this.isStateIgnored(e)&&(this.horizontal&&(_(e.getCenterX(),e,!0),_(e.x,e,!1),_(e.x+e.width,e,!1),e.cell||_(e.getCenterX(),e,!1)),this.vertical&&(b(e.getCenterY(),e,!0),b(e.y,e,!1),b(e.y+e.height,e,!1),e.cell||b(e.getCenterY(),e,!1)))}this.graph.snapDelta(e,t,!i,o,c),e=this.getDelta(t,h,e.x,u,e.y);const S=this.graph.container;if(!o&&this.guideX)this.guideX.node.style.visibility="hidden";else if(this.guideX){let i=null,s=null;h&&(i=Math.min(t.y+e.y-this.graph.getPanDy(),h.y),s=Math.max(t.y+t.height+e.y-this.graph.getPanDy(),h.y+h.height)),this.guideX.points=null!==i&&null!==s?[new n.A(d,i),new n.A(d,s)]:[new n.A(d,-this.graph.getPanDy()),new n.A(d,S.scrollHeight-3-this.graph.getPanDy())],this.guideX.stroke=this.getGuideColor(h,!0),this.guideX.node.style.visibility="visible",this.guideX.redraw()}if(c||null==this.guideY){if(null!=this.guideY){let i=null,s=null;null!=u&&null!=t&&(i=Math.min(t.x+e.x-this.graph.getPanDx(),u.x),s=Math.max(t.x+t.width+e.x-this.graph.getPanDx(),u.x+u.width)),null!=i&&null!=s&&null!==g?this.guideY.points=[new n.A(i,g),new n.A(s,g)]:null!==g&&(this.guideY.points=[new n.A(-this.graph.getPanDx(),g),new n.A(S.scrollWidth-3-this.graph.getPanDx(),g)]),this.guideY.stroke=this.getGuideColor(u,!1),this.guideY.node.style.visibility="visible",this.guideY.redraw()}}else this.guideY.node.style.visibility="hidden"}return e}getDelta(t,e=null,i,s=null,l){const r=this.graph.view.scale;return(this.rounded||null!=e&&null==e.cell)&&(i=Math.round((t.x+i)/r)*r-t.x),(this.rounded||null!=s&&null==s.cell)&&(l=Math.round((t.y+l)/r)*r-t.y),new n.A(i,l)}getGuideColor(t,e){return s.GUIDE_COLOR}hide(){this.setVisible(!1)}setVisible(t){this.guideX&&(this.guideX.node.style.visibility=t?"visible":"hidden"),this.guideY&&(this.guideY.node.style.visibility=t?"visible":"hidden")}destroy(){this.guideX&&(this.guideX.destroy(),this.guideX=null),this.guideY&&(this.guideY.destroy(),this.guideY=null)}}},2628:(t,e,i)=>{i.d(e,{A:()=>n});class s{static putValue(t,e){s.values[t]=e}static getValue(t){return s.values[t]}static getName(t){for(const e in s.values)if(s.values[e]===t)return e;return null}}s.values={};const n=s},7648:(t,e,i)=>{i.d(e,{n:()=>n});var s=i(1532);class n{constructor(){this.styles=new Map,this.putDefaultVertexStyle(this.createDefaultVertexStyle()),this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}createDefaultVertexStyle(){const t={};return t.shape=s.SHAPE.RECTANGLE,t.perimeter="rectanglePerimeter",t.verticalAlign=s.ALIGN.MIDDLE,t.align=s.ALIGN.CENTER,t.fillColor="#C3D9FF",t.strokeColor="#6482B9",t.fontColor="#774400",t}createDefaultEdgeStyle(){const t={};return t.shape=s.SHAPE.CONNECTOR,t.endArrow=s.ARROW.CLASSIC,t.verticalAlign=s.ALIGN.MIDDLE,t.align=s.ALIGN.CENTER,t.strokeColor="#6482B9",t.fontColor="#446299",t}putDefaultVertexStyle(t){this.putCellStyle("defaultVertex",t)}putDefaultEdgeStyle(t){this.putCellStyle("defaultEdge",t)}getDefaultVertexStyle(){return this.styles.get("defaultVertex")}getDefaultEdgeStyle(){return this.styles.get("defaultEdge")}putCellStyle(t,e){this.styles.set(t,e)}getCellStyle(t,e){let i=t.ignoreDefaultStyle?{}:{...e};t.baseStyleNames&&(i=t.baseStyleNames.reduce(((t,e)=>({...t,...this.styles.get(e)})),i));for(const e of Object.keys(t))void 0!==t[e]&&(t[e]==s.NONE?delete i[e]:i[e]=t[e]);return"baseStyleNames"in i&&delete i.baseStyleNames,"ignoreDefaultStyle"in i&&delete i.ignoreDefaultStyle,i}}},3816:(t,e,i)=>{i.d(e,{A:()=>r});var s=i(4432),n=i(9447),l=i(7620);const r=class{constructor(t,e){if(this.view=t,this.root=e,this.previous=e,this.isUp=null===e,!this.isUp){let t=this.view.currentRoot;for(;t;){if(t===e){this.isUp=!0;break}t=t.getParent()}}}execute(){const t=this.view.currentRoot;this.view.currentRoot=this.previous,this.previous=t;const e=this.view.graph.getTranslateForRoot(this.view.currentRoot);e&&(this.view.translate=new n.A(-e.x,-e.y)),this.isUp?(this.view.clear(this.view.currentRoot,!0,!0),this.view.validate(null)):this.view.refresh();const i=this.isUp?l.A.UP:l.A.DOWN;this.view.fireEvent(new s.A(i,{root:this.view.currentRoot,previous:this.previous})),this.isUp=!this.isUp}}},1323:(t,e,i)=>{i.d(e,{A:()=>l});var s=i(7620),n=i(4432);const l=class{constructor(t,e=!0){this.changes=[],this.significant=!0,this.undone=!1,this.redone=!1,this.source=t,this.changes=[],this.significant=e}isEmpty(){return 0===this.changes.length}isSignificant(){return this.significant}add(t){this.changes.push(t)}notify(){}die(){}undo(){if(!this.undone){this.source.fireEvent(new n.A(s.A.START_EDIT));for(let t=this.changes.length-1;t>=0;t--){const e=this.changes[t];e.execute?e.execute():e.undo&&e.undo(),this.source.fireEvent(new n.A(s.A.EXECUTED,{change:e}))}this.undone=!0,this.redone=!1,this.source.fireEvent(new n.A(s.A.END_EDIT))}this.notify()}redo(){if(!this.redone){this.source.fireEvent(new n.A(s.A.START_EDIT));const t=this.changes.length;for(let e=0;e<t;e+=1){const t=this.changes[e];null!=t.execute?t.execute():null!=t.redo&&t.redo(),this.source.fireEvent(new n.A(s.A.EXECUTED,{change:t}))}this.undone=!1,this.redone=!0,this.source.fireEvent(new n.A(s.A.END_EDIT))}this.notify()}}}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={},cellArrayUtils_namespaceObject={};__webpack_require__.r(cellArrayUtils_namespaceObject),__webpack_require__.d(cellArrayUtils_namespaceObject,{cloneCell:()=>cloneCell,cloneCells:()=>cloneCells,filterCells:()=>filterCells,getOpposites:()=>getOpposites,getParents:()=>getParents,getTopmostCells:()=>getTopmostCells});var printUtils_namespaceObject={};__webpack_require__.r(printUtils_namespaceObject),__webpack_require__.d(printUtils_namespaceObject,{getScaleForPageCount:()=>getScaleForPageCount,printScreen:()=>printScreen,show:()=>show});var domHelpers_namespaceObject={};__webpack_require__.r(domHelpers_namespaceObject),__webpack_require__.d(domHelpers_namespaceObject,{button:()=>domHelpers_button,link:()=>domHelpers_link,linkAction:()=>linkAction,linkInvoke:()=>linkInvoke});var lib_namespaceObject={};__webpack_require__.r(lib_namespaceObject),__webpack_require__.d(lib_namespaceObject,{AbstractCanvas2D:()=>AbstractCanvas2D.A,ActorShape:()=>geometry_ActorShape,Animation:()=>animate_Animation,ArrowConnectorShape:()=>edge_ArrowConnectorShape,ArrowShape:()=>edge_ArrowShape,AutoSaveManager:()=>other_AutoSaveManager,Cell:()=>Cell.f,CellAttributeChange:()=>undoable_changes_CellAttributeChange,CellCodec:()=>CellCodec,CellEditorHandler:()=>handler_CellEditorHandler,CellHighlight:()=>CellHighlight.A,CellMarker:()=>cell_CellMarker,CellOverlay:()=>cell_CellOverlay,CellPath:()=>CellPath.A,CellRenderer:()=>cell_CellRenderer,CellState:()=>CellState.A,CellStatePreview:()=>cell_CellStatePreview,CellTracker:()=>cell_CellTracker,ChildChange:()=>ChildChange,ChildChangeCodec:()=>ChildChangeCodec,CircleLayout:()=>layout_CircleLayout,Client:()=>Client.A,Clipboard:()=>util_Clipboard,CloudShape:()=>node_CloudShape,Codec:()=>Codec.A,CodecRegistry:()=>CodecRegistry.A,CollapseChange:()=>undoable_changes_CollapseChange,CompactTreeLayout:()=>layout_CompactTreeLayout,CompositeLayout:()=>layout_CompositeLayout,ConnectionConstraint:()=>ConnectionConstraint.A,ConnectionHandler:()=>handler_ConnectionHandler,ConnectorShape:()=>edge_ConnectorShape,ConsoleLogger:()=>logger.C,ConstraintHandler:()=>handler_ConstraintHandler,CoordinateAssignment:()=>hierarchical_CoordinateAssignment,CurrentRootChange:()=>CurrentRootChange.A,CylinderShape:()=>node_CylinderShape,Dictionary:()=>util_Dictionary.A,DomHelpers:()=>domHelpers_namespaceObject,DoubleEllipseShape:()=>node_DoubleEllipseShape,DragSource:()=>DragSource.A,EdgeHandler:()=>handler_EdgeHandler,EdgeHandlerConfig:()=>EdgeHandlerConfig,EdgeLabelLayout:()=>layout_EdgeLabelLayout,EdgeSegmentHandler:()=>handler_EdgeSegmentHandler,EdgeStyle:()=>style_EdgeStyle,Editor:()=>Editor,EditorCodec:()=>EditorCodec,EditorKeyHandler:()=>EditorKeyHandler,EditorKeyHandlerCodec:()=>EditorKeyHandlerCodec,EditorPopupMenu:()=>EditorPopupMenu.j,EditorPopupMenuCodec:()=>EditorPopupMenuCodec,EditorToolbar:()=>EditorToolbar.t,EditorToolbarCodec:()=>EditorToolbarCodec.f,Effects:()=>animate_Effects,ElbowEdgeHandler:()=>handler_ElbowEdgeHandler,EllipseShape:()=>node_EllipseShape,EventObject:()=>EventObject.A,EventSource:()=>EventSource.A,FastOrganicLayout:()=>FastOrganicLayout,GenericChangeCodec:()=>GenericChangeCodec,Geometry:()=>Geometry.A,GeometryChange:()=>undoable_changes_GeometryChange,GlobalConfig:()=>config.eo,Graph:()=>Graph,GraphAbstractHierarchyCell:()=>datatypes_GraphAbstractHierarchyCell,GraphCodec:()=>GraphCodec,GraphDataModel:()=>GraphDataModel,GraphHierarchyEdge:()=>datatypes_GraphHierarchyEdge,GraphHierarchyModel:()=>hierarchical_GraphHierarchyModel,GraphHierarchyNode:()=>datatypes_GraphHierarchyNode,GraphLayout:()=>layout_GraphLayout,GraphView:()=>GraphView.w,GraphViewCodec:()=>GraphViewCodec,Guide:()=>Guide.A,HandleConfig:()=>HandleConfig,HexagonShape:()=>node_HexagonShape,HierarchicalEdgeStyle:()=>datatypes_HierarchicalEdgeStyle,HierarchicalLayout:()=>layout_HierarchicalLayout,HierarchicalLayoutStage:()=>hierarchical_HierarchicalLayoutStage,ImageBox:()=>image_ImageBox,ImageBundle:()=>image_ImageBundle,ImageExport:()=>image_ImageExport,ImageShape:()=>ImageShape.A,InternalEvent:()=>InternalEvent.A,InternalMouseEvent:()=>InternalMouseEvent.A,KeyHandler:()=>handler_KeyHandler,LabelShape:()=>node_LabelShape,LayoutManager:()=>layout_LayoutManager,LineShape:()=>edge_LineShape,MarkerShape:()=>edge_MarkerShape,MaxForm:()=>gui_MaxForm,MaxLog:()=>gui_MaxLog,MaxLogAsLogger:()=>MaxLogAsLogger,MaxPopupMenu:()=>MaxPopupMenu.A,MaxToolbar:()=>MaxToolbar.A,MaxWindow:()=>gui_MaxWindow,MaxXmlRequest:()=>MaxXmlRequest.Ay,MedianHybridCrossingReduction:()=>hierarchical_MedianHybridCrossingReduction,MinimumCycleRemover:()=>hierarchical_MinimumCycleRemover,ModelCodec:()=>ModelCodec,ModelXmlSerializer:()=>ModelXmlSerializer,Morphing:()=>animate_Morphing,Multiplicity:()=>other_Multiplicity,NoOpLogger:()=>logger.N,ObjectCodec:()=>ObjectCodec.A,ObjectIdentity:()=>ObjectIdentity.A,Outline:()=>other_Outline,PanningHandler:()=>handler_PanningHandler,PanningManager:()=>other_PanningManager,ParallelEdgeLayout:()=>layout_ParallelEdgeLayout,PartitionLayout:()=>layout_PartitionLayout,Perimeter:()=>style_Perimeter,Point:()=>Point.A,PolylineShape:()=>PolylineShape.A,PopupMenuHandler:()=>handler_PopupMenuHandler,PrintPreview:()=>other_PrintPreview,RadialTreeLayout:()=>layout_RadialTreeLayout,Rectangle:()=>Rectangle.A,RectangleShape:()=>RectangleShape.A,RhombusShape:()=>node_RhombusShape,RootChange:()=>RootChange,RootChangeCodec:()=>RootChangeCodec,RubberBandHandler:()=>handler_RubberBandHandler,SelectionCellsHandler:()=>handler_SelectionCellsHandler,SelectionChange:()=>undoable_changes_SelectionChange,SelectionHandler:()=>handler_SelectionHandler,Shape:()=>Shape.A,StackLayout:()=>layout_StackLayout,StencilShape:()=>StencilShape.A,StencilShapeConfig:()=>StencilShape.U,StencilShapeRegistry:()=>StencilShapeRegistry.A,StyleChange:()=>undoable_changes_StyleChange,StyleDefaultsConfig:()=>config.m5,StyleRegistry:()=>StyleRegistry.A,Stylesheet:()=>Stylesheet.n,StylesheetCodec:()=>StylesheetCodec.X,SvgCanvas2D:()=>SvgCanvas2D.A,SwimlaneLayout:()=>layout_SwimlaneLayout,SwimlaneManager:()=>layout_SwimlaneManager,SwimlaneModel:()=>hierarchical_SwimlaneModel,SwimlaneOrdering:()=>hierarchical_SwimlaneOrdering,SwimlaneShape:()=>node_SwimlaneShape,TemporaryCellStates:()=>TemporaryCellStates.A,TerminalChange:()=>TerminalChange,TerminalChangeCodec:()=>TerminalChangeCodec,TextShape:()=>node_TextShape,TooltipHandler:()=>handler_TooltipHandler,Translations:()=>Translations.A,TriangleShape:()=>node_TriangleShape,UndoManager:()=>undoable_changes_UndoManager,UndoableEdit:()=>UndoableEdit.A,UrlConverter:()=>UrlConverter.A,ValueChange:()=>undoable_changes_ValueChange,VertexHandle:()=>cell_VertexHandle,VertexHandler:()=>handler_VertexHandler,VertexHandlerConfig:()=>VertexHandlerConfig,VisibleChange:()=>undoable_changes_VisibleChange,XmlCanvas2D:()=>canvas_XmlCanvas2D,cellArrayUtils:()=>cellArrayUtils_namespaceObject,cloneUtils:()=>cloneUtils,constants:()=>Constants,domUtils:()=>domUtils,error:()=>error,eventUtils:()=>EventUtils,gestureUtils:()=>gestureUtils,get:()=>MaxXmlRequest.Jt,getAll:()=>MaxXmlRequest.UK,getDefaultPlugins:()=>getDefaultPlugins,load:()=>MaxXmlRequest.Hh,mathUtils:()=>mathUtils,mxCellCodec:()=>mxCellCodec,mxGeometryCodec:()=>mxGeometryCodec,popup:()=>popup,post:()=>MaxXmlRequest.bE,printUtils:()=>printUtils_namespaceObject,registerAllCodecs:()=>registerAllCodecs,registerCoreCodecs:()=>registerCoreCodecs,registerEditorCodecs:()=>registerEditorCodecs,registerModelCodecs:()=>registerModelCodecs,resetEdgeHandlerConfig:()=>resetEdgeHandlerConfig,resetHandleConfig:()=>resetHandleConfig,resetStyleDefaultsConfig:()=>config.Nu,resetVertexHandlerConfig:()=>resetVertexHandlerConfig,stringUtils:()=>StringUtils,styleUtils:()=>styleUtils,submit:()=>MaxXmlRequest.tA,utils:()=>Utils,xmlUtils:()=>xmlUtils});class ImageBox{constructor(t,e,i){this.src=t,this.width=e,this.height=i}}const image_ImageBox=ImageBox;var EventObject=__webpack_require__(4432),EventSource=__webpack_require__(2354),InternalEvent=__webpack_require__(7620),Rectangle=__webpack_require__(1508),Client=__webpack_require__(7773),GraphView=__webpack_require__(2537),RectangleShape=__webpack_require__(3082),Constants=__webpack_require__(1532),PolylineShape=__webpack_require__(1626);class MarkerShape{static addMarker(t,e){MarkerShape.markers[t]=e}static createMarker(t,e,i,s,n,l,r,a,o,h){const d=MarkerShape.markers[i];return d?d(t,e,i,s,n,l,r,a,o,h):null}}MarkerShape.markers={};const edge_MarkerShape=MarkerShape;function createArrow(t){return(e,i,s,n,l,r,a,o,h,d)=>{const c=l*h*1.118,u=r*h*1.118;l*=a+h,r*=a+h;const g=n.clone();g.x-=c,g.y-=u;const p=s!==Constants.ARROW.CLASSIC&&s!==Constants.ARROW.CLASSIC_THIN?1:3/4;return n.x+=-l*p-c,n.y+=-r*p-u,()=>{e.begin(),e.moveTo(g.x,g.y),e.lineTo(g.x-l-r/t,g.y-r+l/t),s!==Constants.ARROW.CLASSIC&&s!==Constants.ARROW.CLASSIC_THIN||e.lineTo(g.x-3*l/4,g.y-3*r/4),e.lineTo(g.x+r/t-l,g.y-r-l/t),e.close(),d?e.fillAndStroke():e.stroke()}}}function createOpenArrow(t){return(e,i,s,n,l,r,a,o,h,d)=>{const c=l*h*1.118,u=r*h*1.118;l*=a+h,r*=a+h;const g=n.clone();return g.x-=c,g.y-=u,n.x+=2*-c,n.y+=2*-u,()=>{e.begin(),e.moveTo(g.x-l-r/t,g.y-r+l/t),e.lineTo(g.x,g.y),e.lineTo(g.x+r/t-l,g.y-r-l/t),e.stroke()}}}const oval=(t,e,i,s,n,l,r,a,o,h)=>{const d=r/2,c=s.clone();return s.x-=n*d,s.y-=l*d,()=>{t.ellipse(c.x-d,c.y-d,r,r),h?t.fillAndStroke():t.stroke()}};function diamond(t,e,i,s,n,l,r,a,o,h){const d=i===Constants.ARROW.DIAMOND?.7071:.9862,c=n*o*d,u=l*o*d;n*=r+o,l*=r+o;const g=s.clone();g.x-=c,g.y-=u,s.x+=-n-c,s.y+=-l-u;const p=i===Constants.ARROW.DIAMOND?2:3.4;return()=>{t.begin(),t.moveTo(g.x,g.y),t.lineTo(g.x-n/2-l/p,g.y+n/p-l/2),t.lineTo(g.x-n,g.y-l),t.lineTo(g.x-n/2+l/p,g.y-l/2-n/p),t.close(),h?t.fillAndStroke():t.stroke()}}let isDefaultMarkersRegistered=!1;const registerDefaultEdgeMarkers=()=>{isDefaultMarkersRegistered||(MarkerShape.addMarker("classic",createArrow(2)),MarkerShape.addMarker("classicThin",createArrow(3)),MarkerShape.addMarker("block",createArrow(2)),MarkerShape.addMarker("blockThin",createArrow(3)),MarkerShape.addMarker("open",createOpenArrow(2)),MarkerShape.addMarker("openThin",createOpenArrow(3)),MarkerShape.addMarker("oval",oval),MarkerShape.addMarker("diamond",diamond),MarkerShape.addMarker("diamondThin",diamond),isDefaultMarkersRegistered=!0)};class ConnectorShape extends PolylineShape.A{constructor(t,e,i){super(t,e,i)}updateBoundingBox(){this.useSvgBoundingBox=!!this.style?.curved,super.updateBoundingBox()}paintEdgeShape(t,e){const i=this.createMarker(t,e,!0),s=this.createMarker(t,e,!1);if(super.paintEdgeShape(t,e),t.setShadow(!1),t.setDashed(!1),i){const e=this.style?.startStrokeColor??this.stroke;t.setStrokeColor(e),t.setFillColor(this.style?.startFillColor??e),i()}if(s){const e=this.style?.endStrokeColor??this.stroke;t.setStrokeColor(e),t.setFillColor(this.style?.endFillColor??e),s()}}createMarker(t,e,i){if(!this.style)return null;let s=null;const n=e.length,l=(i?this.style.startArrow:this.style.endArrow)||Constants.NONE;let r=i?e[1]:e[n-2];const a=i?e[0]:e[n-1];if(l!==Constants.NONE&&null!==r&&null!==a){let o=1;for(;o<n-1&&0===Math.round(r.x-a.x)&&0===Math.round(r.y-a.y);)r=i?e[1+o]:e[n-2-o],o++;const h=a.x-r.x,d=a.y-r.y,c=Math.max(1,Math.sqrt(h*h+d*d)),u=h/c,g=d/c,p=(i?this.style.startSize:this.style.endSize)??Constants.DEFAULT_MARKERSIZE,E=(i?this.style.startFill:this.style.endFill)??!0;s=edge_MarkerShape.createMarker(t,this,l,a,u,g,p,i,this.strokeWidth,E)}return s}augmentBoundingBox(t){if(super.augmentBoundingBox(t),!this.style)return;let e=0;this.style.startArrow!==Constants.NONE&&(e=(this.style.startSize??Constants.DEFAULT_MARKERSIZE)+1),this.style.endArrow!==Constants.NONE&&(e=Math.max(e,this.style.endSize??Constants.DEFAULT_MARKERSIZE)+1),t.grow(e*this.scale)}}const edge_ConnectorShape=ConnectorShape;var ImageShape=__webpack_require__(1898),mathUtils=__webpack_require__(3514),styleUtils=__webpack_require__(9155),Point=__webpack_require__(9447),Shape=__webpack_require__(8760),StringUtils=__webpack_require__(3215),domUtils=__webpack_require__(4532),SvgCanvas2D=__webpack_require__(4881);class TextShape extends Shape.A{constructor(t,e,i=Constants.ALIGN.CENTER,s=Constants.ALIGN.MIDDLE,n="black",l=Constants.DEFAULT_FONTFAMILY,r=Constants.DEFAULT_FONTSIZE,a=Constants.DEFAULT_FONTSTYLE,o=2,h=0,d=0,c=0,u=0,g=!0,p=Constants.NONE,E=Constants.NONE,C=!1,m=!1,f="visible",y=0,v=Constants.DEFAULT_TEXT_DIRECTION){super(),this.margin=null,this.unrotatedBoundingBox=null,this.flipH=!1,this.flipV=!1,this.baseSpacingTop=0,this.baseSpacingBottom=0,this.baseSpacingLeft=0,this.baseSpacingRight=0,this.replaceLinefeeds=!0,this.verticalTextRotation=-90,this.ignoreClippedStringSize=!0,this.ignoreStringSize=!1,this.lastValue=null,this.cacheEnabled=!0,this.value=t,this.bounds=e,this.color=n??"black",this.align=i??Constants.ALIGN.CENTER,this.valign=s??Constants.ALIGN.MIDDLE,this.family=l??Constants.DEFAULT_FONTFAMILY,this.size=r??Constants.DEFAULT_FONTSIZE,this.fontStyle=a??Constants.DEFAULT_FONTSTYLE,this.spacing=o??2,this.spacingTop=this.spacing+(h??0),this.spacingRight=this.spacing+(d??0),this.spacingBottom=this.spacing+(c??0),this.spacingLeft=this.spacing+(u??0),this.horizontal=g??!0,this.background=p,this.border=E,this.wrap=C??!1,this.clipped=m??!1,this.overflow=f??"visible",this.labelPadding=y??0,this.textDirection=v,this.rotation=0,this.updateMargin()}getSvgScreenOffset(){return 0}checkBounds(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)}paint(t,e=!1){const i=this.scale,s=this.bounds.x/i,n=this.bounds.y/i,l=this.bounds.width/i,r=this.bounds.height/i;if(this.updateTransform(t,s,n,l,r),this.configureCanvas(t,s,n,l,r),e)t.updateText(s,n,l,r,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node);else{const e=(0,domUtils.isNode)(this.value)||this.dialect===Constants.DIALECT.STRICTHTML,i=e?"html":"";let a=this.value;e||"html"!==i||(a=(0,StringUtils.htmlEntities)(a,!1)),"html"!==i||(0,domUtils.isNode)(this.value)||(a=(0,StringUtils.replaceTrailingNewlines)(a,"<div><br></div>")),a=!(0,domUtils.isNode)(this.value)&&this.replaceLinefeeds&&"html"===i?a.replace(/\n/g,"<br/>"):a;let o=this.textDirection;o!==Constants.TEXT_DIRECTION.AUTO||e||(o=this.getAutoDirection()),o!==Constants.TEXT_DIRECTION.LTR&&o!==Constants.TEXT_DIRECTION.RTL&&(o=Constants.TEXT_DIRECTION.DEFAULT),t.text(s,n,l,r,a,this.align,this.valign,this.wrap,i,this.overflow,this.clipped,this.getTextRotation(),o)}}redraw(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue===this.value&&((0,domUtils.isNode)(this.value)||this.dialect===Constants.DIALECT.STRICTHTML))if("DIV"===this.node.nodeName)this.redrawHtmlShape(),this.updateBoundingBox();else{const t=this.createCanvas();t&&(t.pointerEvents=this.pointerEvents,this.paint(t,!0),this.destroyCanvas(t),this.updateBoundingBox())}else super.redraw(),(0,domUtils.isNode)(this.value)||this.dialect===Constants.DIALECT.STRICTHTML?this.lastValue=this.value:this.lastValue=null}resetStyles(){super.resetStyles(),this.color="black",this.align=Constants.ALIGN.CENTER,this.valign=Constants.ALIGN.MIDDLE,this.family=Constants.DEFAULT_FONTFAMILY,this.size=Constants.DEFAULT_FONTSIZE,this.fontStyle=Constants.DEFAULT_FONTSTYLE,this.spacing=2,this.spacingTop=2,this.spacingRight=2,this.spacingBottom=2,this.spacingLeft=2,this.horizontal=!0,this.background=Constants.NONE,this.border=Constants.NONE,this.textDirection=Constants.DEFAULT_TEXT_DIRECTION,this.margin=null}apply(t){const e=this.spacing;super.apply(t),this.style&&(this.fontStyle=this.style.fontStyle??this.fontStyle,this.family=this.style.fontFamily??this.family,this.size=this.style.fontSize??this.size,this.color=this.style.fontColor??this.color,this.align=this.style.align??this.align,this.valign=this.style.verticalAlign??this.valign,this.spacing=this.style.spacing??this.spacing,this.spacingTop=(this.style.spacingTop??this.spacingTop-e)+this.spacing,this.spacingRight=(this.style.spacingRight??this.spacingRight-e)+this.spacing,this.spacingBottom=(this.style.spacingBottom??this.spacingBottom-e)+this.spacing,this.spacingLeft=(this.style.spacingLeft??this.spacingLeft-e)+this.spacing,this.horizontal=this.style.horizontal??this.horizontal,this.background=this.style.labelBackgroundColor??this.background,this.border=this.style.labelBorderColor??this.border,this.textDirection=this.style.textDirection??Constants.DEFAULT_TEXT_DIRECTION,this.opacity=this.style.textOpacity??100,this.updateMargin()),this.flipV=!1,this.flipH=!1}getAutoDirection(){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(String(this.value));return t&&t.length>0&&t[0]>"z"?Constants.TEXT_DIRECTION.RTL:Constants.TEXT_DIRECTION.LTR}getContentNode(){let t=this.node;return t&&(t=t.ownerSVGElement?t.firstChild.firstChild.firstChild.firstChild.firstChild:this.node.firstChild.firstChild),t}updateBoundingBox(){let{node:t}=this;this.boundingBox=this.bounds.clone();const e=this.getTextRotation(),i=this.style?.labelPosition??Constants.ALIGN.CENTER,s=this.style?.verticalLabelPosition??Constants.ALIGN.MIDDLE;if(!this.ignoreStringSize&&t&&"fill"!==this.overflow&&(!this.clipped||!this.ignoreClippedStringSize||i!==Constants.ALIGN.CENTER||s!==Constants.ALIGN.MIDDLE)){let e=null,i=null;if(t.firstChild&&t.firstChild.firstChild&&"foreignObject"===t.firstChild.firstChild.nodeName)t=t.firstChild.firstChild.firstChild.firstChild,i=t.offsetHeight*this.scale,e="width"===this.overflow?this.boundingBox.width:t.offsetWidth*this.scale;else try{const e=t.getBBox();return void("string"==typeof this.value&&0===(0,StringUtils.trim)(this.value)?.length||0===e.width&&0===e.height?this.boundingBox=null:this.boundingBox=new Rectangle.A(e.x,e.y,e.width,e.height))}catch(t){}e&&i&&(this.boundingBox=new Rectangle.A(this.bounds.x,this.bounds.y,e,i))}if(this.boundingBox){const t=this.margin;if(0!==e){const i=(0,mathUtils.getBoundingBox)(new Rectangle.A(t.x*this.boundingBox.width,t.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),e,new Point.A(0,0));this.unrotatedBoundingBox=Rectangle.A.fromRectangle(this.boundingBox),this.unrotatedBoundingBox.x+=t.x*this.unrotatedBoundingBox.width,this.unrotatedBoundingBox.y+=t.y*this.unrotatedBoundingBox.height,this.boundingBox.x+=i.x,this.boundingBox.y+=i.y,this.boundingBox.width=i.width,this.boundingBox.height=i.height}else this.boundingBox.x+=t.x*this.boundingBox.width,this.boundingBox.y+=t.y*this.boundingBox.height,this.unrotatedBoundingBox=null}}getShapeRotation(){return 0}getTextRotation(){return this.state&&this.state.shape?this.state.shape.getTextRotation():0}isPaintBoundsInverted(){return!this.horizontal&&!!this.state&&this.state.cell.isVertex()}configureCanvas(t,e,i,s,n){super.configureCanvas(t,e,i,s,n),t.setFontColor(this.color),t.setFontBackgroundColor(this.background),t.setFontBorderColor(this.border),t.setFontFamily(this.family),t.setFontSize(this.size),t.setFontStyle(this.fontStyle)}getHtmlValue(){let t=this.value;return this.dialect!==Constants.DIALECT.STRICTHTML&&(t=(0,StringUtils.htmlEntities)(t,!1)),t=(0,StringUtils.replaceTrailingNewlines)(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t,t}getTextCss(){const t=Constants.ABSOLUTE_LINE_HEIGHT?this.size*Constants.LINE_HEIGHT+"px":Constants.LINE_HEIGHT;let e=`display: inline-block; font-size: ${this.size}px; font-family: ${this.family}; color: ${this.color}; line-height: ${t}; pointer-events: ${this.pointerEvents?"all":"none"}; `;(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.BOLD)&&(e+="font-weight: bold; "),(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.ITALIC)&&(e+="font-style: italic; ");const i=[];return(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.UNDERLINE)&&i.push("underline"),(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(e+=`text-decoration: ${i.join(" ")}; `),e}redrawHtmlShape(){const t=Math.max(0,Math.round(this.bounds.width/this.scale)),e=Math.max(0,Math.round(this.bounds.height/this.scale)),i=`position: absolute; left: ${Math.round(this.bounds.x)}px; top: ${Math.round(this.bounds.y)}px; pointer-events: none; `,s=this.getTextCss(),n=this.margin,l=this.node;SvgCanvas2D.A.createCss(t+2,e,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.background!==Constants.NONE?(0,StringUtils.htmlEntities)(this.background,!0):null,this.border!==Constants.NONE?(0,StringUtils.htmlEntities)(this.border,!0):null,i,s,this.scale,((t,e,i,s,r,a)=>{const o=this.getTextRotation();let h=(1!==this.scale?`scale(${this.scale}) `:"")+(0!==o?`rotate(${o}deg) `:"")+(0!==n.x||0!==n.y?`translate(${100*n.x}%,${100*n.y}%)`:"");""!==h&&(h=`transform-origin: 0 0; transform: ${h}; `),""===a?(i+=s,s=`display:inline-block; min-width: 100%; ${h}`):(s+=h,Client.A.IS_SF&&(s+="-webkit-clip-path: content-box;")),this.opacity<100&&(r+=`opacity: ${this.opacity/100}; `),l.setAttribute("style",i);const d=(0,domUtils.isNode)(this.value)?this.value.outerHTML:this.getHtmlValue();l.firstChild||(l.innerHTML=`<div><div>${d}</div></div>`),l.firstChild.firstChild.setAttribute("style",r),l.firstChild.setAttribute("style",s)}))}updateInnerHtml(t){if((0,domUtils.isNode)(this.value))t.innerHTML=this.value.outerHTML;else{let e=this.value;this.dialect!==Constants.DIALECT.STRICTHTML&&(e=(0,StringUtils.htmlEntities)(e,!1)),e=(0,StringUtils.replaceTrailingNewlines)(e,"<div>&nbsp;</div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e,e=`<div style="display:inline-block;_display:inline;">${e}</div>`,t.innerHTML=e}}updateValue(){const t=this.node;if((0,domUtils.isNode)(this.value))t.innerHTML="",t.appendChild(this.value);else{let e=this.value;this.dialect!==Constants.DIALECT.STRICTHTML&&(e=(0,StringUtils.htmlEntities)(e,!1)),e=(0,StringUtils.replaceTrailingNewlines)(e,"<div><br></div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e;const i=this.background!==Constants.NONE?this.background:null,s=this.border!==Constants.NONE?this.border:null;if("fill"===this.overflow||"width"===this.overflow)i&&(t.style.backgroundColor=i),s&&(t.style.border=`1px solid ${s}`);else{let t="";i&&(t+=`background-color:${(0,StringUtils.htmlEntities)(i,!0)};`),s&&(t+=`border:1px solid ${(0,StringUtils.htmlEntities)(s,!0)};`),e=`<div style="zoom:1;${t}display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:${Constants.ABSOLUTE_LINE_HEIGHT?this.size*Constants.LINE_HEIGHT+"px":Constants.LINE_HEIGHT}">${e}</div>`}t.innerHTML=e;const n=t.getElementsByTagName("div");if(n.length>0){let t=this.textDirection;t===Constants.TEXT_DIRECTION.AUTO&&this.dialect!==Constants.DIALECT.STRICTHTML&&(t=this.getAutoDirection()),t===Constants.TEXT_DIRECTION.LTR||t===Constants.TEXT_DIRECTION.RTL?n[n.length-1].setAttribute("dir",t):n[n.length-1].removeAttribute("dir")}}}updateFont(t){const{style:e}=t;e.lineHeight=Constants.ABSOLUTE_LINE_HEIGHT?this.size*Constants.LINE_HEIGHT+"px":Constants.LINE_HEIGHT,e.fontSize=`${this.size}px`,e.fontFamily=this.family,e.verticalAlign="top",e.color=this.color,(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.BOLD)?e.fontWeight="bold":e.fontWeight="",(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.ITALIC)?e.fontStyle="italic":e.fontStyle="";const i=[];(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.UNDERLINE)&&i.push("underline"),(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(e.textDecoration=i.join(" ")),this.align===Constants.ALIGN.CENTER?e.textAlign="center":this.align===Constants.ALIGN.RIGHT?e.textAlign="right":e.textAlign="left"}updateSize(t,e=!1){const i=Math.max(0,Math.round(this.bounds.width/this.scale)),s=Math.max(0,Math.round(this.bounds.height/this.scale)),{style:n}=t;if(this.clipped?(n.overflow="hidden",n.maxHeight=`${s}px`,n.maxWidth=`${i}px`):"fill"===this.overflow?(n.width=`${i+1}px`,n.height=`${s+1}px`,n.overflow="hidden"):"width"===this.overflow&&(n.width=`${i+1}px`,n.maxHeight=`${s+1}px`,n.overflow="hidden"),this.wrap&&i>0){if(n.wordWrap=Constants.WORD_WRAP,n.whiteSpace="normal",n.width=`${i}px`,e&&"fill"!==this.overflow&&"width"!==this.overflow){let e=t;null!=e.firstChild&&"DIV"===e.firstChild.nodeName&&(e=e.firstChild,"break-word"===t.style.wordWrap&&(e.style.width="100%"));let s=e.offsetWidth;if(0===s){const i=t.parentNode;t.style.visibility="hidden",document.body.appendChild(t),s=e.offsetWidth,t.style.visibility="",i.appendChild(t)}s+=3,this.clipped&&(s=Math.min(s,i)),n.width=`${s}px`}}else n.whiteSpace="nowrap"}updateMargin(){this.margin=(0,styleUtils.getAlignmentAsPoint)(this.align,this.valign)}getSpacing(){let t=0,e=0;return t=this.align===Constants.ALIGN.CENTER?(this.spacingLeft-this.spacingRight)/2:this.align===Constants.ALIGN.RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,e=this.valign===Constants.ALIGN.MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign===Constants.ALIGN.BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop,new Point.A(t,e)}}const node_TextShape=TextShape;var arrayUtils=__webpack_require__(1847),StencilShapeRegistry=__webpack_require__(3950),InternalMouseEvent=__webpack_require__(2387),util_Dictionary=__webpack_require__(5525),EventUtils=__webpack_require__(5524);const placeholderStyleValues=["inherit","swimlane","indicated"],placeholderStyleProperties=["fillColor","strokeColor","gradientColor","fontColor"];class CellRenderer{constructor(){this.defaultEdgeShape=edge_ConnectorShape,this.defaultVertexShape=RectangleShape.A,this.defaultTextShape=node_TextShape,this.legacyControlPosition=!0,this.legacySpacing=!0,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.forceControlClickHandler=!1}static registerShape(t,e){CellRenderer.defaultShapes[t]=e}initializeShape(t){t.shape&&(t.shape.dialect=t.view.graph.dialect,this.configureShape(t),t.shape.init(t.view.getDrawPane()))}createShape(t){let e=null;const i=StencilShapeRegistry.A.getStencil(t.style.shape);return e=i?new Shape.A(i):new(this.getShapeConstructor(t)),e}createIndicatorShape(t){t.shape&&(t.shape.indicatorShape=this.getShape(t.getIndicatorShape()||null))}getShape(t){return t?CellRenderer.defaultShapes[t]:null}getShapeConstructor(t){let e=this.getShape(t.style.shape||null);return e||(e=t.cell.isEdge()?this.defaultEdgeShape:this.defaultVertexShape),e}configureShape(t){const e=t.shape;e&&(e.apply(t),e.imageSrc=t.getImageSrc()||null,e.indicatorColor=t.getIndicatorColor()||Constants.NONE,e.indicatorStrokeColor=t.style.indicatorStrokeColor||Constants.NONE,e.indicatorGradientColor=t.getIndicatorGradientColor()||Constants.NONE,t.style.indicatorDirection&&(e.indicatorDirection=t.style.indicatorDirection),e.indicatorImageSrc=t.getIndicatorImageSrc()||null,this.postConfigureShape(t))}postConfigureShape(t){t.shape&&(this.resolveColor(t,"indicatorGradientColor","gradientColor"),this.resolveColor(t,"indicatorColor","fillColor"),this.resolveColor(t,"gradient","gradientColor"),this.resolveColor(t,"stroke","strokeColor"),this.resolveColor(t,"fill","fillColor"))}checkPlaceholderStyles(t){for(const e of placeholderStyleProperties)if(placeholderStyleValues.includes(t.style[e]))return!0;return!1}resolveColor(t,e,i){const s="fontColor"===i?t.text:t.shape;if(s){const n=t.view.graph,l=s[e];let r=null;if("inherit"===l?r=t.cell.getParent():"swimlane"===l?(s[e]="strokeColor"===i||"fontColor"===i?"#000000":"#ffffff",r=t.cell.getTerminal(!1)?t.cell.getTerminal(!1):t.cell,r=n.getSwimlane(r),i=n.swimlaneIndicatorColorAttribute):"indicated"===l&&t.shape?s[e]=t.shape.indicatorColor:"fillColor"!==i&&"fillColor"===l&&t.shape?s[e]=t.style.fillColor:"strokeColor"!==i&&"strokeColor"===l&&t.shape&&(s[e]=t.style.strokeColor),r){const t=n.getView().getState(r);if(s[e]=null,t){const n="fontColor"===i?t.text:t.shape;s[e]=n&&"indicatorColor"!==e?n[e]:t.style[i]}}}}getLabelValue(t){return t.view.graph.getLabel(t.cell)}createLabel(t,e){const i=t.view.graph;if((t.style.fontSize||0)>0||null==t.style.fontSize){const s=i.isHtmlLabel(t.cell)||(0,domUtils.isNode)(e);t.text=new this.defaultTextShape(e,new Rectangle.A,t.style.align??Constants.ALIGN.CENTER,t.getVerticalAlign(),t.style.fontColor,t.style.fontFamily,t.style.fontSize,t.style.fontStyle,t.style.spacing,t.style.spacingTop,t.style.spacingRight,t.style.spacingBottom,t.style.spacingLeft,t.style.horizontal,t.style.labelBackgroundColor,t.style.labelBorderColor,i.isWrapping(t.cell)&&i.isHtmlLabel(t.cell),i.isLabelClipped(t.cell),t.style.overflow,t.style.labelPadding,t.style.textDirection??Constants.DEFAULT_TEXT_DIRECTION),t.text.opacity=t.style.textOpacity??100,t.text.dialect=s?Constants.DIALECT.STRICTHTML:i.dialect,t.text.style=t.style,t.text.state=t,this.initializeLabel(t,t.text);let n=!1;const l=e=>{let s=t;if(Client.A.IS_TOUCH||n){const t=(0,EventUtils.getClientX)(e),n=(0,EventUtils.getClientY)(e),l=(0,styleUtils.convertPoint)(i.container,t,n);s=i.view.getState(i.getCellAt(l.x,l.y))}return s};InternalEvent.A.addGestureListeners(t.text.node,(e=>{if(this.isLabelEvent(t,e)){i.fireMouseEvent(InternalEvent.A.MOUSE_DOWN,new InternalMouseEvent.A(e,t));const s=(0,EventUtils.getSource)(e);n=i.dialect!==Constants.DIALECT.SVG&&"IMG"===s.nodeName}}),(e=>{this.isLabelEvent(t,e)&&i.fireMouseEvent(InternalEvent.A.MOUSE_MOVE,new InternalMouseEvent.A(e,l(e)))}),(e=>{this.isLabelEvent(t,e)&&(i.fireMouseEvent(InternalEvent.A.MOUSE_UP,new InternalMouseEvent.A(e,l(e))),n=!1)})),i.isNativeDblClickEnabled()&&InternalEvent.A.addListener(t.text.node,"dblclick",(e=>{this.isLabelEvent(t,e)&&(i.dblClick(e,t.cell),InternalEvent.A.consume(e))}))}}initializeLabel(t,e){if(Client.A.IS_SVG&&Client.A.NO_FO&&e.dialect!==Constants.DIALECT.SVG){const i=t.view.graph;e.init(i.container)}else e.init(t.view.getDrawPane())}createCellOverlays(t){const e=t.view.graph,i=e.getCellOverlays(t.cell),s=new util_Dictionary.A;for(let n=0;n<i.length;n+=1){const l=t.overlays.remove(i[n]);if(l)s.put(i[n],l);else{const l=new ImageShape.A(new Rectangle.A,i[n].image.src);l.dialect=e.dialect,l.preserveImageAspect=!1,l.overlay=i[n],this.initializeOverlay(t,l),this.installCellOverlayListeners(t,i[n],l),i[n].cursor&&(l.node.style.cursor=i[n].cursor),s.put(i[n],l)}}t.overlays.visit(((t,e)=>{e.destroy()})),t.overlays=s}initializeOverlay(t,e){e.init(t.view.getOverlayPane())}installCellOverlayListeners(t,e,i){const s=t.view.graph;InternalEvent.A.addListener(i.node,"click",(i=>{s.isEditing()&&s.stopEditing(!s.isInvokesStopCellEditing()),e.fireEvent(new EventObject.A(InternalEvent.A.CLICK,{event:i,cell:t.cell}))})),InternalEvent.A.addGestureListeners(i.node,(t=>{InternalEvent.A.consume(t)}),(e=>{s.fireMouseEvent(InternalEvent.A.MOUSE_MOVE,new InternalMouseEvent.A(e,t))})),Client.A.IS_TOUCH&&InternalEvent.A.addListener(i.node,"touchend",(i=>{e.fireEvent(new EventObject.A(InternalEvent.A.CLICK,{event:i,cell:t.cell}))}))}createControl(t){const e=t.view.graph,i=e.getFoldingImage(t);if(e.isFoldingEnabled()&&i){if(!t.control){const s=new Rectangle.A(0,0,i.width,i.height);t.control=new ImageShape.A(s,i.src),t.control.preserveImageAspect=!1,t.control.dialect=e.dialect,this.initControl(t,t.control,!0,this.createControlClickHandler(t))}}else t.control&&(t.control.destroy(),t.control=null)}createControlClickHandler(t){const e=t.view.graph;return i=>{if(this.forceControlClickHandler||e.isEnabled()){const s=!t.cell.isCollapsed();e.foldCells(s,!1,[t.cell],!1,i),InternalEvent.A.consume(i)}}}initControl(t,e,i,s){const n=t.view.graph;n.isHtmlLabel(t.cell)&&Client.A.NO_FO&&n.dialect===Constants.DIALECT.SVG?(e.dialect=Constants.DIALECT.PREFERHTML,e.init(n.container),e.node.style.zIndex=String(1)):e.init(t.view.getOverlayPane());const l=e.node;if(s&&!Client.A.IS_IOS&&(n.isEnabled()&&(l.style.cursor="pointer"),InternalEvent.A.addListener(l,"click",s)),i){let e=null;InternalEvent.A.addGestureListeners(l,(i=>{e=new Point.A((0,EventUtils.getClientX)(i),(0,EventUtils.getClientY)(i)),n.fireMouseEvent(InternalEvent.A.MOUSE_DOWN,new InternalMouseEvent.A(i,t)),InternalEvent.A.consume(i)}),(e=>{n.fireMouseEvent(InternalEvent.A.MOUSE_MOVE,new InternalMouseEvent.A(e,t))}),(e=>{n.fireMouseEvent(InternalEvent.A.MOUSE_UP,new InternalMouseEvent.A(e,t)),InternalEvent.A.consume(e)})),s&&Client.A.IS_IOS&&l.addEventListener("touchend",(t=>{if(e){const i=n.getEventTolerance();Math.abs(e.x-(0,EventUtils.getClientX)(t))<i&&Math.abs(e.y-(0,EventUtils.getClientY)(t))<i&&(s.call(s,t),InternalEvent.A.consume(t))}}),!0)}return l}isShapeEvent(t,e){return!0}isLabelEvent(t,e){return!0}installListeners(t){const e=t.view.graph,i=i=>{let s=t;const n=(0,EventUtils.getSource)(i);if(n&&e.dialect!==Constants.DIALECT.SVG&&"IMG"===n.nodeName||Client.A.IS_TOUCH){const t=(0,EventUtils.getClientX)(i),n=(0,EventUtils.getClientY)(i),l=(0,styleUtils.convertPoint)(e.container,t,n),r=e.getCellAt(l.x,l.y);s=r?e.view.getState(r):null}return s};t.shape&&(InternalEvent.A.addGestureListeners(t.shape.node,(i=>{this.isShapeEvent(t,i)&&e.fireMouseEvent(InternalEvent.A.MOUSE_DOWN,new InternalMouseEvent.A(i,t))}),(s=>{this.isShapeEvent(t,s)&&e.fireMouseEvent(InternalEvent.A.MOUSE_MOVE,new InternalMouseEvent.A(s,i(s)))}),(s=>{this.isShapeEvent(t,s)&&e.fireMouseEvent(InternalEvent.A.MOUSE_UP,new InternalMouseEvent.A(s,i(s)))})),e.isNativeDblClickEnabled()&&InternalEvent.A.addListener(t.shape.node,"dblclick",(i=>{this.isShapeEvent(t,i)&&(e.dblClick(i,t.cell),InternalEvent.A.consume(i))})))}redrawLabel(t,e){const i=t.view.graph,s=this.getLabelValue(t),n=i.isWrapping(t.cell),l=i.isLabelClipped(t.cell),r=i.isHtmlLabel(t.cell)||s&&(0,domUtils.isNode)(s)?Constants.DIALECT.STRICTHTML:i.dialect,a=t.style.overflow??"visible";if(!t.text||t.text.wrap===n&&t.text.clipped===l&&t.text.overflow===a&&t.text.dialect===r||(t.text.destroy(),t.text=null),null==t.text&&null!=s&&((0,domUtils.isNode)(s)||s.length>0)?this.createLabel(t,s):null==t.text||null!=s&&0!=s.length||(t.text.destroy(),t.text=null),null!=t.text){e&&(null!=t.text.lastValue&&this.isTextShapeInvalid(t,t.text)&&(t.text.lastValue=null),t.text.resetStyles(),t.text.apply(t),t.text.valign=t.getVerticalAlign());const i=this.getLabelBounds(t),o=this.getTextScale(t);if(this.resolveColor(t,"color","fontColor"),e||t.text.value!==s||t.text.wrap!==n||t.text.overflow!==a||t.text.clipped!==l||t.text.scale!==o||t.text.dialect!==r||null==t.text.bounds||!t.text.bounds.equals(i)){t.text.dialect=r,t.text.value=s,t.text.bounds=i,t.text.scale=o,t.text.wrap=n,t.text.clipped=l,t.text.overflow=a;const e=t.text.node.style.visibility;this.redrawLabelShape(t.text),t.text.node.style.visibility=e}}}isTextShapeInvalid(t,e){function i(i,s,n){let l=!1;return l="spacingTop"===s||"spacingRight"===s||"spacingBottom"===s||"spacingLeft"===s?parseFloat(String(e[i]))-parseFloat(String(e.spacing))!==(t.style[s]||n):e[i]!==(t.style[s]||n),l}return i("fontStyle","fontStyle",Constants.DEFAULT_FONTSTYLE)||i("family","fontFamily",Constants.DEFAULT_FONTFAMILY)||i("size","fontSize",Constants.DEFAULT_FONTSIZE)||i("color","fontColor","black")||i("align","align","")||i("valign","verticalAlign","")||i("spacing","spacing",2)||i("spacingTop","spacingTop",0)||i("spacingRight","spacingRight",0)||i("spacingBottom","spacingBottom",0)||i("spacingLeft","spacingLeft",0)||i("horizontal","horizontal",!0)||i("background","labelBackgroundColor",null)||i("border","labelBorderColor",null)||i("opacity","textOpacity",100)||i("textDirection","textDirection",Constants.DEFAULT_TEXT_DIRECTION)}redrawLabelShape(t){t.redraw()}getTextScale(t){return t.view.scale}getLabelBounds(t){const{scale:e}=t.view,i=t.cell.isEdge();let s=new Rectangle.A(t.absoluteOffset.x,t.absoluteOffset.y);if(i){const i=t.text.getSpacing();s.x+=i.x*e,s.y+=i.y*e;const n=t.cell.getGeometry();null!=n&&(s.width=Math.max(0,n.width*e),s.height=Math.max(0,n.height*e))}else{if(t.text.isPaintBoundsInverted()){const t=s.x;s.x=s.y,s.y=t}s.x+=t.x,s.y+=t.y,s.width=Math.max(1,t.width),s.height=Math.max(1,t.height)}if(t.text.isPaintBoundsInverted()){const e=(t.width-t.height)/2;s.x+=e,s.y-=e;const i=s.width;s.width=s.height,s.height=i}if(null!=t.shape){const e=t.style.labelPosition??Constants.ALIGN.CENTER,i=t.style.verticalLabelPosition??Constants.ALIGN.MIDDLE;e===Constants.ALIGN.CENTER&&i===Constants.ALIGN.MIDDLE&&(s=t.shape.getLabelBounds(s))}const n=t.style.labelWidth??null;return null!=n&&(s.width=n*e),i||this.rotateLabelBounds(t,s),s}rotateLabelBounds(t,e){if(e.y-=t.text.margin.y*e.height,e.x-=t.text.margin.x*e.width,!this.legacySpacing||"fill"!==t.style.overflow&&"width"!==t.style.overflow){const i=t.view.scale,s=t.text.getSpacing();e.x+=s.x*i,e.y+=s.y*i;const n=t.style.labelPosition??Constants.ALIGN.CENTER,l=t.style.verticalLabelPosition??Constants.ALIGN.MIDDLE,r=t.style.labelWidth??null;e.width=Math.max(0,e.width-(n===Constants.ALIGN.CENTER&&null==r?t.text.spacingLeft*i+t.text.spacingRight*i:0)),e.height=Math.max(0,e.height-(l===Constants.ALIGN.MIDDLE?t.text.spacingTop*i+t.text.spacingBottom*i:0))}const i=t.text.getTextRotation();if(0!==i&&null!=t&&t.cell.isVertex()){const s=t.getCenterX(),n=t.getCenterY();if(e.x!==s||e.y!==n){const t=i*(Math.PI/180),l=(0,mathUtils.getRotatedPoint)(new Point.A(e.x,e.y),Math.cos(t),Math.sin(t),new Point.A(s,n));e.x=l.x,e.y=l.y}}}redrawCellOverlays(t,e=!1){if(this.createCellOverlays(t),null!=t.overlays){const i=(0,mathUtils.mod)(t.style.rotation??0,90),s=(0,mathUtils.toRadians)(i),n=Math.cos(s),l=Math.sin(s);t.overlays.visit(((s,r)=>{const a=r.overlay.getBounds(t);if(!t.cell.isEdge()&&null!=t.shape&&0!==i){let e=a.getCenterX(),i=a.getCenterY();const s=(0,mathUtils.getRotatedPoint)(new Point.A(e,i),n,l,new Point.A(t.getCenterX(),t.getCenterY()));e=s.x,i=s.y,a.x=Math.round(e-a.width/2),a.y=Math.round(i-a.height/2)}!e&&null!=r.bounds&&r.scale===t.view.scale&&r.bounds.equals(a)||(r.bounds=a,r.scale=t.view.scale,r.redraw())}))}}redrawControl(t,e=!1){const i=t.view.graph.getFoldingImage(t);if(null!=t.control&&null!=i){const s=this.getControlBounds(t,i.width,i.height),n=this.legacyControlPosition?t.style.rotation??0:t.shape.getTextRotation(),l=t.view.scale;!e&&t.control.scale===l&&t.control.bounds.equals(s)&&t.control.rotation===n||(t.control.rotation=n,t.control.bounds=s,t.control.scale=l,t.control.redraw())}}getControlBounds(t,e,i){if(null!=t.control){const s=t.view.scale;let n=t.getCenterX(),l=t.getCenterY();if(!t.cell.isEdge()&&(n=t.x+e*s,l=t.y+i*s,null!=t.shape)){let e=t.shape.getShapeRotation();if(this.legacyControlPosition)e=t.style.rotation??0;else if(t.shape.isPaintBoundsInverted()){const e=(t.width-t.height)/2;n+=e,l-=e}if(0!==e){const i=(0,mathUtils.toRadians)(e),s=Math.cos(i),r=Math.sin(i),a=(0,mathUtils.getRotatedPoint)(new Point.A(n,l),s,r,new Point.A(t.getCenterX(),t.getCenterY()));n=a.x,l=a.y}}return t.cell.isEdge(),new Rectangle.A(Math.round(n-e/2*s),Math.round(l-i/2*s),Math.round(e*s),Math.round(i*s))}return null}insertStateAfter(t,e,i){const s=t.view.graph,n=this.getShapesForState(t);for(let l=0;l<n.length;l+=1)if(null!=n[l]&&null!=n[l].node){const r=n[l].node.parentNode!==t.view.getDrawPane()&&n[l].node.parentNode!==t.view.getOverlayPane(),a=r?i:e;if(null!=a&&a.nextSibling!==n[l].node)null==a.nextSibling?a.parentNode.appendChild(n[l].node):a.parentNode.insertBefore(n[l].node,a.nextSibling);else if(null==a){const e=n[l].node;if(e.parentNode===s.container){let{canvas:i}=t.view;for(;null!=i&&i.parentNode!==s.container;)i=i.parentNode;null!=i&&null!=i.nextSibling?i.nextSibling!==e&&e.parentNode.insertBefore(e,i.nextSibling):e.parentNode.appendChild(e)}else null!=e.parentNode&&null!=e.parentNode.firstChild&&e.parentNode.firstChild!=e&&e.parentNode.insertBefore(e,e.parentNode.firstChild)}r?i=n[l].node:e=n[l].node}return[e,i]}getShapesForState(t){return[t.shape,t.text,t.control]}redraw(t,e=!1,i=!0){const s=this.redrawShape(t,e,i);null!=t.shape&&i&&(this.redrawLabel(t,s),this.redrawCellOverlays(t,s),this.redrawControl(t,s))}redrawShape(t,e=!1,i=!0){let s=!1;const n=t.view.graph;if(null!=t.shape&&null!=t.shape.style&&null!=t.style&&t.shape.style.shape!==t.style.shape&&(t.shape.destroy(),t.shape=null),null==t.shape&&null!=n.container&&t.cell!==t.view.currentRoot&&(t.cell.isVertex()||t.cell.isEdge())){if(t.shape=this.createShape(t),null!=t.shape){t.shape.minSvgStrokeWidth=this.minSvgStrokeWidth,t.shape.antiAlias=this.antiAlias,this.createIndicatorShape(t),this.initializeShape(t),this.createCellOverlays(t),this.installListeners(t);const e=n.getPlugin("SelectionCellsHandler");e?.updateHandler(t)}}else if(!e&&null!=t.shape&&(!(0,arrayUtils.FG)(t.shape.style,t.style)||this.checkPlaceholderStyles(t))){t.shape.resetStyles(),this.configureShape(t);const i=n.getPlugin("SelectionCellsHandler");i?.updateHandler(t),e=!0}return null!=t.shape&&t.shape.indicatorShape!=this.getShape(t.getIndicatorShape())&&(null!=t.shape.indicator&&(t.shape.indicator.destroy(),t.shape.indicator=null),this.createIndicatorShape(t),null!=t.shape.indicatorShape&&(t.shape.indicator=new t.shape.indicatorShape,t.shape.indicator.dialect=t.shape.dialect,t.shape.indicator.init(t.node),e=!0)),t.shape&&(this.createControl(t),(e||this.isShapeInvalid(t,t.shape))&&(t.absolutePoints.length>0?(t.shape.points=t.absolutePoints.slice(),t.shape.bounds=null):(t.shape.points=[],t.shape.bounds=new Rectangle.A(t.x,t.y,t.width,t.height)),t.shape.scale=t.view.scale,null==i||i?this.doRedrawShape(t):t.shape.updateBoundingBox(),s=!0)),s}doRedrawShape(t){t.shape?.redraw()}isShapeInvalid(t,e){return null==e.bounds||e.scale!==t.view.scale||0===t.absolutePoints.length&&!e.bounds.equals(t)||t.absolutePoints.length>0&&!(0,arrayUtils.s7)(e.points,t.absolutePoints)}destroy(t){t.shape&&(t.text&&(t.text.destroy(),t.text=null),t.overlays.visit(((t,e)=>{e.destroy()})),t.overlays=new util_Dictionary.A,t.control&&(t.control.destroy(),t.control=null),t.shape.destroy(),t.shape=null)}}CellRenderer.defaultShapes={};const cell_CellRenderer=CellRenderer;var Cell=__webpack_require__(8981),UndoableEdit=__webpack_require__(1323),CellPath=__webpack_require__(6498);class ChildChange{constructor(t,e,i,s=0){this.model=t,this.parent=e,this.previous=e,this.child=i,this.index=s,this.previousIndex=s}execute(){let t=this.child.getParent();const e=t?t.getIndex(this.child):0;this.previous||this.connect(this.child,!1),t=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex),this.previous&&this.connect(this.child,!0),this.parent=this.previous,this.previous=t,this.index=this.previousIndex,this.previousIndex=e}connect(t,e=!0){const i=t.getTerminal(!0),s=t.getTerminal(!1);i&&(e?this.model.terminalForCellChanged(t,i,!0):this.model.terminalForCellChanged(t,null,!0)),s&&(e?this.model.terminalForCellChanged(t,s,!1):this.model.terminalForCellChanged(t,null,!1)),t.setTerminal(i,!0),t.setTerminal(s,!1);const n=t.getChildCount();for(let i=0;i<n;i+=1)this.connect(t.getChildAt(i),e)}}const undoable_changes_ChildChange=ChildChange;class CollapseChange{constructor(t,e,i){this.model=t,this.cell=e,this.collapsed=i,this.previous=i}execute(){this.collapsed=this.previous,this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)}}const undoable_changes_CollapseChange=CollapseChange;class GeometryChange{constructor(t,e,i){this.model=t,this.cell=e,this.geometry=i,this.previous=i}execute(){this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous)}}const undoable_changes_GeometryChange=GeometryChange;class RootChange{constructor(t,e){this.model=t,this.root=e,this.previous=e}execute(){this.root=this.previous,this.previous=this.model.rootChanged(this.previous)}}const undoable_changes_RootChange=RootChange;class StyleChange{constructor(t,e,i){this.model=t,this.cell=e,this.style=i,this.previous=i}execute(){this.style=this.previous,this.previous=this.model.styleForCellChanged(this.cell,this.previous)}}const undoable_changes_StyleChange=StyleChange;class TerminalChange{constructor(t,e,i,s){this.model=t,this.cell=e,this.terminal=i,this.previous=i,this.source=s}execute(){this.terminal=this.previous,this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)}}const undoable_changes_TerminalChange=TerminalChange;class ValueChange{constructor(t,e,i){this.model=t,this.cell=e,this.value=i,this.previous=i}execute(){this.value=this.previous,this.previous=this.model.valueForCellChanged(this.cell,this.previous)}}const undoable_changes_ValueChange=ValueChange;class VisibleChange{constructor(t,e,i){this.model=t,this.cell=e,this.visible=i,this.previous=i}execute(){this.visible=this.previous,this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)}}const undoable_changes_VisibleChange=VisibleChange;var ObjectIdentity=__webpack_require__(6232);const filterCells=t=>e=>{const i=[];for(let s=0;s<e.length;s+=1)t(e[s])&&i.push(e[s]);return i},getOpposites=(t,e,i=!0,s=!0)=>t.reduce(((t,n)=>{const l=n.getTerminal(!0),r=n.getTerminal(!1);return l===e&&null!=r&&r!==e&&s?t.push(r):r===e&&null!=l&&l!==e&&i&&t.push(l),t}),[]),getTopmostCells=t=>{const e=new util_Dictionary.A,i=[];for(let i=0;i<t.length;i+=1)e.put(t[i],!0);for(let s=0;s<t.length;s+=1){const n=t[s];let l=!0,r=n.getParent();for(;null!=r;){if(e.get(r)){l=!1;break}r=r.getParent()}l&&i.push(n)}return i},getParents=t=>{const e=[],i=new util_Dictionary.A;for(const s of t){const t=s.getParent();null==t||i.get(t)||(i.put(t,!0),e.push(t))}return e},cloneCell=(t=null,e=!0)=>t?cloneCells([t],e)[0]:null,cloneCells=(t,e=!0,i={})=>{const s=[];for(const n of t)s.push(cloneCellImpl(n,i,e));for(let e=0;e<s.length;e+=1)null!=s[e]&&restoreClone(s[e],t[e],i);return s},cloneCellImpl=(t,e={},i=!1)=>{const s=ObjectIdentity.A.get(t);let n=e?e[s]:null;if(null==n&&(n=t.clone(),e[s]=n,i)){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=cloneCellImpl(t.getChildAt(s),e,!0);n.insert(i)}}return n},restoreClone=(t,e,i)=>{const s=e.getTerminal(!0);if(null!=s){const e=i[ObjectIdentity.A.get(s)];null!=e&&e.insertEdge(t,!0)}const n=e.getTerminal(!1);if(null!=n){const e=i[ObjectIdentity.A.get(n)];null!=e&&e.insertEdge(t,!1)}const l=t.getChildCount();for(let s=0;s<l;s+=1)restoreClone(t.getChildAt(s),e.getChildAt(s),i)};class GraphDataModel extends EventSource.A{constructor(t=null){super(),this.root=null,this.cells={},this.maintainEdgeParent=!0,this.ignoreRelativeEdgeParent=!0,this.createIds=!0,this.prefix="",this.postfix="",this.nextId=0,this.currentEdit=null,this.updateLevel=0,this.endingUpdate=!1,this.currentEdit=this.createUndoableEdit(),null!=t?this.setRoot(t):this.clear()}clear(){this.setRoot(this.createRoot())}isCreateIds(){return this.createIds}setCreateIds(t){this.createIds=t}createRoot(){const t=new Cell.A;return t.insert(new Cell.A),t}getCell(t){return this.cells?this.cells[t]:null}filterCells(t,e){return filterCells(e)(t)}getRoot(t=null){return t?t.getRoot():this.root}setRoot(t){return this.execute(new undoable_changes_RootChange(this,t)),t}rootChanged(t){const e=this.root;return this.root=t,this.nextId=0,this.cells=null,this.cellAdded(t),e}isRoot(t=null){return null!=t&&this.root===t}isLayer(t){return!!t&&this.isRoot(t.getParent())}contains(t){return this.root.isAncestor(t)}add(t,e,i=null){if(e!==t&&null!=t&&null!=e){null==i&&(i=t.getChildCount());const s=t!==e.getParent();this.execute(new undoable_changes_ChildChange(this,t,e,i)),this.maintainEdgeParent&&s&&this.updateEdgeParents(e)}return e}cellAdded(t){if(null!=t){if(null==t.getId()&&this.createIds&&t.setId(this.createId(t)),null!=t.getId()){let e=this.getCell(t.getId());if(e!==t){for(;null!=e;)t.setId(this.createId(t)),e=this.getCell(t.getId());null==this.cells&&(this.cells={}),this.cells[t.getId()]=t}}(0,mathUtils.isNumeric)(String(t.getId()))&&(this.nextId=Math.max(this.nextId,parseInt(t.getId())));for(const e of t.getChildren())this.cellAdded(e)}}createId(t){const e=this.nextId;return this.nextId++,this.prefix+e+this.postfix}updateEdgeParents(t,e=this.getRoot(t)){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=t.getChildAt(s);this.updateEdgeParents(i,e)}const s=t.getEdgeCount(),n=[];for(let e=0;e<s;e+=1)n.push(t.getEdgeAt(e));for(let t=0;t<n.length;t+=1){const i=n[t];e.isAncestor(i)&&this.updateEdgeParent(i,e)}}updateEdgeParent(t,e){let i=t.getTerminal(!0),s=t.getTerminal(!1),n=null;for(;null!=i&&!i.isEdge()&&null!=i.geometry&&i.geometry.relative;)i=i.getParent();for(;null!=s&&this.ignoreRelativeEdgeParent&&!s.isEdge()&&null!=s.geometry&&s.geometry.relative;)s=s.getParent();if(e.isAncestor(i)&&e.isAncestor(s)&&(i===s?n=i?i.getParent():null:i&&(n=i.getNearestCommonAncestor(s)),null!=n&&(n.getParent()!==this.root||n.isAncestor(t))&&t&&t.getParent()!==n)){let e=t.getGeometry();if(null!=e){const i=t.getParent().getOrigin(),s=n.getOrigin(),l=s.x-i.x,r=s.y-i.y;e=e.clone(),e.translate(-l,-r),this.setGeometry(t,e)}this.add(n,t,n.getChildCount())}}remove(t){return t===this.root?this.setRoot(null):null!=t.getParent()&&this.execute(new undoable_changes_ChildChange(this,null,t)),t}cellRemoved(t){if(null!=t&&null!=this.cells){for(let e=t.getChildCount()-1;e>=0;e--)this.cellRemoved(t.getChildAt(e));null!=this.cells&&null!=t.getId()&&delete this.cells[t.getId()]}}parentForCellChanged(t,e,i){const s=t.getParent();if(null!=e)e===s&&s.getIndex(t)===i||e.insert(t,i);else if(null!=s){const e=s.getIndex(t);s.remove(e)}const n=e?this.contains(e):null,l=this.contains(s);return n&&!l?this.cellAdded(t):l&&!n&&this.cellRemoved(t),s}setTerminal(t,e,i){const s=e!==t.getTerminal(i);return this.execute(new undoable_changes_TerminalChange(this,t,e,i)),this.maintainEdgeParent&&s&&this.updateEdgeParent(t,this.getRoot()),e}setTerminals(t,e,i){this.beginUpdate();try{this.setTerminal(t,e,!0),this.setTerminal(t,i,!1)}finally{this.endUpdate()}}terminalForCellChanged(t,e,i=!1){const s=t.getTerminal(i);return null!=e?e.insertEdge(t,i):null!=s&&s.removeEdge(t,i),s}getEdgesBetween(t,e,i=!1){const s=t.getEdgeCount(),n=e.getEdgeCount();let l=t,r=s;n<s&&(r=n,l=e);const a=[];for(let s=0;s<r;s+=1){const n=l.getEdgeAt(s),r=n.getTerminal(!0),o=n.getTerminal(!1);(r===t&&o===e||!i&&o===t&&r===e)&&a.push(n)}return a}setValue(t,e){return this.execute(new undoable_changes_ValueChange(this,t,e)),e}valueForCellChanged(t,e){return t.valueChanged(e)}setGeometry(t,e){return e!==t.getGeometry()&&this.execute(new undoable_changes_GeometryChange(this,t,e)),e}geometryForCellChanged(t,e){const i=t.getGeometry();return t.setGeometry(e),i}setStyle(t,e){e!==t.getStyle()&&this.execute(new undoable_changes_StyleChange(this,t,e))}styleForCellChanged(t,e){const i=t.getStyle();return t.setStyle(e),i}setCollapsed(t,e){return e!==t.isCollapsed()&&this.execute(new undoable_changes_CollapseChange(this,t,e)),e}collapsedStateForCellChanged(t,e){const i=t.isCollapsed();return t.setCollapsed(e),i}setVisible(t,e){return e!==t.isVisible()&&this.execute(new undoable_changes_VisibleChange(this,t,e)),e}visibleStateForCellChanged(t,e){const i=t.isVisible();return t.setVisible(e),i}execute(t){t.execute(),this.beginUpdate(),this.currentEdit.add(t),this.fireEvent(new EventObject.A(InternalEvent.A.EXECUTE,{change:t})),this.fireEvent(new EventObject.A(InternalEvent.A.EXECUTED,{change:t})),this.endUpdate()}batchUpdate(t){this.beginUpdate();try{t()}finally{this.endUpdate()}}beginUpdate(){this.updateLevel+=1,this.fireEvent(new EventObject.A(InternalEvent.A.BEGIN_UPDATE)),1===this.updateLevel&&this.fireEvent(new EventObject.A(InternalEvent.A.START_EDIT))}endUpdate(){if(this.updateLevel-=1,0===this.updateLevel&&this.fireEvent(new EventObject.A(InternalEvent.A.END_EDIT)),!this.endingUpdate){this.endingUpdate=0===this.updateLevel,this.fireEvent(new EventObject.A(InternalEvent.A.END_UPDATE,{edit:this.currentEdit}));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new EventObject.A(InternalEvent.A.BEFORE_UNDO,{edit:this.currentEdit}));const t=this.currentEdit;this.currentEdit=this.createUndoableEdit(),t.notify(),this.fireEvent(new EventObject.A(InternalEvent.A.UNDO,{edit:t}))}}finally{this.endingUpdate=!1}}}createUndoableEdit(t=!0){const e=new UndoableEdit.A(this,t);return e.notify=()=>{e.source.fireEvent(new EventObject.A(InternalEvent.A.CHANGE,{edit:e,changes:e.changes})),e.source.fireEvent(new EventObject.A(InternalEvent.A.NOTIFY,{edit:e,changes:e.changes}))},e}mergeChildren(t,e,i=!0){this.beginUpdate();try{const s={};this.mergeChildrenImpl(t,e,i,s);for(const t in s){const e=s[t];let i=e.getTerminal(!0);null!=i&&(i=s[CellPath.A.create(i)],this.setTerminal(e,i,!0)),i=e.getTerminal(!1),null!=i&&(i=s[CellPath.A.create(i)],this.setTerminal(e,i,!1))}}finally{this.endUpdate()}}mergeChildrenImpl(t,e,i,s={}){this.beginUpdate();try{const n=t.getChildCount();for(let l=0;l<n;l+=1){const n=t.getChildAt(l);if("function"==typeof n.getId){const t=n.getId();let l=null==t||n.isEdge()&&i?null:this.getCell(t);if(null==l){const i=n.clone();i.setId(t),i.setTerminal(n.getTerminal(!0),!0),i.setTerminal(n.getTerminal(!1),!1),l=e.insert(i),this.cellAdded(l)}s[CellPath.A.create(n)]=l,this.mergeChildrenImpl(n,l,i,s)}}}finally{this.endUpdate()}}}const view_GraphDataModel=GraphDataModel;var Stylesheet=__webpack_require__(7648),Utils=__webpack_require__(6960),Geometry=__webpack_require__(6381);function scalePointArray(t,e){let i=[];if(null!=t)for(let s=0;s<t.length;s+=1)null!=t[s]?i[s]=new Point.A(Math.round(t[s].x/e*10)/10,Math.round(t[s].y/e*10)/10):i[s]=null;else i=null;return i}function scaleCellState(t,e){let i=null;return null!=t&&(i=t.clone(),i.setRect(Math.round(t.x/e*10)/10,Math.round(t.y/e*10)/10,Math.round(t.width/e*10)/10,Math.round(t.height/e*10)/10)),i}var CellState=__webpack_require__(5364);const SideToSide=(t,e,i,s,n)=>{const{view:l}=t;let r=null!=s&&s.length>0?s[0]:null;const a=t.absolutePoints,o=a[0],h=a[a.length-1];if(null!=r&&(r=l.transformControlPoint(t,r)),null!=o&&((e=new CellState.A).x=o.x,e.y=o.y),null!=h&&((i=new CellState.A).x=h.x,i.y=h.y),null!=e&&null!=i){const t=Math.max(e.x,i.x),s=Math.min(e.x+e.width,i.x+i.width),a=null!=r?r.x:Math.round(s+(t-s)/2);let o=l.getRoutingCenterY(e),h=l.getRoutingCenterY(i);if(null!=r&&(r.y>=e.y&&r.y<=e.y+e.height&&(o=r.y),r.y>=i.y&&r.y<=i.y+i.height&&(h=r.y)),(0,mathUtils.contains)(i,a,o)||(0,mathUtils.contains)(e,a,o)||n.push(new Point.A(a,o)),(0,mathUtils.contains)(i,a,h)||(0,mathUtils.contains)(e,a,h)||n.push(new Point.A(a,h)),1===n.length)if(null!=r)(0,mathUtils.contains)(i,a,r.y)||(0,mathUtils.contains)(e,a,r.y)||n.push(new Point.A(a,r.y));else{const t=Math.max(e.y,i.y),s=Math.min(e.y+e.height,i.y+i.height);n.push(new Point.A(a,t+(s-t)/2))}}},TopToBottom=(t,e,i,s,n)=>{const{view:l}=t;let r=null!=s&&s.length>0?s[0]:null;const a=t.absolutePoints,o=a[0],h=a[a.length-1];if(null!=r&&(r=l.transformControlPoint(t,r)),null!=o&&((e=new CellState.A).x=o.x,e.y=o.y),null!=h&&((i=new CellState.A).x=h.x,i.y=h.y),null!=e&&null!=i){const t=Math.max(e.y,i.y),s=Math.min(e.y+e.height,i.y+i.height);let a=l.getRoutingCenterX(e);null!=r&&r.x>=e.x&&r.x<=e.x+e.width&&(a=r.x);const o=null!=r?r.y:Math.round(s+(t-s)/2);if((0,mathUtils.contains)(i,a,o)||(0,mathUtils.contains)(e,a,o)||n.push(new Point.A(a,o)),a=null!=r&&r.x>=i.x&&r.x<=i.x+i.width?r.x:l.getRoutingCenterX(i),(0,mathUtils.contains)(i,a,o)||(0,mathUtils.contains)(e,a,o)||n.push(new Point.A(a,o)),1===n.length)if(null!=r&&1===n.length)(0,mathUtils.contains)(i,r.x,o)||(0,mathUtils.contains)(e,r.x,o)||n.push(new Point.A(r.x,o));else{const t=Math.max(e.x,i.x),s=Math.min(e.x+e.width,i.x+i.width);n.push(new Point.A(t+(s-t)/2,o))}}},ElbowConnector=(t,e,i,s,n)=>{let l=null!=s&&s.length>0?s[0]:null,r=!1,a=!1;if(null!=e&&null!=i)if(null!=l){const s=Math.min(e.x,i.x),n=Math.max(e.x+e.width,i.x+i.width),o=Math.min(e.y,i.y),h=Math.max(e.y+e.height,i.y+i.height);l=t.view.transformControlPoint(t,l),r=l.y<o||l.y>h,a=l.x<s||l.x>n}else r=Math.max(e.x,i.x)===Math.min(e.x+e.width,i.x+i.width),r||(a=Math.max(e.y,i.y)===Math.min(e.y+e.height,i.y+i.height));a||!r&&t.style.elbow!==Constants.ELBOW.VERTICAL?SideToSide(t,e,i,s,n):TopToBottom(t,e,i,s,n)},EntityRelation=(t,e,i,s,n)=>{const{view:l}=t,r=(0,Utils.getValue)(t.style,"segment",Constants.ENTITY_SEGMENT)*l.scale,a=t.absolutePoints,o=a[0],h=a[a.length-1];let d=!1;if(null!=e){const t=e.cell.getGeometry();t.relative?d=t.x<=.5:null!=i&&(d=(null!=h?h.x:i.x+i.width)<(null!=o?o.x:e.x))}if(null!=o)(e=new CellState.A).x=o.x,e.y=o.y;else{if(null==e)return;{const i=(0,mathUtils.getPortConstraints)(e,t,!0,Constants.DIRECTION_MASK.NONE);i!==Constants.DIRECTION_MASK.NONE&&i!==Constants.DIRECTION_MASK.WEST+Constants.DIRECTION_MASK.EAST&&(d=i===Constants.DIRECTION_MASK.WEST)}}let c=!0;if(null!=i){const t=i.cell.getGeometry();t.relative?c=t.x<=.5:null!=e&&(c=(null!=o?o.x:e.x+e.width)<(null!=h?h.x:i.x))}if(null!=h)(i=new CellState.A).x=h.x,i.y=h.y;else if(null!=i){const e=(0,mathUtils.getPortConstraints)(i,t,!1,Constants.DIRECTION_MASK.NONE);e!==Constants.DIRECTION_MASK.NONE&&e!=Constants.DIRECTION_MASK.WEST+Constants.DIRECTION_MASK.EAST&&(c=e===Constants.DIRECTION_MASK.WEST)}if(null!=e&&null!=i){const t=d?e.x:e.x+e.width,s=l.getRoutingCenterY(e),a=c?i.x:i.x+i.width,o=l.getRoutingCenterY(i),h=r;let u=d?-h:h;const g=new Point.A(t+u,s);u=c?-h:h;const p=new Point.A(a+u,o);if(d===c){const e=d?Math.min(t,a)-r:Math.max(t,a)+r;n.push(new Point.A(e,s)),n.push(new Point.A(e,o))}else if(g.x<p.x===d){const t=s+(o-s)/2;n.push(g),n.push(new Point.A(g.x,t)),n.push(new Point.A(p.x,t)),n.push(p)}else n.push(g),n.push(p)}},Loop=(t,e,i,s,n)=>{const l=t.absolutePoints,r=l[0],a=l[l.length-1];if(null==r||null==a){if(null!=e){const{view:i}=t,{graph:l}=i;let r=null!=s&&s.length>0?s[0]:null;null!=r&&(r=i.transformControlPoint(t,r),(0,mathUtils.contains)(e,r.x,r.y)&&(r=null));let a=0,o=0,h=0,d=0;const c=(0,Utils.getValue)(t.style,"segment",l.gridSize)*i.scale,u=(0,Utils.getValue)(t.style,"direction",Constants.DIRECTION.WEST);u===Constants.DIRECTION.NORTH||u===Constants.DIRECTION.SOUTH?(a=i.getRoutingCenterX(e),o=c):(h=i.getRoutingCenterY(e),d=c),null==r||r.x<e.x||r.x>e.x+e.width?null!=r?(a=r.x,d=Math.max(Math.abs(h-r.y),d)):u===Constants.DIRECTION.NORTH?h=e.y-2*o:u===Constants.DIRECTION.SOUTH?h=e.y+e.height+2*o:a=u===Constants.DIRECTION.EAST?e.x-2*d:e.x+e.width+2*d:null!==r&&(a=i.getRoutingCenterX(e),o=Math.max(Math.abs(a-r.x),d),h=r.y,d=0),n.push(new Point.A(a-o,h-d)),n.push(new Point.A(a+o,h+d))}}else if(null!=s&&s.length>0)for(let e=0;e<s.length;e+=1){let i=s[e];i=t.view.transformControlPoint(t,i),n.push(new Point.A(i.x,i.y))}},SegmentConnector=(t,e,i,s,n)=>{const l=scalePointArray(t.absolutePoints,t.view.scale),r=scaleCellState(e,t.view.scale),a=scaleCellState(i,t.view.scale);let o=n.length>0?n[0]:null,h=!0,d=null;function c(e){return e.x=Math.round(e.x*t.view.scale*10)/10,e.y=Math.round(e.y*t.view.scale*10)/10,(null==o||Math.abs(o.x-e.x)>=1||Math.abs(o.y-e.y)>=Math.max(1,t.view.scale))&&(n.push(e),o=e),o}let u=l[0];null==u&&null!=r?u=new Point.A(t.view.getRoutingCenterX(r),t.view.getRoutingCenterY(r)):null!=u&&(u=u.clone());const g=l.length-1;let p=null;if(null!=s&&s.length>0){let e=[];for(let i=0;i<s.length;i+=1){const n=t.view.transformControlPoint(t,s[i],!0);null!=n&&e.push(n)}if(0===e.length)return;null!=u&&null!=e[0]&&(Math.abs(e[0].x-u.x)<1&&(e[0].x=u.x),Math.abs(e[0].y-u.y)<1&&(e[0].y=u.y)),p=l[g],null!=p&&null!=e[e.length-1]&&(Math.abs(e[e.length-1].x-p.x)<1&&(e[e.length-1].x=p.x),Math.abs(e[e.length-1].y-p.y)<1&&(e[e.length-1].y=p.y)),d=e[0];let i=r,n=l[0],o=!1,E=!1,C=d;null!=n&&(i=null);for(let t=0;t<2;t+=1){const s=null!=n&&n.x===C.x,r=null!=n&&n.y===C.y,d=null!=i&&C.y>=i.y&&C.y<=i.y+i.height,c=null!=i&&C.x>=i.x&&C.x<=i.x+i.width;if(o=r||null==n&&d,E=s||null==n&&c,0!=t||!(o&&E||s&&r)){if(null!=n&&!r&&!s&&(d||c)){h=!d;break}if(E||o){h=o,1===t&&(h=e.length%2==0?o:E);break}}i=a,n=l[g],null!=n&&(i=null),C=e[e.length-1],s&&r&&(e=e.slice(1))}h&&(null!=l[0]&&l[0].y!==d.y||null==l[0]&&null!=r&&(d.y<r.y||d.y>r.y+r.height))?c(new Point.A(u.x,d.y)):!h&&(null!=l[0]&&l[0].x!==d.x||null==l[0]&&null!=r&&(d.x<r.x||d.x>r.x+r.width))&&c(new Point.A(d.x,u.y)),h?u.y=d.y:u.x=d.x;for(let t=0;t<e.length;t+=1)h=!h,d=e[t],h?u.y=d.y:u.x=d.x,c(u.clone())}else d=u,h=!0;if(u=l[g],null==u&&null!=a&&(u=new Point.A(t.view.getRoutingCenterX(a),t.view.getRoutingCenterY(a))),null!=u&&null!=d&&(h&&(null!=l[g]&&l[g].y!==d.y||null==l[g]&&null!=a&&(d.y<a.y||d.y>a.y+a.height))?c(new Point.A(u.x,d.y)):!h&&(null!=l[g]&&l[g].x!==d.x||null==l[g]&&null!=a&&(d.x<a.x||d.x>a.x+a.width))&&c(new Point.A(d.x,u.y))),null==l[0]&&null!=r)for(;n.length>1&&null!=n[1]&&(0,mathUtils.contains)(r,n[1].x,n[1].y);)n.splice(1,1);if(null==l[g]&&null!=a)for(;n.length>1&&null!=n[n.length-1]&&(0,mathUtils.contains)(a,n[n.length-1].x,n[n.length-1].y);)n.splice(n.length-1,1);null!=p&&null!=n[n.length-1]&&Math.abs(p.x-n[n.length-1].x)<=1&&Math.abs(p.y-n[n.length-1].y)<=1&&(n.splice(n.length-1,1),null!=n[n.length-1]&&(Math.abs(n[n.length-1].x-p.x)<1&&(n[n.length-1].x=p.x),Math.abs(n[n.length-1].y-p.y)<1&&(n[n.length-1].y=p.y)))};var _a;class EdgeStyle{static getJettySize(t,e){let i=(0,Utils.getValue)(t.style,e?"sourceJettySize":"targetJettySize",(0,Utils.getValue)(t.style,"jettySize",_a.orthBuffer));if("auto"===i)if((0,Utils.getValue)(t.style,e?"startArrow":"endArrow",Constants.NONE)!==Constants.NONE){const s=(0,StringUtils.getNumber)(t.style,e?"startSize":"endSize",Constants.DEFAULT_MARKERSIZE);i=Math.max(2,Math.ceil((s+_a.orthBuffer)/_a.orthBuffer))*_a.orthBuffer}else i=2*_a.orthBuffer;return i}static getRoutePattern(t,e,i,s){let n=t[0]===Constants.DIRECTION_MASK.EAST?3:t[0],l=t[1]===Constants.DIRECTION_MASK.EAST?3:t[1];n-=e,l-=e,n<1&&(n+=4),l<1&&(l+=4);let r=_a.routePatterns[n-1][l-1];return 0!==i&&0!==s||null!=_a.inlineRoutePatterns[n-1][l-1]&&(r=_a.inlineRoutePatterns[n-1][l-1]),r}}_a=EdgeStyle,EdgeStyle.EntityRelation=EntityRelation,EdgeStyle.Loop=Loop,EdgeStyle.ElbowConnector=ElbowConnector,EdgeStyle.SideToSide=SideToSide,EdgeStyle.TopToBottom=TopToBottom,EdgeStyle.SegmentConnector=SegmentConnector,EdgeStyle.orthBuffer=10,EdgeStyle.orthPointsFallback=!0,EdgeStyle.dirVectors=[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],EdgeStyle.wayPoints1=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],EdgeStyle.routePatterns=[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],EdgeStyle.inlineRoutePatterns=[[null,[2114,2568],null,null],[null,[514,2081,2114,2568],null,null],[null,[2114,2561],null,null],[[2081,2562],[1057,2114,2568],[2184,2562],null]],EdgeStyle.vertexSeperations=[],EdgeStyle.limits=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],EdgeStyle.LEFT_MASK=32,EdgeStyle.TOP_MASK=64,EdgeStyle.RIGHT_MASK=128,EdgeStyle.BOTTOM_MASK=256,EdgeStyle.LEFT=1,EdgeStyle.TOP=2,EdgeStyle.RIGHT=4,EdgeStyle.BOTTOM=8,EdgeStyle.SIDE_MASK=480,EdgeStyle.CENTER_MASK=512,EdgeStyle.SOURCE_MASK=1024,EdgeStyle.TARGET_MASK=2048,EdgeStyle.VERTEX_MASK=3072,EdgeStyle.OrthConnector=(t,e,i,s,n)=>{const l=scalePointArray(t.absolutePoints,t.view.scale),r=scaleCellState(e,t.view.scale),a=scaleCellState(i,t.view.scale),o=null!=r&&r.cell.isEdge(),h=null!=a&&a.cell.isEdge(),d=l[0],c=l[l.length-1];let u=null!=r?r.x:d.x,g=null!=r?r.y:d.y,p=null!=r?r.width:0,E=null!=r?r.height:0,C=null!=a?a.x:c.x,m=null!=a?a.y:c.y,f=null!=a?a.width:0,y=null!=a?a.height:0,v=_a.getJettySize(t,!0),A=_a.getJettySize(t,!1);null!=r&&a===r&&(A=Math.max(v,A),v=A);const _=A+v;let b=!1;if(null!=d&&null!=c){const t=c.x-d.x,e=c.y-d.y;b=t*t+e*e<_*_}if(b||_a.orthPointsFallback&&null!=s&&s.length>0||o||h)return void _a.SegmentConnector(t,e,i,s,n);const S=[Constants.DIRECTION_MASK.ALL,Constants.DIRECTION_MASK.ALL];let w=0;if(null!=r&&(S[0]=(0,mathUtils.getPortConstraints)(r,t,!0,Constants.DIRECTION_MASK.ALL),w=r.style.rotation??0,0!==w)){const t=(0,mathUtils.getBoundingBox)(new Rectangle.A(u,g,p,E),w);u=t.x,g=t.y,p=t.width,E=t.height}if(null!=a&&(S[1]=(0,mathUtils.getPortConstraints)(a,t,!1,Constants.DIRECTION_MASK.ALL),w=a.style.rotation??0,0!==w)){const t=(0,mathUtils.getBoundingBox)(new Rectangle.A(C,m,f,y),w);C=t.x,m=t.y,f=t.width,y=t.height}const x=[0,0],T=[[u,g,p,E],[C,m,f,y]],M=[v,A];for(let t=0;t<2;t+=1)_a.limits[t][1]=T[t][0]-M[t],_a.limits[t][2]=T[t][1]-M[t],_a.limits[t][4]=T[t][0]+T[t][2]+M[t],_a.limits[t][8]=T[t][1]+T[t][3]+M[t];const P=T[0][0]+T[0][2]/2,I=T[0][1]+T[0][3]/2,O=P-(T[1][0]+T[1][2]/2),L=I-(T[1][1]+T[1][3]/2);let R=0;O<0?R=L<0?2:1:L<=0&&(R=3,0===O&&(R=2));let D=null;null!=r&&(D=d);const N=[[.5,.5],[.5,.5]];for(let t=0;t<2;t+=1)null!=D&&(N[t][0]=(D.x-T[t][0])/T[t][2],Math.abs(D.x-T[t][0])<=1?x[t]=Constants.DIRECTION_MASK.WEST:Math.abs(D.x-T[t][0]-T[t][2])<=1&&(x[t]=Constants.DIRECTION_MASK.EAST),N[t][1]=(D.y-T[t][1])/T[t][3],Math.abs(D.y-T[t][1])<=1?x[t]=Constants.DIRECTION_MASK.NORTH:Math.abs(D.y-T[t][1]-T[t][3])<=1&&(x[t]=Constants.DIRECTION_MASK.SOUTH)),D=null,null!=a&&(D=c);const H=T[0][1]-(T[1][1]+T[1][3]),k=T[0][0]-(T[1][0]+T[1][2]),U=T[1][1]-(T[0][1]+T[0][3]),V=T[1][0]-(T[0][0]+T[0][2]);_a.vertexSeperations[1]=Math.max(k-_,0),_a.vertexSeperations[2]=Math.max(H-_,0),_a.vertexSeperations[4]=Math.max(U-_,0),_a.vertexSeperations[3]=Math.max(V-_,0);const B=[],G=[],F=[];G[0]=k>=V?Constants.DIRECTION_MASK.WEST:Constants.DIRECTION_MASK.EAST,F[0]=H>=U?Constants.DIRECTION_MASK.NORTH:Constants.DIRECTION_MASK.SOUTH,G[1]=(0,mathUtils.reversePortConstraints)(G[0]),F[1]=(0,mathUtils.reversePortConstraints)(F[0]);const z=k>=V?k:V,W=H>=U?H:U,X=[[0,0],[0,0]];let Y=!1;for(let t=0;t<2;t+=1)0===x[t]&&(G[t]&S[t]||(G[t]=(0,mathUtils.reversePortConstraints)(G[t])),F[t]&S[t]||(F[t]=(0,mathUtils.reversePortConstraints)(F[t])),X[t][0]=F[t],X[t][1]=G[t]);W>0&&z>0&&((G[0]&S[0])>0&&(F[1]&S[1])>0?(X[0][0]=G[0],X[0][1]=F[0],X[1][0]=F[1],X[1][1]=G[1],Y=!0):(F[0]&S[0])>0&&(G[1]&S[1])>0&&(X[0][0]=F[0],X[0][1]=G[0],X[1][0]=G[1],X[1][1]=F[1],Y=!0)),W>0&&!Y&&(X[0][0]=F[0],X[0][1]=G[0],X[1][0]=F[1],X[1][1]=G[1],Y=!0),z>0&&!Y&&(X[0][0]=G[0],X[0][1]=F[0],X[1][0]=G[1],X[1][1]=F[1],Y=!0);for(let t=0;t<2;t+=1)0===x[t]&&(X[t][0]&S[t]||(X[t][0]=X[t][1]),B[t]=X[t][0]&S[t],B[t]|=(X[t][1]&S[t])<<8,B[t]|=(X[1-t][t]&S[t])<<16,B[t]|=(X[1-t][1-t]&S[t])<<24,15&B[t]||(B[t]=B[t]<<8),3840&B[t]||(B[t]=15&B[t]|B[t]>>8),983040&B[t]||(B[t]=65535&B[t]|(251658240&B[t])>>8),x[t]=15&B[t],S[t]!==Constants.DIRECTION_MASK.WEST&&S[t]!==Constants.DIRECTION_MASK.NORTH&&S[t]!==Constants.DIRECTION_MASK.EAST&&S[t]!==Constants.DIRECTION_MASK.SOUTH||(x[t]=S[t]));let K=x[0]===Constants.DIRECTION_MASK.EAST?3:x[0],$=x[1]===Constants.DIRECTION_MASK.EAST?3:x[1];K-=R,$-=R,K<1&&(K+=4),$<1&&($+=4);const q=_a.routePatterns[K-1][$-1];switch(_a.wayPoints1[0][0]=T[0][0],_a.wayPoints1[0][1]=T[0][1],x[0]){case Constants.DIRECTION_MASK.WEST:_a.wayPoints1[0][0]-=v,_a.wayPoints1[0][1]+=N[0][1]*T[0][3];break;case Constants.DIRECTION_MASK.SOUTH:_a.wayPoints1[0][0]+=N[0][0]*T[0][2],_a.wayPoints1[0][1]+=T[0][3]+v;break;case Constants.DIRECTION_MASK.EAST:_a.wayPoints1[0][0]+=T[0][2]+v,_a.wayPoints1[0][1]+=N[0][1]*T[0][3];break;case Constants.DIRECTION_MASK.NORTH:_a.wayPoints1[0][0]+=N[0][0]*T[0][2],_a.wayPoints1[0][1]-=v}let j=0,Z=(x[0]&(Constants.DIRECTION_MASK.EAST|Constants.DIRECTION_MASK.WEST))>0?0:1;const J=Z;let Q=0;for(let t=0;t<q.length;t+=1){const e=15&q[t];let i=e===Constants.DIRECTION_MASK.EAST?3:e;i+=R,i>4&&(i-=4);const s=_a.dirVectors[i-1];Q=i%2>0?0:1,Q!==Z&&(j++,_a.wayPoints1[j][0]=_a.wayPoints1[j-1][0],_a.wayPoints1[j][1]=_a.wayPoints1[j-1][1]);const n=(q[t]&_a.TARGET_MASK)>0,l=(q[t]&_a.SOURCE_MASK)>0;let r=(q[t]&_a.SIDE_MASK)>>5;r<<=R,r>15&&(r>>=4);const a=(q[t]&_a.CENTER_MASK)>0;if((l||n)&&r<9){let t=0;const e=l?0:1;if(t=a&&0===Q?T[e][0]+N[e][0]*T[e][2]:a?T[e][1]+N[e][1]*T[e][3]:_a.limits[e][r],0===Q){const e=(t-_a.wayPoints1[j][0])*s[0];e>0&&(_a.wayPoints1[j][0]+=s[0]*e)}else{const e=(t-_a.wayPoints1[j][1])*s[1];e>0&&(_a.wayPoints1[j][1]+=s[1]*e)}}else a&&(_a.wayPoints1[j][0]+=s[0]*Math.abs(_a.vertexSeperations[i]/2),_a.wayPoints1[j][1]+=s[1]*Math.abs(_a.vertexSeperations[i]/2));j>0&&_a.wayPoints1[j][Q]===_a.wayPoints1[j-1][Q]?j--:Z=Q}for(let e=0;e<=j&&(e!==j||(((x[1]&(Constants.DIRECTION_MASK.EAST|Constants.DIRECTION_MASK.WEST))>0?0:1)===J?0:1)==(j+1)%2);e+=1)n.push(new Point.A(Math.round(_a.wayPoints1[e][0]*t.view.scale*10)/10,Math.round(_a.wayPoints1[e][1]*t.view.scale*10)/10));let tt=1;for(;tt<n.length;)null==n[tt-1]||null==n[tt]||n[tt-1].x!==n[tt].x||n[tt-1].y!==n[tt].y?tt++:n.splice(tt,1)},EdgeStyle.MANHATTAN_STEP=12,EdgeStyle.MANHATTAN_MAXIMUM_LOOPS=2e3,EdgeStyle.MANHATTAN_START_DIRECTIONS=[Constants.DIRECTION.NORTH,Constants.DIRECTION.EAST,Constants.DIRECTION.SOUTH,Constants.DIRECTION.WEST],EdgeStyle.MANHATTAN_END_DIRECTIONS=[Constants.DIRECTION.NORTH,Constants.DIRECTION.EAST,Constants.DIRECTION.SOUTH,Constants.DIRECTION.WEST],EdgeStyle.MANHATTAN_MAX_ALLOWED_DIRECTION_CHANGE=90,EdgeStyle.MANHATTAN_PADDING_BOX=new Geometry.A(-_a.MANHATTAN_STEP,-_a.MANHATTAN_STEP,2*_a.MANHATTAN_STEP,2*_a.MANHATTAN_STEP),EdgeStyle.ManhattanConnector=(t,e,i,s,n)=>{function l(t,e){return t.x+=e.x||0,t.y+=e.y||0,t.width+=e.width||0,t.height+=e.height||0,t}function r(t,e){return e*Math.round(t/e)}function a(t,e,i){return t.x=r(t.x,e),t.y=r(t.y,i||e),t}function o(t,e){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}function h(t){return new Point.A(t.x+t.width/2,t.y+t.height/2)}function d(t,e){return new Point.A(t.x-e.x,t.y-e.y)}function c(t,e,i){return t.x+=e||0,t.y+=i||0,t}function u(t,e){const i=e.clone(),s=-(i.y-t.y),n=i.x-t.x;return 180*("0"==s.toFixed(10)&&"0"==n.toFixed(10)?0:Math.atan2(s,n))/Math.PI}function g(t){return new Point.A(0===t.x?0:Math.abs(t.x)/t.x,0===t.y?0:Math.abs(t.y)/t.y)}function p(t){const e=t.split(-1===t.indexOf("@")?" ":"@");return new Point.A(parseInt(e[0],10),parseInt(e[1],10))}function E(t){return`${t.x}@${t.y}`}function C(t){const e=t.view.graph,i=e.getCellBounds(t.cell,!1,!1)?.clone();if(!i)return;const s=e.view,{scale:n,translate:l}=s,{x:r,y:a}=l,o=t=>Math.round(10*t)/10;return new Rectangle.A(o(i.x/n-r),o(i.y/n-a),o(i.width/n),o(i.height/n))}const m=_a.MANHATTAN_STEP,f={paddingBox:_a.MANHATTAN_PADDING_BOX,directions:[{offsetX:m,offsetY:0,cost:m,angle:b(u(new Point.A(0,0),new Point.A(m,0)))},{offsetX:0,offsetY:m,cost:m,angle:b(u(new Point.A(0,0),new Point.A(0,m)))},{offsetX:-m,offsetY:0,cost:m,angle:b(u(new Point.A(0,0),new Point.A(-m,0)))},{offsetX:0,offsetY:-m,cost:m,angle:b(u(new Point.A(0,0),new Point.A(0,-m)))}],directionMap:{east:{x:1,y:0},south:{x:0,y:1},west:{x:-1,y:0},north:{x:0,y:-1}},penaltiesGenerator:t=>45==t||90==t||180==t?_a.MANHATTAN_STEP/2:0,draggingRoute:null,previousDirAngle:0};class y{constructor(t){this.options=t,this.mapGridSize=100,this.map=new Map}build(t,e){const i=t?.view.graph||e?.view.graph;if(i)return Array.from(i.getView().getCellStates()).filter((t=>t.cell&&t.cell.isVertex()&&!t.cell.isEdge())).map((t=>C(t))).map((t=>t?l(t,this.options.paddingBox):null)).forEach((t=>{if(!t)return;const e=a(new Point.A(t.x,t.y),this.mapGridSize),i=a(new Point.A(t.x+t.width,t.y+t.height),this.mapGridSize);for(let s=e.x;s<=i.x;s+=this.mapGridSize)for(let n=e.y;n<=i.y;n+=this.mapGridSize){const e=s+"@"+n,i=this.map.get(e)||[];this.map.has(e)||this.map.set(e,i),i.push(t)}}))}isPointAccessible(t){const e=E(a(t.clone(),this.mapGridSize)),i=this.map.get(e);return!i||i.every((e=>!o(e,t)))}}class v{constructor(){this.items=[],this.hash=new Map}add(t,e){const i=this.hash.get(t);i?(i.value=e,this.items.splice(this.items.indexOf(t),1)):this.hash.set(t,{value:e,open:!0}),this.items.push(t),this.items.sort(((t,e)=>{const i=this.hash.get(t),s=this.hash.get(e);return i&&s?i.value-s.value:0}))}remove(t){const e=this.hash.get(t);e&&(e.open=!1)}isOpen(t){const e=this.hash.get(t);return e&&1==e.open}isClose(t){const e=this.hash.get(t);return e&&0==e.open}isEmpty(){return 0==this.items.length}pop(){const t=this.items.shift();return t&&this.remove(t),t}}function A(t,e,i,s){const n=[];let l,r=g(d(s,e)),a=e;for(;t[E(a)];){if(l=t[E(a)],!l)continue;const e=g(d(a,l));e.equals(r)||(n.unshift(a),r=e),a=l}return g(d(a,i)).equals(r)||n.unshift(a),n}function _(t,e,i){const s=_a.MANHATTAN_STEP,n=h(t),l=[];for(const r of e){const e=i.directionMap[r],h=e.x*t.width/2,d=e.y*t.height/2,u=c(n.clone(),h,d);o(t,u)&&c(u,e.x*s,e.y*s),l.push(a(u,s))}return l}function b(t){return t%360+(t<0?360:0)}function S(t,e,i){const s=360/i;return Math.floor(b(u(t,e)+s/2)/s)*s}function w(t,e){const i=Math.abs(t-e);return i>180?360-i:i}function x(t,e){let i=1/0;for(let l=0,r=e.length;l<r;l++){const r=(s=t,n=e[l],Math.abs(n.x-s.x)+Math.abs(n.y-s.y));r<i&&(i=r)}var s,n;return i}function T(t,e,i,s){const n=C(i),l=s?e.style.exitY:e.style.entryY,r=s?_a.MANHATTAN_START_DIRECTIONS.every((t=>t!=Constants.DIRECTION.NORTH&&t!=Constants.DIRECTION.SOUTH)):_a.MANHATTAN_END_DIRECTIONS.every((t=>t!=Constants.DIRECTION.NORTH&&t!=Constants.DIRECTION.SOUTH));if(null!=l&&r){const e=n?.height||0;t.y=null!=n?.y?n?.y+e*l:t.y-e/2+e*l}const a=s?e.style.exitX:e.style.entryX,o=s?_a.MANHATTAN_START_DIRECTIONS.every((t=>t!=Constants.DIRECTION.WEST&&t!=Constants.DIRECTION.EAST)):_a.MANHATTAN_END_DIRECTIONS.every((t=>t!=Constants.DIRECTION.WEST&&t!=Constants.DIRECTION.EAST));if(null!=a&&o){const e=n?.width||0;t.x=null!=n?.x?n?.x+e*a:t.x-e/2+e*(a||0)}}!function(t,e,i,s,n,r){if(null!=s&&s.length>0||null==e||null==i)return void _a.SegmentConnector(t,e,i,s,n);let o=C(e);o=o?l(o,r.paddingBox):void 0;let d=C(i);d=d?l(d,r.paddingBox):void 0;const u=new y(r);if(u.build(e,i),!o||!d)return _a.OrthConnector(t,e,i,s,n);const g=function(t,e,i,s){const n=_a.MANHATTAN_STEP,l=_(t,_a.MANHATTAN_START_DIRECTIONS,s).filter((t=>i.isPointAccessible(t))),r=a(h(t),n),o=_(e,_a.MANHATTAN_END_DIRECTIONS,s).filter((t=>i.isPointAccessible(t))),d=a(h(e),n);if(l.length>0&&o.length>0){const t=new v,e={},n={};l.forEach((e=>{const i=E(e);t.add(i,x(e,o)),n[i]=0}));let a=_a.MANHATTAN_MAXIMUM_LOOPS;const h=o.map((t=>E(t)));let u,g;for(;!t.isEmpty()&&a>0;){const l=t.pop();if(null==l)continue;const C=p(l),m=n[l];if(g=u,u=e[l]?S(e[l],C,s.directions.length):0!=s.previousDirAngle?s.previousDirAngle:S(r,C,s.directions.length),h.indexOf(l)>=0){const t=w(u,S(C,d,s.directions.length));if(C.equals(d)||t<180)return s.previousDirAngle=u,A(e,C,r,d)}for(let l=0;l<s.directions.length;l++){const r=s.directions[l],a=w(u,r.angle);if(g&&a>_a.MANHATTAN_MAX_ALLOWED_DIRECTION_CHANGE)continue;const h=c(C.clone(),r.offsetX,r.offsetY),d=E(h);if(t.isClose(d)||!i.isPointAccessible(h))continue;const p=m+r.cost+s.penaltiesGenerator(a);(!t.isOpen(d)||p<n[d])&&(e[d]=C,n[d]=p,t.add(d,p+x(h,o)))}a--}return null}return null}(o,d,u,r);if(null==g||0==g.length)return _a.OrthConnector(t,e,i,s,n);t.style&&(t.visibleSourceState&&g.length>0&&T(g[0],t,t.visibleSourceState,!0),t.visibleTargetState&&g.length>1&&T(g[g.length-1],t,t.visibleTargetState,!1));const m=t.view.scale;g.forEach((e=>n.push(new Point.A(Math.round((e.x+t.view.translate.x)*m*10)/10,Math.round((e.y+t.view.translate.y)*m*10)/10))))}(t,e,i,s,n,f)};const style_EdgeStyle=EdgeStyle;var CellHighlight=__webpack_require__(4113);class CellMarker extends EventSource.A{constructor(t,e=Constants.DEFAULT_VALID_COLOR,i=Constants.DEFAULT_INVALID_COLOR,s=Constants.DEFAULT_HOTSPOT){super(),this.enabled=!0,this.hotspot=Constants.DEFAULT_HOTSPOT,this.hotspotEnabled=!1,this.currentColor=Constants.NONE,this.validState=null,this.markedState=null,this.graph=t,this.validColor=e,this.invalidColor=i,this.hotspot=s,this.highlight=new CellHighlight.A(t)}setEnabled(t){this.enabled=t}isEnabled(){return this.enabled}setHotspot(t){this.hotspot=t}getHotspot(){return this.hotspot}setHotspotEnabled(t){this.hotspotEnabled=t}isHotspotEnabled(){return this.hotspotEnabled}hasValidState(){return!!this.validState}getValidState(){return this.validState}getMarkedState(){return this.markedState}reset(){this.validState=null,this.markedState&&(this.markedState=null,this.unmark())}process(t){let e=null;return this.isEnabled()&&(e=this.getState(t),this.setCurrentState(e,t)),e}setCurrentState(t,e,i){const s=!!t&&this.isValidState(t);i=i??this.getMarkerColor(e.getEvent(),t,s),this.validState=s?t:null,t===this.markedState&&i===this.currentColor||(this.currentColor=i,t&&this.currentColor!==Constants.NONE?(this.markedState=t,this.mark()):this.markedState&&(this.markedState=null,this.unmark()))}markCell(t,e){const i=this.graph.getView().getState(t);i&&(this.currentColor=e??this.validColor,this.markedState=i,this.mark())}mark(){this.highlight.setHighlightColor(this.currentColor),this.highlight.highlight(this.markedState),this.fireEvent(new EventObject.A(InternalEvent.A.MARK,"state",this.markedState))}unmark(){this.mark()}isValidState(t){return!0}getMarkerColor(t,e,i){return i?this.validColor:this.invalidColor}getState(t){const e=this.graph.getView(),i=this.getCell(t);if(!i)return null;const s=this.getStateToMark(e.getState(i));return s&&this.intersects(s,t)?s:null}getCell(t){return t.getCell()}getStateToMark(t){return t}intersects(t,e){const i=e.getGraphX(),s=e.getGraphY();return!this.hotspotEnabled||(0,mathUtils.intersectsHotspot)(t,i,s,this.hotspot,Constants.MIN_HOTSPOT_SIZE,Constants.MAX_HOTSPOT_SIZE)}destroy(){this.highlight.destroy()}}const cell_CellMarker=CellMarker;class EllipseShape extends Shape.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.ellipse(e,i,s,n),t.fillAndStroke()}}const node_EllipseShape=EllipseShape;var ConnectionConstraint=__webpack_require__(2342);class ConstraintHandler{constructor(t){this.pointImage=new image_ImageBox(`${Client.A.imageBasePath}/point.gif`,5,5),this.currentFocus=null,this.currentFocusArea=null,this.focusIcons=[],this.constraints=null,this.currentConstraint=null,this.focusHighlight=null,this.focusPoints=[],this.currentPoint=null,this.enabled=!0,this.highlightColor=Constants.DEFAULT_VALID_COLOR,this.mouseleaveHandler=null,this.graph=t,this.resetHandler=()=>{this.currentFocus&&!this.graph.view.getState(this.currentFocus.cell)?this.reset():this.redraw()},this.graph.model.addListener(InternalEvent.A.CHANGE,this.resetHandler),this.graph.view.addListener(InternalEvent.A.SCALE_AND_TRANSLATE,this.resetHandler),this.graph.view.addListener(InternalEvent.A.TRANSLATE,this.resetHandler),this.graph.view.addListener(InternalEvent.A.SCALE,this.resetHandler),this.graph.addListener(InternalEvent.A.ROOT,this.resetHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}reset(){for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null),this.currentConstraint=null,this.currentFocusArea=null,this.currentPoint=null,this.currentFocus=null,this.focusPoints=[]}getTolerance(t){return this.graph.getEventTolerance()}getImageForConstraint(t,e,i){return this.pointImage}isEventIgnored(t,e=!1){return!1}isStateIgnored(t,e=!1){return!1}destroyIcons(){for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusPoints=[]}destroyFocusHighlight(){this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)}isKeepFocusEvent(t){return(0,EventUtils.isShiftDown)(t.getEvent())}getCellForEvent(t,e){let i=t.getCell();if(i||!e||t.getGraphX()===e.x&&t.getGraphY()===e.y||(i=this.graph.getCellAt(e.x,e.y)),i&&!i.isConnectable()){const t=i.getParent();t&&t.isVertex()&&t.isConnectable()&&(i=t)}return i?this.graph.isCellLocked(i)?null:i:null}update(t,e,i,s){if(this.isEnabled()&&!this.isEventIgnored(t)){!this.mouseleaveHandler&&this.graph.container&&(this.mouseleaveHandler=()=>{this.reset()},InternalEvent.A.addListener(this.graph.container,"mouseleave",this.resetHandler));const n=this.getTolerance(t),l=s?s.x:t.getGraphX(),r=s?s.y:t.getGraphY(),a=new Rectangle.A(l-n,r-n,2*n,2*n),o=new Rectangle.A(t.getGraphX()-n,t.getGraphY()-n,2*n,2*n),h=this.graph.view.getState(this.getCellForEvent(t,s));this.isKeepFocusEvent(t)||this.currentFocusArea&&this.currentFocus&&!h&&this.currentFocus.cell.isVertex()&&(0,mathUtils.intersects)(this.currentFocusArea,o)||h===this.currentFocus||(this.currentFocusArea=null,this.currentFocus=null,this.setFocus(t,h,e)),this.currentConstraint=null,this.currentPoint=null;let d,c=null;if(this.focusIcons.length>0&&this.constraints&&(!h||this.currentFocus===h)){const t=o.getCenterX(),n=o.getCenterY();for(let l=0;l<this.focusIcons.length;l+=1){const r=t-this.focusIcons[l].bounds.getCenterX(),u=n-this.focusIcons[l].bounds.getCenterY();if(d=r*r+u*u,(this.intersects(this.focusIcons[l],o,e,i)||s&&this.intersects(this.focusIcons[l],a,e,i))&&(null===c||d<c)){if(this.currentConstraint=this.constraints[l],this.currentPoint=this.focusPoints[l],c=d,d=this.focusIcons[l].bounds.clone(),d.grow(Constants.HIGHLIGHT_SIZE+1),d.width-=1,d.height-=1,!this.focusHighlight){const t=this.createHighlightShape();t.dialect=Constants.DIALECT.SVG,t.pointerEvents=!1,t.init(this.graph.getView().getOverlayPane()),this.focusHighlight=t;const e=()=>this.currentFocus?this.currentFocus:h;InternalEvent.A.redirectMouseEvents(t.node,this.graph,e)}this.focusHighlight.bounds=d,this.focusHighlight.redraw()}}}this.currentConstraint||this.destroyFocusHighlight()}else this.currentConstraint=null,this.currentFocus=null,this.currentPoint=null}redraw(){if(this.currentFocus&&this.constraints&&this.focusIcons.length>0){const t=this.graph.view.getState(this.currentFocus.cell);this.currentFocus=t,this.currentFocusArea=new Rectangle.A(t.x,t.y,t.width,t.height);for(let e=0;e<this.constraints.length;e+=1){const i=this.graph.getConnectionPoint(t,this.constraints[e]),s=this.getImageForConstraint(t,this.constraints[e],i),n=new Rectangle.A(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height);this.focusIcons[e].bounds=n,this.focusIcons[e].redraw(),this.currentFocusArea.add(this.focusIcons[e].bounds),this.focusPoints[e]=i}}}setFocus(t,e,i){if(this.constraints=e&&!this.isStateIgnored(e,i)&&e.cell.isConnectable()?this.isEnabled()?this.graph.getAllConnectionConstraints(e,i)??[]:[]:null,this.constraints&&e){this.currentFocus=e,this.currentFocusArea=new Rectangle.A(e.x,e.y,e.width,e.height);for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusPoints=[];for(let t=0;t<this.constraints.length;t+=1){const i=this.graph.getConnectionPoint(e,this.constraints[t]),s=this.getImageForConstraint(e,this.constraints[t],i),{src:n}=s,l=new Rectangle.A(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height),r=new ImageShape.A(l,n);r.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,r.preserveImageAspect=!1,r.init(this.graph.getView().getDecoratorPane()),r.node.previousSibling&&r.node.parentNode?.insertBefore(r.node,r.node.parentNode.firstChild);const a=()=>this.currentFocus?this.currentFocus:e;r.redraw(),InternalEvent.A.redirectMouseEvents(r.node,this.graph,a),this.currentFocusArea.add(r.bounds),this.focusIcons.push(r),this.focusPoints.push(i)}this.currentFocusArea.grow(this.getTolerance(t))}else this.destroyIcons(),this.destroyFocusHighlight()}createHighlightShape(){const t=new RectangleShape.A(new Rectangle.A,this.highlightColor,this.highlightColor,Constants.HIGHLIGHT_STROKEWIDTH);return t.opacity=Constants.HIGHLIGHT_OPACITY,t}intersects(t,e,i,s){return(0,mathUtils.intersects)(t.bounds,e)}onDestroy(){this.reset(),this.graph.model.removeListener(this.resetHandler),this.graph.view.removeListener(this.resetHandler),this.graph.removeListener(this.resetHandler),this.mouseleaveHandler&&this.graph.container&&(InternalEvent.A.removeListener(this.graph.container,"mouseleave",this.mouseleaveHandler),this.mouseleaveHandler=null)}}const handler_ConstraintHandler=ConstraintHandler;var cloneUtils=__webpack_require__(8291);const EdgeHandlerConfig={connectFillColor:Constants.CONNECT_HANDLE_FILLCOLOR,handleShape:"square",selectionColor:Constants.EDGE_SELECTION_COLOR,selectionStrokeWidth:Constants.EDGE_SELECTION_STROKEWIDTH,selectionDashed:Constants.EDGE_SELECTION_DASHED},defaultEdgeHandlerConfig={...EdgeHandlerConfig},resetEdgeHandlerConfig=()=>{(0,cloneUtils.shallowCopy)(defaultEdgeHandlerConfig,EdgeHandlerConfig)},HandleConfig={fillColor:Constants.HANDLE_FILLCOLOR,labelFillColor:Constants.LABEL_HANDLE_FILLCOLOR,labelSize:Constants.LABEL_HANDLE_SIZE,size:Constants.HANDLE_SIZE,strokeColor:Constants.HANDLE_STROKECOLOR},defaultHandleConfig={...HandleConfig},resetHandleConfig=()=>{(0,cloneUtils.shallowCopy)(defaultHandleConfig,HandleConfig)},VertexHandlerConfig={rotationEnabled:!1,selectionColor:Constants.VERTEX_SELECTION_COLOR,selectionStrokeWidth:Constants.VERTEX_SELECTION_STROKEWIDTH,selectionDashed:Constants.VERTEX_SELECTION_DASHED},defaultVertexHandlerConfig={...VertexHandlerConfig},resetVertexHandlerConfig=()=>{(0,cloneUtils.shallowCopy)(defaultVertexHandlerConfig,VertexHandlerConfig)};class EdgeHandler{constructor(t){if(this.error=null,this.bends=[],this.cloneEnabled=!0,this.addEnabled=!1,this.removeEnabled=!1,this.dblClickRemoveEnabled=!1,this.mergeRemoveEnabled=!1,this.straightRemoveEnabled=!1,this.virtualBendsEnabled=!1,this.virtualBendOpacity=20,this.parentHighlightEnabled=!1,this.preferHtml=!1,this.allowHandleBoundsCheck=!0,this.snapToTerminals=!1,this.handleImage=null,this.labelHandleImage=null,this.tolerance=0,this.outlineConnect=!1,this.manageLabelHandle=!1,this.currentPoint=null,this.parentHighlight=null,this.index=null,this.isSource=!1,this.isTarget=!1,this.isLabel=!1,this.points=[],this.snapPoint=null,this.abspoints=[],this.startX=0,this.startY=0,this.outline=!0,this.active=!0,this.state=t,this.graph=this.state.view.graph,this.marker=this.createMarker(),this.constraintHandler=new handler_ConstraintHandler(this.graph),this.points=[],this.abspoints=this.getSelectionPoints(this.state),this.shape=this.createSelectionShape(this.abspoints),this.shape.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,this.shape.init(this.graph.getView().getOverlayPane()),this.shape.pointerEvents=!1,this.shape.setCursor(Constants.CURSOR.MOVABLE_EDGE),InternalEvent.A.redirectMouseEvents(this.shape.node,this.graph,this.state),this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode===this.graph.container,!this.preferHtml){const t=this.state.getVisibleTerminalState(!0);if(null!=t&&(this.preferHtml=null!=t.text&&t.text.node.parentNode===this.graph.container),!this.preferHtml){const t=this.state.getVisibleTerminalState(!1);null!=t&&(this.preferHtml=null!=t.text&&t.text.node.parentNode===this.graph.container)}}const e=this.graph.getPlugin("SelectionHandler");e&&(this.graph.getSelectionCount()<e.maxCells||e.maxCells<=0)&&(this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends())),this.label=new Point.A(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape=this.createLabelHandleShape(),this.initBend(this.labelShape),this.labelShape.setCursor(Constants.CURSOR.LABEL_HANDLE),this.customHandles=this.createCustomHandles(),this.updateParentHighlight(),this.redraw(),this.escapeHandler=(e,i)=>{const s=null!=this.index;this.reset(),s&&this.graph.cellRenderer.redraw(this.state,!1,t.view.isRendering())},this.state.view.graph.addListener(InternalEvent.A.ESCAPE,this.escapeHandler)}isParentHighlightVisible(){const t=this.state.cell.getParent();return t?!this.graph.isCellSelected(t):null}updateParentHighlight(){if(!this.isDestroyed()){const t=this.isParentHighlightVisible(),e=this.state.cell.getParent(),i=e?this.graph.view.getState(e):null;if(this.parentHighlight)if(e&&e.isVertex()&&t){const t=this.parentHighlight.bounds;i&&t&&(t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&(this.parentHighlight.bounds=Rectangle.A.fromRectangle(i),this.parentHighlight.redraw())}else i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&t&&e&&e.isVertex()&&i&&!i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=Constants.DIALECT.SVG,this.parentHighlight.pointerEvents=!1,i.style.rotation&&(this.parentHighlight.rotation=i.style.rotation),this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}createCustomHandles(){return[]}isVirtualBendsEnabled(t){return this.virtualBendsEnabled&&(null==this.state.style.edgeStyle||this.state.style.edgeStyle===Constants.NONE||this.state.style.noEdgeStyle)&&"arrow"!==this.state.style.shape}isCellEnabled(t){return!0}isAddPointEvent(t){return(0,EventUtils.isShiftDown)(t)}isRemovePointEvent(t){return(0,EventUtils.isShiftDown)(t)}getSelectionPoints(t){return t.absolutePoints}createParentHighlightShape(t){const e=new RectangleShape.A(Rectangle.A.fromRectangle(t),Constants.NONE,this.getSelectionColor());return e.strokeWidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e}createSelectionShape(t){const e=new(0,this.state.shape.constructor);return e.outline=!0,e.apply(this.state),e.isDashed=this.isSelectionDashed(),e.stroke=this.getSelectionColor(),e.isShadow=!1,e}getSelectionColor(){return EdgeHandlerConfig.selectionColor}getSelectionStrokeWidth(){return EdgeHandlerConfig.selectionStrokeWidth}isSelectionDashed(){return EdgeHandlerConfig.selectionDashed}isConnectableCell(t){return!0}getCellAt(t,e){return this.outlineConnect?null:this.graph.getCellAt(t,e)}createMarker(){return new EdgeHandlerCellMarker(this.graph,this)}validateConnection(t,e){return this.graph.getEdgeValidationError(this.state.cell,t,e)}createBends(){const{cell:t}=this.state,e=[];for(let i=0;i<this.abspoints.length;i+=1)if(this.isHandleVisible(i)){const s=0===i,n=i===this.abspoints.length-1,l=s||n;(l||this.graph.isCellBendable(t))&&(t=>{const s=this.createHandleShape(t);this.initBend(s,(()=>{this.dblClickRemoveEnabled&&this.removePoint(this.state,t)})),this.isHandleEnabled(i)&&s.setCursor(l?Constants.CURSOR.TERMINAL_HANDLE:Constants.CURSOR.BEND_HANDLE),e.push(s),l||(this.points.push(new Point.A(0,0)),s.node.style.visibility="hidden")})(i)}return e}createVirtualBends(){const{cell:t}=this.state,e=(this.abspoints[0],[]);if(this.graph.isCellBendable(t))for(let t=1;t<this.abspoints.length;t+=1)(t=>{this.initBend(t),t.setCursor(Constants.CURSOR.VIRTUAL_BEND_HANDLE),e.push(t)})(this.createHandleShape());return e}isHandleEnabled(t){return!0}isHandleVisible(t){const e=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),s=this.state.cell.getGeometry();return(s?this.graph.view.getEdgeStyle(this.state,s.points||void 0,e,i):null)!==style_EdgeStyle.EntityRelation||0===t||t===this.abspoints.length-1}createHandleShape(t){if(this.handleImage){const t=new ImageShape.A(new Rectangle.A(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src);return t.preserveImageAspect=!1,t}let e=HandleConfig.size;return this.preferHtml&&(e-=1),new("circle"===EdgeHandlerConfig.handleShape?node_EllipseShape:RectangleShape.A)(new Rectangle.A(0,0,e,e),HandleConfig.fillColor,HandleConfig.strokeColor)}createLabelHandleShape(){if(this.labelHandleImage){const t=new ImageShape.A(new Rectangle.A(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src);return t.preserveImageAspect=!1,t}const t=HandleConfig.labelSize;return new RectangleShape.A(new Rectangle.A(0,0,t,t),HandleConfig.labelFillColor,HandleConfig.strokeColor)}initBend(t,e){this.preferHtml?(t.dialect=Constants.DIALECT.STRICTHTML,t.init(this.graph.container)):(t.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,t.init(this.graph.getView().getOverlayPane())),InternalEvent.A.redirectMouseEvents(t.node,this.graph,this.state,null,null,null,e),Client.A.IS_TOUCH&&t.node.setAttribute("pointer-events","none")}getHandleForEvent(t){let e=null;const i=(0,EventUtils.isMouseEvent)(t.getEvent())?1:this.tolerance,s=this.allowHandleBoundsCheck&&i>0?new Rectangle.A(t.getGraphX()-i,t.getGraphY()-i,2*i,2*i):null;let n=Number.POSITIVE_INFINITY;function l(e){if(e&&e.bounds&&e.node&&"none"!==e.node.style.display&&"hidden"!==e.node.style.visibility&&(t.isSource(e)||s&&(0,mathUtils.intersects)(e.bounds,s))){const i=t.getGraphX()-e.bounds.getCenterX(),s=t.getGraphY()-e.bounds.getCenterY(),l=i*i+s*s;if(l<=n)return n=l,!0}return!1}if(this.isCustomHandleEvent(t)&&this.customHandles)for(let t=this.customHandles.length-1;t>=0;t--)if(l(this.customHandles[t].shape))return InternalEvent.A.CUSTOM_HANDLE-t;(t.isSource(this.state.text)||l(this.labelShape))&&(e=InternalEvent.A.LABEL_HANDLE);for(let t=0;t<this.bends.length;t+=1)l(this.bends[t])&&(e=t);if(this.virtualBends&&this.isAddVirtualBendEvent(t))for(let t=0;t<this.virtualBends.length;t+=1)l(this.virtualBends[t])&&(e=InternalEvent.A.VIRTUAL_HANDLE-t);return e}isAddVirtualBendEvent(t){return!0}isCustomHandleEvent(t){return!0}mouseDown(t,e){const i=this.getHandleForEvent(e);if(null!==i&&this.bends[i]){const t=this.bends[i].bounds;t&&(this.snapPoint=new Point.A(t.getCenterX(),t.getCenterY()))}if(this.addEnabled&&null===i&&this.isAddPointEvent(e.getEvent()))this.addPoint(this.state,e.getEvent()),e.consume();else if(null!==i&&!e.isConsumed()&&this.graph.isEnabled()){const t=e.getCell();this.removeEnabled&&this.isRemovePointEvent(e.getEvent())?this.removePoint(this.state,i):(i!==InternalEvent.A.LABEL_HANDLE||t&&this.graph.isLabelMovable(t))&&(this.virtualBends&&i<=InternalEvent.A.VIRTUAL_HANDLE&&(0,styleUtils.setOpacity)(this.virtualBends[InternalEvent.A.VIRTUAL_HANDLE-i].node,100),this.start(e.getX(),e.getY(),i)),e.consume()}}start(t,e,i){if(this.startX=t,this.startY=e,this.isSource=0!==this.bends.length&&0===i,this.isTarget=0!==this.bends.length&&i===this.bends.length-1,this.isLabel=i===InternalEvent.A.LABEL_HANDLE,this.isSource||this.isTarget){const{cell:t}=this.state,e=t.getTerminal(this.isSource);(null==e&&this.graph.isTerminalPointMovable(t,this.isSource)||null!=e&&this.graph.isCellDisconnectable(t,e,this.isSource))&&(this.index=i)}else this.index=i;if(null!==this.index&&this.index<=InternalEvent.A.CUSTOM_HANDLE&&this.index>InternalEvent.A.VIRTUAL_HANDLE&&null!=this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)t!==InternalEvent.A.CUSTOM_HANDLE-this.index&&this.customHandles[t].setVisible(!1)}clonePreviewState(t,e){return this.state.clone()}getSnapToTerminalTolerance(){return this.graph.getGridSize()*this.graph.getView().scale/2}updateHint(t,e){}removeHint(){}roundLength(t){return Math.round(t)}isSnapToTerminalsEvent(t){return this.snapToTerminals&&!(0,EventUtils.isAltDown)(t.getEvent())}getPointForEvent(t){const e=this.graph.getView(),{scale:i}=e,s=new Point.A(this.roundLength(t.getGraphX()/i)*i,this.roundLength(t.getGraphY()/i)*i),n=this.getSnapToTerminalTolerance();let l=!1,r=!1;if(n>0&&this.isSnapToTerminalsEvent(t)){const t=t=>{if(t){const{x:e}=t;Math.abs(s.x-e)<n&&(s.x=e,l=!0);const{y:i}=t;Math.abs(s.y-i)<n&&(s.y=i,r=!0)}},i=i=>{i&&t(new Point.A(e.getRoutingCenterX(i),e.getRoutingCenterY(i)))};i(this.state.getVisibleTerminalState(!0)),i(this.state.getVisibleTerminalState(!1));for(let e=0;e<this.state.absolutePoints.length;e+=1)t(this.state.absolutePoints[e])}if(this.graph.isGridEnabledEvent(t.getEvent())){const t=e.translate;l||(s.x=(this.graph.snap(s.x/i-t.x)+t.x)*i),r||(s.y=(this.graph.snap(s.y/i-t.y)+t.y)*i)}return s}getPreviewTerminalState(t){if(this.constraintHandler.update(t,this.isSource,!0,t.isSource(this.marker.highlight.shape)?null:this.currentPoint),this.constraintHandler.currentFocus&&this.constraintHandler.currentConstraint){this.marker.highlight&&this.marker.highlight.shape&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent");const t=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(this.state.cell.getTerminal(!this.isSource)),!this.isSource),e=t?t.cell:null,i=this.isSource?this.constraintHandler.currentFocus.cell:e,s=this.isSource?e:this.constraintHandler.currentFocus.cell;this.error=this.validateConnection(i,s);let n=null;return null===this.error&&(n=this.constraintHandler.currentFocus),(null!==this.error||n&&!this.isCellEnabled(n.cell))&&this.constraintHandler.reset(),n}if(!this.graph.isIgnoreTerminalEvent(t.getEvent())){this.marker.process(t);const e=this.marker.getValidState();return e&&!this.isCellEnabled(e.cell)&&(this.constraintHandler.reset(),this.marker.reset()),this.marker.getValidState()}return this.marker.reset(),null}getPreviewPoints(t,e){const i=this.state.cell.getGeometry();if(!i)return null;let s=(i.points||[]).slice();const n=new Point.A(t.x,t.y);let l=null;if(this.isSource||this.isTarget||null===this.index)this.graph.isResetEdgesOnConnect()&&(s=[]);else{if(this.convertPoint(n,!1),this.index<=InternalEvent.A.VIRTUAL_HANDLE&&s.splice(InternalEvent.A.VIRTUAL_HANDLE-this.index,0,n),!this.isSource&&!this.isTarget){for(let e=0;e<this.bends.length;e+=1)if(e!==this.index){const i=this.bends[e];i&&(0,mathUtils.contains)(i.bounds,t.x,t.y)&&(this.index<=InternalEvent.A.VIRTUAL_HANDLE?s.splice(InternalEvent.A.VIRTUAL_HANDLE-this.index,1):s.splice(this.index-1,1),l=s)}if(!l&&this.straightRemoveEnabled&&(!e||!(0,EventUtils.isAltDown)(e.getEvent()))){const e=this.graph.getEventTolerance()*this.graph.getEventTolerance(),i=this.state.absolutePoints.slice();i[this.index]=t;const n=this.state.getVisibleTerminalState(!0);if(null!=n){const t=this.graph.getConnectionConstraint(this.state,n,!0);null!=t&&null!=this.graph.getConnectionPoint(n,t)||(i[0]=new Point.A(n.view.getRoutingCenterX(n),n.view.getRoutingCenterY(n)))}const o=this.state.getVisibleTerminalState(!1);if(null!=o){const t=this.graph.getConnectionConstraint(this.state,o,!1);null!=t&&null!=this.graph.getConnectionPoint(o,t)||(i[i.length-1]=new Point.A(o.view.getRoutingCenterX(o),o.view.getRoutingCenterY(o)))}r=this.index,a=t,r>0&&r<i.length-1&&(0,mathUtils.ptSegDistSq)(i[r-1].x,i[r-1].y,i[r+1].x,i[r+1].y,a.x,a.y)<e&&(s.splice(r-1,1),l=s)}}null==l&&this.index>InternalEvent.A.VIRTUAL_HANDLE&&(s[this.index-1]=n)}var r,a;return null!=l?l:s}isOutlineConnectEvent(t){if(!this.currentPoint)return!1;const e=(0,styleUtils.getOffset)(this.graph.container),i=t.getEvent(),s=(0,EventUtils.getClientX)(i),n=(0,EventUtils.getClientY)(i),l=document.documentElement,r=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),a=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+e.x-r,h=this.currentPoint.y-this.graph.container.scrollTop+e.y-a;return this.outlineConnect&&!(0,EventUtils.isShiftDown)(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||(0,EventUtils.isAltDown)(t.getEvent())&&null!=t.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||h!==n)&&null==t.getState()&&this.marker.highlight.isHighlightAt(o,h))}updatePreviewState(t,e,i,s,n=!1){const l=this.isSource?i:this.state.getVisibleTerminalState(!0),r=this.isTarget?i:this.state.getVisibleTerminalState(!1);let a=this.graph.getConnectionConstraint(t,l,!0),o=this.graph.getConnectionConstraint(t,r,!1),h=this.constraintHandler.currentConstraint;if(null==h&&n&&(null!=i?(s.isSource(this.marker.highlight.shape)&&(e=new Point.A(s.getGraphX(),s.getGraphY())),h=this.graph.getOutlineConstraint(e,i,s),this.constraintHandler.setFocus(s,i,this.isSource),this.constraintHandler.currentConstraint=h,this.constraintHandler.currentPoint=e):h=new ConnectionConstraint.A(null)),this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){const t=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=n?Constants.OUTLINE_HIGHLIGHT_COLOR:"transparent",this.marker.highlight.shape.strokeWidth=Constants.OUTLINE_HIGHLIGHT_STROKEWIDTH/t/t,this.marker.highlight.repaint();else if(this.marker.hasValidState()){const e=s.getCell();this.marker.highlight.shape.stroke=e&&e.isConnectable()&&this.marker.getValidState()!==s.getState()?"transparent":Constants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokeWidth=Constants.HIGHLIGHT_STROKEWIDTH/t/t,this.marker.highlight.repaint()}}this.isSource?a=h:this.isTarget&&(o=h),(this.isSource||this.isTarget)&&(null!=h&&null!=h.point?(t.style[this.isSource?"exitX":"entryX"]=h.point.x,t.style[this.isSource?"exitY":"entryY"]=h.point.y):(delete t.style[this.isSource?"exitX":"entryX"],delete t.style[this.isSource?"exitY":"entryY"])),t.setVisibleTerminalState(l,!0),t.setVisibleTerminalState(r,!1),this.isSource&&null==l||t.view.updateFixedTerminalPoint(t,l,!0,a),this.isTarget&&null==r||t.view.updateFixedTerminalPoint(t,r,!1,o),(this.isSource||this.isTarget)&&null==i&&(t.setAbsoluteTerminalPoint(e,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.isAllowDanglingEdges()?null:"")),t.view.updatePoints(t,this.points,l,r),t.view.updateFloatingTerminalPoints(t,l,r)}mouseMove(t,e){if(null!=this.index&&null!=this.marker){if(this.currentPoint=this.getPointForEvent(e),this.error=null,!this.graph.isIgnoreTerminalEvent(e.getEvent())&&(0,EventUtils.isShiftDown)(e.getEvent())&&null!=this.snapPoint&&(Math.abs(this.snapPoint.x-this.currentPoint.x)<Math.abs(this.snapPoint.y-this.currentPoint.y)?this.currentPoint.x=this.snapPoint.x:this.currentPoint.y=this.snapPoint.y),this.index<=InternalEvent.A.CUSTOM_HANDLE&&this.index>InternalEvent.A.VIRTUAL_HANDLE)null!=this.customHandles&&(this.customHandles[InternalEvent.A.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[InternalEvent.A.CUSTOM_HANDLE-this.index].positionChanged(),null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="none"));else if(this.isLabel&&this.label)this.label.x=this.currentPoint.x,this.label.y=this.currentPoint.y;else{this.points=this.getPreviewPoints(this.currentPoint,e);let t=this.isSource||this.isTarget?this.getPreviewTerminalState(e):null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?this.currentPoint=this.constraintHandler.currentPoint.clone():this.outlineConnect&&((this.isSource||this.isTarget)&&this.isOutlineConnectEvent(e)?t=this.marker.highlight.state:null!=t&&t!==e.getState()&&e.getCell()?.isConnectable()&&null!=this.marker.highlight.shape&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint(),t=null)),null==t||this.isCellEnabled(t.cell)||(t=null,this.marker.reset()),this.currentPoint){const i=this.clonePreviewState(this.currentPoint,null!=t?t.cell:null);this.updatePreviewState(i,this.currentPoint,t,e,this.outline);const s=null==this.error?this.marker.validColor:this.marker.invalidColor;this.setPreviewColor(s),this.abspoints=i.absolutePoints,this.active=!0,this.updateHint(e,this.currentPoint)}}this.drawPreview(),InternalEvent.A.consume(e.getEvent()),e.consume()}}mouseUp(t,e){if(null!=this.index&&null!=this.marker){null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="");let t=this.state.cell;const{index:i}=this;if(this.index=null,e.getX()!==this.startX||e.getY()!==this.startY){const s=!this.graph.isIgnoreTerminalEvent(e.getEvent())&&this.graph.isCloneEvent(e.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable();if(null!=this.error)this.error.length>0&&this.graph.validationAlert(this.error);else if(i<=InternalEvent.A.CUSTOM_HANDLE&&i>InternalEvent.A.VIRTUAL_HANDLE){if(null!=this.customHandles){const t=this.graph.getDataModel();t.beginUpdate();try{this.customHandles[InternalEvent.A.CUSTOM_HANDLE-i].execute(e),null!=this.shape&&null!=this.shape.node&&(this.shape.apply(this.state),this.shape.redraw())}finally{t.endUpdate()}}}else if(this.isLabel&&this.label)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){let i=null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(i=this.constraintHandler.currentFocus.cell),!i&&this.marker.hasValidState()&&null!=this.marker.highlight&&null!=this.marker.highlight.shape&&"transparent"!==this.marker.highlight.shape.stroke&&"white"!==this.marker.highlight.shape.stroke&&(i=this.marker.validState.cell),i){const n=this.graph.getDataModel(),l=t.getParent();n.beginUpdate();try{if(s){let e=t.getGeometry();const i=this.graph.cloneCell(t);n.add(l,i,l.getChildCount()),null!=e&&(e=e.clone(),n.setGeometry(i,e));const s=t.getTerminal(!this.isSource);this.graph.connectCell(i,s,!this.isSource),t=i}t=this.connect(t,i,this.isSource,s,e)}finally{n.endUpdate()}}else if(this.graph.isAllowDanglingEdges()){const e=this.abspoints[this.isSource?0:this.abspoints.length-1];e.x=this.roundLength(e.x/this.graph.view.scale-this.graph.view.translate.x),e.y=this.roundLength(e.y/this.graph.view.scale-this.graph.view.translate.y);const i=t.getParent(),n=i?this.graph.getView().getState(i):null;null!=n&&(e.x-=n.origin.x,e.y-=n.origin.y),e.x-=this.graph.getPanDx()/this.graph.view.scale,e.y-=this.graph.getPanDy()/this.graph.view.scale,t=this.changeTerminalPoint(t,e,this.isSource,s)}}else this.active?t=this.changePoints(t,this.points,s):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().validate(this.state.cell))}else this.graph.isToggleEvent(e.getEvent())&&this.graph.selectCellForEvent(this.state.cell,e.getEvent());null!=this.marker&&(this.reset(),t!==this.state.cell&&this.graph.setSelectionCell(t)),e.consume()}}reset(){if(this.active&&this.refresh(),this.error=null,this.index=null,this.points=[],this.snapPoint=null,this.isLabel=!1,this.isSource=!1,this.isTarget=!1,this.active=!1,this.marker&&this.marker.reset(),this.constraintHandler.reset(),this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].reset();this.setPreviewColor(EdgeHandlerConfig.selectionColor),this.removeHint(),this.redraw()}setPreviewColor(t){this.shape.stroke=t}convertPoint(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate();e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/i-s.x),t.y=Math.round(t.y/i-s.y);const n=this.state.cell.getParent(),l=n?this.graph.getView().getState(n):n;return l&&(t.x-=l.origin.x,t.y-=l.origin.y),t}moveLabel(t,e,i){const s=this.graph.getDataModel();let n=t.cell.getGeometry();if(null!=n){const{scale:l}=this.graph.getView();if(n=n.clone(),n.relative){let s=this.graph.getView().getRelativePoint(t,e,i);n.x=Math.round(1e4*s.x)/1e4,n.y=Math.round(s.y),n.offset=new Point.A(0,0),s=this.graph.view.getPoint(t,n),n.offset=new Point.A(Math.round((e-s.x)/l),Math.round((i-s.y)/l))}else{const s=t.absolutePoints,r=s[0],a=s[s.length-1];if(null!=r&&null!=a){const t=r.x+(a.x-r.x)/2,s=r.y+(a.y-r.y)/2;n.offset=new Point.A(Math.round((e-t)/l),Math.round((i-s)/l)),n.x=0,n.y=0}}s.setGeometry(t.cell,n)}}connect(t,e,i,s,n){return t.getParent(),this.graph.batchUpdate((()=>{let s=this.constraintHandler.currentConstraint;null==s&&(s=new ConnectionConstraint.A(null)),this.graph.connectCell(t,e,i,s)})),t}changeTerminalPoint(t,e,i,s){const n=this.graph.getDataModel();return n.batchUpdate((()=>{if(s){const e=t.getParent(),s=t.getTerminal(!i);t=this.graph.cloneCell(t),n.add(e,t,e.getChildCount()),n.setTerminal(t,s,!i)}let l=t.getGeometry();null!=l&&(l=l.clone(),l.setTerminalPoint(e,i),n.setGeometry(t,l),this.graph.connectCell(t,null,i,new ConnectionConstraint.A(null)))})),t}changePoints(t,e,i){const s=this.graph.getDataModel();return s.batchUpdate((()=>{if(i){const e=t.getParent(),i=t.getTerminal(!0),n=t.getTerminal(!1);t=this.graph.cloneCell(t),s.add(e,t,e.getChildCount()),s.setTerminal(t,i,!0),s.setTerminal(t,n,!1)}let n=t.getGeometry();null!=n&&(n=n.clone(),n.points=e,s.setGeometry(t,n))})),t}addPoint(t,e){const i=(0,styleUtils.convertPoint)(this.graph.container,(0,EventUtils.getClientX)(e),(0,EventUtils.getClientY)(e)),s=this.graph.isGridEnabledEvent(e);this.convertPoint(i,s),this.addPointAt(t,i.x,i.y),InternalEvent.A.consume(e)}addPointAt(t,e,i){let s=t.cell.getGeometry();const n=new Point.A(e,i);if(null!=s){s=s.clone();const e=this.graph.view.translate,i=this.graph.view.scale;let l=new Point.A(e.x*i,e.y*i);const r=this.state.cell.getParent();if(r&&r.isVertex()){const t=this.graph.view.getState(r);t&&(l=new Point.A(t.x,t.y))}const a=(0,mathUtils.findNearestSegment)(t,n.x*i+l.x,n.y*i+l.y);null==s.points?s.points=[n]:s.points.splice(a,0,n),this.graph.getDataModel().setGeometry(t.cell,s),this.refresh(),this.redraw()}}removePoint(t,e){if(e>0&&e<this.abspoints.length-1){let i=this.state.cell.getGeometry();null!=i&&null!=i.points&&(i=i.clone(),(i.points||[]).splice(e-1,1),this.graph.getDataModel().setGeometry(t.cell,i),this.refresh(),this.redraw())}}getHandleFillColor(t){const e=0===t,{cell:i}=this.state,s=i.getTerminal(e);let n=HandleConfig.fillColor;return null!=s&&!this.graph.isCellDisconnectable(i,s,e)||null==s&&!this.graph.isTerminalPointMovable(i,e)?n=Constants.LOCKED_HANDLE_FILLCOLOR:null!=s&&this.graph.isCellDisconnectable(i,s,e)&&(n=EdgeHandlerConfig.connectFillColor),n}redraw(t){this.abspoints=this.state.absolutePoints.slice();const e=this.state.cell.getGeometry();if(e){const t=e.points;if(null!=this.bends&&this.bends.length>0&&null!=t){null==this.points&&(this.points=[]);for(let e=1;e<this.bends.length-1;e+=1)null!=this.bends[e]&&null!=this.abspoints[e]&&(this.points[e-1]=t[e-1])}}this.drawPreview(),t||this.redrawHandles()}redrawHandles(){const{cell:t}=this.state;let e=this.labelShape.bounds;this.label=new Point.A(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape.bounds=new Rectangle.A(Math.round(this.label.x-e.width/2),Math.round(this.label.y-e.height/2),e.width,e.height);const i=this.graph.getLabel(t);if(this.labelShape.visible=null!=i&&i.length>0&&this.graph.isLabelMovable(t),null!=this.bends&&this.bends.length>0){const t=this.abspoints.length-1,i=this.abspoints[0],s=i.x,n=i.y;e=this.bends[0].bounds,this.bends[0].bounds=new Rectangle.A(Math.floor(s-e.width/2),Math.floor(n-e.height/2),e.width,e.height),this.bends[0].fill=this.getHandleFillColor(0),this.bends[0].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);const l=this.abspoints[t],r=l.x,a=l.y,o=this.bends.length-1;e=this.bends[o].bounds,this.bends[o].bounds=new Rectangle.A(Math.floor(r-e.width/2),Math.floor(a-e.height/2),e.width,e.height),this.bends[o].fill=this.getHandleFillColor(o),this.bends[o].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[o].bounds),this.redrawInnerBends(i,l)}if(this.virtualBends&&this.virtualBends.length>0){let t=this.abspoints[0];for(let e=0;e<this.virtualBends.length;e+=1)if(null!=this.virtualBends[e]&&null!=this.abspoints[e+1]){const i=this.abspoints[e+1],s=this.virtualBends[e],n=t.x+(i.x-t.x)/2,l=t.y+(i.y-t.y)/2;s.bounds&&(s.bounds=new Rectangle.A(Math.floor(n-s.bounds.width/2),Math.floor(l-s.bounds.height/2),s.bounds.width,s.bounds.height),s.redraw()),(0,styleUtils.setOpacity)(s.node,this.virtualBendOpacity),t=i,this.manageLabelHandle&&this.checkLabelHandle(s.bounds)}}if(this.labelShape.redraw(),this.customHandles)for(let t=0;t<this.customHandles.length;t+=1){const e=this.customHandles[t].shape;if(e){const i=e.node.style.display;this.customHandles[t].redraw(),e.node.style.display=i,e.node.style.visibility=this.isCustomHandleVisible(this.customHandles[t])?"":"hidden"}}}isCustomHandleVisible(t){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}setHandlesVisible(t){for(let e=0;e<this.bends.length;e+=1)this.bends[e].node.style.display=t?"":"none";if(this.virtualBends)for(let e=0;e<this.virtualBends.length;e+=1)this.virtualBends[e].node.style.display=t?"":"none";if(this.labelShape.node.style.display=t?"":"none",this.customHandles)for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].setVisible(t)}redrawInnerBends(t,e){for(let t=1;t<this.bends.length-1;t+=1)if(null!=this.bends[t])if(null!=this.abspoints[t]){const{x:e}=this.abspoints[t],{y:i}=this.abspoints[t],s=this.bends[t].bounds;if(this.bends[t].node.style.visibility="visible",this.bends[t].bounds=new Rectangle.A(Math.round(e-s.width/2),Math.round(i-s.height/2),s.width,s.height),this.manageLabelHandle)this.checkLabelHandle(this.bends[t].bounds);else if(null==this.handleImage&&this.labelShape.visible&&(0,mathUtils.intersects)(this.bends[t].bounds,this.labelShape.bounds)){const s=HandleConfig.size+3,n=s;this.bends[t].bounds=new Rectangle.A(Math.round(e-s/2),Math.round(i-n/2),s,n)}this.bends[t].redraw()}else this.bends[t].destroy()}checkLabelHandle(t){const e=this.labelShape.bounds;(0,mathUtils.intersects)(t,e)&&(t.getCenterY()<e.getCenterY()?e.y=t.y+t.height:e.y=t.y-e.height)}drawPreview(){try{if(this.isLabel){const t=this.labelShape.bounds,e=new Rectangle.A(Math.round(this.label.x-t.width/2),Math.round(this.label.y-t.height/2),t.width,t.height);t.equals(e)||(this.labelShape.bounds=e,this.labelShape.redraw())}null==this.shape||(0,arrayUtils.s7)(this.shape.points,this.abspoints)||(this.shape.apply(this.state),this.shape.points=this.abspoints.slice(),this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokeWidth=this.getSelectionStrokeWidth()/this.shape.scale/this.shape.scale,this.shape.isShadow=!1,this.shape.redraw()),this.updateParentHighlight()}catch(t){}}refresh(){null!=this.state&&(this.abspoints=this.getSelectionPoints(this.state),this.points=[],this.destroyBends(this.bends),this.bends=this.createBends(),this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends()),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles()),null!=this.labelShape&&null!=this.labelShape.node&&null!=this.labelShape.node.parentNode&&this.labelShape.node.parentNode.appendChild(this.labelShape.node))}isDestroyed(){return null==this.shape}destroyBends(t){if(null!=t)for(let e=0;e<t.length;e+=1)null!=t[e]&&t[e].destroy()}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.marker.destroy(),this.marker=null,this.shape.destroy(),this.shape=null,this.parentHighlight){const t=this.state.cell.getParent(),e=t?this.graph.view.getState(t):null;e&&e.parentHighlight===this.parentHighlight&&(e.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.labelShape.destroy(),this.labelShape=null,this.constraintHandler.onDestroy(),this.constraintHandler=null,this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=[]),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=[]),this.destroyBends(this.bends),this.bends=[],this.removeHint()}}class EdgeHandlerCellMarker extends cell_CellMarker{constructor(t,e,i=Constants.DEFAULT_VALID_COLOR,s=Constants.DEFAULT_INVALID_COLOR,n=Constants.DEFAULT_HOTSPOT){super(t,i,s,n),this.getCell=t=>{let e=super.getCell(t);if(e!==this.edgeHandler.state.cell&&e||!this.edgeHandler.currentPoint||(e=this.edgeHandler.graph.getCellAt(this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)),e&&!e.isConnectable()){const t=e.getParent();t&&t.isVertex()&&t.isConnectable()&&(e=t)}return e&&(this.graph.isSwimlane(e)&&this.edgeHandler.currentPoint&&this.graph.hitsSwimlaneContent(e,this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)||!this.edgeHandler.isConnectableCell(e)||e===this.edgeHandler.state.cell||e&&!this.edgeHandler.graph.connectableEdges&&e.isEdge()||this.edgeHandler.state.cell.isAncestor(e))&&(e=null),e&&!e.isConnectable()&&(e=null),e},this.isValidState=t=>{const e=this.edgeHandler.state.cell.getTerminal(!this.edgeHandler.isSource),i=this.edgeHandler.graph.view.getState(e),s=this.edgeHandler.graph.view.getTerminalPort(t,i,!this.edgeHandler.isSource),n=s?s.cell:null,l=this.edgeHandler.isSource?t.cell:n,r=this.edgeHandler.isSource?n:t.cell;return this.edgeHandler.error=this.edgeHandler.validateConnection(l,r),!this.edgeHandler.error},this.edgeHandler=e}}const handler_EdgeHandler=EdgeHandler;class VertexHandler{isRotationEnabled(){return VertexHandlerConfig.rotationEnabled}constructor(t){this.sizers=[],this.singleSizer=!1,this.index=null,this.allowHandleBoundsCheck=!0,this.handleImage=null,this.handlesVisible=!0,this.tolerance=0,this.parentHighlightEnabled=!1,this.rotationRaster=!0,this.rotationCursor="crosshair",this.livePreview=!1,this.movePreviewToFront=!1,this.manageSizers=!1,this.constrainGroupByChildren=!1,this.rotationHandleVSpacing=-16,this.horizontalOffset=0,this.verticalOffset=0,this.minBounds=null,this.x0=0,this.y0=0,this.customHandles=[],this.inTolerance=!1,this.startX=0,this.startY=0,this.rotationShape=null,this.currentAlpha=100,this.startAngle=0,this.startDist=0,this.ghostPreview=null,this.livePreviewActive=!1,this.childOffsetX=0,this.childOffsetY=0,this.parentState=null,this.parentHighlight=null,this.unscaledBounds=null,this.preview=null,this.labelShape=null,this.edgeHandlers=[],this.EMPTY_POINT=new Point.A,this.state=t,this.graph=this.state.view.graph,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.bounds),this.selectionBorder.dialect=Constants.DIALECT.SVG,this.selectionBorder.pointerEvents=!1,this.selectionBorder.rotation=this.state.style.rotation??0,this.selectionBorder.init(this.graph.getView().getOverlayPane()),InternalEvent.A.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state),this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(Constants.CURSOR.MOVABLE_VERTEX);const e=this.graph.getPlugin("SelectionHandler");if(e&&(e.maxCells<=0||this.graph.getSelectionCount()<e.maxCells)){const t=this.graph.isCellResizable(this.state.cell);if(this.sizers=[],t||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2){let e=0;t&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",e++)),this.sizers.push(this.createSizer("n-resize",e++)),this.sizers.push(this.createSizer("ne-resize",e++)),this.sizers.push(this.createSizer("w-resize",e++)),this.sizers.push(this.createSizer("e-resize",e++)),this.sizers.push(this.createSizer("sw-resize",e++)),this.sizers.push(this.createSizer("s-resize",e++))),this.sizers.push(this.createSizer("se-resize",e++)));const i=this.state.cell.getGeometry();null!=i&&!i.relative&&this.graph.isLabelMovable(this.state.cell)&&(this.labelShape=this.createSizer(Constants.CURSOR.LABEL_HANDLE,InternalEvent.A.LABEL_HANDLE,HandleConfig.labelSize,HandleConfig.labelFillColor),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(Constants.CURSOR.MOVABLE_VERTEX,InternalEvent.A.LABEL_HANDLE,void 0,HandleConfig.labelFillColor),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,InternalEvent.A.ROTATION_HANDLE,HandleConfig.size+3,HandleConfig.fillColor),this.sizers.push(this.rotationShape)),this.customHandles=this.createCustomHandles(),this.redraw(),this.constrainGroupByChildren&&this.updateMinBounds(),this.escapeHandler=(t,e)=>{this.livePreview&&null!=this.index&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate()),this.reset()},this.state.view.graph.addListener(InternalEvent.A.ESCAPE,this.escapeHandler)}isRotationHandleVisible(){const t=this.graph.getPlugin("SelectionHandler"),e=!t||t.maxCells<=0||this.graph.getSelectionCount()<t.maxCells;return this.graph.isEnabled()&&this.isRotationEnabled()&&this.graph.isCellRotatable(this.state.cell)&&e}isConstrainedEvent(t){return(0,EventUtils.isShiftDown)(t.getEvent())||"fixed"===this.state.style.aspect}isCenteredEvent(t,e){return!1}createCustomHandles(){return[]}updateMinBounds(){const t=this.graph.getChildCells(this.state.cell);if(t.length>0&&(this.minBounds=this.graph.view.getBounds(t),this.minBounds)){const t=this.state.view.scale,e=this.state.view.translate;this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=t,this.minBounds.y/=t,this.minBounds.width/=t,this.minBounds.height/=t,this.x0=this.state.x/t-e.x,this.y0=this.state.y/t-e.y}}getSelectionBounds(t){return new Rectangle.A(Math.round(t.x),Math.round(t.y),Math.round(t.width),Math.round(t.height))}createParentHighlightShape(t){return this.createSelectionShape(t)}createSelectionShape(t){const e=new RectangleShape.A(Rectangle.A.fromRectangle(t),Constants.NONE,this.getSelectionColor());return e.strokeWidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e}getSelectionColor(){return VertexHandlerConfig.selectionColor}getSelectionStrokeWidth(){return VertexHandlerConfig.selectionStrokeWidth}isSelectionDashed(){return VertexHandlerConfig.selectionDashed}createSizer(t,e,i=HandleConfig.size,s=HandleConfig.fillColor){const n=new Rectangle.A(0,0,i,i),l=this.createSizerShape(n,e,s);return l.bounds&&l.isHtmlAllowed()&&this.state.text&&this.state.text.node.parentNode===this.graph.container?(l.bounds.height-=1,l.bounds.width-=1,l.dialect=Constants.DIALECT.STRICTHTML,l.init(this.graph.container)):(l.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,l.init(this.graph.getView().getOverlayPane())),InternalEvent.A.redirectMouseEvents(l.node,this.graph,this.state),this.graph.isEnabled()&&l.setCursor(t),this.isSizerVisible(e)||(l.visible=!1),l}isSizerVisible(t){return!0}createSizerShape(t,e,i=HandleConfig.fillColor){if(this.handleImage){t=new Rectangle.A(t.x,t.y,this.handleImage.width,this.handleImage.height);const e=new ImageShape.A(t,this.handleImage.src);return e.preserveImageAspect=!1,e}const s=HandleConfig.strokeColor;return e===InternalEvent.A.ROTATION_HANDLE?new node_EllipseShape(t,i,s):new RectangleShape.A(t,i,s)}moveSizerTo(t,e,i){t&&t.bounds&&(t.bounds.x=Math.floor(e-t.bounds.width/2),t.bounds.y=Math.floor(i-t.bounds.height/2),t.node&&"none"!==t.node.style.display&&t.redraw())}getHandleForEvent(t){const e=(0,EventUtils.isMouseEvent)(t.getEvent())?1:this.tolerance,i=this.allowHandleBoundsCheck&&e>0?new Rectangle.A(t.getGraphX()-e,t.getGraphY()-e,2*e,2*e):null,s=e=>{const s=e&&e.constructor!==ImageShape.A&&this.allowHandleBoundsCheck?e.strokeWidth+e.svgStrokeTolerance:null,n=s?new Rectangle.A(t.getGraphX()-Math.floor(s/2),t.getGraphY()-Math.floor(s/2),s,s):i;return e&&e.bounds&&(t.isSource(e)||n&&(0,mathUtils.intersects)(e.bounds,n)&&"none"!==e.node.style.display&&"hidden"!==e.node.style.visibility)};if(s(this.rotationShape))return InternalEvent.A.ROTATION_HANDLE;if(s(this.labelShape))return InternalEvent.A.LABEL_HANDLE;for(let t=0;t<this.sizers.length;t+=1)if(s(this.sizers[t]))return t;if(null!=this.customHandles&&this.isCustomHandleEvent(t))for(let t=this.customHandles.length-1;t>=0;t--)if(s(this.customHandles[t].shape))return InternalEvent.A.CUSTOM_HANDLE-t;return null}isCustomHandleEvent(t){return!0}mouseDown(t,e){if(!e.isConsumed()&&this.graph.isEnabled()){const t=this.getHandleForEvent(e);t&&(this.start(e.getGraphX(),e.getGraphY(),t),e.consume())}}isLivePreviewBorder(){return this.state.shape&&this.state.shape.fill===Constants.NONE&&this.state.shape.stroke===Constants.NONE}start(t,e,i){if(this.livePreviewActive=this.livePreview&&0===this.state.cell.getChildCount(),this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=i,this.startX=t,this.startY=e,this.index<=InternalEvent.A.CUSTOM_HANDLE&&this.isGhostPreview())this.ghostPreview=this.createGhostPreview();else{const{model:t}=this.state.view.graph,e=this.state.cell.getParent();if(this.state.view.currentRoot!==e&&e&&(e.isVertex()||e.isEdge())&&(this.parentState=this.state.view.graph.view.getState(e)),this.selectionBorder.node.style.display=i===InternalEvent.A.ROTATION_HANDLE?"inline":"none",this.livePreviewActive&&!this.isLivePreviewBorder()||(this.preview=this.createSelectionShape(this.bounds),Client.A.IS_SVG&&0!==Number(this.state.style.rotation||"0")||null==this.state.text||this.state.text.node.parentNode!==this.graph.container?(this.preview.dialect=Constants.DIALECT.SVG,this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect=Constants.DIALECT.STRICTHTML,this.preview.init(this.graph.container))),i===InternalEvent.A.ROTATION_HANDLE){const t=this.getRotationHandlePosition(),e=t.x-this.state.getCenterX(),i=t.y-this.state.getCenterY();this.startAngle=0!==e?180*Math.atan(i/e)/Math.PI+90:0,this.startDist=Math.sqrt(e*e+i*i)}if(this.livePreviewActive){this.hideSizers(),i===InternalEvent.A.ROTATION_HANDLE&&this.rotationShape?this.rotationShape.node.style.display="":i===InternalEvent.A.LABEL_HANDLE&&this.labelShape?this.labelShape.node.style.display="":this.sizers[i]?this.sizers[i].node.style.display="":i<=InternalEvent.A.CUSTOM_HANDLE&&this.customHandles[InternalEvent.A.CUSTOM_HANDLE-i].setVisible(!0);const t=this.state.cell.getEdges();this.edgeHandlers=[];const e=this.graph.getPlugin("SelectionCellsHandler");for(let i=0;i<t.length;i+=1){const s=e?.getHandler(t[i]);s&&this.edgeHandlers.push(s)}}}}createGhostPreview(){const t=this.graph.cellRenderer.createShape(this.state);return t.init(this.graph.view.getOverlayPane()),t.scale=this.state.view.scale,t.bounds=this.bounds,t.outline=!0,t}setHandlesVisible(t){this.handlesVisible=t;for(let e=0;e<this.sizers.length;e+=1)this.sizers[e].node.style.display=t?"":"none";for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].setVisible(t)}hideSizers(){this.setHandlesVisible(!1)}checkTolerance(t){this.inTolerance&&null!==this.startX&&null!==this.startY&&((0,EventUtils.isMouseEvent)(t.getEvent())||Math.abs(t.getGraphX()-this.startX)>this.graph.getEventTolerance()||Math.abs(t.getGraphY()-this.startY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}updateHint(t){}removeHint(){}roundAngle(t){return Math.round(10*t)/10}roundLength(t){return Math.round(100*t)/100}mouseMove(t,e){e.isConsumed()||null==this.index?!this.graph.isMouseDown&&this.getHandleForEvent(e)&&e.consume(!1):(this.checkTolerance(e),this.inTolerance||(this.index<=InternalEvent.A.CUSTOM_HANDLE?null!=this.customHandles&&(this.customHandles[InternalEvent.A.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[InternalEvent.A.CUSTOM_HANDLE-this.index].active=!0,null!=this.ghostPreview?(this.ghostPreview.apply(this.state),this.ghostPreview.strokeWidth=this.getSelectionStrokeWidth()/this.ghostPreview.scale/this.ghostPreview.scale,this.ghostPreview.isDashed=this.isSelectionDashed(),this.ghostPreview.stroke=this.getSelectionColor(),this.ghostPreview.redraw(),null!=this.selectionBounds&&(this.selectionBorder.node.style.display="none")):(this.movePreviewToFront&&this.moveToFront(),this.customHandles[InternalEvent.A.CUSTOM_HANDLE-this.index].positionChanged())):this.index===InternalEvent.A.LABEL_HANDLE?this.moveLabel(e):(this.index===InternalEvent.A.ROTATION_HANDLE?this.rotateVertex(e):this.resizeVertex(e),this.updateHint(e))),e.consume())}isGhostPreview(){return this.state.cell.getChildCount()>0}moveLabel(t){const e=new Point.A(t.getGraphX(),t.getGraphY()),i=this.graph.view.translate,{scale:s}=this.graph.view;this.graph.isGridEnabledEvent(t.getEvent())&&(e.x=(this.graph.snap(e.x/s-i.x)+i.x)*s,e.y=(this.graph.snap(e.y/s-i.y)+i.y)*s);const n=this.rotationShape?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[n],e.x,e.y)}rotateVertex(t){const e=new Point.A(t.getGraphX(),t.getGraphY());let i=this.state.x+this.state.width/2-e.x,s=this.state.y+this.state.height/2-e.y;if(this.currentAlpha=0!==i?180*Math.atan(s/i)/Math.PI+90:s<0?180:0,i>0&&(this.currentAlpha-=180),this.currentAlpha-=this.startAngle,this.rotationRaster&&this.graph.isGridEnabledEvent(t.getEvent())){let t;i=e.x-this.state.getCenterX(),s=e.y-this.state.getCenterY();const n=Math.sqrt(i*i+s*s);t=n-this.startDist<2?15:n-this.startDist<25?5:1,this.currentAlpha=Math.round(this.currentAlpha/t)*t}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha,this.selectionBorder.redraw(),this.livePreviewActive&&this.redrawHandles()}resizeVertex(t){const e=new Point.A(this.state.getCenterX(),this.state.getCenterY()),i=(0,mathUtils.toRadians)(this.state.style.rotation??0),s=new Point.A(t.getGraphX(),t.getGraphY()),n=this.graph.view.translate,{scale:l}=this.graph.view;let r=Math.cos(-i),a=Math.sin(-i),o=s.x-this.startX,h=s.y-this.startY;const d=a*o+r*h;o=r*o-a*h,h=d;const c=this.state.cell.getGeometry();if(c&&null!==this.index&&(this.unscaledBounds=this.union(c,o/l,h/l,this.index,this.graph.isGridEnabledEvent(t.getEvent()),1,new Point.A(0,0),this.isConstrainedEvent(t),this.isCenteredEvent(this.state,t))),c&&!c.relative){let t=this.graph.getMaximumGraphBounds();if(null!=t&&null!=this.parentState&&(t=Rectangle.A.fromRectangle(t),t.x-=(this.parentState.x-n.x*l)/l,t.y-=(this.parentState.y-n.y*l)/l),this.graph.isConstrainChild(this.state.cell)){let e=this.graph.getCellContainmentArea(this.state.cell);if(null!=e){const i=this.graph.getOverlap(this.state.cell);i>0&&(e=Rectangle.A.fromRectangle(e),e.x-=e.width*i,e.y-=e.height*i,e.width+=2*e.width*i,e.height+=2*e.height*i),t?(t=Rectangle.A.fromRectangle(t),t.intersect(e)):t=e}}t&&this.unscaledBounds&&(this.unscaledBounds.x<t.x&&(this.unscaledBounds.width-=t.x-this.unscaledBounds.x,this.unscaledBounds.x=t.x),this.unscaledBounds.y<t.y&&(this.unscaledBounds.height-=t.y-this.unscaledBounds.y,this.unscaledBounds.y=t.y),this.unscaledBounds.x+this.unscaledBounds.width>t.x+t.width&&(this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-t.x-t.width),this.unscaledBounds.y+this.unscaledBounds.height>t.y+t.height&&(this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-t.y-t.height))}if(this.unscaledBounds){const s=this.bounds;this.bounds=new Rectangle.A((this.parentState?this.parentState.x:n.x*l)+this.unscaledBounds.x*l,(this.parentState?this.parentState.y:n.y*l)+this.unscaledBounds.y*l,this.unscaledBounds.width*l,this.unscaledBounds.height*l),c&&c.relative&&this.parentState&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y),r=Math.cos(i),a=Math.sin(i);const d=new Point.A(this.bounds.getCenterX(),this.bounds.getCenterY());o=d.x-e.x,h=d.y-e.y;const u=r*o-a*h-o,g=a*o+r*h-h,p=this.bounds.x-this.state.x,E=this.bounds.y-this.state.y,C=r*p-a*E,m=a*p+r*E;this.bounds.x+=u,this.bounds.y+=g,this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+u/l),this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+g/l),this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width),this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height),this.state.cell.isCollapsed()||0===u&&0===g?(this.childOffsetX=0,this.childOffsetY=0):(this.childOffsetX=this.state.x-this.bounds.x+C,this.childOffsetY=this.state.y-this.bounds.y+m),s.equals(this.bounds)||(this.livePreviewActive&&this.updateLivePreview(t),null!=this.preview?this.drawPreview():this.updateParentHighlight())}}updateLivePreview(t){const{scale:e}=this.graph.view,i=this.graph.view.translate,s=this.state.clone();this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new Point.A(this.state.x/e-i.x,this.state.y/e-i.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height;let n=this.state.absoluteOffset;n=new Point.A(n.x,n.y),this.state.absoluteOffset.x=0,this.state.absoluteOffset.y=0;const l=this.state.cell.getGeometry();if(null!=l){const t=l.offset||this.EMPTY_POINT;null==t||l.relative||(this.state.absoluteOffset.x=this.state.view.scale*t.x,this.state.absoluteOffset.y=this.state.view.scale*t.y),this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.movePreviewToFront&&this.moveToFront(),null!=this.state.control&&null!=this.state.control.node&&(this.state.control.node.style.visibility="hidden"),this.state.setState(s)}moveToFront(){(this.state.text&&this.state.text.node&&this.state.text.node.nextSibling||this.state.shape&&this.state.shape.node&&this.state.shape.node.nextSibling&&(!this.state.text||this.state.shape.node.nextSibling!==this.state.text.node))&&(this.state.shape&&this.state.shape.node&&this.state.shape.node.parentNode&&this.state.shape.node.parentNode.appendChild(this.state.shape.node),this.state.text&&this.state.text.node&&this.state.text.node.parentNode&&this.state.text.node.parentNode.appendChild(this.state.text.node))}mouseUp(t,e){if(null!=this.index&&null!=this.state){const t=new Point.A(e.getGraphX(),e.getGraphY()),{index:i}=this;this.index=null,null==this.ghostPreview&&(this.state.view.invalidate(this.state.cell,!1,!1),this.state.view.validate()),this.graph.batchUpdate((()=>{if(i<=InternalEvent.A.CUSTOM_HANDLE){if(null!=this.customHandles){const t=this.state.view.graph.getCellStyle(this.state.cell);this.customHandles[InternalEvent.A.CUSTOM_HANDLE-i].active=!1,this.customHandles[InternalEvent.A.CUSTOM_HANDLE-i].execute(e),null!=this.customHandles&&null!=this.customHandles[InternalEvent.A.CUSTOM_HANDLE-i]&&(this.state.style=t,this.customHandles[InternalEvent.A.CUSTOM_HANDLE-i].positionChanged())}}else if(i===InternalEvent.A.ROTATION_HANDLE)if(null!=this.currentAlpha){const t=this.currentAlpha-(this.state.style.rotation??0);0!==t&&this.rotateCell(this.state.cell,t)}else this.rotateClick();else{const s=this.graph.isGridEnabledEvent(e.getEvent()),n=(0,mathUtils.toRadians)(this.state.style.rotation??0),l=Math.cos(-n),r=Math.sin(-n);let a=t.x-this.startX,o=t.y-this.startY;const h=r*a+l*o;a=l*a-r*o,o=h;const d=this.graph.view.scale,c=this.isRecursiveResize(this.state,e);this.resizeCell(this.state.cell,this.roundLength(a/d),this.roundLength(o/d),i,s,this.isConstrainedEvent(e),c)}})),e.consume(),this.reset(),this.redrawHandles()}}isRecursiveResize(t,e){return this.graph.isRecursiveResize(this.state)}rotateClick(){}rotateCell(t,e,i){if(0!==e){const s=this.graph.getDataModel();if(t.isVertex()||t.isEdge()){if(!t.isEdge()){const i=(this.graph.getCurrentCellStyle(t).rotation||0)+e;this.graph.setCellStyles("rotation",i,[t])}let n=t.getGeometry();if(n&&i){const l=i.getGeometry();if(null==l||i.isEdge()||(n=n.clone(),n.rotate(e,new Point.A(l.width/2,l.height/2)),s.setGeometry(t,n)),t.isVertex()&&!n.relative||t.isEdge()){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.rotateCell(t.getChildAt(s),e,t)}}}}}reset(){if(null!==this.index&&"none"===this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display=""),this.index=null,this.preview&&(this.preview.destroy(),this.preview=null),this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.livePreviewActive){for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].node.style.display="";this.state.control&&this.state.control.node&&(this.state.control.node.style.visibility="")}for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].active?(this.customHandles[t].active=!1,this.customHandles[t].reset()):this.customHandles[t].setVisible(!0);this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),this.removeHint(),this.redrawHandles(),this.edgeHandlers=[],this.handlesVisible=!0,this.unscaledBounds=null}resizeCell(t,e,i,s,n,l,r){let a=t.getGeometry();if(a)if(s===InternalEvent.A.LABEL_HANDLE&&this.labelShape&&this.labelShape.bounds){const e=-(0,mathUtils.toRadians)(this.state.style.rotation??0),i=Math.cos(e),s=Math.sin(e),{scale:n}=this.graph.view,l=(0,mathUtils.getRotatedPoint)(new Point.A(Math.round((this.labelShape.bounds.getCenterX()-this.startX)/n),Math.round((this.labelShape.bounds.getCenterY()-this.startY)/n)),i,s);a=a.clone(),null==a.offset?a.offset=l:(a.offset.x+=l.x,a.offset.y+=l.y),this.graph.model.setGeometry(t,a)}else if(this.unscaledBounds){const{scale:e}=this.graph.view;0===this.childOffsetX&&0===this.childOffsetY||this.moveChildren(t,Math.round(this.childOffsetX/e),Math.round(this.childOffsetY/e)),this.graph.resizeCell(t,this.unscaledBounds,r)}}moveChildren(t,e,i){const s=this.graph.getDataModel(),n=t.getChildCount();for(let l=0;l<n;l+=1){const n=t.getChildAt(l);let r=n.getGeometry();null!=r&&(r=r.clone(),r.translate(e,i),s.setGeometry(n,r))}}union(t,e,i,s,n,l,r,a,o){if(n=n&&this.graph.isGridEnabled(),this.singleSizer){let s=t.x+t.width+e,r=t.y+t.height+i;n&&(s=this.graph.snap(s/l)*l,r=this.graph.snap(r/l)*l);const a=new Rectangle.A(t.x,t.y,0,0);return a.add(new Rectangle.A(s,r,0,0)),a}const h=t.width,d=t.height;let c=t.x-r.x*l,u=c+h,g=t.y-r.y*l,p=g+d;const E=c+h/2,C=g+d/2;s>4?(p+=i,p=n?this.graph.snap(p/l)*l:Math.round(p/l)*l):s<3&&(g+=i,g=n?this.graph.snap(g/l)*l:Math.round(g/l)*l),0===s||3===s||5===s?(c+=e,c=n?this.graph.snap(c/l)*l:Math.round(c/l)*l):2!==s&&4!==s&&7!==s||(u+=e,u=n?this.graph.snap(u/l)*l:Math.round(u/l)*l);let m=u-c,f=p-g;if(a){const t=this.state.cell.getGeometry();if(null!=t){const e=t.width/t.height;1===s||2===s||7===s||6===s?m=f*e:f=m/e,0===s&&(c=u-m,g=p-f)}}if(o){m+=m-h,f+=f-d;const t=E-(c+m/2),e=C-(g+f/2);c+=t,g+=e,u+=t,p+=e}m<0&&(c+=m,m=Math.abs(m)),f<0&&(g+=f,f=Math.abs(f));const y=new Rectangle.A(c+r.x*l,g+r.y*l,m,f);return null!=this.minBounds&&(y.width=Math.max(y.width,this.minBounds.x*l+this.minBounds.width*l+Math.max(0,this.x0*l-y.x)),y.height=Math.max(y.height,this.minBounds.y*l+this.minBounds.height*l+Math.max(0,this.y0*l-y.y))),y}redraw(t){this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle.A(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),t||this.redrawHandles()}getHandlePadding(){const t=new Point.A(0,0);let e=this.tolerance;return this.sizers.length>0&&this.sizers[0].bounds&&(this.bounds.width<2*this.sizers[0].bounds.width+2*e||this.bounds.height<2*this.sizers[0].bounds.height+2*e)&&(e/=2,t.x=this.sizers[0].bounds.width+e,t.y=this.sizers[0].bounds.height+e),t}getSizerBounds(){return this.bounds}redrawHandles(){let t=this.getSizerBounds();const e=this.tolerance;this.horizontalOffset=0,this.verticalOffset=0;for(let t=0;t<this.customHandles.length;t+=1){const e=this.customHandles[t].shape;if(e){const i=e.node.style.display;this.customHandles[t].redraw(),e.node.style.display=i,e.node.style.visibility=this.handlesVisible&&this.isCustomHandleVisible(this.customHandles[t])?"":"hidden"}}if(this.sizers.length>0&&this.sizers[0]){if(null===this.index&&this.manageSizers&&this.sizers.length>=8){const i=this.getHandlePadding();this.horizontalOffset=i.x,this.verticalOffset=i.y,0===this.horizontalOffset&&0===this.verticalOffset||(t=new Rectangle.A(t.x,t.y,t.width,t.height),t.x-=this.horizontalOffset/2,t.width+=this.horizontalOffset,t.y-=this.verticalOffset/2,t.height+=this.verticalOffset),this.sizers.length>=8&&(this.sizers[0].bounds&&(t.width<2*this.sizers[0].bounds.width+2*e||t.height<2*this.sizers[0].bounds.height+2*e)?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):this.handlesVisible&&(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))}const i=t.x+t.width,s=t.y+t.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],i,s);else{const e=t.x+t.width/2,n=t.y+t.height/2;if(this.sizers.length>=8){const l=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],r=(0,mathUtils.toRadians)(this.state.style.rotation??0),a=Math.cos(r),o=Math.sin(r),h=Math.round(4*r/Math.PI),d=new Point.A(t.getCenterX(),t.getCenterY());let c=(0,mathUtils.getRotatedPoint)(new Point.A(t.x,t.y),a,o,d);this.moveSizerTo(this.sizers[0],c.x,c.y),this.sizers[0].setCursor(l[(0,mathUtils.mod)(0+h,l.length)]),c.x=e,c.y=t.y,c=(0,mathUtils.getRotatedPoint)(c,a,o,d),this.moveSizerTo(this.sizers[1],c.x,c.y),this.sizers[1].setCursor(l[(0,mathUtils.mod)(1+h,l.length)]),c.x=i,c.y=t.y,c=(0,mathUtils.getRotatedPoint)(c,a,o,d),this.moveSizerTo(this.sizers[2],c.x,c.y),this.sizers[2].setCursor(l[(0,mathUtils.mod)(2+h,l.length)]),c.x=t.x,c.y=n,c=(0,mathUtils.getRotatedPoint)(c,a,o,d),this.moveSizerTo(this.sizers[3],c.x,c.y),this.sizers[3].setCursor(l[(0,mathUtils.mod)(7+h,l.length)]),c.x=i,c.y=n,c=(0,mathUtils.getRotatedPoint)(c,a,o,d),this.moveSizerTo(this.sizers[4],c.x,c.y),this.sizers[4].setCursor(l[(0,mathUtils.mod)(3+h,l.length)]),c.x=t.x,c.y=s,c=(0,mathUtils.getRotatedPoint)(c,a,o,d),this.moveSizerTo(this.sizers[5],c.x,c.y),this.sizers[5].setCursor(l[(0,mathUtils.mod)(6+h,l.length)]),c.x=e,c.y=s,c=(0,mathUtils.getRotatedPoint)(c,a,o,d),this.moveSizerTo(this.sizers[6],c.x,c.y),this.sizers[6].setCursor(l[(0,mathUtils.mod)(5+h,l.length)]),c.x=i,c.y=s,c=(0,mathUtils.getRotatedPoint)(c,a,o,d),this.moveSizerTo(this.sizers[7],c.x,c.y),this.sizers[7].setCursor(l[(0,mathUtils.mod)(4+h,l.length)]),c.x=e+this.state.absoluteOffset.x,c.y=n+this.state.absoluteOffset.y,c=(0,mathUtils.getRotatedPoint)(c,a,o,d),this.moveSizerTo(this.sizers[8],c.x,c.y)}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],e+this.state.absoluteOffset.x,n+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}if(this.rotationShape){const t=(0,mathUtils.toRadians)(this.currentAlpha),e=Math.cos(t),i=Math.sin(t),s=new Point.A(this.state.getCenterX(),this.state.getCenterY()),n=(0,mathUtils.getRotatedPoint)(this.getRotationHandlePosition(),e,i,s);null!=this.rotationShape.node&&(this.moveSizerTo(this.rotationShape,n.x,n.y),this.rotationShape.node.style.visibility=this.state.view.graph.isEditing()||!this.handlesVisible?"hidden":"")}if(null!=this.selectionBorder&&(this.selectionBorder.rotation=this.state.style.rotation??0),null!=this.edgeHandlers)for(let t=0;t<this.edgeHandlers.length;t+=1)this.edgeHandlers[t].redraw()}isCustomHandleVisible(t){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}getRotationHandlePosition(){return new Point.A(this.bounds.x+this.bounds.width/2,this.bounds.y+this.rotationHandleVSpacing)}isParentHighlightVisible(){const t=this.state.cell.getParent();return!!t&&!this.graph.isCellSelected(t)}updateParentHighlight(){if(!this.isDestroyed()){const t=this.isParentHighlightVisible(),e=this.state.cell.getParent(),i=e?this.graph.view.getState(e):null;if(this.parentHighlight)if(e&&e.isVertex()&&t){const t=this.parentHighlight.bounds;i&&t&&(t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&(this.parentHighlight.bounds=Rectangle.A.fromRectangle(i),this.parentHighlight.redraw())}else null!=i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&t&&e&&e.isVertex()&&null!=i&&null==i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=Constants.DIALECT.SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=i.style.rotation??0,this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}drawPreview(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode===this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=this.state.style.rotation??0,this.preview.redraw()),this.selectionBorder.bounds=this.getSelectionBorderBounds(),this.selectionBorder.redraw(),this.updateParentHighlight()}getSelectionBorderBounds(){return this.bounds}isDestroyed(){return null==this.selectionBorder}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=()=>{},this.preview&&(this.preview.destroy(),this.preview=null),this.parentHighlight){const t=this.state.cell.getParent(),e=t?this.graph.view.getState(t):null;e&&e.parentHighlight===this.parentHighlight&&(e.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.selectionBorder&&this.selectionBorder.destroy(),this.labelShape=null,this.removeHint();for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].destroy();this.sizers=[];for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].destroy();this.customHandles=[]}}const handler_VertexHandler=VertexHandler;var Translations=__webpack_require__(2593);class ElbowEdgeHandler extends handler_EdgeHandler{constructor(t){super(t),this.flipEnabled=!0,this.doubleClickOrientationResource="none"!==Client.A.language?"doubleClickOrientation":""}createBends(){const t=[];let e=this.createHandleShape(0);return this.initBend(e),e.setCursor(Constants.CURSOR.TERMINAL_HANDLE),t.push(e),t.push(this.createVirtualBend((t=>{!(0,EventUtils.isConsumed)(t)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell),InternalEvent.A.consume(t))}))),this.points.push(new Point.A(0,0)),e=this.createHandleShape(2),this.initBend(e),e.setCursor(Constants.CURSOR.TERMINAL_HANDLE),t.push(e),t}createVirtualBend(t){const e=this.createHandleShape();return this.initBend(e,t),e.setCursor(this.getCursorForBend()),this.graph.isCellBendable(this.state.cell)||(e.node.style.display="none"),e}getCursorForBend(){return this.state.style.edgeStyle===Constants.EDGESTYLE.TOPTOBOTTOM||this.state.style.edgeStyle===Constants.EDGESTYLE.ELBOW&&this.state.style.elbow===Constants.ELBOW.VERTICAL?"row-resize":"col-resize"}getTooltipForNode(t){let e=null;return null==this.bends||null==this.bends[1]||t!==this.bends[1].node&&t.parentNode!==this.bends[1].node||(e=this.doubleClickOrientationResource,e=Translations.A.get(e)||e),e}convertPoint(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate(),{origin:n}=this.state;return e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/i-s.x-n.x),t.y=Math.round(t.y/i-s.y-n.y),t}redrawInnerBends(t,e){const i=this.state.cell.getGeometry(),s=this.state.absolutePoints;let n=null;s.length>1?(t=s[1],e=s[s.length-2]):null!=i.points&&i.points.length>0&&(n=s[0]),n=null==n?new Point.A(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2):new Point.A(this.graph.getView().scale*(n.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(n.y+this.graph.getView().translate.y+this.state.origin.y));const l=this.bends[1].bounds;let r=l.width,a=l.height,o=new Rectangle.A(Math.round(n.x-r/2),Math.round(n.y-a/2),r,a);this.manageLabelHandle?this.checkLabelHandle(o):null==this.handleImage&&this.labelShape.visible&&this.labelShape.bounds&&(0,mathUtils.intersects)(o,this.labelShape.bounds)&&(r=HandleConfig.size+3,a=r,o=new Rectangle.A(Math.floor(n.x-r/2),Math.floor(n.y-a/2),r,a)),this.bends[1].bounds=o,this.bends[1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)}}const handler_ElbowEdgeHandler=ElbowEdgeHandler;class EdgeSegmentHandler extends handler_ElbowEdgeHandler{constructor(t){super(t),this.points=[]}getCurrentPoints(){let t=this.state.absolutePoints;const e=Math.max(1,this.graph.view.scale);if(2===t.length&&t[0]&&t[1]||3===t.length&&t[0]&&t[1]&&t[2]&&(Math.abs(t[0].x-t[1].x)<e&&Math.abs(t[1].x-t[2].x)<e||Math.abs(t[0].y-t[1].y)<e&&Math.abs(t[1].y-t[2].y)<e)){const e=t[0].x+(t[t.length-1].x-t[0].x)/2,i=t[0].y+(t[t.length-1].y-t[0].y)/2;t=[t[0],new Point.A(e,i),new Point.A(e,i),t[t.length-1]]}return t}getPreviewPoints(t){if(this.isSource||this.isTarget)return super.getPreviewPoints(t);const e=this.getCurrentPoints();let i=this.convertPoint(e[0].clone(),!1);t=this.convertPoint(t.clone(),!1);let s=[];for(let n=1;n<e.length;n+=1){const l=this.convertPoint(e[n].clone(),!1);n===this.index&&(0===Math.round(i.x-l.x)&&(i.x=t.x,l.x=t.x),0===Math.round(i.y-l.y)&&(i.y=t.y,l.y=t.y)),n<e.length-1&&s.push(l),i=l}if(1===s.length){const e=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),n=this.state.view.getScale(),l=this.state.view.getTranslate(),r=s[0].x*n+l.x,a=s[0].y*n+l.y;(null!=e&&(0,mathUtils.contains)(e,r,a)||null!=i&&(0,mathUtils.contains)(i,r,a))&&(s=[t,t])}return s}updatePreviewState(t,e,i,s){if(super.updatePreviewState(t,e,i,s),!this.isSource&&!this.isTarget){e=this.convertPoint(e.clone(),!1);const i=t.absolutePoints;let s=i[0],n=i[1],l=[];for(let t=2;t<i.length;t+=1){const e=i[t];0===Math.round(s.x-n.x)&&0===Math.round(n.x-e.x)||0===Math.round(s.y-n.y)&&0===Math.round(n.y-e.y)||l.push(this.convertPoint(n.clone(),!1)),s=n,n=e}const r=this.state.getVisibleTerminalState(!0),a=this.state.getVisibleTerminalState(!1),o=this.state.absolutePoints,h=i[i.length-1];if(0===l.length&&i[0]&&h&&(0===Math.round(i[0].x-h.x)||0===Math.round(i[0].y-h.y)))l=[e,e];else if(5===i.length&&2===l.length&&null!=r&&null!=a&&null!=o&&0===Math.round(o[0].x-o[o.length-1].x)){const i=this.graph.getView(),s=i.getScale(),n=i.getTranslate();let o=i.getRoutingCenterY(r)/s-n.y;const h=this.graph.getConnectionConstraint(t,r,!0);if(null!=h){const t=this.graph.getConnectionPoint(r,h);null!=t&&(this.convertPoint(t,!1),o=t.y)}let d=i.getRoutingCenterY(a)/s-n.y;const c=this.graph.getConnectionConstraint(t,a,!1);if(c){const t=this.graph.getConnectionPoint(a,c);null!=t&&(this.convertPoint(t,!1),d=t.y)}l=[new Point.A(e.x,o),new Point.A(e.x,d)]}this.points=l,t.view.updateFixedTerminalPoints(t,r,a),t.view.updatePoints(t,this.points,r,a),t.view.updateFloatingTerminalPoints(t,r,a)}}connect(t,e,i,s,n){const l=this.graph.getDataModel();let r=t.getGeometry(),a=null;if(null!=r&&null!=r.points&&r.points.length>0){const t=this.abspoints;let e=t[0],i=t[1];a=[];for(let s=2;s<t.length;s+=1){const n=t[s];!(e&&i&&n)||0===Math.round(e.x-i.x)&&0===Math.round(i.x-n.x)||0===Math.round(e.y-i.y)&&0===Math.round(i.y-n.y)||a.push(this.convertPoint(i.clone(),!1)),e=i,i=n}}return this.graph.batchUpdate((()=>{null!=a&&(r=t.getGeometry(),null!=r&&(r=r.clone(),r.points=a,l.setGeometry(t,r))),t=super.connect(t,e,i,s,n)})),t}getTooltipForNode(t){return null}start(t,e,i){super.start(t,e,i),null==this.bends||null==this.bends[i]||this.isSource||this.isTarget||(0,styleUtils.setOpacity)(this.bends[i].node,100)}createBends(){const t=[];let e=this.createHandleShape(0);this.initBend(e),e.setCursor(Constants.CURSOR.TERMINAL_HANDLE),t.push(e);const i=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(let s=0;s<i.length-1;s+=1){e=this.createVirtualBend(),t.push(e);let n=0===Math.round(i[s].x-i[s+1].x);0===Math.round(i[s].y-i[s+1].y)&&s<i.length-2&&(n=0===Math.round(i[s].x-i[s+2].x)),e.setCursor(n?"col-resize":"row-resize"),this.points.push(new Point.A(0,0))}}return e=this.createHandleShape(i.length),this.initBend(e),e.setCursor(Constants.CURSOR.TERMINAL_HANDLE),t.push(e),t}redraw(){this.refresh(),super.redraw()}redrawInnerBends(t,e){if(this.graph.isCellBendable(this.state.cell)){const i=this.getCurrentPoints();if(null!=i&&i.length>1){let s=!1;if(4===i.length&&i[0]&&i[1]&&i[2]&&i[3]&&0===Math.round(i[1].x-i[2].x)&&0===Math.round(i[1].y-i[2].y))if(s=!0,0===Math.round(i[0].y-i[i.length-1].y)){const t=i[0].x+(i[i.length-1].x-i[0].x)/2;i[1]=new Point.A(t,i[1].y),i[2]=new Point.A(t,i[2].y)}else{const t=i[0].y+(i[i.length-1].y-i[0].y)/2;i[1]=new Point.A(i[1].x,t),i[2]=new Point.A(i[2].x,t)}for(let s=0;s<i.length-1;s+=1)if(null!=this.bends[s+1]){t=i[s],e=i[s+1];const n=new Point.A(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2),l=this.bends[s+1].bounds;this.bends[s+1].bounds=new Rectangle.A(Math.floor(n.x-l.width/2),Math.floor(n.y-l.height/2),l.width,l.height),this.bends[s+1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[s+1].bounds)}s&&((0,styleUtils.setOpacity)(this.bends[1].node,this.virtualBendOpacity),(0,styleUtils.setOpacity)(this.bends[3].node,this.virtualBendOpacity))}}}}const handler_EdgeSegmentHandler=EdgeSegmentHandler;class SelectionChange{constructor(t,e=[],i=[]){this.graph=t,this.added=e.slice(),this.removed=i.slice()}execute(){const t=this.graph.getSelectionModel();for(const e of this.removed)t.cellRemoved(e);for(const e of this.added)t.cellAdded(e);[this.added,this.removed]=[this.removed,this.added],t.fireEvent(new EventObject.A(InternalEvent.A.CHANGE,{added:this.added,removed:this.removed}))}}const undoable_changes_SelectionChange=SelectionChange;class GraphSelectionModel extends EventSource.A{constructor(t){super(),this.doneResource="none"!==Client.A.language?"done":"",this.updatingSelectionResource="none"!==Client.A.language?"updatingSelection":"",this.singleSelection=!1,this.graph=t,this.cells=[]}isSingleSelection(){return this.singleSelection}setSingleSelection(t){this.singleSelection=t}isSelected(t){return this.cells.indexOf(t)>=0}isEmpty(){return 0===this.cells.length}clear(){this.changeSelection(null,this.cells)}setCell(t){this.setCells(t?[t]:[])}setCells(t){this.singleSelection&&(t=[this.getFirstSelectableCell(t)]);const e=[];for(let i=0;i<t.length;i+=1)this.graph.isCellSelectable(t[i])&&e.push(t[i]);this.changeSelection(e,this.cells)}getFirstSelectableCell(t){for(let e=0;e<t.length;e+=1)if(this.graph.isCellSelectable(t[e]))return t[e];return null}addCell(t){this.addCells([t])}addCells(t){let e=null;if(this.singleSelection){e=this.cells;const i=this.getFirstSelectableCell(t);t=i?[i]:[]}const i=[];for(let e=0;e<t.length;e+=1)!this.isSelected(t[e])&&this.graph.isCellSelectable(t[e])&&i.push(t[e]);this.changeSelection(i,e)}removeCell(t){this.removeCells([t])}removeCells(t){const e=[];for(let i=0;i<t.length;i+=1)this.isSelected(t[i])&&e.push(t[i]);this.changeSelection(null,e)}changeSelection(t=null,e=null){if(t&&t.length>0&&t[0]||e&&e.length>0&&e[0]){const i=new undoable_changes_SelectionChange(this.graph,t||[],e||[]);i.execute();const s=new UndoableEdit.A(this.graph,!1);s.add(i),this.fireEvent(new EventObject.A(InternalEvent.A.UNDO,{edit:s}))}}cellAdded(t){this.isSelected(t)||this.cells.push(t)}cellRemoved(t){const e=this.cells.indexOf(t);e>=0&&this.cells.splice(e,1)}}const view_GraphSelectionModel=GraphSelectionModel;class RhombusShape extends Shape.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isRoundable(){return!0}paintVertexShape(t,e,i,s,n){const l=s/2,r=n/2,a=(this.style?.arcSize??Constants.LINE_ARCSIZE)/2;t.begin(),this.addPoints(t,[new Point.A(e+l,i),new Point.A(e+s,i+r),new Point.A(e+l,i+n),new Point.A(e,i+r)],this.isRounded,a,!0),t.fillAndStroke()}}const node_RhombusShape=RhombusShape;class CylinderShape extends Shape.A{constructor(t,e,i,s=1){super(),this.maxHeight=40,this.svgStrokeTolerance=0,this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.translate(e,i),t.begin(),this.redrawPath(t,e,i,s,n,!1),t.fillAndStroke(),this.outline&&this.style&&this.style.backgroundOutline||(t.setShadow(!1),t.begin(),this.redrawPath(t,e,i,s,n,!0),t.stroke())}getCylinderSize(t,e,i,s){return Math.min(this.maxHeight,Math.round(s/5))}redrawPath(t,e,i,s,n,l=!1){const r=this.getCylinderSize(e,i,s,n);(l&&this.fill!==Constants.NONE||!l&&this.fill===Constants.NONE)&&(t.moveTo(0,r),t.curveTo(0,2*r,s,2*r,s,r),l||(t.stroke(),t.begin())),l||(t.moveTo(0,r),t.curveTo(0,-r/3,s,-r/3,s,r),t.lineTo(s,n-r),t.curveTo(s,n+r/3,0,n+r/3,0,n-r),t.close())}}const node_CylinderShape=CylinderShape;class ActorShape extends Shape.A{constructor(t=null,e=Constants.NONE,i=Constants.NONE,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.translate(e,i),t.begin(),this.redrawPath(t,e,i,s,n),t.fillAndStroke()}redrawPath(t,e,i,s,n){const l=s/3;t.moveTo(0,n),t.curveTo(0,3*n/5,0,2*n/5,s/2,2*n/5),t.curveTo(s/2-l,2*n/5,s/2-l,0,s/2,0),t.curveTo(s/2+l,0,s/2+l,2*n/5,s/2,2*n/5),t.curveTo(s,2*n/5,s,3*n/5,s,n),t.close()}}const geometry_ActorShape=ActorShape;class TriangleShape extends geometry_ActorShape{constructor(){super()}isRoundable(){return!0}redrawPath(t,e,i,s,n){const l=(this.style?.arcSize??Constants.LINE_ARCSIZE)/2;this.addPoints(t,[new Point.A(0,0),new Point.A(s,.5*n),new Point.A(0,n)],this.isRounded,l,!0)}}const node_TriangleShape=TriangleShape;class HexagonShape extends geometry_ActorShape{constructor(){super()}redrawPath(t,e,i,s,n){const l=(this.style?.arcSize??Constants.LINE_ARCSIZE)/2;this.addPoints(t,[new Point.A(.25*s,0),new Point.A(.75*s,0),new Point.A(s,.5*n),new Point.A(.75*s,n),new Point.A(.25*s,n),new Point.A(0,.5*n)],this.isRounded,l,!0)}}const node_HexagonShape=HexagonShape;class CloudShape extends geometry_ActorShape{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}redrawPath(t,e,i,s,n){t.moveTo(.25*s,.25*n),t.curveTo(.05*s,.25*n,0,.5*n,.16*s,.55*n),t.curveTo(0,.66*n,.18*s,.9*n,.31*s,.8*n),t.curveTo(.4*s,n,.7*s,n,.8*s,.8*n),t.curveTo(s,.8*n,s,.6*n,.875*s,.5*n),t.curveTo(s,.3*n,.8*s,.1*n,.625*s,.2*n),t.curveTo(.5*s,.05*n,.3*s,.05*n,.25*s,.25*n),t.close()}}const node_CloudShape=CloudShape;class LineShape extends Shape.A{constructor(t,e,i=1,s=!1){super(),this.bounds=t,this.stroke=e,this.strokeWidth=i,this.vertical=s}paintVertexShape(t,e,i,s,n){if(t.begin(),this.vertical){const l=e+s/2;t.moveTo(l,i),t.lineTo(l,i+n)}else{const l=i+n/2;t.moveTo(e,l),t.lineTo(e+s,l)}t.stroke()}}const edge_LineShape=LineShape;class ArrowShape extends Shape.A{constructor(t,e,i,s=1,n=Constants.ARROW_WIDTH,l=Constants.ARROW_SPACING,r=Constants.ARROW_SIZE){super(),this.points=t,this.fill=e,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.spacing=l,this.endSize=r}augmentBoundingBox(t){super.augmentBoundingBox(t);const e=Math.max(this.arrowWidth,this.endSize);t.grow((e/2+this.strokeWidth)*this.scale)}paintEdgeShape(t,e){const i=Constants.ARROW_SPACING,s=Constants.ARROW_WIDTH,n=Constants.ARROW_SIZE,l=e[0],r=e[e.length-1],a=r.x-l.x,o=r.y-l.y,h=Math.sqrt(a*a+o*o),d=h-2*i-n,c=a/h,u=o/h,g=d*c,p=d*u,E=s*u/3,C=-s*c/3,m=l.x-E/2+i*c,f=l.y-C/2+i*u,y=m+E,v=f+C,A=y+g,_=v+p,b=A+E,S=_+C,w=b-3*E,x=S-3*C;t.begin(),t.moveTo(m,f),t.lineTo(y,v),t.lineTo(A,_),t.lineTo(b,S),t.lineTo(r.x-i*c,r.y-i*u),t.lineTo(w,x),t.lineTo(w+E,x+C),t.close(),t.fillAndStroke()}}const edge_ArrowShape=ArrowShape;class ArrowConnectorShape extends Shape.A{constructor(t,e,i,s=1,n=Constants.ARROW_WIDTH,l=Constants.ARROW_SPACING,r=Constants.ARROW_SIZE/5){super(),this.useSvgBoundingBox=!0,this.points=t,this.fill=e,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.arrowSpacing=l,this.startSize=Constants.ARROW_SIZE/5,this.endSize=r}isRoundable(){return!0}resetStyles(){super.resetStyles(),this.arrowSpacing=Constants.ARROW_SPACING}apply(t){super.apply(t),this.style&&null!=this.style.startSize&&null!=this.style.endSize&&(this.startSize=3*this.style.startSize,this.endSize=3*this.style.endSize)}augmentBoundingBox(t){super.augmentBoundingBox(t);let e=this.getEdgeWidth();this.isMarkerStart()&&(e=Math.max(e,this.getStartArrowWidth())),this.isMarkerEnd()&&(e=Math.max(e,this.getEndArrowWidth())),t.grow((e/2+this.strokeWidth)*this.scale)}paintEdgeShape(t,e){let i=this.strokeWidth;this.outline&&(i=Math.max(1,this.style?.strokeWidth??0));const s=this.getStartArrowWidth()+i,n=this.getEndArrowWidth()+i,l=this.outline?this.getEdgeWidth()+i:this.getEdgeWidth(),r=this.isOpenEnded(),a=this.isMarkerStart(),o=this.isMarkerEnd(),h=r?0:this.arrowSpacing+i/2,d=this.startSize+i,c=this.endSize+i,u=this.isArrowRounded(),g=e[e.length-1];let p=1;for(;p<e.length-1&&e[p].x===e[0].x&&e[p].y===e[0].y;)p++;const E=e[p].x-e[0].x,C=e[p].y-e[0].y,m=Math.sqrt(E*E+C*C);if(0===m)return;let f,y,v=E/m,A=v,_=C/m,b=_,S=l*_,w=-l*v;const x=[];u?t.setLineJoin("round"):e.length>2&&t.setMiterLimit(1.42),t.begin();const T=v,M=_;if(a&&!r)this.paintMarker(t,e[0].x,e[0].y,v,_,d,s,l,h,!0);else{const i=e[0].x+S/2+h*v,s=e[0].y+w/2+h*_,n=e[0].x-S/2+h*v,l=e[0].y-w/2+h*_;r?(t.moveTo(i,s),x.push((()=>{t.lineTo(n,l)}))):(t.moveTo(n,l),t.lineTo(i,s))}let P=0,I=0,O=0;for(let i=0;i<e.length-2;i+=1){const s=(0,mathUtils.relativeCcw)(e[i].x,e[i].y,e[i+1].x,e[i+1].y,e[i+2].x,e[i+2].y);if(P=e[i+2].x-e[i+1].x,I=e[i+2].y-e[i+1].y,O=Math.sqrt(P*P+I*I),0!==O){A=P/O,b=I/O;const n=v*A+_*b,r=Math.max(Math.sqrt((n+1)/2),.04);f=v+A,y=_+b;const a=Math.sqrt(f*f+y*y);if(0!==a){f/=a,y/=a;const n=Math.max(r,Math.min(this.strokeWidth/200+.04,.35)),o=0!==s&&u?Math.max(.1,n):Math.max(r,.06),h=e[i+1].x+y*l/2/o,d=e[i+1].y-f*l/2/o,c=e[i+1].x-y*l/2/o,g=e[i+1].y+f*l/2/o;if(0!==s&&u)if(-1===s){const e=c+_*l,i=g-v*l,s=c+b*l,n=g-A*l;t.lineTo(e,i),t.quadTo(h,d,s,n),((e,i)=>{x.push((()=>{t.lineTo(e,i)}))})(c,g)}else t.lineTo(h,d),((e,i)=>{const s=h-_*l,n=d+v*l,r=h-b*l,a=d+A*l;x.push((()=>{t.quadTo(e,i,s,n)})),x.push((()=>{t.lineTo(r,a)}))})(c,g);else t.lineTo(h,d),((e,i)=>{x.push((()=>{t.lineTo(e,i)}))})(c,g);v=A,_=b}}}if(S=l*b,w=-l*A,o&&!r)this.paintMarker(t,g.x,g.y,-v,-_,c,n,l,h,!1);else{t.lineTo(g.x-h*A+S/2,g.y-h*b+w/2);const e=g.x-h*A-S/2,i=g.y-h*b-w/2;r?(t.moveTo(e,i),x.splice(0,0,(()=>{t.moveTo(e,i)}))):t.lineTo(e,i)}for(let t=x.length-1;t>=0;t--)x[t]();r?(t.end(),t.stroke()):(t.close(),t.fillAndStroke()),t.setShadow(!1),t.setMiterLimit(4),u&&t.setLineJoin("flat"),e.length>2&&(t.setMiterLimit(4),a&&!r&&(t.begin(),this.paintMarker(t,e[0].x,e[0].y,T,M,d,s,l,h,!0),t.stroke(),t.end()),o&&!r&&(t.begin(),this.paintMarker(t,g.x,g.y,-v,-_,c,n,l,h,!0),t.stroke(),t.end()))}paintMarker(t,e,i,s,n,l,r,a,o,h){const d=a/r,c=a*n/2,u=-a*s/2,g=(o+l)*s,p=(o+l)*n;h?t.moveTo(e-c+g,i-u+p):t.lineTo(e-c+g,i-u+p),t.lineTo(e-c/d+g,i-u/d+p),t.lineTo(e+o*s,i+o*n),t.lineTo(e+c/d+g,i+u/d+p),t.lineTo(e+c+g,i+u+p)}isArrowRounded(){return this.isRounded}getStartArrowWidth(){return Constants.ARROW_WIDTH}getEndArrowWidth(){return Constants.ARROW_WIDTH}getEdgeWidth(){return Constants.ARROW_WIDTH/3}isOpenEnded(){return!1}isMarkerStart(){return(this.style?.startArrow??Constants.NONE)!==Constants.NONE}isMarkerEnd(){return(this.style?.endArrow??Constants.NONE)!==Constants.NONE}}const edge_ArrowConnectorShape=ArrowConnectorShape;class DoubleEllipseShape extends Shape.A{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintBackground(t,e,i,s,n){t.ellipse(e,i,s,n),t.fillAndStroke()}paintForeground(t,e,i,s,n){if(!this.outline){const l=this.style?.margin??Math.min(3+this.strokeWidth,Math.min(s/5,n/5));e+=l,i+=l,n-=2*l,(s-=2*l)>0&&n>0&&t.ellipse(e,i,s,n),t.stroke()}}getLabelBounds(t){const e=this.style?.margin??Math.min(3+this.strokeWidth,Math.min(t.width/5/this.scale,t.height/5/this.scale))*this.scale;return new Rectangle.A(t.x+e,t.y+e,t.width-2*e,t.height-2*e)}}const node_DoubleEllipseShape=DoubleEllipseShape;class SwimlaneShape extends Shape.A{constructor(t,e,i,s=1){super(),this.imageSize=16,this.imageSrc=null,this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isRoundable(t,e,i,s,n){return!0}getTitleSize(){return Math.max(0,this.style?.startSize??Constants.DEFAULT_STARTSIZE)}getLabelBounds(t){const e=this.getTitleSize(),i=new Rectangle.A(t.x,t.y,t.width,t.height),s=this.isHorizontal(),n=this.style?.flipH??!1,l=this.style?.flipV??!1,r=this.direction===Constants.DIRECTION.NORTH||this.direction===Constants.DIRECTION.SOUTH,a=s==!r,o=!a&&n!==(this.direction===Constants.DIRECTION.SOUTH||this.direction===Constants.DIRECTION.WEST),h=a&&l!==(this.direction===Constants.DIRECTION.SOUTH||this.direction===Constants.DIRECTION.WEST);if(r){const t=Math.min(i.width,e*this.scale);(o||h)&&(i.x+=i.width-t),i.width=t}else{const t=Math.min(i.height,e*this.scale);(o||h)&&(i.y+=i.height-t),i.height=t}return i}getGradientBounds(t,e,i,s,n){let l=this.getTitleSize();return this.isHorizontal()?(l=Math.min(l,n),new Rectangle.A(e,i,s,l)):(l=Math.min(l,s),new Rectangle.A(e,i,l,n))}getSwimlaneArcSize(t,e,i){return this.style?.absoluteArcSize?Math.min(t/2,Math.min(e/2,this.style?.arcSize??Constants.LINE_ARCSIZE/2)):i*((this.style?.arcSize??100*Constants.RECTANGLE_ROUNDING_FACTOR)/100)*3}isHorizontal(){return this.style?.horizontal??!0}paintVertexShape(t,e,i,s,n){let l=this.getTitleSize();const r=this.style?.swimlaneFillColor??Constants.NONE,a=this.style?.swimlaneLine??!0;let o=0;l=this.isHorizontal()?Math.min(l,n):Math.min(l,s),t.translate(e,i),this.isRounded?(o=this.getSwimlaneArcSize(s,n,l),o=Math.min((this.isHorizontal()?n:s)-l,Math.min(l,o)),this.paintRoundedSwimlane(t,e,i,s,n,l,o,r,a)):this.paintSwimlane(t,e,i,s,n,l,r,a);const h=this.style?.separatorColor??Constants.NONE;if(this.paintSeparator(t,e,i,s,n,l,h),this.imageSrc){const l=this.getImageBounds(e,i,s,n);t.image(l.x-e,l.y-i,l.width,l.height,this.imageSrc,!1,!1,!1)}this.glass&&(t.setShadow(!1),this.paintGlassEffect(t,0,0,s,l,o))}paintSwimlane(t,e,i,s,n,l,r,a){t.begin();let o=!0;this.style&&null!=this.style.pointerEvents&&(o=this.style.pointerEvents),o||this.fill!==Constants.NONE||(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(0,l),t.lineTo(0,0),t.lineTo(s,0),t.lineTo(s,l),t.fillAndStroke(),l<n&&(r!==Constants.NONE&&o||(t.pointerEvents=!1),r!==Constants.NONE&&t.setFillColor(r),t.begin(),t.moveTo(0,l),t.lineTo(0,n),t.lineTo(s,n),t.lineTo(s,l),r===Constants.NONE?t.stroke():t.fillAndStroke())):(t.moveTo(l,0),t.lineTo(0,0),t.lineTo(0,n),t.lineTo(l,n),t.fillAndStroke(),l<s&&(r!==Constants.NONE&&o||(t.pointerEvents=!1),r!==Constants.NONE&&t.setFillColor(r),t.begin(),t.moveTo(l,0),t.lineTo(s,0),t.lineTo(s,n),t.lineTo(l,n),r===Constants.NONE?t.stroke():t.fillAndStroke())),a&&this.paintDivider(t,e,i,s,n,l,r===Constants.NONE)}paintRoundedSwimlane(t,e,i,s,n,l,r,a,o){t.begin();let h=!0;this.style&&null!=this.style.pointerEvents&&(h=this.style.pointerEvents),h||this.fill!==Constants.NONE||(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(s,l),t.lineTo(s,r),t.quadTo(s,0,s-Math.min(s/2,r),0),t.lineTo(Math.min(s/2,r),0),t.quadTo(0,0,0,r),t.lineTo(0,l),t.fillAndStroke(),l<n&&(a!==Constants.NONE&&h||(t.pointerEvents=!1),a!==Constants.NONE&&t.setFillColor(a),t.begin(),t.moveTo(0,l),t.lineTo(0,n-r),t.quadTo(0,n,Math.min(s/2,r),n),t.lineTo(s-Math.min(s/2,r),n),t.quadTo(s,n,s,n-r),t.lineTo(s,l),a===Constants.NONE?t.stroke():t.fillAndStroke())):(t.moveTo(l,0),t.lineTo(r,0),t.quadTo(0,0,0,Math.min(n/2,r)),t.lineTo(0,n-Math.min(n/2,r)),t.quadTo(0,n,r,n),t.lineTo(l,n),t.fillAndStroke(),l<s&&(a!==Constants.NONE&&h||(t.pointerEvents=!1),a!==Constants.NONE&&t.setFillColor(a),t.begin(),t.moveTo(l,n),t.lineTo(s-r,n),t.quadTo(s,n,s,n-Math.min(n/2,r)),t.lineTo(s,Math.min(n/2,r)),t.quadTo(s,0,s-r,0),t.lineTo(l,0),a===Constants.NONE?t.stroke():t.fillAndStroke())),o&&this.paintDivider(t,e,i,s,n,l,a===Constants.NONE)}paintDivider(t,e,i,s,n,l,r){r||t.setShadow(!1),t.begin(),this.isHorizontal()?(t.moveTo(0,l),t.lineTo(s,l)):(t.moveTo(l,0),t.lineTo(l,n)),t.stroke()}paintSeparator(t,e,i,s,n,l,r){r!==Constants.NONE&&(t.setStrokeColor(r),t.setDashed(!0),t.begin(),this.isHorizontal()?(t.moveTo(s,l),t.lineTo(s,n)):(t.moveTo(l,0),t.lineTo(s,0)),t.stroke(),t.setDashed(!1))}getImageBounds(t,e,i,s){return this.isHorizontal()?new Rectangle.A(t+i-this.imageSize,e,this.imageSize,this.imageSize):new Rectangle.A(t,e,this.imageSize,this.imageSize)}}const node_SwimlaneShape=SwimlaneShape;class LabelShape extends RectangleShape.A{constructor(t,e,i,s){super(t,e,i,s),this.imageSize=Constants.DEFAULT_IMAGESIZE,this.imageSrc=null,this.spacing=2,this.indicatorSize=10,this.indicatorSpacing=2,this.indicatorImageSrc=null}init(t){super.init(t),this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))}redraw(){this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.redraw()),super.redraw()}isHtmlAllowed(){return super.isHtmlAllowed()&&this.indicatorColor===Constants.NONE&&!!this.indicatorShape}paintForeground(t,e,i,s,n){this.paintImage(t,e,i,s,n),this.paintIndicator(t,e,i,s,n),super.paintForeground(t,e,i,s,n)}paintImage(t,e,i,s,n){if(this.imageSrc){const l=this.getImageBounds(e,i,s,n);t.image(l.x,l.y,l.width,l.height,this.imageSrc,!1,!1,!1)}}getImageBounds(t,e,i,s){const n=this.style?.imageAlign??Constants.ALIGN.LEFT,l=this.style?.verticalAlign??Constants.ALIGN.MIDDLE,r=this.style?.imageWidth??Constants.DEFAULT_IMAGESIZE,a=this.style?.imageHeight??Constants.DEFAULT_IMAGESIZE,o=this.style?.spacing??this.spacing+5;return n===Constants.ALIGN.CENTER?t+=(i-r)/2:n===Constants.ALIGN.RIGHT?t+=i-r-o:t+=o,l===Constants.ALIGN.TOP?e+=o:l===Constants.ALIGN.BOTTOM?e+=s-a-o:e+=(s-a)/2,new Rectangle.A(t,e,r,a)}paintIndicator(t,e,i,s,n){if(this.indicator)this.indicator.bounds=this.getIndicatorBounds(e,i,s,n),this.indicator.paint(t);else if(this.indicatorImageSrc){const l=this.getIndicatorBounds(e,i,s,n);t.image(l.x,l.y,l.width,l.height,this.indicatorImageSrc,!1,!1,!1)}}getIndicatorBounds(t,e,i,s){const n=this.style?.imageAlign??Constants.ALIGN.LEFT,l=this.style?.verticalAlign??Constants.ALIGN.MIDDLE,r=this.style?.indicatorWidth??this.indicatorSize,a=this.style?.indicatorHeight??this.indicatorSize,o=this.spacing+5;return n===Constants.ALIGN.RIGHT?t+=i-r-o:n===Constants.ALIGN.CENTER?t+=(i-r)/2:t+=o,l===Constants.ALIGN.BOTTOM?e+=s-a-o:l===Constants.ALIGN.TOP?e+=o:e+=(s-a)/2,new Rectangle.A(t,e,r,a)}redrawHtmlShape(){for(super.redrawHtmlShape();this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(this.imageSrc&&this.bounds){const t=document.createElement("img");t.style.position="relative",t.setAttribute("border","0");const e=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);e.x-=this.bounds.x,e.y-=this.bounds.y,t.style.left=`${Math.round(e.x)}px`,t.style.top=`${Math.round(e.y)}px`,t.style.width=`${Math.round(e.width)}px`,t.style.height=`${Math.round(e.height)}px`,t.src=this.imageSrc,this.node.appendChild(t)}}}const node_LabelShape=LabelShape;let isDefaultElementsRegistered=!1;function registerDefaultShapes(){if(!isDefaultElementsRegistered){const t=[[Constants.SHAPE.ACTOR,geometry_ActorShape],[Constants.SHAPE.ARROW,edge_ArrowShape],[Constants.SHAPE.ARROW_CONNECTOR,edge_ArrowConnectorShape],[Constants.SHAPE.CONNECTOR,edge_ConnectorShape],[Constants.SHAPE.CLOUD,node_CloudShape],[Constants.SHAPE.CYLINDER,node_CylinderShape],[Constants.SHAPE.DOUBLE_ELLIPSE,node_DoubleEllipseShape],[Constants.SHAPE.ELLIPSE,node_EllipseShape],[Constants.SHAPE.HEXAGON,node_HexagonShape],[Constants.SHAPE.IMAGE,ImageShape.A],[Constants.SHAPE.LABEL,node_LabelShape],[Constants.SHAPE.LINE,edge_LineShape],[Constants.SHAPE.RECTANGLE,RectangleShape.A],[Constants.SHAPE.RHOMBUS,node_RhombusShape],[Constants.SHAPE.SWIMLANE,node_SwimlaneShape],[Constants.SHAPE.TRIANGLE,node_TriangleShape]];for(const[e,i]of t)cell_CellRenderer.registerShape(e,i);isDefaultElementsRegistered=!0}}const EllipsePerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,r=t.width/2,a=t.height/2,o=n+r,h=l+a,d=i.x,c=i.y,u=parseInt(String(d-o)),g=parseInt(String(c-h));if(0===u&&0!==g)return new Point.A(o,h+a*g/Math.abs(g));if(0===u&&0===g)return new Point.A(d,c);if(s){if(c>=l&&c<=l+t.height){const t=c-h;let e=Math.sqrt(r*r*(1-t*t/(a*a)))||0;return d<=n&&(e=-e),new Point.A(o+e,c)}if(d>=n&&d<=n+t.width){const t=d-o;let e=Math.sqrt(a*a*(1-t*t/(r*r)))||0;return c<=l&&(e=-e),new Point.A(d,h+e)}}const p=g/u,E=h-p*o,C=r*r*p*p+a*a,m=-2*o*C,f=r*r*p*p*o*o+a*a*o*o-r*r*a*a,y=Math.sqrt(m*m-4*C*f),v=(-m+y)/(2*C),A=(-m-y)/(2*C),_=p*v+E,b=p*A+E;let S=0,w=0;return Math.sqrt(Math.pow(v-d,2)+Math.pow(_-c,2))<Math.sqrt(Math.pow(A-d,2)+Math.pow(b-c,2))?(S=v,w=_):(S=A,w=b),new Point.A(S,w)},HexagonPerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,r=t.width,a=t.height,o=t.getCenterX(),h=t.getCenterY(),d=i.x,c=i.y,u=d-o,g=c-h,p=-Math.atan2(g,u),E=Math.PI,C=Math.PI/2;let m=new Point.A(o,h);const f=e?.style?.direction??Constants.DIRECTION.EAST,y=f===Constants.DIRECTION.NORTH||f===Constants.DIRECTION.SOUTH;let v=new Point.A,A=new Point.A;if((d<n&&c<l||d<n&&c>l+a||d>n+r&&c<l||d>n+r&&c>l+a)&&(s=!1),s){if(y){if(d===o){if(c<=l)return new Point.A(o,l);if(c>=l+a)return new Point.A(o,l+a)}else if(d<n){if(c===l+a/4)return new Point.A(n,l+a/4);if(c===l+3*a/4)return new Point.A(n,l+3*a/4)}else if(d>n+r){if(c===l+a/4)return new Point.A(n+r,l+a/4);if(c===l+3*a/4)return new Point.A(n+r,l+3*a/4)}else if(d===n){if(c<h)return new Point.A(n,l+a/4);if(c>h)return new Point.A(n,l+3*a/4)}else if(d===n+r){if(c<h)return new Point.A(n+r,l+a/4);if(c>h)return new Point.A(n+r,l+3*a/4)}if(c===l)return new Point.A(o,l);if(c===l+a)return new Point.A(o,l+a);d<o?c>l+a/4&&c<l+3*a/4?(v=new Point.A(n,l),A=new Point.A(n,l+a)):c<l+a/4?(v=new Point.A(n-Math.floor(.5*r),l+Math.floor(.5*a)),A=new Point.A(n+r,l-Math.floor(.25*a))):c>l+3*a/4&&(v=new Point.A(n-Math.floor(.5*r),l+Math.floor(.5*a)),A=new Point.A(n+r,l+Math.floor(1.25*a))):d>o&&(c>l+a/4&&c<l+3*a/4?(v=new Point.A(n+r,l),A=new Point.A(n+r,l+a)):c<l+a/4?(v=new Point.A(n,l-Math.floor(.25*a)),A=new Point.A(n+Math.floor(1.5*r),l+Math.floor(.5*a))):c>l+3*a/4&&(v=new Point.A(n+Math.floor(1.5*r),l+Math.floor(.5*a)),A=new Point.A(n,l+Math.floor(1.25*a))))}else{if(c===h){if(d<=n)return new Point.A(n,l+a/2);if(d>=n+r)return new Point.A(n+r,l+a/2)}else if(c<l){if(d===n+r/4)return new Point.A(n+r/4,l);if(d===n+3*r/4)return new Point.A(n+3*r/4,l)}else if(c>l+a){if(d===n+r/4)return new Point.A(n+r/4,l+a);if(d===n+3*r/4)return new Point.A(n+3*r/4,l+a)}else if(c===l){if(d<o)return new Point.A(n+r/4,l);if(d>o)return new Point.A(n+3*r/4,l)}else if(c===l+a){if(d<o)return new Point.A(n+r/4,l+a);if(c>h)return new Point.A(n+3*r/4,l+a)}if(d===n)return new Point.A(n,h);if(d===n+r)return new Point.A(n+r,h);c<h?d>n+r/4&&d<n+3*r/4?(v=new Point.A(n,l),A=new Point.A(n+r,l)):d<n+r/4?(v=new Point.A(n-Math.floor(.25*r),l+a),A=new Point.A(n+Math.floor(.5*r),l-Math.floor(.5*a))):d>n+3*r/4&&(v=new Point.A(n+Math.floor(.5*r),l-Math.floor(.5*a)),A=new Point.A(n+Math.floor(1.25*r),l+a)):c>h&&(d>n+r/4&&d<n+3*r/4?(v=new Point.A(n,l+a),A=new Point.A(n+r,l+a)):d<n+r/4?(v=new Point.A(n-Math.floor(.25*r),l),A=new Point.A(n+Math.floor(.5*r),l+Math.floor(1.5*a))):d>n+3*r/4&&(v=new Point.A(n+Math.floor(.5*r),l+Math.floor(1.5*a)),A=new Point.A(n+Math.floor(1.25*r),l)))}let t=o,e=h;d>=n&&d<=n+r?(t=d,e=c<h?l+a:l):c>=l&&c<=l+a&&(e=c,t=d<o?n+r:n),m=(0,mathUtils.intersection)(t,e,i.x,i.y,v.x,v.y,A.x,A.y)}else{if(y){const t=Math.atan2(a/4,r/2);if(p===t)return new Point.A(n+r,l+Math.floor(.25*a));if(p===C)return new Point.A(n+Math.floor(.5*r),l);if(p===E-t)return new Point.A(n,l+Math.floor(.25*a));if(p===-t)return new Point.A(n+r,l+Math.floor(.75*a));if(p===-C)return new Point.A(n+Math.floor(.5*r),l+a);if(p===-E+t)return new Point.A(n,l+Math.floor(.75*a));p<t&&p>-t?(v=new Point.A(n+r,l),A=new Point.A(n+r,l+a)):p>t&&p<C?(v=new Point.A(n,l-Math.floor(.25*a)),A=new Point.A(n+Math.floor(1.5*r),l+Math.floor(.5*a))):p>C&&p<E-t?(v=new Point.A(n-Math.floor(.5*r),l+Math.floor(.5*a)),A=new Point.A(n+r,l-Math.floor(.25*a))):p>E-t&&p<=E||p<-E+t&&p>=-E?(v=new Point.A(n,l),A=new Point.A(n,l+a)):p<-t&&p>-C?(v=new Point.A(n+Math.floor(1.5*r),l+Math.floor(.5*a)),A=new Point.A(n,l+Math.floor(1.25*a))):p<-C&&p>-E+t&&(v=new Point.A(n-Math.floor(.5*r),l+Math.floor(.5*a)),A=new Point.A(n+r,l+Math.floor(1.25*a)))}else{const t=Math.atan2(a/2,r/4);if(p===t)return new Point.A(n+Math.floor(.75*r),l);if(p===E-t)return new Point.A(n+Math.floor(.25*r),l);if(p===E||p===-E)return new Point.A(n,l+Math.floor(.5*a));if(0===p)return new Point.A(n+r,l+Math.floor(.5*a));if(p===-t)return new Point.A(n+Math.floor(.75*r),l+a);if(p===-E+t)return new Point.A(n+Math.floor(.25*r),l+a);p>0&&p<t?(v=new Point.A(n+Math.floor(.5*r),l-Math.floor(.5*a)),A=new Point.A(n+Math.floor(1.25*r),l+a)):p>t&&p<E-t?(v=new Point.A(n,l),A=new Point.A(n+r,l)):p>E-t&&p<E?(v=new Point.A(n-Math.floor(.25*r),l+a),A=new Point.A(n+Math.floor(.5*r),l-Math.floor(.5*a))):p<0&&p>-t?(v=new Point.A(n+Math.floor(.5*r),l+Math.floor(1.5*a)),A=new Point.A(n+Math.floor(1.25*r),l)):p<-t&&p>-E+t?(v=new Point.A(n,l+a),A=new Point.A(n+r,l+a)):p<-E+t&&p>-E&&(v=new Point.A(n-Math.floor(.25*r),l),A=new Point.A(n+Math.floor(.5*r),l+Math.floor(1.5*a)))}m=(0,mathUtils.intersection)(o,h,i.x,i.y,v.x,v.y,A.x,A.y)}return null==m?new Point.A(o,h):m},RectanglePerimeter=(t,e,i,s=!1)=>{const n=t.getCenterX(),l=t.getCenterY(),r=i.x-n,a=i.y-l,o=Math.atan2(a,r),h=new Point.A(0,0),d=Math.PI,c=Math.PI/2-o,u=Math.atan2(t.height,t.width);return o<-d+u||o>d-u?(h.x=t.x,h.y=l-t.width*Math.tan(o)/2):o<-u?(h.y=t.y,h.x=n-t.height*Math.tan(c)/2):o<u?(h.x=t.x+t.width,h.y=l+t.width*Math.tan(o)/2):(h.y=t.y+t.height,h.x=n+t.height*Math.tan(c)/2),s&&(i.x>=t.x&&i.x<=t.x+t.width?h.x=i.x:i.y>=t.y&&i.y<=t.y+t.height&&(h.y=i.y),i.x<t.x?h.x=t.x:i.x>t.x+t.width&&(h.x=t.x+t.width),i.y<t.y?h.y=t.y:i.y>t.y+t.height&&(h.y=t.y+t.height)),h},RhombusPerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,r=t.width,a=t.height,o=n+r/2,h=l+a/2,d=i.x,c=i.y;if(o===d)return h>c?new Point.A(o,l):new Point.A(o,l+a);if(h===c)return o>d?new Point.A(n,h):new Point.A(n+r,h);let u=o,g=h;return s&&(d>=n&&d<=n+r?u=d:c>=l&&c<=l+a&&(g=c)),d<o?c<h?(0,mathUtils.intersection)(d,c,u,g,o,l,n,h):(0,mathUtils.intersection)(d,c,u,g,o,l+a,n,h):c<h?(0,mathUtils.intersection)(d,c,u,g,o,l,n+r,h):(0,mathUtils.intersection)(d,c,u,g,o,l+a,n+r,h)},TrianglePerimeter=(t,e,i,s=!1)=>{const n=null!=e?e.style.direction:null,l=n===Constants.DIRECTION.NORTH||n===Constants.DIRECTION.SOUTH,{x:r}=t,{y:a}=t,o=t.width,h=t.height;let d=r+o/2,c=a+h/2,u=new Point.A(r,a),g=new Point.A(r+o,c),p=new Point.A(r,a+h);n===Constants.DIRECTION.NORTH?(u=p,g=new Point.A(d,a),p=new Point.A(r+o,a+h)):n===Constants.DIRECTION.SOUTH?(g=new Point.A(d,a+h),p=new Point.A(r+o,a)):n===Constants.DIRECTION.WEST&&(u=new Point.A(r+o,a),g=new Point.A(r,c),p=new Point.A(r+o,a+h));let E=i.x-d,C=i.y-c;const m=l?Math.atan2(E,C):Math.atan2(C,E),f=l?Math.atan2(o,h):Math.atan2(h,o);let y=!1;y=n===Constants.DIRECTION.NORTH||n===Constants.DIRECTION.WEST?m>-f&&m<f:m<-Math.PI+f||m>Math.PI-f;let v=null;if(y)v=s&&(l&&i.x>=u.x&&i.x<=p.x||!l&&i.y>=u.y&&i.y<=p.y)?l?new Point.A(i.x,u.y):new Point.A(u.x,i.y):n===Constants.DIRECTION.NORTH?new Point.A(r+o/2+h*Math.tan(m)/2,a+h):n===Constants.DIRECTION.SOUTH?new Point.A(r+o/2-h*Math.tan(m)/2,a):n===Constants.DIRECTION.WEST?new Point.A(r+o,a+h/2+o*Math.tan(m)/2):new Point.A(r,a+h/2-o*Math.tan(m)/2);else{if(s){const t=new Point.A(d,c);i.y>=a&&i.y<=a+h?(t.x=l?d:n===Constants.DIRECTION.WEST?r+o:r,t.y=i.y):i.x>=r&&i.x<=r+o&&(t.x=i.x,t.y=l?n===Constants.DIRECTION.NORTH?a+h:a:c),E=i.x-t.x,C=i.y-t.y,d=t.x,c=t.y}v=l&&i.x<=r+o/2||!l&&i.y<=a+h/2?(0,mathUtils.intersection)(i.x,i.y,d,c,u.x,u.y,g.x,g.y):(0,mathUtils.intersection)(i.x,i.y,d,c,g.x,g.y,p.x,p.y)}return null==v&&(v=new Point.A(d,c)),v},Perimeter={RectanglePerimeter,EllipsePerimeter,RhombusPerimeter,TrianglePerimeter,HexagonPerimeter},style_Perimeter=Perimeter;var StyleRegistry=__webpack_require__(2628);let isDefaultsRegistered=!1;const registerDefaultStyleElements=()=>{isDefaultsRegistered||(StyleRegistry.A.putValue(Constants.EDGESTYLE.ELBOW,style_EdgeStyle.ElbowConnector),StyleRegistry.A.putValue(Constants.EDGESTYLE.ENTITY_RELATION,style_EdgeStyle.EntityRelation),StyleRegistry.A.putValue(Constants.EDGESTYLE.LOOP,style_EdgeStyle.Loop),StyleRegistry.A.putValue(Constants.EDGESTYLE.MANHATTAN,style_EdgeStyle.ManhattanConnector),StyleRegistry.A.putValue(Constants.EDGESTYLE.ORTHOGONAL,style_EdgeStyle.OrthConnector),StyleRegistry.A.putValue(Constants.EDGESTYLE.SEGMENT,style_EdgeStyle.SegmentConnector),StyleRegistry.A.putValue(Constants.EDGESTYLE.SIDETOSIDE,style_EdgeStyle.SideToSide),StyleRegistry.A.putValue(Constants.EDGESTYLE.TOPTOBOTTOM,style_EdgeStyle.TopToBottom),StyleRegistry.A.putValue(Constants.PERIMETER.ELLIPSE,style_Perimeter.EllipsePerimeter),StyleRegistry.A.putValue(Constants.PERIMETER.HEXAGON,style_Perimeter.HexagonPerimeter),StyleRegistry.A.putValue(Constants.PERIMETER.RECTANGLE,style_Perimeter.RectanglePerimeter),StyleRegistry.A.putValue(Constants.PERIMETER.RHOMBUS,style_Perimeter.RhombusPerimeter),StyleRegistry.A.putValue(Constants.PERIMETER.TRIANGLE,style_Perimeter.TrianglePerimeter),isDefaultsRegistered=!0)},CellsMixin={cellsResizable:!0,cellsBendable:!0,cellsSelectable:!0,cellsDisconnectable:!0,autoSizeCells:!1,autoSizeCellsOnAdd:!1,cellsLocked:!1,cellsCloneable:!0,cellsDeletable:!0,cellsMovable:!0,extendParents:!0,extendParentsOnAdd:!0,extendParentsOnMove:!1,getBoundingBox(t){let e=null;if(t.length>0)for(const i of t)if(i.isVertex()||i.isEdge()){const t=this.getView().getBoundingBox(this.getView().getState(i),!0);t&&(e?e.add(t):e=Rectangle.A.fromRectangle(t))}return e},removeStateForCell(t){for(const e of t.getChildren())this.removeStateForCell(e);this.getView().invalidate(t,!1,!0),this.getView().removeState(t)},getCurrentCellStyle(t,e=!1){const i=e?null:this.getView().getState(t);return i?i.style:this.getCellStyle(t)},getCellStyle(t){const e=t.getStyle(),i=this.getStylesheet(),s=t.isEdge()?i.getDefaultEdgeStyle():i.getDefaultVertexStyle();return this.postProcessCellStyle(i.getCellStyle(e,s??{}))},postProcessCellStyle(t){if(!t.image)return t;const e=t.image;let i=this.getImageFromBundles(e);if(i?t.image=i:i=e,i&&"data:image/"===i.substring(0,11)){if("data:image/svg+xml,<"===i.substring(0,20))i=i.substring(0,19)+encodeURIComponent(i.substring(19));else if("data:image/svg+xml,%3C"!==i.substring(0,22)){const t=i.indexOf(",");t>0&&";base64,"!==i.substring(t-7,t+1)&&(i=`${i.substring(0,t)};base64,${i.substring(t+1)}`)}t.image=i}return t},setCellStyle(t,e){e=e??this.getSelectionCells(),this.batchUpdate((()=>{for(const i of e)this.getDataModel().setStyle(i,t)}))},toggleCellStyle(t,e=!1,i){return i=i??this.getSelectionCell(),this.toggleCellStyles(t,e,[i])},toggleCellStyles(t,e=!1,i){let s=!1;return(i=i??this.getSelectionCells()).length>0&&(s=!(this.getCurrentCellStyle(i[0])[t]??e),this.setCellStyles(t,s,i)),s},setCellStyles(t,e,i){i=i??this.getSelectionCells(),(0,styleUtils.setCellStyles)(this.getDataModel(),i,t,e)},toggleCellStyleFlags(t,e,i){i=i??this.getSelectionCells(),this.setCellStyleFlags(t,e,null,i)},setCellStyleFlags(t,e,i=null,s){(s=s??this.getSelectionCells()).length>0&&(null===i&&(i=!(((this.getCurrentCellStyle(s[0])[t]||0)&e)===e)),(0,styleUtils.setCellStyleFlags)(this.getDataModel(),s,t,e,i))},alignCells(t,e,i=null){if((e=e??this.getSelectionCells()).length>1){if(null===i)for(const s of e){const e=this.getView().getState(s);if(e&&!s.isEdge())if(null===i){if(t===Constants.ALIGN.CENTER){i=e.x+e.width/2;break}if(t===Constants.ALIGN.RIGHT)i=e.x+e.width;else if(t===Constants.ALIGN.TOP)i=e.y;else{if(t===Constants.ALIGN.MIDDLE){i=e.y+e.height/2;break}i=t===Constants.ALIGN.BOTTOM?e.y+e.height:e.x}}else i=t===Constants.ALIGN.RIGHT?Math.max(i,e.x+e.width):t===Constants.ALIGN.TOP?Math.min(i,e.y):t===Constants.ALIGN.BOTTOM?Math.max(i,e.y+e.height):Math.min(i,e.x)}if(null!==i){const s=this.getView().scale;this.batchUpdate((()=>{const n=i;for(const i of e){const e=this.getView().getState(i);if(null!=e){let l=i.getGeometry();null==l||i.isEdge()||(l=l.clone(),t===Constants.ALIGN.CENTER?l.x+=(n-e.x-e.width/2)/s:t===Constants.ALIGN.RIGHT?l.x+=(n-e.x-e.width)/s:t===Constants.ALIGN.TOP?l.y+=(n-e.y)/s:t===Constants.ALIGN.MIDDLE?l.y+=(n-e.y-e.height/2)/s:t===Constants.ALIGN.BOTTOM?l.y+=(n-e.y-e.height)/s:l.x+=(n-e.x)/s,this.resizeCell(i,l))}}this.fireEvent(new EventObject.A(InternalEvent.A.ALIGN_CELLS,{align:t,cells:e}))}))}}return e},cloneCell(t,e=!1,i={},s=!1){return this.cloneCells([t],e,i,s)[0]},cloneCells(t,e=!0,i={},s=!1){let n;const l=new util_Dictionary.A,r=[];for(const e of t)l.put(e,!0),r.push(e);if(r.length>0){const{scale:r}=this.getView(),a=this.getView().translate,o=[];n=cloneCells(t,!0,i);for(let i=0;i<t.length;i+=1){const h=t[i],d=n[i];if(!e&&d.isEdge()&&null!==this.getEdgeValidationError(d,d.getTerminal(!0),d.getTerminal(!1)));else{o.push(d);const t=d.getGeometry();if(t){const e=this.getView().getState(h),i=h.getParent(),n=i?this.getView().getState(i):null;if(e&&n){const i=s?0:n.origin.x,o=s?0:n.origin.y;if(d.isEdge()){const s=e.absolutePoints;let n=h.getTerminal(!0);for(;n&&!l.get(n);)n=n.getParent();!n&&s[0]&&t.setTerminalPoint(new Point.A(s[0].x/r-a.x,s[0].y/r-a.y),!0);let d=h.getTerminal(!1);for(;d&&!l.get(d);)d=d.getParent();const c=s[s.length-1];!d&&c&&t.setTerminalPoint(new Point.A(c.x/r-a.x,c.y/r-a.y),!1);const{points:u}=t;if(u)for(const t of u)t.x+=i,t.y+=o}else t.translate(i,o)}}}}n=o}else n=[];return n},addCell(t,e=null,i=null,s=null,n=null){return this.addCells([t],e,i,s,n)[0]},addCells(t,e=null,i=null,s=null,n=null,l=!1){const r=e??this.getDefaultParent(),a=i??r.getChildCount();return this.batchUpdate((()=>{this.cellsAdded(t,r,a,s,n,l,!0),this.fireEvent(new EventObject.A(InternalEvent.A.ADD_CELLS,{cells:t,p:r,i:a,source:s,target:n}))})),t},cellsAdded(t,e,i,s=null,n=null,l=!1,r=!1,a=!0){this.batchUpdate((()=>{const o=l?this.getView().getState(e):null,h=o?o.origin:null,d=new Point.A(0,0);t.forEach(((t,l)=>{const o=t.getParent();if(h&&t!==e&&e!==o){const e=o?this.getView().getState(o):null,i=e?e.origin:d;let s=t.getGeometry();if(s){const e=i.x-h.x,n=i.y-h.y;s=s.clone(),s.translate(e,n),s.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),this.getDataModel().setGeometry(t,s)}}e===o&&i+l>e.getChildCount()&&i--,this.getDataModel().add(e,t,i+l),this.autoSizeCellsOnAdd&&this.autoSizeCell(t,!0),(!a||a)&&this.isExtendParentsOnAdd(t)&&this.isExtendParent(t)&&this.extendParent(t),r&&!r||this.constrainChild(t),s&&this.cellConnected(t,s,!0),n&&this.cellConnected(t,n,!1)})),this.fireEvent(new EventObject.A(InternalEvent.A.CELLS_ADDED,{cells:t,parent:e,index:i,source:s,target:n,absolute:l}))}))},autoSizeCell(t,e=!0){if(e)for(const e of t.getChildren())this.autoSizeCell(e);t.isVertex()&&this.isAutoSizeCell(t)&&this.updateCellSize(t)},removeCells(t=null,e=!0){if(t||(t=this.getDeletableCells(this.getSelectionCells())),e)t=this.getDeletableCells(this.addAllEdges(t));else{t=t.slice();const e=this.getDeletableCells(this.getAllEdges(t)),i=new util_Dictionary.A;for(const e of t)i.put(e,!0);for(const s of e)this.getView().getState(s)||i.get(s)||(i.put(s,!0),t.push(s))}return this.batchUpdate((()=>{this.cellsRemoved(t),this.fireEvent(new EventObject.A(InternalEvent.A.REMOVE_CELLS,{cells:t,includeEdges:e}))})),t??[]},cellsRemoved(t){if(t.length>0){const{scale:e}=this.getView(),i=this.getView().translate;this.batchUpdate((()=>{const s=new util_Dictionary.A;for(const e of t)s.put(e,!0);for(const n of t){const t=this.getAllEdges([n]),l=(t,s)=>{let l=t.getGeometry();if(l){const r=t.getTerminal(s);let a=!1,o=r;for(;o;){if(n===o){a=!0;break}o=o.getParent()}if(a){l=l.clone();const n=this.getView().getState(t);if(n){const t=n.absolutePoints,r=t[s?0:t.length-1];l.setTerminalPoint(new Point.A(r.x/e-i.x-n.origin.x,r.y/e-i.y-n.origin.y),s)}else if(r){const t=this.getView().getState(r);t&&l.setTerminalPoint(new Point.A(t.getCenterX()/e-i.x,t.getCenterY()/e-i.y),s)}this.getDataModel().setGeometry(t,l),this.getDataModel().setTerminal(t,null,s)}}};for(const e of t)s.get(e)||(s.put(e,!0),l(e,!0),l(e,!1));this.getDataModel().remove(n)}this.fireEvent(new EventObject.A(InternalEvent.A.CELLS_REMOVED,{cells:t}))}))}},toggleCells(t=!1,e,i=!0){return e=e??this.getSelectionCells(),i&&(e=this.addAllEdges(e)),this.batchUpdate((()=>{this.cellsToggled(e,t),this.fireEvent(new EventObject.A(InternalEvent.A.TOGGLE_CELLS,{show:t,cells:e,includeEdges:i}))})),e},cellsToggled(t,e=!1){t.length>0&&this.batchUpdate((()=>{for(const i of t)this.getDataModel().setVisible(i,e)}))},updateCellSize(t,e=!1){return this.batchUpdate((()=>{this.cellSizeUpdated(t,e),this.fireEvent(new EventObject.A(InternalEvent.A.UPDATE_CELL_SIZE,{cell:t,ignoreChildren:e}))})),t},cellSizeUpdated(t,e=!1){this.batchUpdate((()=>{const i=this.getPreferredSizeForCell(t);let s=t.getGeometry();if(i&&s){const n=t.isCollapsed();if(s=s.clone(),this.isSwimlane(t)){const e=this.getCellStyle(t),l=t.getStyle();e.horizontal??1?(l.startSize=i.height+8,n&&(s.height=i.height+8),s.width=i.width):(l.startSize=i.width+8,n&&(s.width=i.width+8),s.height=i.height),this.getDataModel().setStyle(t,l)}else{const e=this.getView().createState(t),n=e.style.align??Constants.ALIGN.CENTER;n===Constants.ALIGN.RIGHT?s.x+=s.width-i.width:n===Constants.ALIGN.CENTER&&(s.x+=Math.round((s.width-i.width)/2));const l=e.getVerticalAlign();l===Constants.ALIGN.BOTTOM?s.y+=s.height-i.height:l===Constants.ALIGN.MIDDLE&&(s.y+=Math.round((s.height-i.height)/2)),s.width=i.width,s.height=i.height}if(!e&&!n){const e=this.getView().getBounds(t.getChildren());if(null!=e){const t=this.getView().translate,{scale:i}=this.getView(),n=(e.x+e.width)/i-s.x-t.x,l=(e.y+e.height)/i-s.y-t.y;s.width=Math.max(s.width,n),s.height=Math.max(s.height,l)}}this.cellsResized([t],[s],!1)}}))},getPreferredSizeForCell(t,e=null){let i=null;const s=this.getView().createState(t),{style:n}=s;if(!t.isEdge()){const t=n.fontSize||Constants.DEFAULT_FONTSIZE;let l=0,r=0;(s.getImageSrc()||n.image)&&n.shape===Constants.SHAPE.LABEL&&(n.verticalAlign===Constants.ALIGN.MIDDLE&&(l+=n.imageWidth||Constants.DEFAULT_IMAGESIZE),n.align!==Constants.ALIGN.CENTER&&(r+=n.imageHeight||Constants.DEFAULT_IMAGESIZE)),l+=2*(n.spacing||0),l+=n.spacingLeft||0,l+=n.spacingRight||0,r+=2*(n.spacing||0),r+=n.spacingTop||0,r+=n.spacingBottom||0;const a=this.getFoldingImage(s);a&&(l+=a.width+8);let o=this.getCellRenderer().getLabelValue(s);if(o&&o.length>0){this.isHtmlLabel(s.cell)||(o=(0,StringUtils.htmlEntities)(o,!1)),o=o.replace(/\n/g,"<br>");const a=(0,styleUtils.getSizeForString)(o,t,n.fontFamily,e,n.fontStyle);let h=a.width+l,d=a.height+r;if(!(n.horizontal??1)){const t=d;d=h,h=t}this.isGridEnabled()&&(h=this.snap(h+this.getGridSize()/2),d=this.snap(d+this.getGridSize()/2)),i=new Rectangle.A(0,0,h,d)}else{const t=4*this.getGridSize();i=new Rectangle.A(0,0,t,t)}}return i},resizeCell(t,e,i=!1){return this.resizeCells([t],[e],i)[0]},resizeCells(t,e,i){return i=i??this.isRecursiveResize(),this.batchUpdate((()=>{const s=this.cellsResized(t,e,i);this.fireEvent(new EventObject.A(InternalEvent.A.RESIZE_CELLS,{cells:t,bounds:e,prev:s}))})),t},cellsResized(t,e,i=!1){const s=[];return t.length===e.length&&this.batchUpdate((()=>{t.forEach(((t,n)=>{s.push(this.cellResized(t,e[n],!1,i)),this.isExtendParent(t)&&this.extendParent(t),this.constrainChild(t)})),this.isResetEdgesOnResize()&&this.resetEdges(t),this.fireEvent(new EventObject.A(InternalEvent.A.CELLS_RESIZED,{cells:t,bounds:e,prev:s}))})),s},cellResized(t,e,i=!1,s=!1){const n=t.getGeometry();if(n&&(n.x!==e.x||n.y!==e.y||n.width!==e.width||n.height!==e.height)){const l=n.clone();if(!i&&l.relative){const{offset:t}=l;t&&(t.x+=e.x-l.x,t.y+=e.y-l.y)}else l.x=e.x,l.y=e.y;l.width=e.width,l.height=e.height,l.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(l.x=Math.max(0,l.x),l.y=Math.max(0,l.y)),this.batchUpdate((()=>{s&&this.resizeChildCells(t,l),this.getDataModel().setGeometry(t,l),this.constrainChildCells(t)}))}return n},resizeChildCells(t,e){const i=t.getGeometry();if(i){const s=0!==i.width?e.width/i.width:1,n=0!==i.height?e.height/i.height:1;for(const e of t.getChildren())this.scaleCell(e,s,n,!0)}},constrainChildCells(t){for(const e of t.getChildren())this.constrainChild(e)},scaleCell(t,e,i,s=!1){let n=t.getGeometry();if(n){const l=this.getCurrentCellStyle(t);n=n.clone();const{x:r}=n,{y:a}=n,o=n.width,h=n.height;n.scale(e,i,"fixed"===l.aspect),l.resizeWidth?n.width=o*e:l.resizeWidth||(n.width=o),l.resizeHeight?n.height=h*i:l.resizeHeight||(n.height=h),this.isCellMovable(t)||(n.x=r,n.y=a),this.isCellResizable(t)||(n.width=o,n.height=h),t.isVertex()?this.cellResized(t,n,!0,s):this.getDataModel().setGeometry(t,n)}},extendParent(t){const e=t.getParent();let i=e?e.getGeometry():null;if(e&&i&&!e.isCollapsed()){const s=t.getGeometry();s&&!s.relative&&(i.width<s.x+s.width||i.height<s.y+s.height)&&(i=i.clone(),i.width=Math.max(i.width,s.x+s.width),i.height=Math.max(i.height,s.y+s.height),this.cellsResized([e],[i],!1))}},importCells(t,e,i,s=null,n=null,l={}){return this.moveCells(t,e,i,!0,s,n,l)},moveCells(t,e=0,i=0,s=!1,n=null,l=null,r={}){if(0!==e||0!==i||s||n){const a=t=getTopmostCells(t);this.batchUpdate((()=>{const o=new util_Dictionary.A;for(const e of t)o.put(e,!0);const h=t=>{for(;t;){if(o.get(t))return!0;t=t.getParent()}return!1},d=[];for(const e of t){const t=e.getGeometry(),i=e.getParent();(!t||!t.relative||i&&!i.isEdge()||i&&!h(i.getTerminal(!0))&&!h(i.getTerminal(!1)))&&d.push(e)}t=d,s&&(t=this.cloneCells(t,this.isCloneInvalidEdges(),r),n||(n=this.getDefaultParent()));const c=this.isAllowNegativeCoordinates();if(n&&this.setAllowNegativeCoordinates(!0),this.cellsMoved(t,e,i,!s&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),!n,this.isExtendParentsOnMove()&&!n),this.setAllowNegativeCoordinates(c),n){const e=n.getChildCount();this.cellsAdded(t,n,e,null,null,!0),s&&t.forEach(((t,e)=>{const i=t.getGeometry(),s=a[e].getParent();i&&i.relative&&s&&s.isEdge()&&this.getDataModel().contains(s)&&this.getDataModel().add(s,t)}))}this.fireEvent(new EventObject.A(InternalEvent.A.MOVE_CELLS,{cells:t,dx:e,dy:i,clone:s,target:n,event:l}))}))}return t},cellsMoved(t,e,i,s=!1,n=!1,l=!1){0===e&&0===i||this.batchUpdate((()=>{s&&this.disconnectGraph(t);for(const s of t)this.translateCell(s,e,i),l&&this.isExtendParent(s)?this.extendParent(s):n&&this.constrainChild(s);this.isResetEdgesOnMove()&&this.resetEdges(t),this.fireEvent(new EventObject.A(InternalEvent.A.CELLS_MOVED,{cells:t,dx:e,dy:i,disconnect:s}))}))},translateCell(t,e,i){let s=t.getGeometry();if(s){if(s=s.clone(),s.translate(e,i),s.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),s.relative&&!t.isEdge()){const n=t.getParent();let l=0;if(n.isVertex()&&(l=this.getCurrentCellStyle(n).rotation??0),0!==l){const t=(0,mathUtils.toRadians)(-l),s=Math.cos(t),n=Math.sin(t),r=(0,mathUtils.getRotatedPoint)(new Point.A(e,i),s,n,new Point.A(0,0));e=r.x,i=r.y}s.offset?(s.offset.x=s.offset.x+e,s.offset.y=s.offset.y+i):s.offset=new Point.A(e,i)}this.getDataModel().setGeometry(t,s)}},getCellContainmentArea(t){if(!t.isEdge()){const e=t.getParent();if(e&&e!==this.getDefaultParent()){const t=e.getGeometry();if(t){let i=0,s=0,n=t.width,l=t.height;if(this.isSwimlane(e)){const t=this.getStartSize(e),r=this.getCurrentCellStyle(e),a=r.direction??Constants.DIRECTION.EAST,o=r.flipH??!1,h=r.flipV??!1;if(a===Constants.DIRECTION.SOUTH||a===Constants.DIRECTION.NORTH){const e=t.width;t.width=t.height,t.height=e}(a===Constants.DIRECTION.EAST&&!h||a===Constants.DIRECTION.NORTH&&!o||a===Constants.DIRECTION.WEST&&h||a===Constants.DIRECTION.SOUTH&&o)&&(i=t.width,s=t.height),n-=t.width,l-=t.height}return new Rectangle.A(i,s,n,l)}}}return null},constrainChild(t,e=!0){let i=t.getGeometry();if(i&&(this.isConstrainRelativeChildren()||!i.relative)){const e=t.getParent();let s=this.getMaximumGraphBounds();if(s&&e){const t=this.getBoundingBoxFromGeometry([e],!1);t&&(s=Rectangle.A.fromRectangle(s),s.x-=t.x,s.y-=t.y)}if(this.isConstrainChild(t)){let e=this.getCellContainmentArea(t);if(e){const i=this.getOverlap(t);i>0&&(e=Rectangle.A.fromRectangle(e),e.x-=e.width*i,e.y-=e.height*i,e.width+=2*e.width*i,e.height+=2*e.height*i),s?(s=Rectangle.A.fromRectangle(s),s.intersect(e)):s=e}}if(s){const e=[t];if(!t.isCollapsed()){const i=t.getDescendants();for(const t of i)t.isVisible()&&e.push(t)}const n=this.getBoundingBoxFromGeometry(e,!1);if(n){i=i.clone();let e=0;i.width>s.width&&(e=i.width-s.width,i.width-=e),n.x+n.width>s.x+s.width&&(e-=n.x+n.width-s.x-s.width-e);let l=0;i.height>s.height&&(l=i.height-s.height,i.height-=l),n.y+n.height>s.y+s.height&&(l-=n.y+n.height-s.y-s.height-l),n.x<s.x&&(e-=n.x-s.x),n.y<s.y&&(l-=n.y-s.y),0===e&&0===l||(i.relative?(i.offset||(i.offset=new Point.A),i.offset.x+=e,i.offset.y+=l):(i.x+=e,i.y+=l)),this.getDataModel().setGeometry(t,i)}}}},getChildCells(t,e=!1,i=!1){const s=(t=t??this.getDefaultParent()).getChildCells(e,i),n=[];for(const t of s)t.isVisible()&&n.push(t);return n},getCellAt(t,e,i=null,s=!0,n=!0,l=null){if(i||(i=this.getCurrentRoot())||(i=this.getDataModel().getRoot()),i)for(let r=i.getChildCount()-1;r>=0;r--){const a=i.getChildAt(r),o=this.getCellAt(t,e,a,s,n,l);if(o)return o;if(a.isVisible()&&(n&&a.isEdge()||s&&a.isVertex())){const i=this.getView().getState(a);if(i&&(!l||!l(i,t,e))&&this.intersects(i,t,e))return a}}return null},getCells(t,e,i,s,n=null,l=[],r=null,a=null,o=!1){if(i>0||s>0||r){const h=this.getDataModel(),d=t+i,c=e+s;if(n||(n=this.getCurrentRoot())||(n=h.getRoot()),n)for(const h of n.getChildren()){const n=this.getView().getState(h);if(n&&h.isVisible()&&(!a||!a(n))){const u=n.style.rotation??0;let g=n;0!==u&&(g=(0,mathUtils.getBoundingBox)(g,u));const p=r&&h.isVertex()&&(0,mathUtils.intersects)(r,g)||!r&&(h.isEdge()||h.isVertex())&&g.x>=t&&g.y+g.height<=c&&g.y>=e&&g.x+g.width<=d;p&&l.push(h),p&&!o||this.getCells(t,e,i,s,h,l,r,a,o)}}}return l},getCellsBeyond(t,e,i=null,s=!1,n=!1){const l=[];if((s||n)&&(i||(i=this.getDefaultParent()),i))for(const r of i.getChildren()){const i=this.getView().getState(r);r.isVisible()&&i&&(!s||i.x>=t)&&(!n||i.y>=e)&&l.push(r)}return l},intersects(t,e,i){const s=t.absolutePoints;if(s.length>0){const t=this.getEventTolerance()*this.getEventTolerance();let n=s[0];for(let l=1;l<s.length;l+=1){const r=s[l];if(n&&r&&(0,mathUtils.ptSegDistSq)(n.x,n.y,r.x,r.y,e,i)<=t)return!0;n=r}}else{const s=(0,mathUtils.toRadians)(t.style.rotation??0);if(0!==s){const n=Math.cos(-s),l=Math.sin(-s),r=new Point.A(t.getCenterX(),t.getCenterY()),a=(0,mathUtils.getRotatedPoint)(new Point.A(e,i),n,l,r);e=a.x,i=a.y}if((0,mathUtils.contains)(t,e,i))return!0}return!1},isValidAncestor:(t,e,i=!1)=>i?e.isAncestor(t):t.getParent()===e,isCellLocked(t){const e=t.getGeometry();return this.isCellsLocked()||!!e&&t.isVertex()&&e.relative},isCellsLocked(){return this.cellsLocked},setCellsLocked(t){this.cellsLocked=t},getCloneableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellCloneable(t)))},isCellCloneable(t){return this.isCellsCloneable()&&(this.getCurrentCellStyle(t).cloneable??!0)},isCellsCloneable(){return this.cellsCloneable},setCellsCloneable(t){this.cellsCloneable=t},getExportableCells(t){return this.getDataModel().filterCells(t,(t=>this.canExportCell(t)))},canExportCell(t=null){return this.isExportEnabled()},getImportableCells(t){return this.getDataModel().filterCells(t,(t=>this.canImportCell(t)))},canImportCell(t=null){return this.isImportEnabled()},isCellSelectable(t){return this.isCellsSelectable()},isCellsSelectable(){return this.cellsSelectable},setCellsSelectable(t){this.cellsSelectable=t},getDeletableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellDeletable(t)))},isCellDeletable(t){return this.isCellsDeletable()&&(this.getCurrentCellStyle(t).deletable??!0)},isCellsDeletable(){return this.cellsDeletable},setCellsDeletable(t){this.cellsDeletable=t},isCellRotatable(t){return this.getCurrentCellStyle(t).rotatable??!0},getMovableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellMovable(t)))},isCellMovable(t){return this.isCellsMovable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).movable??!0)},isCellsMovable(){return this.cellsMovable},setCellsMovable(t){this.cellsMovable=t},isCellResizable(t){return this.isCellsResizable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).resizable??!0)},isCellsResizable(){return this.cellsResizable},setCellsResizable(t){this.cellsResizable=t},isCellBendable(t){return this.isCellsBendable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).bendable??!0)},isCellsBendable(){return this.cellsBendable},setCellsBendable(t){this.cellsBendable=t},isAutoSizeCell(t){return this.isAutoSizeCells()||(this.getCurrentCellStyle(t).autoSize??!1)},isAutoSizeCells(){return this.autoSizeCells},setAutoSizeCells(t){this.autoSizeCells=t},isExtendParent(t){return!t.isEdge()&&this.isExtendParents()},isExtendParents(){return this.extendParents},setExtendParents(t){this.extendParents=t},isExtendParentsOnAdd(t){return this.extendParentsOnAdd},setExtendParentsOnAdd(t){this.extendParentsOnAdd=t},isExtendParentsOnMove(){return this.extendParentsOnMove},setExtendParentsOnMove(t){this.extendParentsOnMove=t},getCursorForCell:t=>null,getCellBounds(t,e=!1,i=!1){let s=[t];e&&(s=s.concat(t.getEdges()));let n=this.getView().getBounds(s);if(i)for(const i of t.getChildren()){const t=this.getCellBounds(i,e,!0);n&&t?n.add(t):n=t}return n},getBoundingBoxFromGeometry(t,e=!1){let i=null,s=null;for(const n of t)if(e||n.isVertex()){const e=n.getGeometry();if(e){let l=null;if(n.isEdge()){const t=t=>{t&&(s?s.add(new Rectangle.A(t.x,t.y,0,0)):s=new Rectangle.A(t.x,t.y,0,0))};n.getTerminal(!0)||t(e.getTerminalPoint(!0)),n.getTerminal(!1)||t(e.getTerminalPoint(!1));const i=e.points;if(i&&i.length>0){s=new Rectangle.A(i[0].x,i[0].y,0,0);for(let e=1;e<i.length;e++)t(i[e])}l=s}else{const i=n.getParent();e.relative&&i?i.isVertex()&&i!==this.getView().currentRoot&&(s=this.getBoundingBoxFromGeometry([i],!1),s&&(l=new Rectangle.A(e.x*s.width,e.y*s.height,e.width,e.height),t.indexOf(i)>=0&&(l.x+=s.x,l.y+=s.y))):(l=Rectangle.A.fromRectangle(e),i&&i.isVertex()&&t.indexOf(i)>=0&&(s=this.getBoundingBoxFromGeometry([i],!1),s&&(l.x+=s.x,l.y+=s.y))),l&&e.offset&&(l.x+=e.offset.x,l.y+=e.offset.y);const r=this.getCurrentCellStyle(n);if(l){const t=r.rotation??0;0!==t&&(l=(0,mathUtils.getBoundingBox)(l,t))}}l&&(i?i.add(l):i=Rectangle.A.fromRectangle(l))}}return i}},ConnectionsMixin={constrainChildren:!0,constrainRelativeChildren:!1,disconnectOnMove:!0,cellsDisconnectable:!0,getOutlineConstraint(t,e,i){if(e.shape){const i=this.getView().getPerimeterBounds(e),s=e.style.direction;if(s===Constants.DIRECTION.NORTH||s===Constants.DIRECTION.SOUTH){i.x+=i.width/2-i.height/2,i.y+=i.height/2-i.width/2;const t=i.width;i.width=i.height,i.height=t}const n=(0,mathUtils.toRadians)(e.shape.getShapeRotation());if(0!==n){const e=Math.cos(-n),s=Math.sin(-n),l=new Point.A(i.getCenterX(),i.getCenterY());t=(0,mathUtils.getRotatedPoint)(t,e,s,l)}let l=1,r=1,a=0,o=0;if(e.cell.isVertex()){let t=e.style.flipH,n=e.style.flipV;if(s===Constants.DIRECTION.NORTH||s===Constants.DIRECTION.SOUTH){const e=t;t=n,n=e}t&&(l=-1,a=-i.width),n&&(r=-1,o=-i.height)}t=new Point.A((t.x-i.x)*l-a+i.x,(t.y-i.y)*r-o+i.y);const h=0===i.width?0:Math.round(1e3*(t.x-i.x)/i.width)/1e3,d=0===i.height?0:Math.round(1e3*(t.y-i.y)/i.height)/1e3;return new ConnectionConstraint.A(new Point.A(h,d),!1)}return null},getAllConnectionConstraints:(t,e)=>t?.shape?.stencil?.constraints??null,getConnectionConstraint(t,e,i=!1){let s=null;const n=t.style[i?"exitX":"entryX"];if(void 0!==n){const e=t.style[i?"exitY":"entryY"];void 0!==e&&(s=new Point.A(n,e))}let l=!1,r=0,a=0;return s&&(l=t.style[i?"exitPerimeter":"entryPerimeter"]||!1,r=t.style[i?"exitDx":"entryDx"],a=t.style[i?"exitDy":"entryDy"],r=Number.isFinite(r)?r:0,a=Number.isFinite(a)?a:0),new ConnectionConstraint.A(s,l,null,r,a)},setConnectionConstraint(t,e,i=!1,s=null){s&&this.batchUpdate((()=>{s&&s.point?s.point&&(this.setCellStyles(i?"exitX":"entryX",s.point.x,[t]),this.setCellStyles(i?"exitY":"entryY",s.point.y,[t]),this.setCellStyles(i?"exitDx":"entryDx",s.dx,[t]),this.setCellStyles(i?"exitDy":"entryDy",s.dy,[t]),s.perimeter?this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[t]):this.setCellStyles(i?"exitPerimeter":"entryPerimeter","0",[t])):(this.setCellStyles(i?"exitX":"entryX",null,[t]),this.setCellStyles(i?"exitY":"entryY",null,[t]),this.setCellStyles(i?"exitDx":"entryDx",null,[t]),this.setCellStyles(i?"exitDy":"entryDy",null,[t]),this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[t]))}))},getConnectionPoint(t,e,i=!0){let s=null;if(e.point){const i=this.getView().getPerimeterBounds(t),n=new Point.A(i.getCenterX(),i.getCenterY()),l=t.style.direction;let r=0;t.style.anchorPointDirection&&(l===Constants.DIRECTION.NORTH?r+=270:l===Constants.DIRECTION.WEST?r+=180:l===Constants.DIRECTION.SOUTH&&(r+=90),l!==Constants.DIRECTION.NORTH&&l!==Constants.DIRECTION.SOUTH||i.rotate90());const{scale:a}=this.getView();s=new Point.A(i.x+e.point.x*i.width+e.dx*a,i.y+e.point.y*i.height+e.dy*a);let o=t.style.rotation||0;if(e.perimeter){if(0!==r){let t=0,e=0;90===r?e=1:180===r?t=-1:270===r&&(e=-1),s=(0,mathUtils.getRotatedPoint)(s,t,e,n)}s=this.getView().getPerimeterPoint(t,s,!1)}else if(o+=r,t.cell.isVertex()){let e=t.style.flipH,n=t.style.flipV;if(l===Constants.DIRECTION.NORTH||l===Constants.DIRECTION.SOUTH){const t=e;e=n,n=t}e&&(s.x=2*i.getCenterX()-s.x),n&&(s.y=2*i.getCenterY()-s.y)}if(0!==o&&s){const t=(0,mathUtils.toRadians)(o),e=Math.cos(t),i=Math.sin(t);s=(0,mathUtils.getRotatedPoint)(s,e,i,n)}}return i&&s&&(s.x=Math.round(s.x),s.y=Math.round(s.y)),s},connectCell(t,e=null,i=!1,s=null){return this.batchUpdate((()=>{const n=t.getTerminal(i);this.cellConnected(t,e,i,s),this.fireEvent(new EventObject.A(InternalEvent.A.CONNECT_CELL,"edge",t,"terminal",e,"source",i,"previous",n))})),t},cellConnected(t,e,i=!1,s=null){this.batchUpdate((()=>{const n=t.getTerminal(i);if(this.setConnectionConstraint(t,e,i,s),this.isPortsEnabled()){let s=null;e&&this.isPort(e)&&(s=e.getId(),e=this.getTerminalForPort(e,i));const n=i?"sourcePort":"targetPort";this.setCellStyles(n,s,[t])}this.getDataModel().setTerminal(t,e,i),this.isResetEdgesOnConnect()&&this.resetEdge(t),this.fireEvent(new EventObject.A(InternalEvent.A.CELL_CONNECTED,"edge",t,"terminal",e,"source",i,"previous",n))}))},disconnectGraph(t){this.batchUpdate((()=>{const{scale:e,translate:i}=this.getView(),s=new util_Dictionary.A;for(let e=0;e<t.length;e+=1)s.put(t[e],!0);for(const n of t)if(n.isEdge()){let t=n.getGeometry();if(t){const l=this.getView().getState(n),r=n.getParent(),a=r?this.getView().getState(r):null;if(l&&a){t=t.clone();const r=-a.origin.x,o=-a.origin.y,h=l.absolutePoints;let d=n.getTerminal(!0);if(d&&this.isCellDisconnectable(n,d,!0)){for(;d&&!s.get(d);)d=d.getParent();!d&&h[0]&&(t.setTerminalPoint(new Point.A(h[0].x/e-i.x+r,h[0].y/e-i.y+o),!0),this.getDataModel().setTerminal(n,null,!0))}let c=n.getTerminal(!1);if(c&&this.isCellDisconnectable(n,c,!1)){for(;c&&!s.get(c);)c=c.getParent();if(!c){const s=h[h.length-1];s&&(t.setTerminalPoint(new Point.A(s.x/e-i.x+r,s.y/e-i.y+o),!1),this.getDataModel().setTerminal(n,null,!1))}}this.getDataModel().setGeometry(n,t)}}}}))},getConnections(t,e=null){return this.getEdges(t,e,!0,!0,!1)},isConstrainChild(t){return this.isConstrainChildren()&&!!t.getParent()&&!t.getParent().isEdge()},isConstrainChildren(){return this.constrainChildren},setConstrainChildren(t){this.constrainChildren=t},isConstrainRelativeChildren(){return this.constrainRelativeChildren},setConstrainRelativeChildren(t){this.constrainRelativeChildren=t},isDisconnectOnMove(){return this.disconnectOnMove},setDisconnectOnMove(t){this.disconnectOnMove=t},isCellDisconnectable(t,e=null,i=!1){return this.isCellsDisconnectable()&&!this.isCellLocked(t)},isCellsDisconnectable(){return this.cellsDisconnectable},setCellsDisconnectable(t){this.cellsDisconnectable=t},isValidSource(t){return null==t&&this.isAllowDanglingEdges()||null!=t&&(!t.isEdge()||this.isConnectableEdges())&&t.isConnectable()},isValidTarget(t){return this.isValidSource(t)},isValidConnection(t,e){return this.isValidSource(t)&&this.isValidTarget(e)},setConnectable(t){const e=this.getPlugin("ConnectionHandler");e?.setEnabled(t)},isConnectable(){const t=this.getPlugin("ConnectionHandler");return t?.isEnabled()??!1}},DragDropMixin={dropEnabled:!1,splitEnabled:!0,autoScroll:!0,isAutoScroll(){return this.autoScroll},autoExtend:!0,isAutoExtend(){return this.autoExtend},isDropEnabled(){return this.dropEnabled},setDropEnabled(t){this.dropEnabled=t},isSplitEnabled(){return this.splitEnabled},setSplitEnabled(t){this.splitEnabled=t},isSplitTarget(t,e=[],i){if(t.isEdge()&&1===e.length&&e[0].isConnectable()&&!this.getEdgeValidationError(t,t.getTerminal(!0),e[0])){const i=t.getTerminal(!0),s=t.getTerminal(!1);return!e[0].isAncestor(i)&&!e[0].isAncestor(s)}return!1}},EdgeMixin={resetEdgesOnResize:!1,isResetEdgesOnResize(){return this.resetEdgesOnResize},resetEdgesOnMove:!1,isResetEdgesOnMove(){return this.resetEdgesOnMove},resetEdgesOnConnect:!0,isResetEdgesOnConnect(){return this.resetEdgesOnConnect},connectableEdges:!1,allowDanglingEdges:!0,cloneInvalidEdges:!1,alternateEdgeStyle:{},edgeLabelsMovable:!0,isEdgeLabelsMovable(){return this.edgeLabelsMovable},setEdgeLabelsMovable(t){this.edgeLabelsMovable=t},setAllowDanglingEdges(t){this.allowDanglingEdges=t},isAllowDanglingEdges(){return this.allowDanglingEdges},setConnectableEdges(t){this.connectableEdges=t},isConnectableEdges(){return this.connectableEdges},setCloneInvalidEdges(t){this.cloneInvalidEdges=t},isCloneInvalidEdges(){return this.cloneInvalidEdges},flipEdge(t){return this.alternateEdgeStyle&&this.batchUpdate((()=>{const e=t.getStyle();Object.keys(e).length?this.getDataModel().setStyle(t,this.alternateEdgeStyle):this.getDataModel().setStyle(t,{}),this.resetEdge(t),this.fireEvent(new EventObject.A(InternalEvent.A.FLIP_EDGE,{edge:t}))})),t},splitEdge(t,e,i,s=0,n=0,l,r,a=null){a=a??t.getParent();const o=t.getTerminal(!0);return this.batchUpdate((()=>{if(!i){i=this.cloneCell(t);const e=this.getView().getState(t);let l=i.getGeometry();if(l&&e){const i=this.getView().translate,r=this.getView().scale,a=(0,mathUtils.findNearestSegment)(e,(s+i.x)*r,(n+i.y)*r);l.points=l.points.slice(0,a),l=t.getGeometry(),l&&(l=l.clone(),l.points=l.points.slice(a),this.getDataModel().setGeometry(t,l))}}this.cellsMoved(e,s,n,!1,!1),this.cellsAdded(e,a,a?a.getChildCount():0,null,null,!0),this.cellsAdded([i],a,a?a.getChildCount():0,o,e[0],!1),this.cellConnected(t,e[0],!0),this.fireEvent(new EventObject.A(InternalEvent.A.SPLIT_EDGE,{edge:t,cells:e,newEdge:i,dx:s,dy:n}))})),i},insertEdge(...t){let e,i,s,n,l,r;if(1===t.length&&"object"==typeof t[0]){const a=t[0];e=a.parent,i=a.id,s=a.value,n=a.source,l=a.target,r=a.style}else[e,i,s,n,l,r]=t;const a=this.createEdge(e,i,s,n,l,r);return this.addEdge(a,e,n,l)},createEdge(t=null,e,i,s=null,n=null,l={}){const r=new Cell.A(i,new Geometry.A,l);return r.setId(e),r.setEdge(!0),r.geometry.relative=!0,r},addEdge(t,e=null,i=null,s=null,n=null){return this.addCell(t,e,n,i,s)},addAllEdges(t){const e=t.slice();return(0,arrayUtils.R3)(e.concat(this.getAllEdges(t)))},getAllEdges(t){let e=[];if(t)for(let i=0;i<t.length;i+=1){const s=t[i].getEdgeCount();for(let n=0;n<s;n++)e.push(t[i].getEdgeAt(n));const n=t[i].getChildren();e=e.concat(this.getAllEdges(n))}return e},getIncomingEdges(t,e=null){return this.getEdges(t,e,!0,!1,!1)},getOutgoingEdges(t,e=null){return this.getEdges(t,e,!1,!0,!1)},getEdges(t,e=null,i=!0,s=!0,n=!0,l=!1){let r=[];const a=t.isCollapsed(),o=t.getChildCount();for(let e=0;e<o;e+=1){const n=t.getChildAt(e);!a&&n.isVisible()||(r=r.concat(n.getEdges(i,s)))}r=r.concat(t.getEdges(i,s));const h=[];for(let a=0;a<r.length;a+=1){const o=this.getView().getState(r[a]),d=o?o.getVisibleTerminal(!0):this.getView().getVisibleTerminal(r[a],!0),c=o?o.getVisibleTerminal(!1):this.getView().getVisibleTerminal(r[a],!1);(n&&d===c||d!==c&&(i&&c===t&&(!e||this.isValidAncestor(d,e,l))||s&&d===t&&(!e||this.isValidAncestor(c,e,l))))&&h.push(r[a])}return h},getChildEdges(t){return this.getChildCells(t,!1,!0)},getEdgesBetween(t,e,i=!1){const s=this.getEdges(t),n=[];for(let l=0;l<s.length;l+=1){const r=this.getView().getState(s[l]),a=r?r.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[l],!0),o=r?r.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[l],!1);(a===t&&o===e||!i&&a===e&&o===t)&&n.push(s[l])}return n},resetEdges(t){const e=new util_Dictionary.A;for(let i=0;i<t.length;i+=1)e.put(t[i],!0);this.batchUpdate((()=>{for(let i=0;i<t.length;i+=1){const s=t[i].getEdges();for(let t=0;t<s.length;t++){const i=this.getView().getState(s[t]),n=i?i.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[t],!0),l=i?i.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[t],!1);e.get(n)&&e.get(l)||this.resetEdge(s[t])}this.resetEdges(t[i].getChildren())}}))},resetEdge(t){let e=t.getGeometry();return e&&e.points&&e.points.length>0&&(e=e.clone(),e.points=[],this.getDataModel().setGeometry(t,e)),t}},EditingMixin={cellsEditable:!0,startEditing(t){this.startEditingAtCell(null,t)},startEditingAtCell(t=null,e){if(!e||!(0,EventUtils.isMultiTouchEvent)(e))if(t){this.fireEvent(new EventObject.A(InternalEvent.A.START_EDITING,{cell:t,event:e}));const i=this.getPlugin("CellEditorHandler");i?.startEditing(t,e),this.fireEvent(new EventObject.A(InternalEvent.A.EDITING_STARTED,{cell:t,event:e}))}else(t=this.getSelectionCell())&&!this.isCellEditable(t)&&(t=null)},getEditingValue(t,e){return this.convertValueToString(t)},stopEditing(t=!1){const e=this.getPlugin("CellEditorHandler");e?.stopEditing(t),this.fireEvent(new EventObject.A(InternalEvent.A.EDITING_STOPPED,{cancel:t}))},labelChanged(t,e,i){return this.batchUpdate((()=>{const s=t.value;this.cellLabelChanged(t,e,this.isAutoSizeCell(t)),this.fireEvent(new EventObject.A(InternalEvent.A.LABEL_CHANGED,{cell:t,value:e,old:s,event:i}))})),t},cellLabelChanged(t,e,i=!1){this.batchUpdate((()=>{this.getDataModel().setValue(t,e),i&&this.cellSizeUpdated(t,!1)}))},isEditing(t=null){const e=this.getPlugin("CellEditorHandler"),i=e?.getEditingCell();return t?t===i:!!i},isCellEditable(t){return this.isCellsEditable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).editable??!0)},isCellsEditable(){return this.cellsEditable},setCellsEditable(t){this.cellsEditable=t}},EventsMixin={lastTouchEvent:null,doubleClickCounter:0,lastTouchCell:null,fireDoubleClick:null,tapAndHoldThread:null,lastMouseX:null,lastMouseY:null,isMouseTrigger:null,ignoreMouseEvents:null,mouseMoveRedirect:null,mouseUpRedirect:null,lastEvent:null,escapeEnabled:!0,invokesStopCellEditing:!0,enterStopsCellEditing:!1,isMouseDown:!1,nativeDblClickEnabled:!0,doubleTapEnabled:!0,doubleTapTimeout:500,doubleTapTolerance:25,lastTouchX:0,lastTouchY:0,lastTouchTime:0,tapAndHoldEnabled:!0,tapAndHoldDelay:500,tapAndHoldInProgress:!1,tapAndHoldValid:!1,initialTouchX:0,initialTouchY:0,tolerance:4,isNativeDblClickEnabled(){return this.nativeDblClickEnabled},getEventTolerance(){return this.tolerance},setEventTolerance(t){this.tolerance=t},escape(t){this.fireEvent(new EventObject.A(InternalEvent.A.ESCAPE,{event:t}))},click(t){const e=t.getEvent();let i=t.getCell();const s=new EventObject.A(InternalEvent.A.CLICK,{event:e,cell:i});if(t.isConsumed()&&s.consume(),this.fireEvent(s),this.isEnabled()&&!(0,EventUtils.isConsumed)(e)&&!s.isConsumed()){if(i){if(this.isTransparentClickEvent(e)){let e=!1;const s=this.getCellAt(t.graphX,t.graphY,null,!1,!1,(t=>{const s=this.isCellSelected(t.cell);return e=e||s,!e||s||t.cell!==i&&t.cell.isAncestor(i)}));s&&(i=s)}}else if(this.isSwimlaneSelectionEnabled()&&(i=this.getSwimlaneAt(t.getGraphX(),t.getGraphY()),!(null==i||this.isToggleEvent(e)&&(0,EventUtils.isAltDown)(e)))){let t=i,s=[];for(;null!=t;){t=t.getParent();const e=this.getView().getState(t);this.isSwimlane(t)&&null!=e&&s.push(t)}if(s.length>0){s=s.reverse(),s.splice(0,0,i),s.push(i);for(let t=0;t<s.length-1;t+=1)this.isCellSelected(s[t])&&(i=s[this.isToggleEvent(e)?t:t+1])}}i?this.selectCellForEvent(i,e):this.isToggleEvent(e)||this.clearSelection()}return!1},dblClick(t,e=null){const i=new EventObject.A(InternalEvent.A.DOUBLE_CLICK,{event:t,cell:e});this.fireEvent(i),this.isEnabled()&&!(0,EventUtils.isConsumed)(t)&&!i.isConsumed()&&e&&this.isCellEditable(e)&&!this.isEditing(e)&&(this.startEditingAtCell(e,t),InternalEvent.A.consume(t))},tapAndHold(t){const e=t.getEvent(),i=new EventObject.A(InternalEvent.A.TAP_AND_HOLD,{event:e,cell:t.getCell()}),s=this.getPlugin("PanningHandler"),n=this.getPlugin("ConnectionHandler");if(this.fireEvent(i),i.isConsumed()&&s&&(s.panningTrigger=!1),this.isEnabled()&&!(0,EventUtils.isConsumed)(e)&&!i.isConsumed()&&n&&n.isEnabled()){const e=n.marker.getCell(t);if(e){const i=this.getView().getState(e);i&&(n.marker.currentColor=n.marker.validColor,n.marker.markedState=i,n.marker.mark(),n.first=new Point.A(t.getGraphX(),t.getGraphY()),n.edgeState=n.createEdgeState(t),n.previous=i,n.fireEvent(new EventObject.A(InternalEvent.A.START,{state:n.previous})))}}},addMouseListener(t){this.mouseListeners.push(t)},removeMouseListener(t){for(let e=0;e<this.mouseListeners.length;e+=1)if(this.mouseListeners[e]===t){this.mouseListeners.splice(e,1);break}},updateMouseEvent(t,e){const i=(0,styleUtils.convertPoint)(this.getContainer(),t.getX(),t.getY());if(t.graphX=i.x-this.getPanDx(),t.graphY=i.y-this.getPanDy(),!t.getCell()&&this.isMouseDown&&e===InternalEvent.A.MOUSE_MOVE){const e=this.getCellAt(i.x,i.y,null,!0,!0,(t=>!t.shape||t.shape.paintBackground!==this.paintBackground||t.style.pointerEvents||t.shape.fill!==Constants.NONE));t.state=e?this.getView().getState(e):null}return t},getStateForTouchEvent(t){const e=(0,EventUtils.getClientX)(t),i=(0,EventUtils.getClientY)(t),s=(0,styleUtils.convertPoint)(this.getContainer(),e,i),n=this.getCellAt(s.x,s.y);return n?this.getView().getState(n):null},isEventIgnored(t,e,i){const s=(0,EventUtils.isMouseEvent)(e.getEvent());let n=!1;e.getEvent()===this.lastEvent?n=!0:this.lastEvent=e.getEvent();const l=this.getEventSource();return l&&t!==InternalEvent.A.MOUSE_MOVE?(InternalEvent.A.removeGestureListeners(l,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.mouseMoveRedirect=null,this.mouseUpRedirect=null,this.setEventSource(null)):!Client.A.IS_GC&&l&&e.getSource()!==l?n=!0:l&&Client.A.IS_TOUCH&&t===InternalEvent.A.MOUSE_DOWN&&!s&&!(0,EventUtils.isPenEvent)(e.getEvent())&&(this.setEventSource(e.getSource()),this.mouseMoveRedirect=t=>{this.fireMouseEvent(InternalEvent.A.MOUSE_MOVE,new InternalMouseEvent.A(t,this.getStateForTouchEvent(t)))},this.mouseUpRedirect=t=>{this.fireMouseEvent(InternalEvent.A.MOUSE_UP,new InternalMouseEvent.A(t,this.getStateForTouchEvent(t)))},InternalEvent.A.addGestureListeners(l,null,this.mouseMoveRedirect,this.mouseUpRedirect)),this.isSyntheticEventIgnored(t,e,i)&&(n=!0),!(0,EventUtils.isPopupTrigger)(this.lastEvent)&&t!==InternalEvent.A.MOUSE_MOVE&&2===this.lastEvent.detail||(t===InternalEvent.A.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:t!==InternalEvent.A.MOUSE_DOWN||this.isMouseDown?!n&&((!Client.A.IS_FF||t!==InternalEvent.A.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!==s||t===InternalEvent.A.MOUSE_DOWN&&this.isMouseDown||t===InternalEvent.A.MOUSE_UP&&!this.isMouseDown)&&(n=!0):(this.isMouseDown=!0,this.isMouseTrigger=s),n||t!==InternalEvent.A.MOUSE_DOWN||(this.lastMouseX=e.getX(),this.lastMouseY=e.getY()),n)},isSyntheticEventIgnored(t,e,i){let s=!1;const n=(0,EventUtils.isMouseEvent)(e.getEvent());return this.ignoreMouseEvents&&n&&t!==InternalEvent.A.MOUSE_MOVE?(this.ignoreMouseEvents=t!==InternalEvent.A.MOUSE_UP,s=!0):Client.A.IS_FF&&!n&&t===InternalEvent.A.MOUSE_UP&&(this.ignoreMouseEvents=!0),s},isEventSourceIgnored(t,e){const i=e.getSource();if(!i)return!0;const s=i.nodeName?i.nodeName.toLowerCase():"",n=!(0,EventUtils.isMouseEvent)(e.getEvent())||(0,EventUtils.isLeftMouseButton)(e.getEvent());return t===InternalEvent.A.MOUSE_DOWN&&n&&("select"===s||"option"===s||"input"===s&&"checkbox"!==i.type&&"radio"!==i.type&&"button"!==i.type&&"submit"!==i.type&&"file"!==i.type)},getEventState:t=>t,fireMouseEvent(t,e,i){if(i=i??this,this.isEventSourceIgnored(t,e)){const t=this.getPlugin("TooltipHandler");t&&t.hide()}else{if(e=this.updateMouseEvent(e,t),!this.nativeDblClickEnabled&&!(0,EventUtils.isPopupTrigger)(e.getEvent())||this.doubleTapEnabled&&Client.A.IS_TOUCH&&((0,EventUtils.isTouchEvent)(e.getEvent())||(0,EventUtils.isPenEvent)(e.getEvent()))){const i=(new Date).getTime();if(t===InternalEvent.A.MOUSE_DOWN)if(this.lastTouchEvent&&this.lastTouchEvent!==e.getEvent()&&i-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance&&this.doubleClickCounter<2){this.doubleClickCounter+=1;let i=!1;if(t===InternalEvent.A.MOUSE_UP){if(e.getCell()===this.lastTouchCell&&this.lastTouchCell){this.lastTouchTime=0;const t=this.lastTouchCell;this.lastTouchCell=null,this.dblClick(e.getEvent(),t),i=!0}}else this.fireDoubleClick=!0,this.lastTouchTime=0;if(i)return void InternalEvent.A.consume(e.getEvent())}else this.lastTouchEvent&&this.lastTouchEvent===e.getEvent()||(this.lastTouchCell=e.getCell(),this.lastTouchX=e.getX(),this.lastTouchY=e.getY(),this.lastTouchTime=i,this.lastTouchEvent=e.getEvent(),this.doubleClickCounter=0);else if((this.isMouseDown||t===InternalEvent.A.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;const t=this.lastTouchCell;return this.lastTouchCell=null,this.isMouseDown=!1,void((t||((0,EventUtils.isTouchEvent)(e.getEvent())||(0,EventUtils.isPenEvent)(e.getEvent()))&&(Client.A.IS_GC||Client.A.IS_SF))&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance?this.dblClick(e.getEvent(),t):InternalEvent.A.consume(e.getEvent()))}}if(!this.isEventIgnored(t,e,i)){const s=e.getState();if(e.state=s?this.getEventState(s):null,this.fireEvent(new EventObject.A(InternalEvent.A.FIRE_MOUSE_EVENT,{eventName:t,event:e})),Client.A.IS_SF||Client.A.IS_GC||e.getEvent().target!==this.getContainer()){const s=this.getContainer();if(t===InternalEvent.A.MOUSE_MOVE&&this.isMouseDown&&this.isAutoScroll()&&!(0,EventUtils.isMultiTouchEvent)(e.getEvent()))this.scrollPointToVisible(e.getGraphX(),e.getGraphY(),this.isAutoExtend());else if(t===InternalEvent.A.MOUSE_UP&&this.isIgnoreScrollbars()&&this.isTranslateToScrollPosition()&&(0!==s.scrollLeft||0!==s.scrollTop)){const t=this.getView().scale,e=this.getView().translate;this.getView().setTranslate(e.x-s.scrollLeft/t,e.y-s.scrollTop/t),s.scrollLeft=0,s.scrollTop=0}const n=this.mouseListeners;e.getEvent().preventDefault||(e.getEvent().returnValue=!0);for(const s of n)t===InternalEvent.A.MOUSE_DOWN?s.mouseDown(i,e):t===InternalEvent.A.MOUSE_MOVE?s.mouseMove(i,e):t===InternalEvent.A.MOUSE_UP&&s.mouseUp(i,e);t===InternalEvent.A.MOUSE_UP&&this.click(e)}if(((0,EventUtils.isTouchEvent)(e.getEvent())||(0,EventUtils.isPenEvent)(e.getEvent()))&&t===InternalEvent.A.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress){this.tapAndHoldInProgress=!0,this.initialTouchX=e.getGraphX(),this.initialTouchY=e.getGraphY();const t=()=>{this.tapAndHoldValid&&this.tapAndHold(e),this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1};this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(t,this.tapAndHoldDelay),this.tapAndHoldValid=!0}else t===InternalEvent.A.MOUSE_UP?(this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1):this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-e.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-e.getGraphY())<this.tolerance);const n=this.getPlugin("CellEditorHandler");t===InternalEvent.A.MOUSE_DOWN&&this.isEditing()&&!n?.isEventSource(e.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing()),this.consumeMouseEvent(t,e,i)}}},consumeMouseEvent(t,e,i){i=i??this,t===InternalEvent.A.MOUSE_DOWN&&(0,EventUtils.isTouchEvent)(e.getEvent())&&e.consume(!1)},fireGestureEvent(t,e=null){this.lastTouchTime=0,this.fireEvent(new EventObject.A(InternalEvent.A.GESTURE,{event:t,cell:e}))},sizeDidChange(){const t=this.getGraphBounds(),e=this.getBorder();let i=Math.max(0,t.x)+t.width+2*e,s=Math.max(0,t.y)+t.height+2*e;const n=this.getMinimumContainerSize();if(n&&(i=Math.max(i,n.width),s=Math.max(s,n.height)),this.isResizeContainer()&&this.doResizeContainer(i,s),this.isPreferPageSize()||this.isPageVisible()){const e=this.getPreferredPageSize(t,Math.max(1,i),Math.max(1,s));i=e.width*this.getView().scale,s=e.height*this.getView().scale}const l=this.getMinimumGraphSize();l&&(i=Math.max(i,l.width*this.getView().scale),s=Math.max(s,l.height*this.getView().scale)),i=Math.ceil(i),s=Math.ceil(s);const r=this.getView().getDrawPane().ownerSVGElement;r&&(r.style.minWidth=`${Math.max(1,i)}px`,r.style.minHeight=`${Math.max(1,s)}px`,r.style.width="100%",r.style.height="100%"),this.updatePageBreaks(this.isPageBreaksVisible(),i,s),this.fireEvent(new EventObject.A(InternalEvent.A.SIZE,{bounds:t}))},isCloneEvent:t=>(0,EventUtils.isControlDown)(t),isTransparentClickEvent:t=>!1,isToggleEvent:t=>Client.A.IS_MAC?(0,EventUtils.isMetaDown)(t):(0,EventUtils.isControlDown)(t),isGridEnabledEvent:t=>!(0,EventUtils.isAltDown)(t),isConstrainedEvent:t=>(0,EventUtils.isShiftDown)(t),isIgnoreTerminalEvent:t=>!1,getPointForEvent(t,e=!0){const i=(0,styleUtils.convertPoint)(this.getContainer(),(0,EventUtils.getClientX)(t),(0,EventUtils.getClientY)(t)),s=this.getView().scale,n=this.getView().translate,l=e?this.getGridSize()/2:0;return i.x=this.snap(i.x/s-n.x-l),i.y=this.snap(i.y/s-n.y-l),i},isEscapeEnabled(){return this.escapeEnabled},setEscapeEnabled(t){this.escapeEnabled=t},isInvokesStopCellEditing(){return this.invokesStopCellEditing},setInvokesStopCellEditing(t){this.invokesStopCellEditing=t},isEnterStopsCellEditing(){return this.enterStopsCellEditing},setEnterStopsCellEditing(t){this.enterStopsCellEditing=t},getCursorForMouseEvent(t){const e=t.getCell();return e?this.getCursorForCell(e):null}},FoldingMixin={options:{foldingEnabled:!0,collapsedImage:new image_ImageBox(`${Client.A.imageBasePath}/collapsed.gif`,9,9),expandedImage:new image_ImageBox(`${Client.A.imageBasePath}/expanded.gif`,9,9),collapseToPreferredSize:!0},collapseExpandResource:"none"!=Client.A.language?"collapse-expand":"",getCollapseExpandResource(){return this.collapseExpandResource},isFoldingEnabled(){return this.options.foldingEnabled},getFoldableCells(t,e=!1){return this.getDataModel().filterCells(t,(t=>this.isCellFoldable(t,e)))},isCellFoldable(t,e){const i=this.getCurrentCellStyle(t);return t.getChildCount()>0&&(i.foldable??!0)},getFoldingImage(t){if(null!=t&&this.isFoldingEnabled()&&!t.cell.isEdge()){const e=t.cell.isCollapsed();if(this.isCellFoldable(t.cell,!e))return e?this.options.collapsedImage:this.options.expandedImage}return null},foldCells(t=!1,e=!1,i=null,s=!1,n=null){return null==i&&(i=this.getFoldableCells(this.getSelectionCells(),t)),this.stopEditing(!1),this.batchUpdate((()=>{this.cellsFolded(i,t,e,s),this.fireEvent(new EventObject.A(InternalEvent.A.FOLD_CELLS,"collapse",t,"recurse",e,"cells",i))})),i},cellsFolded(t=null,e=!1,i=!1,s=!1){null!=t&&t.length>0&&this.batchUpdate((()=>{for(let n=0;n<t.length;n+=1)if((!s||this.isCellFoldable(t[n],e))&&e!==t[n].isCollapsed()){if(this.getDataModel().setCollapsed(t[n],e),this.swapBounds(t[n],e),this.isExtendParent(t[n])&&this.extendParent(t[n]),i){const s=t[n].getChildren();this.cellsFolded(s,e,i)}this.constrainChild(t[n])}this.fireEvent(new EventObject.A(InternalEvent.A.CELLS_FOLDED,{cells:t,collapse:e,recurse:i}))}))},swapBounds(t,e=!1){let i=t.getGeometry();null!=i&&(i=i.clone(),this.updateAlternateBounds(t,i,e),i.swap(),this.getDataModel().setGeometry(t,i))},updateAlternateBounds(t=null,e=null,i=!1){if(null!=t&&null!=e){const i=this.getCurrentCellStyle(t);if(null==e.alternateBounds){let s=e;if(this.options.collapseToPreferredSize){const e=this.getPreferredSizeForCell(t);if(null!=e){s=e;const t=(0,Utils.getValue)(i,"startSize");t>0&&(s.height=Math.max(s.height,t))}}e.alternateBounds=new Rectangle.A(0,0,s.width,s.height)}if(null!=e.alternateBounds){e.alternateBounds.x=e.x,e.alternateBounds.y=e.y;const t=(0,mathUtils.toRadians)(i.rotation||0);if(0!==t){const i=e.alternateBounds.getCenterX()-e.getCenterX(),s=e.alternateBounds.getCenterY()-e.getCenterY(),n=Math.cos(t),l=Math.sin(t),r=n*i-l*s,a=l*i+n*s;e.alternateBounds.x+=r-i,e.alternateBounds.y+=a-s}}}}},GroupingMixin={groupCells(t,e=0,i){i||(i=(0,styleUtils.sortCells)(this.getSelectionCells(),!0)),i||(i=this.getCellsForGroup(i)),null==t&&(t=this.createGroupCell(i));const s=this.getBoundsForGroup(t,i,e);if(i.length>1&&null!=s){let n=t.getParent();null==n&&(n=i[0].getParent()),this.batchUpdate((()=>{null==t.getGeometry()&&this.getDataModel().setGeometry(t,new Geometry.A);let l=n.getChildCount();this.cellsAdded([t],n,l,null,null,!1,!1,!1),l=t.getChildCount(),this.cellsAdded(i,t,l,null,null,!1,!1,!1),this.cellsMoved(i,-s.x,-s.y,!1,!1,!1),this.cellsResized([t],[s],!1),this.fireEvent(new EventObject.A(InternalEvent.A.GROUP_CELLS,{group:t,border:e,cells:i}))}))}return t},getCellsForGroup(t){const e=[];if(null!=t&&t.length>0){const i=t[0].getParent();e.push(t[0]);for(let s=1;s<t.length;s+=1)t[s].getParent()===i&&e.push(t[s])}return e},getBoundsForGroup(t,e,i){const s=this.getBoundingBoxFromGeometry(e,!0);if(null!=s){if(this.isSwimlane(t)){const e=this.getStartSize(t);s.x-=e.width,s.y-=e.height,s.width+=e.width,s.height+=e.height}null!=i&&(s.x-=i,s.y-=i,s.width+=2*i,s.height+=2*i)}return s},createGroupCell(t){const e=new Cell.A("");return e.setVertex(!0),e.setConnectable(!1),e},ungroupCells(t){let e=[];return null==t&&(t=this.getCellsForUngroup()),null!=t&&t.length>0&&this.batchUpdate((()=>{const i=t;for(let t=0;t<i.length;t+=1){let s=i[t].getChildren();if(null!=s&&s.length>0){s=s.slice();const n=i[t].getParent(),l=n.getChildCount();this.cellsAdded(s,n,l,null,null,!0),e=e.concat(s);for(const t of s){const e=this.getView().getState(t);let i=t.getGeometry();null!=e&&null!=i&&i.relative&&(i=i.clone(),i.x=e.origin.x,i.y=e.origin.y,i.relative=!1,this.getDataModel().setGeometry(t,i))}}}this.removeCellsAfterUngroup(i),this.fireEvent(new EventObject.A(InternalEvent.A.UNGROUP_CELLS,{cells:t}))})),e},getCellsForUngroup(){const t=this.getSelectionCells(),e=[];for(let i=0;i<t.length;i+=1)t[i].isVertex()&&t[i].getChildCount()>0&&e.push(t[i]);return e},removeCellsAfterUngroup(t){this.cellsRemoved(this.addAllEdges(t))},removeCellsFromParent(t){return null==t&&(t=this.getSelectionCells()),this.batchUpdate((()=>{const e=this.getDefaultParent(),i=e.getChildCount();this.cellsAdded(t,e,i,null,null,!0),this.fireEvent(new EventObject.A(InternalEvent.A.REMOVE_CELLS_FROM_PARENT,{cells:t}))})),t},updateGroupBounds(t,e=0,i=!1,s=0,n=0,l=0,r=0){return null==t&&(t=this.getSelectionCells()),e=null!=e?e:0,i=null!=i&&i,s=null!=s?s:0,n=null!=n?n:0,l=null!=l?l:0,r=null!=r?r:0,this.batchUpdate((()=>{for(let a=t.length-1;a>=0;a--){let o=t[a].getGeometry();if(null==o)continue;const h=this.getChildCells(t[a]);if(null!=h&&h.length>0){const d=this.getBoundingBoxFromGeometry(h,!0);if(null!=d&&d.width>0&&d.height>0){const c=this.isSwimlane(t[a])?this.getActualStartSize(t[a],!0):new Rectangle.A;o=o.clone(),i&&(o.x=Math.round(o.x+d.x-e-c.x-r),o.y=Math.round(o.y+d.y-e-c.y-s)),o.width=Math.round(d.width+2*e+c.x+r+n+c.width),o.height=Math.round(d.height+2*e+c.y+s+l+c.height),this.getDataModel().setGeometry(t[a],o),this.moveCells(h,e+c.x-d.x+r,e+c.y-d.y+s)}}}})),t},enterGroup(t){null!=(t=t||this.getSelectionCell())&&this.isValidRoot(t)&&(this.getView().setCurrentRoot(t),this.clearSelection())},exitGroup(){const t=this.getDataModel().getRoot(),e=this.getCurrentRoot();if(null!=e){let i=e.getParent();for(;i!==t&&!this.isValidRoot(i)&&i.getParent()!==t;)i=i.getParent();i===t||i.getParent()===t?this.getView().setCurrentRoot(null):this.getView().setCurrentRoot(i),null!=this.getView().getState(e)&&this.setSelectionCell(e)}}},ImageMixin={addImageBundle(t){this.imageBundles.push(t)},removeImageBundle(t){const e=[];for(let i=0;i<this.imageBundles.length;i+=1)this.imageBundles[i]!==t&&e.push(this.imageBundles[i]);this.imageBundles=e},getImageFromBundles(t){if(t)for(let e=0;e<this.imageBundles.length;e+=1){const i=this.imageBundles[e].getImage(t);if(i)return i}return null}},LabelMixin={getLabel(t){let e="";return this.isLabelsVisible()&&null!=t&&(this.getCurrentCellStyle(t).noLabel||(e=this.convertValueToString(t))),e},isHtmlLabel(t){return this.isHtmlLabels()},labelsVisible:!0,isLabelsVisible(){return this.labelsVisible},htmlLabels:!1,isHtmlLabels(){return this.htmlLabels},setHtmlLabels(t){this.htmlLabels=t},isWrapping(t){return"wrap"===this.getCurrentCellStyle(t).whiteSpace},isLabelClipped(t){return"hidden"===this.getCurrentCellStyle(t).overflow},isLabelMovable(t){return!this.isCellLocked(t)&&(t.isEdge()&&this.isEdgeLabelsMovable()||t.isVertex()&&this.isVertexLabelsMovable())}},OrderMixin={orderCells(t=!1,e){return e||(e=this.getSelectionCells()),e||(e=(0,styleUtils.sortCells)(this.getSelectionCells(),!0)),this.batchUpdate((()=>{this.cellsOrdered(e,t);const i=new EventObject.A(InternalEvent.A.ORDER_CELLS,"back",t,"cells",e);this.fireEvent(i)})),e},cellsOrdered(t,e=!1){this.batchUpdate((()=>{for(let i=0;i<t.length;i+=1){const s=t[i].getParent();e?this.getDataModel().add(s,t[i],i):this.getDataModel().add(s,t[i],s?s.getChildCount()-1:0)}this.fireEvent(new EventObject.A(InternalEvent.A.CELLS_ORDERED,{back:e,cells:t}))}))}};class CellOverlay extends EventSource.A{constructor(t,e=null,i="right",s="bottom",n=new Point.A,l="help"){super(),this.align="right",this.verticalAlign="bottom",this.offset=new Point.A,this.cursor="help",this.defaultOverlap=.5,this.image=t,this.tooltip=e,this.align=i,this.verticalAlign=s,this.offset=n,this.cursor=l}getBounds(t){const e=t.cell.isEdge(),i=t.view.scale;let s=null;const n=this.image,l=n.width,r=n.height;if(e){const e=t.absolutePoints;if(e.length%2==1)s=e[Math.floor(e.length/2)];else{const t=e.length/2,i=e[t-1],n=e[t];s=new Point.A(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}}else{if(s=new Point.A,"left"===this.align)s.x=t.x;else if("center"===this.align)s.x=t.x+t.width/2;else{if("right"!==this.align)throw new Error;s.x=t.x+t.width}if("top"===this.verticalAlign)s.y=t.y;else if("middle"===this.verticalAlign)s.y=t.y+t.height/2;else{if("bottom"!==this.verticalAlign)throw new Error;s.y=t.y+t.height}}return new Rectangle.A(Math.round(s.x-(l*this.defaultOverlap-this.offset.x)*i),Math.round(s.y-(r*this.defaultOverlap-this.offset.y)*i),l*i,r*i)}toString(){return this.tooltip}}const cell_CellOverlay=CellOverlay,OverlaysMixin={addCellOverlay(t,e){t.overlays.push(e);const i=this.getView().getState(t);return i&&this.getCellRenderer().redraw(i),this.fireEvent(new EventObject.A(InternalEvent.A.ADD_OVERLAY,{cell:t,overlay:e})),e},getCellOverlays:t=>t.overlays,removeCellOverlay(t,e=null){if(e){const i=t.overlays.indexOf(e);if(i>=0){t.overlays.splice(i,1);const s=this.getView().getState(t);s&&this.getCellRenderer().redraw(s),this.fireEvent(new EventObject.A(InternalEvent.A.REMOVE_OVERLAY,{cell:t,overlay:e}))}else e=null}else this.removeCellOverlays(t);return e},removeCellOverlays(t){const{overlays:e}=t;t.overlays=[];const i=this.getView().getState(t);i&&this.getCellRenderer().redraw(i);for(let i=0;i<e.length;i+=1)this.fireEvent(new EventObject.A(InternalEvent.A.REMOVE_OVERLAY,"cell",t,"overlay",e[i]));return e},clearCellOverlays(t=null){if(!(t=t??this.getDataModel().getRoot()))return;this.removeCellOverlays(t);const e=t.getChildCount();for(let i=0;i<e;i+=1){const e=t.getChildAt(i);this.clearCellOverlays(e)}},setCellWarning(t,e=null,i,s=!1){if(i=i??this.getWarningImage(),e&&e.length>0){const n=new cell_CellOverlay(i,`<font color=red>${e}</font>`);return s&&n.addListener(InternalEvent.A.CLICK,((e,i)=>{this.isEnabled()&&this.setSelectionCell(t)})),this.addCellOverlay(t,n)}return this.removeCellOverlays(t),null}},PageBreaksMixin={horizontalPageBreaks:null,verticalPageBreaks:null,updatePageBreaks(t,e,i){const{scale:s,translate:n}=this.getView(),l=this.getPageFormat(),r=s*this.getPageScale(),a=new Rectangle.A(0,0,l.width*r,l.height*r),o=Rectangle.A.fromRectangle(this.getGraphBounds());o.width=Math.max(1,o.width),o.height=Math.max(1,o.height),a.x=Math.floor((o.x-n.x*s)/a.width)*a.width+n.x*s,a.y=Math.floor((o.y-n.y*s)/a.height)*a.height+n.y*s,o.width=Math.ceil((o.width+(o.x-a.x))/a.width)*a.width,o.height=Math.ceil((o.height+(o.y-a.y))/a.height)*a.height;const h=(t=t&&Math.min(a.width,a.height)>this.getMinPageBreakDist())?Math.ceil(o.height/a.height)+1:0,d=t?Math.ceil(o.width/a.width)+1:0,c=(d-1)*a.width,u=(h-1)*a.height;null==this.horizontalPageBreaks&&h>0&&(this.horizontalPageBreaks=[]),null==this.verticalPageBreaks&&d>0&&(this.verticalPageBreaks=[]);const g=t=>{if(null!=t){const e=t===this.horizontalPageBreaks?h:d;for(let i=0;i<=e;i+=1){const e=t===this.horizontalPageBreaks?[new Point.A(Math.round(a.x),Math.round(a.y+i*a.height)),new Point.A(Math.round(a.x+c),Math.round(a.y+i*a.height))]:[new Point.A(Math.round(a.x+i*a.width),Math.round(a.y)),new Point.A(Math.round(a.x+i*a.width),Math.round(a.y+u))];if(null!=t[i])t[i].points=e,t[i].redraw();else{const s=new PolylineShape.A(e,this.getPageBreakColor());s.dialect=this.getDialect(),s.pointerEvents=!1,s.isDashed=this.isPageBreakDashed(),s.init(this.getView().backgroundPane),s.redraw(),t[i]=s}}for(let i=e;i<t.length;i+=1)t[i].destroy();t.splice(e,t.length-e)}};g(this.horizontalPageBreaks),g(this.verticalPageBreaks)}},PanningMixin={shiftPreview1:null,shiftPreview2:null,useScrollbarsForPanning:!0,isUseScrollbarsForPanning(){return this.useScrollbarsForPanning},timerAutoScroll:!1,isTimerAutoScroll(){return this.timerAutoScroll},allowAutoPanning:!1,isAllowAutoPanning(){return this.allowAutoPanning},panDx:0,getPanDx(){return this.panDx},setPanDx(t){this.panDx=t},panDy:0,getPanDy(){return this.panDy},setPanDy(t){this.panDy=t},panGraph(t,e){const i=this.getContainer();if(this.useScrollbarsForPanning&&(0,styleUtils.hasScrollbars)(i))i.scrollLeft=-t,i.scrollTop=-e;else{const s=this.getView().getCanvas();if(0===t&&0===e){if(s.removeAttribute("transform"),this.shiftPreview1){let t=this.shiftPreview1.firstChild;for(;t;){const e=t.nextSibling;i.appendChild(t),t=e}this.shiftPreview1.parentNode&&this.shiftPreview1.parentNode.removeChild(this.shiftPreview1),this.shiftPreview1=null,i.appendChild(s.parentNode);const e=this.shiftPreview2;for(t=e.firstChild;t;){const e=t.nextSibling;i.appendChild(t),t=e}e.parentNode&&e.parentNode.removeChild(e),this.shiftPreview2=null}}else{if(s.setAttribute("transform",`translate(${t},${e})`),!this.shiftPreview1){this.shiftPreview1=document.createElement("div"),this.shiftPreview1.style.position="absolute",this.shiftPreview1.style.overflow="visible",this.shiftPreview2=document.createElement("div"),this.shiftPreview2.style.position="absolute",this.shiftPreview2.style.overflow="visible";let t=this.shiftPreview1,e=i.firstChild;for(;e;){const i=e.nextSibling;e!==s.parentNode?t.appendChild(e):t=this.shiftPreview2,e=i}this.shiftPreview1.firstChild&&i.insertBefore(this.shiftPreview1,s.parentNode),this.shiftPreview2.firstChild&&i.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=`${t}px`,this.shiftPreview1.style.top=`${e}px`,this.shiftPreview2&&(this.shiftPreview2.style.left=`${t}px`,this.shiftPreview2.style.top=`${e}px`)}this.panDx=t,this.panDy=e,this.fireEvent(new EventObject.A(InternalEvent.A.PAN))}},scrollCellToVisible(t,e=!1){const i=-this.getView().translate.x,s=-this.getView().translate.y,n=this.getView().getState(t);if(n){const t=new Rectangle.A(i+n.x,s+n.y,n.width,n.height);if(e&&this.getContainer()){const e=this.getContainer().clientWidth,i=this.getContainer().clientHeight;t.x=t.getCenterX()-e/2,t.width=e,t.y=t.getCenterY()-i/2,t.height=i}const l=new Point.A(this.getView().translate.x,this.getView().translate.y);if(this.scrollRectToVisible(t)){const t=new Point.A(this.getView().translate.x,this.getView().translate.y);this.getView().translate.x=l.x,this.getView().translate.y=l.y,this.getView().setTranslate(t.x,t.y)}}},scrollRectToVisible(t){let e=!1;const i=this.getContainer(),s=i.offsetWidth,n=i.offsetHeight,l=Math.min(s,t.width),r=Math.min(n,t.height);if((0,styleUtils.hasScrollbars)(i)){t.x+=this.getView().translate.x,t.y+=this.getView().translate.y;let e=i.scrollLeft-t.x;const s=Math.max(e-i.scrollLeft,0);e>0?i.scrollLeft-=e+2:(e=t.x+l-i.scrollLeft-i.clientWidth,e>0&&(i.scrollLeft+=e+2));let n=i.scrollTop-t.y;const a=Math.max(0,n-i.scrollTop);n>0?i.scrollTop-=n+2:(n=t.y+r-i.scrollTop-i.clientHeight,n>0&&(i.scrollTop+=n+2)),this.useScrollbarsForPanning||0==s&&0==a||this.getView().setTranslate(s,a)}else{const i=-this.getView().translate.x,a=-this.getView().translate.y,o=this.getView().scale;if(t.x+l>i+s&&(this.getView().translate.x-=(t.x+l-s-i)/o,e=!0),t.y+r>a+n&&(this.getView().translate.y-=(t.y+r-n-a)/o,e=!0),t.x<i&&(this.getView().translate.x+=(i-t.x)/o,e=!0),t.y<a&&(this.getView().translate.y+=(a-t.y)/o,e=!0),e){this.getView().refresh();const t=this.getPlugin("SelectionCellsHandler");t&&t.refresh()}}return e},setPanning(t){const e=this.getPlugin("PanningHandler");e&&(e.panningEnabled=t)}},PortsMixin={portsEnabled:!0,isPort:t=>!1,getTerminalForPort:(t,e=!1)=>t.getParent(),isPortsEnabled(){return this.portsEnabled},setPortsEnabled(t){this.portsEnabled=t}},SelectionMixin={selectionModel:null,getSelectionModel(){return this.selectionModel},setSelectionModel(t){this.selectionModel=t},isCellSelected(t){return this.selectionModel.isSelected(t)},isSelectionEmpty(){return this.selectionModel.isEmpty()},clearSelection(){this.selectionModel.clear()},getSelectionCount(){return this.selectionModel.cells.length},getSelectionCell(){return this.selectionModel.cells[0]},getSelectionCells(){return this.selectionModel.cells.slice()},setSelectionCell(t){this.selectionModel.setCell(t)},setSelectionCells(t){this.selectionModel.setCells(t)},addSelectionCell(t){this.selectionModel.addCell(t)},addSelectionCells(t){this.selectionModel.addCells(t)},removeSelectionCell(t){this.selectionModel.removeCell(t)},removeSelectionCells(t){this.selectionModel.removeCells(t)},selectRegion(t,e){const i=this.getCells(t.x,t.y,t.width,t.height);return this.selectCellsForEvent(i,e),i},selectNextCell(){this.selectCell(!0)},selectPreviousCell(){this.selectCell()},selectParentCell(){this.selectCell(!1,!0)},selectChildCell(){this.selectCell(!1,!1,!0)},selectCell(t=!1,e=!1,i=!1){const s=this.selectionModel.cells.length>0?this.selectionModel.cells[0]:null;this.selectionModel.cells.length>1&&this.selectionModel.clear();const n=s?s.getParent():this.getDefaultParent(),l=n.getChildCount();if(!s&&l>0){const t=n.getChildAt(0);this.setSelectionCell(t)}else if(n&&(!s||e)&&this.getView().getState(n)&&n.getGeometry())this.getCurrentRoot()!==n&&this.setSelectionCell(n);else if(s&&i){if(s.getChildCount()>0){const t=s.getChildAt(0);this.setSelectionCell(t)}}else if(l>0){let e=n.getIndex(s);if(t){e++;const t=n.getChildAt(e%l);this.setSelectionCell(t)}else{e--;const t=e<0?l-1:e,i=n.getChildAt(t);this.setSelectionCell(i)}}},selectAll(t,e=!1){t=t??this.getDefaultParent();const i=e?t.filterDescendants((e=>e!==t&&!!this.getView().getState(e))):t.getChildren();this.setSelectionCells(i)},selectVertices(t,e=!1){this.selectCells(!0,!1,t,e)},selectEdges(t){this.selectCells(!1,!0,t)},selectCells(t=!1,e=!1,i,s=!1){const n=(i=i??this.getDefaultParent()).filterDescendants((i=>{const n=i.getParent();return!!this.getView().getState(i)&&((s||0===i.getChildCount())&&i.isVertex()&&t&&n&&!n.isEdge()||i.isEdge()&&e)}));this.setSelectionCells(n)},selectCellForEvent(t,e){const i=this.isCellSelected(t);this.isToggleEvent(e)?i?this.removeSelectionCell(t):this.addSelectionCell(t):i&&1===this.getSelectionCount()||this.setSelectionCell(t)},selectCellsForEvent(t,e){this.isToggleEvent(e)?this.addSelectionCells(t):this.setSelectionCells(t)},isSiblingSelected(t){const e=t.getParent(),i=e.getChildCount();for(let s=0;s<i;s+=1){const i=e.getChildAt(s);if(t!==i&&this.isCellSelected(i))return!0}return!1},getSelectionCellsForChanges(t,e=null){const i=new util_Dictionary.A,s=[],n=t=>{if(!i.get(t)&&this.getDataModel().contains(t))if(t.isEdge()||t.isVertex())i.put(t,!0),s.push(t);else{const e=t.getChildCount();for(let i=0;i<e;i+=1)n(t.getChildAt(i))}};for(let i=0;i<t.length;i+=1){const s=t[i];if(!(s.constructor===undoable_changes_RootChange||e&&e(s))){let t=null;s instanceof undoable_changes_ChildChange?t=s.child:s.cell&&s.cell instanceof Cell.A&&(t=s.cell),t&&n(t)}}return s},updateSelection(){const t=this.getSelectionCells(),e=[];for(const i of t)if(this.getDataModel().contains(i)&&i.isVisible()){let t=i.getParent();for(;t&&t!==this.getView().currentRoot;){if(t.isCollapsed()||!t.isVisible()){e.push(i);break}t=t.getParent()}}else e.push(i);this.removeSelectionCells(e)}},SnapMixin={snapTolerance:0,getSnapTolerance(){return this.snapTolerance},gridSize:10,gridEnabled:!0,snap(t){return this.gridEnabled&&(t=Math.round(t/this.gridSize)*this.gridSize),t},snapDelta(t,e,i=!1,s=!1,n=!1){const l=this.getView().translate,r=this.getView().scale;if(!i&&this.gridEnabled){const i=this.gridSize*r*.5;if(!s){const s=e.x-(this.snap(e.x/r-l.x)+l.x)*r;Math.abs(t.x-s)<i?t.x=0:t.x=this.snap(t.x/r)*r-s}if(!n){const s=e.y-(this.snap(e.y/r-l.y)+l.y)*r;Math.abs(t.y-s)<i?t.y=0:t.y=this.snap(t.y/r)*r-s}}else{const i=.5*r;if(!s){const s=e.x-(Math.round(e.x/r-l.x)+l.x)*r;Math.abs(t.x-s)<i?t.x=0:t.x=Math.round(t.x/r)*r-s}if(!n){const s=e.y-(Math.round(e.y/r-l.y)+l.y)*r;Math.abs(t.y-s)<i?t.y=0:t.y=Math.round(t.y/r)*r-s}}return t},isGridEnabled(){return this.gridEnabled},setGridEnabled(t){this.gridEnabled=t},getGridSize(){return this.gridSize},setGridSize(t){this.gridSize=t}},SwimlaneMixin={swimlaneSelectionEnabled:!0,swimlaneNesting:!0,swimlaneIndicatorColorAttribute:"fillColor",getSwimlane(t=null){for(;t&&!this.isSwimlane(t);)t=t.getParent();return t},getSwimlaneAt(t,e,i){if(i||(i=this.getCurrentRoot())||(i=this.getDataModel().getRoot()),i){const s=i.getChildCount();for(let n=0;n<s;n+=1){const s=i.getChildAt(n);if(s){const i=this.getSwimlaneAt(t,e,s);if(null!=i)return i;if(s.isVisible()&&this.isSwimlane(s)){const i=this.getView().getState(s);if(i&&this.intersects(i,t,e))return s}}}}return null},hitsSwimlaneContent(t,e,i){const s=this.getView().getState(t),n=this.getStartSize(t);if(s){const t=this.getView().getScale();if(e-=s.x,i-=s.y,n.width>0&&e>0&&e>n.width*t)return!0;if(n.height>0&&i>0&&i>n.height*t)return!0}return!1},getStartSize(t,e=!1){const i=new Rectangle.A,s=this.getCurrentCellStyle(t,e),n=s.startSize??Constants.DEFAULT_STARTSIZE;return s.horizontal??1?i.height=n:i.width=n,i},getSwimlaneDirection(t){const e=t.direction??Constants.DIRECTION.EAST,i=t.flipH,s=t.flipV;let n=t.horizontal??1?0:3;e===Constants.DIRECTION.NORTH?n--:e===Constants.DIRECTION.WEST?n+=2:e===Constants.DIRECTION.SOUTH&&(n+=1);const l=(0,mathUtils.mod)(n,2);return i&&1===l&&(n+=2),s&&0===l&&(n+=2),[Constants.DIRECTION.NORTH,Constants.DIRECTION.EAST,Constants.DIRECTION.SOUTH,Constants.DIRECTION.WEST][(0,mathUtils.mod)(n,4)]},getActualStartSize(t,e=!1){const i=new Rectangle.A;if(this.isSwimlane(t,e)){const s=this.getCurrentCellStyle(t,e),n=s.startSize??Constants.DEFAULT_STARTSIZE,l=this.getSwimlaneDirection(s);l===Constants.DIRECTION.NORTH?i.y=n:l===Constants.DIRECTION.WEST?i.x=n:l===Constants.DIRECTION.SOUTH?i.height=n:i.width=n}return i},isSwimlane(t,e=!1){return!(!t||t.getParent()===this.getDataModel().getRoot()||t.isEdge())&&this.getCurrentCellStyle(t,e).shape===Constants.SHAPE.SWIMLANE},isValidDropTarget(t,e,i){return t&&(this.isSplitEnabled()&&this.isSplitTarget(t,e,i)||!t.isEdge()&&(this.isSwimlane(t)||t.getChildCount()>0&&!t.isCollapsed()))},getDropTarget(t,e,i=null,s=!1){if(!this.isSwimlaneNesting())for(let e=0;e<t.length;e+=1)if(this.isSwimlane(t[e]))return null;const n=(0,styleUtils.convertPoint)(this.getContainer(),(0,EventUtils.getClientX)(e),(0,EventUtils.getClientY)(e));n.x-=this.getPanDx(),n.y-=this.getPanDy();const l=this.getSwimlaneAt(n.x,n.y);if(i){if(l){let t=l.getParent();for(;t&&this.isSwimlane(t)&&t!==i;)t=t.getParent();t===i&&(i=l)}}else i=l;for(;i&&!this.isValidDropTarget(i,t,e)&&!this.getDataModel().isLayer(i);)i=i.getParent();let r=i;if(!s)for(;r&&t.indexOf(r)<0;)r=r.getParent();return this.getDataModel().isLayer(i)||r?null:i},isSwimlaneNesting(){return this.swimlaneNesting},setSwimlaneNesting(t){this.swimlaneNesting=t},isSwimlaneSelectionEnabled(){return this.swimlaneSelectionEnabled},setSwimlaneSelectionEnabled(t){this.swimlaneSelectionEnabled=t}},TerminalMixin={isTerminalPointMovable:(t,e)=>!0,getOpposites(t,e=null,i=!0,s=!0){const n=[],l=new util_Dictionary.A;for(let r=0;r<t.length;r+=1){const a=this.getView().getState(t[r]),o=a?a.getVisibleTerminal(!0):this.getView().getVisibleTerminal(t[r],!0),h=a?a.getVisibleTerminal(!1):this.getView().getVisibleTerminal(t[r],!1);o===e&&h&&h!==e&&s?l.get(h)||(l.put(h,!0),n.push(h)):h===e&&o&&o!==e&&i&&(l.get(o)||(l.put(o,!0),n.push(o)))}return n}},TooltipMixin={getTooltip(t,e,i,s){let n=null;if(!t.control||e!==t.control.node&&e.parentNode!==t.control.node||(n=this.getCollapseExpandResource(),n=(0,StringUtils.htmlEntities)(Translations.A.get(n)||n,!0).replace(/\\n/g,"<br>")),!n&&t.overlays&&t.overlays.visit(((t,i)=>{n||e!==i.node&&e.parentNode!==i.node||(n=i.overlay?i.overlay.toString()??null:null)})),!n){const i=this.getPlugin("SelectionCellsHandler"),s=i?.getHandler(t.cell);s&&"getTooltipForNode"in s&&"function"==typeof s.getTooltipForNode&&(n=s.getTooltipForNode(e))}return n||(n=this.getTooltipForCell(t.cell)),n},getTooltipForCell(t){let e=null;return e=t&&"getTooltip"in t?t.getTooltip():this.convertValueToString(t),e},setTooltips(t){const e=this.getPlugin("TooltipHandler");e?.setEnabled(t)}},ValidationMixin={validationAlert(t){alert(t)},isEdgeValid(t,e,i){return!this.getEdgeValidationError(t,e,i)},getEdgeValidationError(t=null,e=null,i=null){if(t&&!this.isAllowDanglingEdges()&&(!e||!i))return"";if(t&&!t.getTerminal(!0)&&!t.getTerminal(!1))return null;if(!this.isAllowLoops()&&e===i&&e)return"";if(!this.isValidConnection(e,i))return"";if(e&&i){let s="";if(!this.isMultigraph()){const n=this.getDataModel().getEdgesBetween(e,i,!0);(n.length>1||1===n.length&&n[0]!==t)&&(s+=`${Translations.A.get(this.getAlreadyConnectedResource())||this.getAlreadyConnectedResource()}\n`)}const n=e.getDirectedEdgeCount(!0,t),l=i.getDirectedEdgeCount(!1,t);for(const r of this.multiplicities){const a=r.check(this,t,e,i,n,l);null!=a&&(s+=a)}const r=this.validateEdge(t,e,i);return null!=r&&(s+=r),s.length>0?s:null}return this.isAllowDanglingEdges()?null:""},validateEdge:(t=null,e=null,i=null)=>null,validateGraph(t=null,e){if(!(t=t??this.getDataModel().getRoot()))return"The root does not exist!";e=e??{};let i=!0;const s=t.getChildCount();for(let n=0;n<s;n+=1){const s=t.getChildAt(n);let l=e;this.isValidRoot(s)&&(l={});const r=this.validateGraph(s,l);r?this.setCellWarning(s,r.replace(/\n/g,"<br>")):this.setCellWarning(s,null),i=i&&null==r}let n="";t&&t.isCollapsed()&&!i&&(n+=`${Translations.A.get(this.getContainsValidationErrorsResource())||this.getContainsValidationErrorsResource()}\n`),t&&t.isEdge()?n+=this.getEdgeValidationError(t,t.getTerminal(!0),t.getTerminal(!1))||"":n+=this.getCellValidationError(t)||"";const l=this.validateCell(t,e);return null!=l&&(n+=l),null==t.getParent()&&this.getView().validate(),n.length>0||!i?n:null},getCellValidationError(t){const e=t.getDirectedEdgeCount(!0),i=t.getDirectedEdgeCount(!1),s=t.getValue();let n="";for(let t=0;t<this.multiplicities.length;t+=1){const l=this.multiplicities[t];(l.source&&(0,domUtils.isNode)(s,l.type,l.attr,l.value)&&(e>l.max||e<l.min)||!l.source&&(0,domUtils.isNode)(s,l.type,l.attr,l.value)&&(i>l.max||i<l.min))&&(n+=`${l.countError}\n`)}return n.length>0?n:null},validateCell:(t,e)=>null},VertexMixin={vertexLabelsMovable:!1,allowNegativeCoordinates:!0,isAllowNegativeCoordinates(){return this.allowNegativeCoordinates},setAllowNegativeCoordinates(t){this.allowNegativeCoordinates=t},insertVertex(...t){let e,i,s,n,l,r,a,o,h,d;if(1===t.length&&"object"==typeof t[0]){const c=t[0];e=c.parent,i=c.id,s=c.value,n="x"in c?c.x:c.position?.[0],l="y"in c?c.y:c.position?.[1],r="width"in c?c.width:c.size?.[0],a="height"in c?c.height:c.size?.[1],o=c.style,h=c.relative,d=c.geometryClass}else[e,i,s,n,l,r,a,o,h,d]=t;const c=this.createVertex(e,i,s,n,l,r,a,o,h,d);return this.addCell(c,e)},createVertex(t,e,i,s,n,l,r,a,o=!1,h=Geometry.A){const d=new h(s,n,l,r);d.relative=o;const c=new Cell.A(i,d,a);return c.setId(e),c.setVertex(!0),c.setConnectable(!0),c},getChildVertices(t){return this.getChildCells(t,!0,!1)},isVertexLabelsMovable(){return this.vertexLabelsMovable},setVertexLabelsMovable(t){this.vertexLabelsMovable=t}},ZoomMixin={zoomFactor:1.2,keepSelectionVisibleOnZoom:!1,centerZoom:!0,zoomIn(){this.zoom(this.zoomFactor)},zoomOut(){this.zoom(1/this.zoomFactor)},zoomActual(){1===this.getView().scale?this.getView().setTranslate(0,0):(this.getView().translate.x=0,this.getView().translate.y=0,this.getView().setScale(1))},zoomTo(t,e=!1){this.zoom(t/this.getView().scale,e)},zoom(t,e){e=e??this.centerZoom;const i=Math.round(this.getView().scale*t*100)/100,s=this.getView().getState(this.getSelectionCell()),n=this.getContainer();if(t=i/this.getView().scale,this.keepSelectionVisibleOnZoom&&null!=s){const e=new Rectangle.A(s.x*t,s.y*t,s.width*t,s.height*t);this.getView().scale=i,this.scrollRectToVisible(e)||(this.getView().revalidate(),this.getView().setScale(i))}else{const s=(0,styleUtils.hasScrollbars)(this.getContainer());if(e&&!s){let e=n.offsetWidth,s=n.offsetHeight;if(t>1){const n=(t-1)/(2*i);e*=-n,s*=-n}else{const i=(1/t-1)/(2*this.getView().scale);e*=i,s*=i}this.getView().scaleAndTranslate(i,this.getView().translate.x+e,this.getView().translate.y+s)}else{const l=this.getView().translate.x,r=this.getView().translate.y,a=n.scrollLeft,o=n.scrollTop;if(this.getView().setScale(i),s){let i=0,s=0;e&&(i=n.offsetWidth*(t-1)/2,s=n.offsetHeight*(t-1)/2),n.scrollLeft=(this.getView().translate.x-l)*this.getView().scale+Math.round(a*t+i),n.scrollTop=(this.getView().translate.y-r)*this.getView().scale+Math.round(o*t+s)}}}},zoomToRect(t){const e=this.getContainer(),i=e.clientWidth/t.width/(e.clientHeight/t.height);t.x=Math.max(0,t.x),t.y=Math.max(0,t.y);let s=Math.min(e.scrollWidth,t.x+t.width),n=Math.min(e.scrollHeight,t.y+t.height);if(t.width=s-t.x,t.height=n-t.y,i<1){const s=t.height/i,l=(s-t.height)/2;t.height=s;const r=Math.min(t.y,l);t.y-=r,n=Math.min(e.scrollHeight,t.y+t.height),t.height=n-t.y}else{const n=t.width*i,l=(n-t.width)/2;t.width=n;const r=Math.min(t.x,l);t.x-=r,s=Math.min(e.scrollWidth,t.x+t.width),t.width=s-t.x}const l=e.clientWidth/t.width,r=this.getView().scale*l;(0,styleUtils.hasScrollbars)(this.getContainer())?(this.getView().setScale(r),e.scrollLeft=Math.round(t.x*l),e.scrollTop=Math.round(t.y*l)):this.getView().scaleAndTranslate(r,this.getView().translate.x-t.x/this.getView().scale,this.getView().translate.y-t.y/this.getView().scale)}},applyGraphMixins=()=>{const t=(0,Utils.mixInto)(Graph);for(const e of[CellsMixin,ConnectionsMixin,DragDropMixin,EdgeMixin,EditingMixin,EventsMixin,FoldingMixin,GroupingMixin,ImageMixin,LabelMixin,OrderMixin,PageBreaksMixin,OverlaysMixin,PanningMixin,PortsMixin,SelectionMixin,SnapMixin,SwimlaneMixin,TerminalMixin,TooltipMixin,ValidationMixin,VertexMixin,ZoomMixin])t(e)};class CellEditorHandler{constructor(t){this.clearOnChange=!1,this.bounds=null,this.resizeThread=null,this.textDirection=null,this.textarea=null,this.editingCell=null,this.trigger=null,this.modified=!1,this.autoSize=!0,this.selectText=!0,this.emptyLabelText=Client.A.IS_FF?"<br>":"",this.escapeCancelsEditing=!0,this.textNode=null,this.zIndex=5,this.minResize=new Rectangle.A(0,20),this.wordWrapPadding=0,this.blurEnabled=!1,this.initialValue=null,this.align=null,this.graph=t,this.zoomHandler=()=>{this.graph.isEditing()&&this.resize()},this.changeHandler=t=>{this.editingCell&&!this.graph.getView().getState(this.editingCell,!1)&&this.stopEditing(!0)},this.graph.getView().addListener(InternalEvent.A.SCALE,this.zoomHandler),this.graph.getView().addListener(InternalEvent.A.SCALE_AND_TRANSLATE,this.zoomHandler),this.graph.getDataModel().addListener(InternalEvent.A.CHANGE,this.changeHandler)}init(){this.textarea=document.createElement("div"),this.textarea.className="mxCellEditor mxPlainTextEditor",this.textarea.contentEditable=String(!0),Client.A.IS_GC&&(this.textarea.style.minHeight="1em"),this.textarea.style.position="absolute",this.installListeners(this.textarea)}applyValue(t,e){this.graph.labelChanged(t.cell,e,this.trigger)}setAlign(t){this.textarea&&(this.textarea.style.textAlign=t),this.align=t,this.resize()}getInitialValue(t,e){let i=(0,StringUtils.htmlEntities)(this.graph.getEditingValue(t.cell,e),!1);return i=(0,StringUtils.replaceTrailingNewlines)(i,"<div><br></div>"),i.replace(/\n/g,"<br>")}getCurrentValue(t){return this.textarea?(0,domUtils.extractTextWithWhitespace)(Array.from(this.textarea.childNodes)):null}isCancelEditingKeyEvent(t){return this.escapeCancelsEditing||(0,EventUtils.isShiftDown)(t)||(0,EventUtils.isControlDown)(t)||(0,EventUtils.isMetaDown)(t)}installListeners(t){InternalEvent.A.addListener(t,"dragstart",(t=>{this.graph.stopEditing(!1),InternalEvent.A.consume(t)})),InternalEvent.A.addListener(t,"blur",(t=>{this.blurEnabled&&this.focusLost()})),InternalEvent.A.addListener(t,"keydown",(t=>{(0,EventUtils.isConsumed)(t)||(this.isStopEditingEvent(t)?(this.graph.stopEditing(!1),InternalEvent.A.consume(t)):27===t.keyCode&&(this.graph.stopEditing(this.isCancelEditingKeyEvent(t)),InternalEvent.A.consume(t)))}));const e=e=>{null!=this.editingCell&&this.clearOnChange&&t.innerHTML===this.getEmptyLabelText()&&(!Client.A.IS_FF||8!==e.keyCode&&46!==e.keyCode)&&(this.clearOnChange=!1,t.innerHTML="")};InternalEvent.A.addListener(t,"keypress",e),InternalEvent.A.addListener(t,"paste",e);const i=t=>{if(null!=this.editingCell){const t=this.textarea;0===t.innerHTML.length||"<br>"===t.innerHTML?(t.innerHTML=this.getEmptyLabelText(),this.clearOnChange=t.innerHTML.length>0):this.clearOnChange=!1}};InternalEvent.A.addListener(t,"input",i),InternalEvent.A.addListener(t,"cut",i),InternalEvent.A.addListener(t,"paste",i);const s=t=>{null!=this.editingCell&&this.autoSize&&!(0,EventUtils.isConsumed)(t)&&(null!=this.resizeThread&&window.clearTimeout(this.resizeThread),this.resizeThread=window.setTimeout((()=>{this.resizeThread=null,this.resize()}),0))};InternalEvent.A.addListener(t,"input",s),InternalEvent.A.addListener(window,"resize",s),InternalEvent.A.addListener(t,"cut",s),InternalEvent.A.addListener(t,"paste",s)}isStopEditingEvent(t){return 113===t.keyCode||this.graph.isEnterStopsCellEditing()&&13===t.keyCode&&!(0,EventUtils.isControlDown)(t)&&!(0,EventUtils.isShiftDown)(t)}isEventSource(t){return(0,EventUtils.getSource)(t)===this.textarea}resize(){const t=this.editingCell?this.graph.getView().getState(this.editingCell):null;if(t){if(null!=this.textarea){const e=t.cell.isEdge(),{scale:i}=this.graph.getView();let s=null;if(this.autoSize&&"fill"!==t.style.overflow){const n=(0,Utils.getValue)(t.style,"labelWidth",null);if(s=null!=t.text&&null==this.align?t.text.margin:null,null==s&&(s=(0,styleUtils.getAlignmentAsPoint)(this.align||(0,Utils.getValue)(t.style,"align",Constants.ALIGN.CENTER),(0,Utils.getValue)(t.style,"verticalAlign",Constants.ALIGN.MIDDLE))),e){if(this.bounds=new Rectangle.A(t.absoluteOffset.x,t.absoluteOffset.y,0,0),null!=n){const t=(parseFloat(n)+2)*i;this.bounds.width=t,this.bounds.x+=s.x*t}}else{let e=Rectangle.A.fromRectangle(t),s=(0,Utils.getValue)(t.style,"labelPosition",Constants.ALIGN.CENTER),l=(0,Utils.getValue)(t.style,"verticalLabelPosition",Constants.ALIGN.MIDDLE);if(e=null!=t.shape&&"center"===s&&"middle"===l?t.shape.getLabelBounds(e):e,null!=n&&(e.width=parseFloat(n)*i),!t.view.graph.cellRenderer.legacySpacing||"width"!==t.style.overflow){const r=new node_TextShape,a=(t.style.spacing??2)*i,o=((t.style.spacingTop??0)+r.baseSpacingTop)*i+a,h=((t.style.spacingRight??0)+r.baseSpacingRight)*i+a,d=((t.style.spacingBottom??0)+r.baseSpacingBottom)*i+a,c=((t.style.spacingLeft??0)+r.baseSpacingLeft)*i+a;s=null!=t.style.labelPosition?t.style.labelPosition:"center",l=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle",e=new Rectangle.A(e.x+c,e.y+o,e.width-(s===Constants.ALIGN.CENTER&&null==n?c+h:0),e.height-(l===Constants.ALIGN.MIDDLE?o+d:0))}this.bounds=new Rectangle.A(e.x+t.absoluteOffset.x,e.y+t.absoluteOffset.y,e.width,e.height)}if(this.graph.isWrapping(t.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()){this.textarea.style.wordWrap=Constants.WORD_WRAP,this.textarea.style.whiteSpace="normal";const t=Math.round(this.bounds.width/i)+this.wordWrapPadding;"relative"!==this.textarea.style.position?(this.textarea.style.width=`${t}px`,this.textarea.scrollWidth>t&&(this.textarea.style.width=`${this.textarea.scrollWidth}px`)):this.textarea.style.maxWidth=`${t}px`}else this.textarea.style.whiteSpace="nowrap",this.textarea.style.width="";this.textarea.scrollWidth,this.textarea.scrollHeight,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x-s.x*(this.bounds.width-2))+1)}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y-s.y*(this.bounds.height-4)+(-1===s.y?3:0))+1)}px`}else this.bounds=this.getEditorBounds(t),this.textarea.style.width=`${Math.round(this.bounds.width/i)}px`,this.textarea.style.height=`${Math.round(this.bounds.height/i)}px`,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x+1))}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y+1))}px`,this.graph.isWrapping(t.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()?(this.textarea.style.wordWrap=Constants.WORD_WRAP,this.textarea.style.whiteSpace="normal","fill"!==t.style.overflow&&(this.textarea.style.width=`${Math.round(this.bounds.width/i)+this.wordWrapPadding}px`)):(this.textarea.style.whiteSpace="nowrap","fill"!==t.style.overflow&&(this.textarea.style.width=""));(0,styleUtils.setPrefixedStyle)(this.textarea.style,"transformOrigin","0px 0px"),(0,styleUtils.setPrefixedStyle)(this.textarea.style,"transform",`scale(${i},${i})${null==s?"":` translate(${100*s.x}%,${100*s.y}%)`}`)}}else this.stopEditing(!0)}focusLost(){this.stopEditing(!this.graph.isInvokesStopCellEditing())}getBackgroundColor(t){return Constants.NONE}startEditing(t,e=null){this.stopEditing(!0),this.align=null,null==this.textarea&&this.init();const i=this.graph.getPlugin("TooltipHandler");i?.hideTooltip();const s=this.graph.getView().getState(t);if(s){const{scale:i}=this.graph.getView(),n=s.style.fontSize??Constants.DEFAULT_FONTSIZE,l=s.style.fontFamily??Constants.DEFAULT_FONTFAMILY,r=s.style.fontColor??"black",a=s.style.align??Constants.ALIGN.LEFT,o=(s.style.fontStyle||0)&Constants.FONT.BOLD,h=(s.style.fontStyle||0)&Constants.FONT.ITALIC,d=[];(s.style.fontStyle||0)&Constants.FONT.UNDERLINE&&d.push("underline"),(s.style.fontStyle||0)&Constants.FONT.STRIKETHROUGH&&d.push("line-through");const c=this.textarea;c.style.lineHeight=Constants.ABSOLUTE_LINE_HEIGHT?`${Math.round(n*Constants.LINE_HEIGHT)}px`:String(Constants.LINE_HEIGHT),c.style.backgroundColor=this.getBackgroundColor(s)||"transparent",c.style.textDecoration=d.join(" "),c.style.fontWeight=o?"bold":"normal",c.style.fontStyle=h?"italic":"",c.style.fontSize=`${Math.round(n)}px`,c.style.zIndex=String(this.zIndex),c.style.fontFamily=l,c.style.textAlign=a,c.style.outline="none",c.style.color=r;let u=this.textDirection=s.style.textDirection??Constants.DEFAULT_TEXT_DIRECTION;"auto"===u&&(null===s.text||s.text.dialect===Constants.DIALECT.STRICTHTML||(0,domUtils.isNode)(s.text.value)||(u=s.text.getAutoDirection())),"ltr"===u||"rtl"===u?c.setAttribute("dir",u):c.removeAttribute("dir"),c.innerHTML=this.getInitialValue(s,e)||"",this.initialValue=c.innerHTML,0===c.innerHTML.length||"<br>"===c.innerHTML?(c.innerHTML=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=c.innerHTML===this.getEmptyLabelText(),this.graph.container.appendChild(c),this.editingCell=t,this.trigger=e,this.textNode=null,null!==s.text&&this.isHideLabel(s)&&(this.textNode=s.text.node,this.textNode.style.visibility="hidden"),this.autoSize&&(s.cell.isEdge()||"fill"!==s.style.overflow)&&window.setTimeout((()=>{this.resize()}),0),this.resize();try{c.focus(),this.isSelectText()&&c.innerHTML.length>0&&(c.innerHTML!==this.getEmptyLabelText()||!this.clearOnChange)&&document.execCommand("selectAll",!1)}catch(t){}}}isSelectText(){return this.selectText}stopEditing(t=!1){if(this.editingCell){this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null);const e=t?null:this.graph.view.getState(this.editingCell),i=this.textarea,s=this.initialValue;if(this.initialValue=null,this.editingCell=null,this.bounds=null,i.blur(),(0,domUtils.clearSelection)(),i.parentNode&&i.parentNode.removeChild(i),this.clearOnChange&&i.innerHTML===this.getEmptyLabelText()&&(i.innerHTML="",this.clearOnChange=!1),e&&(i.innerHTML!==s||null!==this.align)){this.prepareTextarea();const t=this.getCurrentValue(e);this.graph.batchUpdate((()=>{null!==t&&this.applyValue(e,t),null!==this.align&&this.graph.setCellStyles("align",this.align,[e.cell])}))}this.trigger=null,this.textarea&&InternalEvent.A.release(this.textarea),this.textarea=null,this.align=null}}prepareTextarea(){const t=this.textarea;t.lastChild&&"BR"===t.lastChild.nodeName&&t.removeChild(t.lastChild)}isHideLabel(t=null){return!0}getMinimumSize(t){const{scale:e}=this.graph.getView(),i=this.textarea;return new Rectangle.A(0,0,null===t.text?30:t.text.size*e+20,"left"===i.style.textAlign?120:40)}getEditorBounds(t){const e=t.cell.isEdge(),{scale:i}=this.graph.getView(),s=this.getMinimumSize(t),n=s.width,l=s.height;let r=null;if(!e&&t.view.graph.cellRenderer.legacySpacing&&"fill"===t.style.overflow)r=t.shape.getLabelBounds(Rectangle.A.fromRectangle(t));else{const s=new node_TextShape,a=(t.style.spacing??0)*i,o=((t.style.spacingTop??0)+s.baseSpacingTop)*i+a,h=((t.style.spacingRight??0)+s.baseSpacingRight)*i+a,d=((t.style.spacingBottom??0)+s.baseSpacingBottom)*i+a,c=((t.style.spacingLeft??0)+s.baseSpacingLeft)*i+a;r=new Rectangle.A(t.x,t.y,Math.max(n,t.width-c-h),Math.max(l,t.height-o-d));const u=null!=t.style.labelPosition?t.style.labelPosition:"center",g=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle";if(r=null!=t.shape&&"center"===u&&"middle"===g?t.shape.getLabelBounds(r):r,e?(r.x=t.absoluteOffset.x,r.y=t.absoluteOffset.y,null!=t.text&&null!=t.text.boundingBox&&(t.text.boundingBox.x>0&&(r.x=t.text.boundingBox.x),t.text.boundingBox.y>0&&(r.y=t.text.boundingBox.y))):null!=t.text&&null!=t.text.boundingBox&&(r.x=Math.min(r.x,t.text.boundingBox.x),r.y=Math.min(r.y,t.text.boundingBox.y)),r.x+=c,r.y+=o,null!=t.text&&null!=t.text.boundingBox&&(e?(r.width=Math.max(n,t.text.boundingBox.width),r.height=Math.max(l,t.text.boundingBox.height)):(r.width=Math.max(r.width,t.text.boundingBox.width),r.height=Math.max(r.height,t.text.boundingBox.height))),t.cell.isVertex()){const e=(0,StringUtils.getStringValue)(t.style,"labelPosition",Constants.ALIGN.CENTER);"left"===e?r.x-=t.width:"right"===e&&(r.x+=t.width);const i=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle";"top"===i?r.y-=t.height:"bottom"===i&&(r.y+=t.height)}}return new Rectangle.A(Math.round(r.x),Math.round(r.y),Math.round(r.width),Math.round(r.height))}getEmptyLabelText(t=null){return this.emptyLabelText??""}getEditingCell(){return this.editingCell}onDestroy(){this.textarea&&(InternalEvent.A.release(this.textarea),this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null),this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.zoomHandler)}}CellEditorHandler.pluginId="CellEditorHandler";const handler_CellEditorHandler=CellEditorHandler;class TooltipHandler{constructor(t){this.zIndex=10005,this.delay=500,this.ignoreTouchEvents=!0,this.hideOnHover=!1,this.destroyed=!1,this.lastX=0,this.lastY=0,this.state=null,this.stateSource=!1,this.thread=null,this.enabled=!1,this.graph=t,this.graph.addMouseListener(this),this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),InternalEvent.A.addGestureListeners(this.div,(t=>{const e=(0,EventUtils.getSource)(t);e&&"A"!==e.nodeName&&this.hideTooltip()})),InternalEvent.A.addListener(this.graph.getContainer(),"mouseleave",(t=>{this.div!==t.relatedTarget&&this.hide()}))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isHideOnHover(){return this.hideOnHover}setHideOnHover(t){this.hideOnHover=t}getStateForEvent(t){return t.getState()}mouseDown(t,e){this.reset(e,!1),this.hideTooltip()}mouseMove(t,e){if(e.getX()!==this.lastX||e.getY()!==this.lastY){this.reset(e,!0);const t=this.getStateForEvent(e);(this.isHideOnHover()||t!==this.state||e.getSource()!==this.node&&(!this.stateSource||null!=t&&this.stateSource===(e.isSource(t.shape)||!e.isSource(t.text))))&&this.hideTooltip()}this.lastX=e.getX(),this.lastY=e.getY()}mouseUp(t,e){this.reset(e,!0),this.hideTooltip()}resetTimer(){this.thread&&(window.clearTimeout(this.thread),this.thread=null)}reset(t,e,i=null){if((!this.ignoreTouchEvents||(0,EventUtils.isMouseEvent)(t.getEvent()))&&(this.resetTimer(),i=i??this.getStateForEvent(t),e&&this.isEnabled()&&i&&"hidden"===this.div.style.visibility)){const e=t.getSource(),s=t.getX(),n=t.getY(),l=t.isSource(i.shape)||t.isSource(i.text),r=this.graph.getPlugin("PopupMenuHandler");this.thread=window.setTimeout((()=>{if(i&&e&&!this.graph.isEditing()&&r&&!r.isMenuShowing()&&!this.graph.isMouseDown){const t=this.graph.getTooltip(i,e,s,n);this.show(t,s,n),this.state=i,this.node=e,this.stateSource=l}}),this.delay)}}hide(){this.resetTimer(),this.hideTooltip()}hideTooltip(){this.div.style.visibility="hidden",this.div.innerHTML=""}show(t,e,i){if(!this.destroyed&&t&&""!==t){const s=(0,styleUtils.getScrollOrigin)();this.div.style.zIndex=String(this.zIndex),this.div.style.left=`${e+s.x}px`,this.div.style.top=`${i+Constants.TOOLTIP_VERTICAL_OFFSET+s.y}px`,(0,domUtils.isNode)(t)?(this.div.innerHTML="",this.div.appendChild(t)):this.div.innerHTML=t.replace(/\n/g,"<br>"),this.div.style.visibility="",(0,styleUtils.fit)(this.div)}}onDestroy(){this.destroyed||(this.graph.removeMouseListener(this),InternalEvent.A.release(this.div),this.div.parentNode&&this.div.parentNode.removeChild(this.div),this.destroyed=!0)}}TooltipHandler.pluginId="TooltipHandler";const handler_TooltipHandler=TooltipHandler;class SelectionCellsHandler extends EventSource.A{constructor(t){super(),this.enabled=!0,this.maxHandlers=100,this.graph=t,this.handlers=new util_Dictionary.A,this.graph.addMouseListener(this),this.refreshHandler=(t,e)=>{this.isEnabled()&&this.refresh()},this.graph.getSelectionModel().addListener(InternalEvent.A.CHANGE,this.refreshHandler),this.graph.getDataModel().addListener(InternalEvent.A.CHANGE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.A.SCALE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.A.TRANSLATE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.A.SCALE_AND_TRANSLATE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.A.DOWN,this.refreshHandler),this.graph.getView().addListener(InternalEvent.A.UP,this.refreshHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getHandler(t){return this.handlers.get(t)}isHandled(t){return!!this.getHandler(t)}reset(){this.handlers.visit(((t,e)=>{e.reset.apply(e)}))}getHandledSelectionCells(){return this.graph.getSelectionCells()}refresh(){const t=this.handlers;this.handlers=new util_Dictionary.A;const e=(0,styleUtils.sortCells)(this.getHandledSelectionCells(),!1);for(let i=0;i<e.length;i+=1){const s=this.graph.view.getState(e[i]);if(s){let n=t.remove(e[i]);n&&(n.state!==s?(n.onDestroy(),n=null):this.isHandlerActive(n)||(n.refresh&&n.refresh(),n.redraw())),n&&this.handlers.put(e[i],n)}}t.visit(((t,e)=>{this.fireEvent(new EventObject.A(InternalEvent.A.REMOVE,{state:e.state})),e.onDestroy()}));for(let t=0;t<e.length;t+=1){const i=this.graph.view.getState(e[t]);if(i){let s=this.handlers.get(e[t]);s?s.updateParentHighlight():(s=this.graph.createHandler(i),this.fireEvent(new EventObject.A(InternalEvent.A.ADD,{state:i})),this.handlers.put(e[t],s))}}}isHandlerActive(t){return null!==t.index}updateHandler(t){let e=this.handlers.remove(t.cell);if(e){const{index:i}=e,s=e.startX,n=e.startY;e.onDestroy(),e=this.graph.createHandler(t),e&&(this.handlers.put(t.cell,e),null!==i&&e.start(s,n,i))}}mouseDown(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseDown(t,e)}))}mouseMove(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseMove(t,e)}))}mouseUp(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseUp(t,e)}))}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.refreshHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler)}}SelectionCellsHandler.pluginId="SelectionCellsHandler";const handler_SelectionCellsHandler=SelectionCellsHandler;var MaxPopupMenu=__webpack_require__(8437);class PopupMenuHandler extends MaxPopupMenu.A{constructor(t){super(),this.inTolerance=!1,this.popupTrigger=!1,this.selectOnPopup=!0,this.clearSelectionOnBackground=!0,this.triggerX=null,this.triggerY=null,this.screenX=null,this.screenY=null,this.graph=t,this.graph.addMouseListener(this),this.gestureHandler=(t,e)=>{this.inTolerance=!1},this.graph.addListener(InternalEvent.A.GESTURE,this.gestureHandler),this.init()}init(){InternalEvent.A.addGestureListeners(this.div,(t=>{const e=this.graph.getPlugin("TooltipHandler");e?.hide()}))}isSelectOnPopup(t){return this.selectOnPopup}mouseDown(t,e){this.isEnabled()&&!(0,EventUtils.isMultiTouchEvent)(e.getEvent())&&(this.hideMenu(),this.triggerX=e.getGraphX(),this.triggerY=e.getGraphY(),this.screenX=(0,EventUtils.getMainEvent)(e.getEvent()).screenX,this.screenY=(0,EventUtils.getMainEvent)(e.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(e),this.inTolerance=!0)}mouseMove(t,e){this.inTolerance&&null!=this.screenX&&null!=this.screenY&&(Math.abs((0,EventUtils.getMainEvent)(e.getEvent()).screenX-this.screenX)>this.graph.getEventTolerance()||Math.abs((0,EventUtils.getMainEvent)(e.getEvent()).screenY-this.screenY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}mouseUp(t,e){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){const t=this.getCellForPopupEvent(e);this.graph.isEnabled()&&this.isSelectOnPopup(e)&&null!=t&&!this.graph.isCellSelected(t)?this.graph.setSelectionCell(t):this.clearSelectionOnBackground&&null==t&&this.graph.clearSelection();const i=this.graph.getPlugin("TooltipHandler");i?.hide();const s=(0,styleUtils.getScrollOrigin)();this.popup(e.getX()+s.x+1,e.getY()+s.y+1,t,e.getEvent()),e.consume()}this.popupTrigger=!1,this.inTolerance=!1}getCellForPopupEvent(t){return t.getCell()}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.gestureHandler),super.destroy()}}PopupMenuHandler.pluginId="PopupMenuHandler";const handler_PopupMenuHandler=PopupMenuHandler;var config=__webpack_require__(9639);class ConnectionHandler extends EventSource.A{constructor(t,e=null){super(),this.previous=null,this.iconState=null,this.icons=[],this.cell=null,this.currentPoint=null,this.sourceConstraint=null,this.shape=null,this.icon=null,this.originalPoint=null,this.currentState=null,this.selectedIcon=null,this.waypoints=[],this.factoryMethod=null,this.moveIconFront=!1,this.moveIconBack=!1,this.connectImage=null,this.targetConnectImage=!1,this.enabled=!1,this.select=!0,this.createTarget=!1,this.error=null,this.waypointsEnabled=!1,this.ignoreMouseDown=!1,this.first=null,this.connectIconOffset=new Point.A(0,Constants.TOOLTIP_VERTICAL_OFFSET),this.edgeState=null,this.mouseDownCounter=0,this.movePreviewAway=!1,this.outlineConnect=!1,this.livePreview=!1,this.cursor=null,this.insertBeforeSource=!1,this.graph=t,this.factoryMethod=e,this.graph.addMouseListener(this),this.marker=this.createMarker(),this.constraintHandler=new handler_ConstraintHandler(this.graph),this.changeHandler=t=>{this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell)),this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.previous&&!this.graph.view.getState(this.previous.cell)&&this.reset()},this.graph.getDataModel().addListener(InternalEvent.A.CHANGE,this.changeHandler),this.graph.getView().addListener(InternalEvent.A.SCALE,this.changeHandler),this.graph.getView().addListener(InternalEvent.A.TRANSLATE,this.changeHandler),this.graph.getView().addListener(InternalEvent.A.SCALE_AND_TRANSLATE,this.changeHandler),this.drillHandler=t=>{this.reset()},this.graph.addListener(InternalEvent.A.START_EDITING,this.drillHandler),this.graph.getView().addListener(InternalEvent.A.DOWN,this.drillHandler),this.graph.getView().addListener(InternalEvent.A.UP,this.drillHandler),this.escapeHandler=()=>{this.reset()},this.graph.addListener(InternalEvent.A.ESCAPE,this.escapeHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isInsertBefore(t,e,i,s,n){return this.insertBeforeSource&&e!==i}isCreateTarget(t){return this.createTarget}setCreateTarget(t){this.createTarget=t}createShape(){const t=this.livePreview&&this.edgeState?this.graph.cellRenderer.createShape(this.edgeState):new PolylineShape.A([],Constants.INVALID_COLOR);return t&&t.node&&(t.dialect=Constants.DIALECT.SVG,t.scale=this.graph.view.scale,t.pointerEvents=!1,t.isDashed=!0,t.init(this.graph.getView().getOverlayPane()),InternalEvent.A.redirectMouseEvents(t.node,this.graph,null)),t}isConnectableCell(t){return!0}createMarker(){return new ConnectionHandlerCellMarker(this.graph,this)}start(t,e,i,s){this.previous=t,this.first=new Point.A(e,i),this.edgeState=s??this.createEdgeState(),this.marker.currentColor=this.marker.validColor,this.marker.markedState=t,this.marker.mark(),this.fireEvent(new EventObject.A(InternalEvent.A.START,{state:this.previous}))}isConnecting(){return!!this.first&&!!this.shape}isValidSource(t,e){return this.graph.isValidSource(t)}isValidTarget(t){return!0}validateConnection(t,e){return this.isValidTarget(e)?this.graph.getEdgeValidationError(null,t,e):""}getConnectImage(t){return this.connectImage}isMoveIconToFrontForState(t){return!(!t.text||t.text.node.parentNode!==this.graph.container)||this.moveIconFront}createIcons(t){const e=this.getConnectImage(t);if(e){this.iconState=t;const i=[],s=new Rectangle.A(0,0,e.width,e.height),n=new ImageShape.A(s,e.src,void 0,void 0,0);n.preserveImageAspect=!1,this.isMoveIconToFrontForState(t)?(n.dialect=Constants.DIALECT.STRICTHTML,n.init(this.graph.container)):(n.dialect=Constants.DIALECT.SVG,n.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&n.node.parentNode&&n.node.previousSibling&&n.node.parentNode.insertBefore(n.node,n.node.parentNode.firstChild)),n.node.style.cursor=Constants.CURSOR.CONNECT;const l=()=>this.currentState??t,r=t=>{(0,EventUtils.isConsumed)(t)||(this.icon=n,this.graph.fireMouseEvent(InternalEvent.A.MOUSE_DOWN,new InternalMouseEvent.A(t,l())))};return InternalEvent.A.redirectMouseEvents(n.node,this.graph,l,r),i.push(n),this.redrawIcons(i,this.iconState),i}return[]}redrawIcons(t,e){if(t[0]&&t[0].bounds){const i=this.getIconPosition(t[0],e);t[0].bounds.x=i.x,t[0].bounds.y=i.y,t[0].redraw()}}getIconPosition(t,e){const{scale:i}=this.graph.getView();let s=e.getCenterX(),n=e.getCenterY();if(this.graph.isSwimlane(e.cell)){const t=this.graph.getStartSize(e.cell);s=0!==t.width?e.x+t.width*i/2:s,n=0!==t.height?e.y+t.height*i/2:n;const l=(0,mathUtils.toRadians)(e.style.rotation??0);if(0!==l){const t=Math.cos(l),i=Math.sin(l),r=new Point.A(e.getCenterX(),e.getCenterY()),a=(0,mathUtils.getRotatedPoint)(new Point.A(s,n),t,i,r);s=a.x,n=a.y}}return new Point.A(s-t.bounds.width/2,n-t.bounds.height/2)}destroyIcons(){for(let t=0;t<this.icons.length;t+=1)this.icons[t].destroy();this.icons=[],this.icon=null,this.selectedIcon=null,this.iconState=null}isStartEvent(t){return null!==this.constraintHandler.currentFocus&&null!==this.constraintHandler.currentConstraint||null!==this.previous&&null===this.error&&(0===this.icons.length||null!==this.icon)}mouseDown(t,e){if(this.mouseDownCounter+=1,this.isEnabled()&&this.graph.isEnabled()&&!e.isConsumed()&&!this.isConnecting()&&this.isStartEvent(e)){if(this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new Point.A(e.getGraphX(),e.getGraphY()),this.edgeState=this.createEdgeState(e),this.mouseDownCounter=1,this.waypointsEnabled&&!this.shape&&(this.waypoints=[],this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState)),!this.previous&&this.edgeState&&this.edgeState.cell.geometry){const t=this.graph.getPointForEvent(e.getEvent());this.edgeState.cell.geometry.setTerminalPoint(t,!0)}this.fireEvent(new EventObject.A(InternalEvent.A.START,{state:this.previous})),e.consume()}this.selectedIcon=this.icon,this.icon=null}isImmediateConnectSource(t){return!this.graph.isCellMovable(t.cell)}createEdgeState(t){return null}isOutlineConnectEvent(t){if(!this.currentPoint)return!1;const e=(0,styleUtils.getOffset)(this.graph.container),i=t.getEvent(),s=(0,EventUtils.getClientX)(i),n=(0,EventUtils.getClientY)(i),l=document.documentElement,r=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),a=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+e.x-r,h=this.currentPoint.y-this.graph.container.scrollTop+e.y-a;return this.outlineConnect&&!(0,EventUtils.isShiftDown)(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||(0,EventUtils.isAltDown)(t.getEvent())&&null!=t.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||h!==n)&&null==t.getState()&&this.marker.highlight.isHighlightAt(o,h))}updateCurrentState(t,e){if(this.constraintHandler.update(t,!this.first,!1,!this.first||t.isSource(this.marker.highlight.shape)?null:e),null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint)this.marker.highlight&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell&&this.marker.highlight.shape?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent"),this.previous&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),this.error||(this.currentState=this.constraintHandler.currentFocus),(this.error||this.currentState&&!this.isCellEnabled(this.currentState.cell))&&this.constraintHandler.reset());else{this.graph.isIgnoreTerminalEvent(t.getEvent())?(this.marker.reset(),this.currentState=null):(this.marker.process(t),this.currentState=this.marker.getValidState()),null==this.currentState||this.isCellEnabled(this.currentState.cell)||(this.constraintHandler.reset(),this.marker.reset(),this.currentState=null);const i=this.isOutlineConnectEvent(t);if(null!=this.currentState&&i){t.isSource(this.marker.highlight.shape)&&(e=new Point.A(t.getGraphX(),t.getGraphY()));const i=this.graph.getOutlineConstraint(e,this.currentState,t);this.constraintHandler.setFocus(t,this.currentState,!1),this.constraintHandler.currentConstraint=i,this.constraintHandler.currentPoint=e}if(this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){const e=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=Constants.OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokeWidth=Constants.OUTLINE_HIGHLIGHT_STROKEWIDTH/e/e,this.marker.highlight.repaint();else if(this.marker.hasValidState()){const i=t.getCell();i&&i.isConnectable()&&this.marker.getValidState()!==t.getState()?(this.marker.highlight.shape.stroke="transparent",this.currentState=null):this.marker.highlight.shape.stroke=Constants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokeWidth=Constants.HIGHLIGHT_STROKEWIDTH/e/e,this.marker.highlight.repaint()}}}}isCellEnabled(t){return!0}convertWaypoint(t){const e=this.graph.getView().getScale(),i=this.graph.getView().getTranslate();t.x=t.x/e-i.x,t.y=t.y/e-i.y}snapToPreview(t,e){if(!(0,EventUtils.isAltDown)(t.getEvent())&&this.previous){const i=this.graph.getGridSize()*this.graph.view.scale/2,s=this.sourceConstraint&&this.first?this.first:new Point.A(this.previous.getCenterX(),this.previous.getCenterY());Math.abs(s.x-t.getGraphX())<i&&(e.x=s.x),Math.abs(s.y-t.getGraphY())<i&&(e.y=s.y)}}mouseMove(t,e){if(e.isConsumed()||!this.ignoreMouseDown&&!this.first&&this.graph.isMouseDown)this.constraintHandler.reset();else{!this.isEnabled()&&this.currentState&&(this.destroyIcons(),this.currentState=null);const t=this.graph.getView(),{scale:i}=t,s=t.translate;let n=new Point.A(e.getGraphX(),e.getGraphY());if(this.error=null,this.graph.isGridEnabledEvent(e.getEvent())&&(n=new Point.A((this.graph.snap(n.x/i-s.x)+s.x)*i,(this.graph.snap(n.y/i-s.y)+s.y)*i)),this.snapToPreview(e,n),this.currentPoint=n,(this.first||this.isEnabled()&&this.graph.isEnabled())&&(this.shape||!this.first||Math.abs(e.getGraphX()-this.first.x)>this.graph.getEventTolerance()||Math.abs(e.getGraphY()-this.first.y)>this.graph.getEventTolerance())&&this.updateCurrentState(e,n),this.first){let t=null,i=n;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(t=this.constraintHandler.currentConstraint,i=this.constraintHandler.currentPoint.clone()):this.previous&&!this.graph.isIgnoreTerminalEvent(e.getEvent())&&(0,EventUtils.isShiftDown)(e.getEvent())&&(Math.abs(this.previous.getCenterX()-n.x)<Math.abs(this.previous.getCenterY()-n.y)?n.x=this.previous.getCenterX():n.y=this.previous.getCenterY());let s=this.first;if(this.selectedIcon&&this.selectedIcon.bounds){const t=this.selectedIcon.bounds.width,i=this.selectedIcon.bounds.height;if(this.currentState&&this.targetConnectImage){const t=this.getIconPosition(this.selectedIcon,this.currentState);this.selectedIcon.bounds.x=t.x,this.selectedIcon.bounds.y=t.y}else{const s=new Rectangle.A(e.getGraphX()+this.connectIconOffset.x,e.getGraphY()+this.connectIconOffset.y,t,i);this.selectedIcon.bounds=s}this.selectedIcon.redraw()}if(this.edgeState)this.updateEdgeState(i,t),i=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1],s=this.edgeState.absolutePoints[0];else{if(this.currentState&&!this.constraintHandler.currentConstraint){const t=this.getTargetPerimeterPoint(this.currentState,e);null!=t&&(i=t)}if(!this.sourceConstraint&&this.previous){const t=this.waypoints.length>0?this.waypoints[0]:i,n=this.getSourcePerimeterPoint(this.previous,t,e);n&&(s=n)}}if(!this.currentState&&this.movePreviewAway&&i){let t=s;if(this.edgeState&&this.edgeState.absolutePoints.length>=2){const e=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2];e&&(t=e)}if(t){const e=i.x-t.x,s=i.y-t.y,n=Math.sqrt(e*e+s*s);if(0===n)return;this.originalPoint=i.clone(),i.x-=4*e/n,i.y-=4*s/n}}else this.originalPoint=null;if(!this.shape){const t=Math.abs(e.getGraphX()-this.first.x),i=Math.abs(e.getGraphY()-this.first.y);(t>this.graph.getEventTolerance()||i>this.graph.getEventTolerance())&&(this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState),this.updateCurrentState(e,n))}if(this.shape){if(this.edgeState)this.shape.points=this.edgeState.absolutePoints;else{let t=[s];this.waypoints.length>0&&(t=t.concat(this.waypoints)),t.push(i),this.shape.points=t}this.drawPreview()}this.cursor&&(this.graph.container.style.cursor=this.cursor),InternalEvent.A.consume(e.getEvent()),e.consume()}else this.isEnabled()&&this.graph.isEnabled()?this.previous===this.currentState||this.edgeState?this.previous!==this.currentState||null==this.currentState||0!==this.icons.length||this.graph.isMouseDown||e.consume():(this.destroyIcons(),!this.currentState||this.error||this.constraintHandler.currentConstraint||(this.icons=this.createIcons(this.currentState),0===this.icons.length&&(this.currentState.setCursor(Constants.CURSOR.CONNECT),e.consume())),this.previous=this.currentState):this.constraintHandler.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){let t=!1;const i=e.getSource();for(let e=0;e<this.icons.length&&!t;e+=1)t=i===this.icons[e].node||!!i&&i.parentNode===this.icons[e].node;t||this.updateIcons(this.currentState,this.icons,e)}}}updateEdgeState(t,e){if(!this.edgeState)return;this.sourceConstraint&&this.sourceConstraint.point&&(this.edgeState.style.exitX=this.sourceConstraint.point.x,this.edgeState.style.exitY=this.sourceConstraint.point.y),e&&e.point?(this.edgeState.style.entryX=e.point.x,this.edgeState.style.entryY=e.point.y):(this.edgeState.style.entryX=0,this.edgeState.style.entryY=0),this.edgeState.absolutePoints=[null,null!=this.currentState?null:t],this.sourceConstraint&&this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint),null!=this.currentState&&(null==e&&(e=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,e));const i=[];for(let t=0;t<this.waypoints.length;t+=1){const e=this.waypoints[t].clone();this.convertWaypoint(e),i[t]=e}this.graph.view.updatePoints(this.edgeState,i,this.previous,this.currentState),this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState)}getTargetPerimeterPoint(t,e){let i=null;const{view:s}=t,n=s.getPerimeterFunction(t);if(n&&this.previous&&this.edgeState){const e=this.waypoints.length>0?this.waypoints[this.waypoints.length-1]:new Point.A(this.previous.getCenterX(),this.previous.getCenterY()),l=n(s.getPerimeterBounds(t),this.edgeState,e,!1);l&&(i=l)}else i=new Point.A(t.getCenterX(),t.getCenterY());return i}getSourcePerimeterPoint(t,e,i){let s=null;const{view:n}=t,l=n.getPerimeterFunction(t),r=new Point.A(t.getCenterX(),t.getCenterY());if(l){const i=t.style.rotation??0,a=-i*(Math.PI/180);0!==i&&(e=(0,mathUtils.getRotatedPoint)(new Point.A(e.x,e.y),Math.cos(a),Math.sin(a),r));let o=l(n.getPerimeterBounds(t),t,e,!1);o&&(0!==i&&(o=(0,mathUtils.getRotatedPoint)(new Point.A(o.x,o.y),Math.cos(-a),Math.sin(-a),r)),s=o)}else s=r;return s}updateIcons(t,e,i){}isStopEvent(t){return!!t.getState()}addWaypointForEvent(t){if(!this.first)return;let e=(0,styleUtils.convertPoint)(this.graph.container,t.getX(),t.getY());const i=Math.abs(e.x-this.first.x),s=Math.abs(e.y-this.first.y);if(this.waypoints.length>0||this.mouseDownCounter>1&&(i>this.graph.getEventTolerance()||s>this.graph.getEventTolerance())){const{scale:i}=this.graph.view;e=new Point.A(this.graph.snap(t.getGraphX()/i)*i,this.graph.snap(t.getGraphY()/i)*i),this.waypoints.push(e)}}checkConstraints(t,e){return!(t&&e&&t.point&&e.point&&t.point.equals(e.point)&&t.dx===e.dx&&t.dy===e.dy&&t.perimeter===e.perimeter)}mouseUp(t,e){if(!e.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(e))return this.addWaypointForEvent(e),void e.consume();const t=this.sourceConstraint,i=this.constraintHandler.currentConstraint,s=this.previous?this.previous.cell:null;let n=null;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&(n=this.constraintHandler.currentFocus.cell),!n&&this.currentState&&(n=this.currentState.cell),this.error||s&&n&&s===n&&!this.checkConstraints(t,i)?(null!=this.previous&&null!=this.marker.validState&&this.previous.cell===this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.validState.cell,e.getEvent()),null!=this.error&&this.error.length>0&&this.graph.validationAlert(this.error)):this.connect(s,n,e.getEvent(),e.getCell()),this.destroyIcons(),e.consume()}null!=this.first&&this.reset()}reset(){null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.cursor&&null!=this.graph.container&&(this.graph.container.style.cursor=""),this.destroyIcons(),this.marker.reset(),this.constraintHandler.reset(),this.originalPoint=null,this.currentPoint=null,this.edgeState=null,this.previous=null,this.error=null,this.sourceConstraint=null,this.mouseDownCounter=0,this.first=null,this.fireEvent(new EventObject.A(InternalEvent.A.RESET))}drawPreview(){this.updatePreview(null===this.error),this.shape&&this.shape.redraw()}updatePreview(t){this.shape&&(this.shape.strokeWidth=this.getEdgeWidth(t),this.shape.stroke=this.getEdgeColor(t))}getEdgeColor(t){return t?Constants.VALID_COLOR:Constants.INVALID_COLOR}getEdgeWidth(t){return t?3:1}connect(t,e,i,s=null){if(e||this.isCreateTarget(i)||this.graph.isAllowDanglingEdges()){const n=this.graph.getDataModel();let l=!1,r=null;n.beginUpdate();try{if(t&&!e&&!this.graph.isIgnoreTerminalEvent(i)&&this.isCreateTarget(i)&&(e=this.createTargetVertex(i,t))){if(s=this.graph.getDropTarget([e],i,s),l=!0,null!=s&&s.isEdge())s=this.graph.getDefaultParent();else{const t=s?this.graph.getView().getState(s):null;if(t){const i=e.getGeometry();i&&(i.x-=t.origin.x,i.y-=t.origin.y)}}this.graph.addCell(e,s)}let a=this.graph.getDefaultParent();t&&e&&t.getParent()===e.getParent()&&t.getParent()?.getParent()!==n.getRoot()&&(a=t.getParent(),t.geometry&&t.geometry.relative&&e.geometry&&e.geometry.relative&&(a=a.getParent()));let o=null,h={};if(this.edgeState?.cell&&(o=this.edgeState.cell.value,h=this.edgeState.cell.style??{}),r=this.insertEdge(a,"",o,t,e,h),r&&t){if(this.graph.setConnectionConstraint(r,t,!0,this.sourceConstraint),this.graph.setConnectionConstraint(r,e,!1,this.constraintHandler.currentConstraint),this.edgeState?.cell?.geometry&&n.setGeometry(r,this.edgeState.cell.geometry),a=t.getParent(),this.isInsertBefore(r,t,e,i,s)){let e=t;for(;e&&null!=e.parent&&null!=e.geometry&&e.geometry.relative&&e.parent!==r.parent;)e=e.getParent();null!=e&&null!=e.parent&&e.parent===r.parent&&n.add(a,r,e.parent.getIndex(e))}let o=r.getGeometry();if(null==o&&(o=new Geometry.A,o.relative=!0,n.setGeometry(r,o)),this.waypoints.length>0){const t=this.graph.view.scale,e=this.graph.view.translate;o.points=[];for(let i=0;i<this.waypoints.length;i+=1){const s=this.waypoints[i];o.points.push(new Point.A(s.x/t-e.x,s.y/t-e.y))}}if(!e&&this.currentPoint){const t=this.graph.view.translate,e=this.graph.view.scale,i=null!=this.originalPoint?new Point.A(this.originalPoint.x/e-t.x,this.originalPoint.y/e-t.y):new Point.A(this.currentPoint.x/e-t.x,this.currentPoint.y/e-t.y);i.x-=this.graph.getPanDx()/this.graph.view.scale,i.y-=this.graph.getPanDy()/this.graph.view.scale,o.setTerminalPoint(i,!1)}this.fireEvent(new EventObject.A(InternalEvent.A.CONNECT,"cell",r,"terminal",e,"event",i,"target",s,"terminalInserted",l))}}catch(t){config.eo.logger.show();const e="Error in ConnectionHandler: "+(t instanceof Error?t.message+"\n"+t.stack:"unknown cause");config.eo.logger.debug(e)}finally{n.endUpdate()}this.select&&this.selectCells(r,l?e:null)}}selectCells(t,e){this.graph.setSelectionCell(t)}insertEdge(t,e,i,s,n,l){if(!this.factoryMethod)return this.graph.insertEdge(t,e,i,s,n,l);let r=this.createEdge(i,s,n,l);return r=this.graph.addEdge(r,t,s,n),r}createTargetVertex(t,e){let i=e.getGeometry();for(;i&&i.relative;)i=(e=e.getParent()).getGeometry();const s=this.graph.cloneCell(e);if(i=s.getGeometry(),i&&this.currentPoint){const t=this.graph.view.translate,s=this.graph.view.scale,n=new Point.A(this.currentPoint.x/s-t.x,this.currentPoint.y/s-t.y);i.x=Math.round(n.x-i.width/2-this.graph.getPanDx()/s),i.y=Math.round(n.y-i.height/2-this.graph.getPanDy()/s);const l=this.getAlignmentTolerance();if(l>0){const n=this.graph.view.getState(e);if(null!=n){const e=n.x/s-t.x,r=n.y/s-t.y;Math.abs(e-i.x)<=l&&(i.x=Math.round(e)),Math.abs(r-i.y)<=l&&(i.y=Math.round(r))}}}return s}getAlignmentTolerance(t){return this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.graph.getSnapTolerance()}createEdge(t,e,i,s={}){let n=null;if(null!=this.factoryMethod&&(n=this.factoryMethod(e,i,s)),null==n){n=new Cell.A(t||""),n.setEdge(!0),n.setStyle(s);const e=new Geometry.A;e.relative=!0,n.setGeometry(e)}return n}onDestroy(){this.graph.removeMouseListener(this),this.shape&&(this.shape.destroy(),this.shape=null),this.marker&&(this.marker.destroy(),this.marker=null),this.constraintHandler&&this.constraintHandler.onDestroy(),this.changeHandler&&(this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler)),this.drillHandler&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler)),this.escapeHandler&&this.graph.removeListener(this.escapeHandler)}}ConnectionHandler.pluginId="ConnectionHandler";class ConnectionHandlerCellMarker extends cell_CellMarker{constructor(t,e,i=Constants.DEFAULT_VALID_COLOR,s=Constants.DEFAULT_INVALID_COLOR,n=Constants.DEFAULT_HOTSPOT){super(t,i,s,n),this.hotspotEnabled=!0,this.connectionHandler=e}getCell(t){let e=super.getCell(t);if(this.connectionHandler.error=null,!e&&this.connectionHandler.currentPoint&&(e=this.connectionHandler.graph.getCellAt(this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)),e&&!e.isConnectable()&&this.connectionHandler.cell){const t=this.connectionHandler.cell.getParent();t&&t.isVertex()&&t.isConnectable()&&(e=t)}return e&&(this.connectionHandler.graph.isSwimlane(e)&&null!=this.connectionHandler.currentPoint&&this.connectionHandler.graph.hitsSwimlaneContent(e,this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)||!this.connectionHandler.isConnectableCell(e))&&(e=null),e?this.connectionHandler.isConnecting()?this.connectionHandler.previous&&(this.connectionHandler.error=this.connectionHandler.validateConnection(this.connectionHandler.previous.cell,e),null!==this.connectionHandler.error&&0===this.connectionHandler.error.length&&(e=null,this.connectionHandler.isCreateTarget(t.getEvent())&&(this.connectionHandler.error=null))):this.connectionHandler.isValidSource(e,t)||(e=null):!this.connectionHandler.isConnecting()||this.connectionHandler.isCreateTarget(t.getEvent())||this.connectionHandler.graph.isAllowDanglingEdges()||(this.connectionHandler.error=""),e}isValidState(t){return this.connectionHandler.isConnecting()?!this.connectionHandler.error:super.isValidState(t)}getMarkerColor(t,e,i){return!this.connectionHandler.connectImage||this.connectionHandler.isConnecting()?super.getMarkerColor(t,e,i):Constants.NONE}intersects(t,e){return!(!this.connectionHandler.connectImage&&!this.connectionHandler.isConnecting())||super.intersects(t,e)}}const handler_ConnectionHandler=ConnectionHandler;var Guide=__webpack_require__(1205);class SelectionHandler{constructor(t){this.refreshThread=null,this.maxCells=50,this.enabled=!0,this.highlightEnabled=!0,this.cloneEnabled=!0,this.moveEnabled=!0,this.guidesEnabled=!1,this.handlesVisible=!0,this.guide=null,this.currentDx=0,this.currentDy=0,this.updateCursor=!0,this.selectEnabled=!0,this.removeCellsFromParent=!0,this.removeEmptyParents=!1,this.connectOnDrop=!1,this.scrollOnMove=!0,this.minimumSize=6,this.previewColor="black",this.htmlPreview=!1,this.shape=null,this.scaleGrid=!1,this.rotationEnabled=!0,this.maxLivePreview=0,this.allowLivePreview=Client.A.IS_SVG,this.cell=null,this.delayedSelection=!1,this.first=null,this.cells=null,this.bounds=null,this.pBounds=null,this.allCells=new util_Dictionary.A,this.cellWasClicked=!1,this.cloning=!1,this.cellCount=0,this.target=null,this.suspended=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.highlight=null,this.graph=t,this.graph.addMouseListener(this),this.panHandler=()=>{this.suspended||(this.updatePreview(),this.updateHint())},this.graph.addListener(InternalEvent.A.PAN,this.panHandler),this.escapeHandler=(t,e)=>{this.reset()},this.graph.addListener(InternalEvent.A.ESCAPE,this.escapeHandler),this.refreshHandler=(t,e)=>{this.refreshThread&&window.clearTimeout(this.refreshThread),this.refreshThread=window.setTimeout((()=>{if(this.refreshThread=null,this.first&&!this.suspended&&this.cells){const t=this.currentDx,e=this.currentDy;if(this.currentDx=0,this.currentDy=0,this.updatePreview(),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),null!=this.pBounds||this.livePreviewUsed){if(this.currentDx=t,this.currentDy=e,this.updatePreview(),this.updateHint(),this.livePreviewUsed){const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!1,!0),this.updatePreview()}}else this.reset()}}),0)},this.graph.getDataModel().addListener(InternalEvent.A.CHANGE,this.refreshHandler),this.graph.addListener(InternalEvent.A.REFRESH,this.refreshHandler),this.keyHandler=t=>{if(null!=this.graph.container&&"hidden"!==this.graph.container.style.visibility&&null!=this.first&&!this.suspended){const e=this.graph.isCloneEvent(t)&&this.graph.isCellsCloneable()&&this.isCloneEnabled();e!==this.cloning&&(this.cloning=e,this.checkPreview(),this.updatePreview())}},"undefined"!=typeof document&&(InternalEvent.A.addListener(document,"keydown",this.keyHandler),InternalEvent.A.addListener(document,"keyup",this.keyHandler))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isCloneEnabled(){return this.cloneEnabled}setCloneEnabled(t){this.cloneEnabled=t}isMoveEnabled(){return this.moveEnabled}setMoveEnabled(t){this.moveEnabled=t}isSelectEnabled(){return this.selectEnabled}setSelectEnabled(t){this.selectEnabled=t}isRemoveCellsFromParent(){return this.removeCellsFromParent}setRemoveCellsFromParent(t){this.removeCellsFromParent=t}isPropagateSelectionCell(t,e,i){const s=t.getParent();if(e){const e=t.isEdge()?null:t.getGeometry();return!this.graph.isSiblingSelected(t)&&e&&e.relative||!this.graph.isSwimlane(s)}return(!this.graph.isToggleEvent(i.getEvent())||!this.graph.isSiblingSelected(t)&&!this.graph.isCellSelected(t)&&!this.graph.isSwimlane(s)||this.graph.isCellSelected(s))&&(this.graph.isToggleEvent(i.getEvent())||!this.graph.isCellSelected(s))}getInitialCellForEvent(t){let e=t.getState();if((!this.graph.isToggleEvent(t.getEvent())||!(0,EventUtils.isAltDown)(t.getEvent()))&&e&&!this.graph.isCellSelected(e.cell)){let i=e.cell.getParent(),s=i?this.graph.view.getState(i):null;for(;s&&!this.graph.isCellSelected(s.cell)&&(s.cell.isVertex()||s.cell.isEdge())&&this.isPropagateSelectionCell(e.cell,!0,t);)e=s,i=e.cell.getParent(),s=i?this.graph.view.getState(i):null}return e?e.cell:null}isDelayedSelection(t,e){let i=t;const s=this.graph.getPlugin("SelectionCellsHandler");if(!this.graph.isToggleEvent(e.getEvent())||!(0,EventUtils.isAltDown)(e.getEvent()))for(;i;){if(s?.isHandled(i)){const t=this.graph.getPlugin("CellEditorHandler");return t?.getEditingCell()!==i}i=i.getParent()}return this.graph.isToggleEvent(e.getEvent())&&!(0,EventUtils.isAltDown)(e.getEvent())}selectDelayed(t){const e=this.graph.getPlugin("PopupMenuHandler");if(!e||!e.isPopupTrigger(t)){let e=t.getCell();null===e&&(e=this.cell),e&&this.selectCellForEvent(e,t)}}selectCellForEvent(t,e){const i=this.graph.view.getState(t);if(i)if(e.isSource(i.control))this.graph.selectCellForEvent(t,e.getEvent());else{if(!this.graph.isToggleEvent(e.getEvent())||!(0,EventUtils.isAltDown)(e.getEvent())){let i=t.getParent();for(;i&&this.graph.view.getState(i)&&(i.isVertex()||i.isEdge())&&this.isPropagateSelectionCell(t,!1,e);)i=(t=i).getParent()}this.graph.selectCellForEvent(t,e.getEvent())}return t}consumeMouseEvent(t,e){e.consume()}mouseDown(t,e){if(!e.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&e.getState()&&!(0,EventUtils.isMultiTouchEvent)(e.getEvent())){const t=this.getInitialCellForEvent(e);if(t&&(this.delayedSelection=this.isDelayedSelection(t,e),this.cell=null,this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(t,e.getEvent()),this.isMoveEnabled())){const i=t.getGeometry();i&&this.graph.isCellMovable(t)&&(!t.isEdge()||this.graph.getSelectionCount()>1||i.points&&i.points.length>0||!t.getTerminal(!0)||!t.getTerminal(!1)||this.graph.isAllowDanglingEdges()||this.graph.isCloneEvent(e.getEvent())&&this.graph.isCellsCloneable())?this.start(t,e.getX(),e.getY()):this.delayedSelection&&(this.cell=t),this.cellWasClicked=!0,this.consumeMouseEvent(InternalEvent.A.MOUSE_DOWN,e)}}}getGuideStates(){const t=this.graph.getDefaultParent();return this.graph.view.getCellStates(t.filterDescendants((t=>{const e=t.getGeometry();return!!this.graph.view.getState(t)&&t.isVertex()&&!!e&&!e.relative})))}getCells(t){return!this.delayedSelection&&this.graph.isCellMovable(t)?[t]:this.graph.getMovableCells(this.graph.getSelectionCells())}getPreviewBounds(t){const e=this.getBoundingBox(t);if(e){if(e.width=Math.max(0,e.width-1),e.height=Math.max(0,e.height-1),e.width<this.minimumSize){const t=this.minimumSize-e.width;e.x-=t/2,e.width=this.minimumSize}else e.x=Math.round(e.x),e.width=Math.ceil(e.width);if(e.height<this.minimumSize){const t=this.minimumSize-e.height;e.y-=t/2,e.height=this.minimumSize}else e.y=Math.round(e.y),e.height=Math.ceil(e.height)}return e}getBoundingBox(t){let e=null;if(t.length>0)for(let i=0;i<t.length;i+=1)if(t[i].isVertex()||t[i].isEdge()){const s=this.graph.view.getState(t[i]);if(s){let n=null;t[i].isVertex()&&s.shape&&s.shape.boundingBox&&(n=s.shape.boundingBox),n&&(e?e.add(n):e=Rectangle.A.fromRectangle(n))}}return e}createPreviewShape(t){const e=new RectangleShape.A(t,Constants.NONE,this.previewColor);return e.isDashed=!0,this.htmlPreview?(e.dialect=Constants.DIALECT.STRICTHTML,e.init(this.graph.container)):(e.dialect=Constants.DIALECT.SVG,e.init(this.graph.getView().getOverlayPane()),e.pointerEvents=!1,Client.A.IS_IOS&&(e.getSvgScreenOffset=()=>0)),e}createGuide(){return new Guide.A(this.graph,this.getGuideStates())}start(t,e,i,s){this.cell=t,this.first=(0,styleUtils.convertPoint)(this.graph.container,e,i),this.cells=s||this.getCells(this.cell),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),this.cloning=!1,this.cellCount=0;for(let t=0;t<this.cells.length;t+=1)this.cellCount+=this.addStates(this.cells[t],this.allCells);if(this.guidesEnabled){this.guide=this.createGuide();const e=t.getParent(),i=e.getChildCount()<2,s=new util_Dictionary.A,n=this.graph.getOpposites(this.graph.getEdges(this.cell),this.cell);for(let t=0;t<n.length;t+=1){const e=this.graph.view.getState(n[t]);e&&!s.get(e)&&s.put(e,!0)}this.guide.isStateIgnored=t=>{const n=t.cell.getParent();return!!t.cell&&(!this.cloning&&!!this.isCellMoving(t.cell)||t.cell!==(this.target||e)&&!i&&!s.get(t)&&(!this.target||this.target.getChildCount()>=2)&&n!==(this.target||e))}}}addStates(t,e){const i=this.graph.view.getState(t);let s=0;if(i&&!e.get(t)){e.put(t,i),s++;const n=t.getChildCount();for(let i=0;i<n;i+=1)s+=this.addStates(t.getChildAt(i),e)}return s}isCellMoving(t){return this.allCells.get(t)}useGuidesForEvent(t){return!this.guide||this.guide.isEnabledForEvent(t.getEvent())&&!this.graph.isConstrainedEvent(t.getEvent())}snap(t){const e=this.scaleGrid?this.graph.view.scale:1;return t.x=this.graph.snap(t.x/e)*e,t.y=this.graph.snap(t.y/e)*e,t}getDelta(t){const e=(0,styleUtils.convertPoint)(this.graph.container,t.getX(),t.getY());return this.first?new Point.A(e.x-this.first.x-this.graph.getPanDx(),e.y-this.first.y-this.graph.getPanDy()):new Point.A}updateHint(t){}removeHint(){}roundLength(t){return Math.round(100*t)/100}isValidDropTarget(t,e){return!!this.cell&&this.cell.getParent()!==t}checkPreview(){this.livePreviewActive&&this.cloning?(this.resetLivePreview(),this.livePreviewActive=!1):this.maxLivePreview>=this.cellCount&&!this.livePreviewActive&&this.allowLivePreview?this.cloning&&this.livePreviewActive||(this.livePreviewActive=!0,this.livePreviewUsed=!0):this.livePreviewUsed||this.shape||!this.bounds||(this.shape=this.createPreviewShape(this.bounds))}mouseMove(t,e){const{graph:i}=this;if(!e.isConsumed()&&i.isMouseDown&&this.cell&&this.first&&this.bounds&&!this.suspended){if((0,EventUtils.isMultiTouchEvent)(e.getEvent()))return void this.reset();let t=this.getDelta(e);const s=i.getEventTolerance();if(this.shape||this.livePreviewActive||Math.abs(t.x)>s||Math.abs(t.y)>s){this.highlight||(this.highlight=new CellHighlight.A(this.graph,Constants.DROP_TARGET_COLOR,3));const s=i.isCloneEvent(e.getEvent())&&i.isCellsCloneable()&&this.isCloneEnabled(),n=i.isGridEnabledEvent(e.getEvent()),l=e.getCell();let r=!0,a=null;this.cloning=s,i.isDropEnabled()&&this.highlightEnabled&&this.cells&&(a=i.getDropTarget(this.cells,e.getEvent(),l,s));let o=a?i.getView().getState(a):null,h=!1;if(o&&(s||a&&this.isValidDropTarget(a,e)))this.target!==a&&(this.target=a,this.setHighlightColor(Constants.DROP_TARGET_COLOR)),h=!0;else if(this.target=null,this.connectOnDrop&&l&&this.cells&&1===this.cells.length&&l.isVertex()&&l.isConnectable()&&(o=i.getView().getState(l),o)){const t=null===i.getEdgeValidationError(null,this.cell,l)?Constants.VALID_COLOR:Constants.INVALID_CONNECT_TARGET_COLOR;this.setHighlightColor(t),h=!0}o&&h?this.highlight.highlight(o):this.highlight.hide(),this.guide&&this.useGuidesForEvent(e)?(t=this.guide.move(this.bounds,t,n,s),r=!1):t=this.graph.snapDelta(t,this.bounds,!n,!1,!1),this.guide&&r&&this.guide.hide(),i.isConstrainedEvent(e.getEvent())&&(Math.abs(t.x)>Math.abs(t.y)?t.y=0:t.x=0),this.checkPreview(),this.currentDx===t.x&&this.currentDy===t.y||(this.currentDx=t.x,this.currentDy=t.y,this.updatePreview())}this.updateHint(e),this.consumeMouseEvent(InternalEvent.A.MOUSE_MOVE,e),InternalEvent.A.consume(e.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!e.isConsumed()&&(e.getState()||e.sourceState)&&!i.isMouseDown){let t=i.getCursorForMouseEvent(e);const s=e.getCell();!t&&s&&i.isEnabled()&&i.isCellMovable(s)&&(t=s.isEdge()?Constants.CURSOR.MOVABLE_EDGE:Constants.CURSOR.MOVABLE_VERTEX),t&&e.sourceState&&e.sourceState.setCursor(t)}}updatePreview(t=!1){if(this.livePreviewUsed&&!t){if(this.cells){const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!1),this.updateLivePreview(this.currentDx,this.currentDy)}}else this.updatePreviewShape()}updatePreviewShape(){this.shape&&this.pBounds&&(this.shape.bounds=new Rectangle.A(Math.round(this.pBounds.x+this.currentDx),Math.round(this.pBounds.y+this.currentDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())}updateLivePreview(t,e){if(!this.suspended){const i=[];if(this.allCells&&this.allCells.visit(((s,n)=>{const l=n?this.graph.view.getState(n.cell):null;if(l!==n&&n&&(n.destroy(),l?this.allCells.put(n.cell,l):this.allCells.remove(n.cell),n=l),n){const s=n.clone();i.push([n,s]),n.shape&&(null===n.shape.originalPointerEvents&&(n.shape.originalPointerEvents=n.shape.pointerEvents),n.shape.pointerEvents=!1,n.text&&(null===n.text.originalPointerEvents&&(n.text.originalPointerEvents=n.text.pointerEvents),n.text.pointerEvents=!1)),n.cell.isVertex()&&(n.x+=t,n.y+=e,this.cloning?n.text&&(n.text.updateBoundingBox(),n.text.boundingBox&&(n.text.boundingBox.x+=t,n.text.boundingBox.y+=e),n.text.unrotatedBoundingBox&&(n.text.unrotatedBoundingBox.x+=t,n.text.unrotatedBoundingBox.y+=e)):(n.view.graph.cellRenderer.redraw(n,!0),n.view.invalidate(n.cell),n.invalid=!1,n.control&&n.control.node&&(n.control.node.style.visibility="hidden")))}})),0===i.length)this.reset();else{const s=this.graph.view.scale;for(let n=0;n<i.length;n+=1){const l=i[n][0];if(l.cell.isEdge()){const r=l.cell.getGeometry(),a=[];if(r&&r.points)for(let i=0;i<r.points.length;i++)r.points[i]&&a.push(new Point.A(r.points[i].x+t/s,r.points[i].y+e/s));let o=l.visibleSourceState,h=l.visibleTargetState;const d=i[n][1].absolutePoints;if(null!=o&&this.isCellMoving(o.cell))l.view.updateFixedTerminalPoint(l,o,!0,this.graph.getConnectionConstraint(l,o,!0));else{const i=d[0];i&&(l.setAbsoluteTerminalPoint(new Point.A(i.x+t,i.y+e),!0),o=null)}if(null!=h&&this.isCellMoving(h.cell))l.view.updateFixedTerminalPoint(l,h,!1,this.graph.getConnectionConstraint(l,h,!1));else{const i=d[d.length-1];i&&(l.setAbsoluteTerminalPoint(new Point.A(i.x+t,i.y+e),!1),h=null)}l.view.updatePoints(l,a,o,h),l.view.updateFloatingTerminalPoints(l,o,h),l.view.updateEdgeLabelOffset(l),l.invalid=!1,this.cloning||l.view.graph.cellRenderer.redraw(l,!0)}}this.graph.view.validate(),this.redrawHandles(i),this.resetPreviewStates(i)}}}redrawHandles(t){const e=this.graph.getPlugin("SelectionCellsHandler");for(let i=0;i<t.length;i+=1){const s=e?.getHandler(t[i][0].cell);s?.redraw(!0)}}resetPreviewStates(t){for(let e=0;e<t.length;e+=1)t[e][0].setState(t[e][1])}suspend(){this.suspended||(this.livePreviewUsed&&this.updateLivePreview(0,0),this.shape&&(this.shape.node.style.visibility="hidden"),this.guide&&this.guide.setVisible(!1),this.suspended=!0)}resume(){this.suspended&&(this.suspended=!1,this.livePreviewUsed&&(this.livePreviewActive=!0),this.shape&&(this.shape.node.style.visibility="visible"),this.guide&&this.guide.setVisible(!0))}resetLivePreview(){this.allCells.visit(((t,e)=>{e.shape&&null!==e.shape.originalPointerEvents&&(e.shape.pointerEvents=e.shape.originalPointerEvents,e.shape.originalPointerEvents=null,e.shape.bounds=null,e.text&&null!==e.text.originalPointerEvents&&(e.text.pointerEvents=e.text.originalPointerEvents,e.text.originalPointerEvents=null)),e.control&&e.control.node&&"hidden"===e.control.node.style.visibility&&(e.control.node.style.visibility=""),this.cloning||e.text&&e.text.updateBoundingBox(),e.view.invalidate(e.cell)})),this.graph.view.validate()}setHandlesVisibleForCells(t,e,i=!1){if(i||this.handlesVisible!==e){this.handlesVisible=e;const i=this.graph.getPlugin("SelectionCellsHandler");for(let s=0;s<t.length;s+=1){const n=i?.getHandler(t[s]);n&&(n.setHandlesVisible(e),e&&n.redraw())}}}setHighlightColor(t){this.highlight&&this.highlight.setHighlightColor(t)}mouseUp(t,e){if(!e.isConsumed())if(this.livePreviewUsed&&this.resetLivePreview(),this.cell&&this.first&&(this.shape||this.livePreviewUsed)&&(0,mathUtils.isNumeric)(this.currentDx)&&(0,mathUtils.isNumeric)(this.currentDy)){const{graph:t}=this,i=e.getCell();if(this.connectOnDrop&&!this.target&&i&&i.isVertex()&&i.isConnectable()&&t.isEdgeValid(null,this.cell,i)){const s=t.getPlugin("ConnectionHandler");s?.connect(this.cell,i,e.getEvent())}else{const i=t.isCloneEvent(e.getEvent())&&t.isCellsCloneable()&&this.isCloneEnabled(),{scale:s}=t.getView(),n=this.roundLength(this.currentDx/s),l=this.roundLength(this.currentDy/s),r=this.target;r&&t.isSplitEnabled()&&this.cells&&t.isSplitTarget(r,this.cells,e.getEvent())?t.splitEdge(r,this.cells,null,n,l,e.getGraphX(),e.getGraphY()):this.cells&&this.moveCells(this.cells,n,l,i,this.target,e.getEvent())}}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(e);this.cellWasClicked&&this.consumeMouseEvent(InternalEvent.A.MOUSE_UP,e),this.reset()}reset(){if(this.livePreviewUsed){this.resetLivePreview();const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!0)}this.destroyShapes(),this.removeHint(),this.delayedSelection=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.cellWasClicked=!1,this.suspended=!1,this.currentDx=0,this.currentDy=0,this.cellCount=0,this.cloning=!1,this.allCells.clear(),this.pBounds=null,this.target=null,this.first=null,this.cells=null,this.cell=null}shouldRemoveCellsFromParent(t,e,i){if(t.isVertex()){const e=this.graph.getView().getState(t);if(e){let t=(0,styleUtils.convertPoint)(this.graph.container,(0,EventUtils.getClientX)(i),(0,EventUtils.getClientY)(i));const s=(0,mathUtils.toRadians)(e.style.rotation??0);if(0!==s){const i=Math.cos(-s),n=Math.sin(-s),l=new Point.A(e.getCenterX(),e.getCenterY());t=(0,mathUtils.getRotatedPoint)(t,i,n,l)}return!(0,mathUtils.contains)(e,t.x,t.y)}}return!1}moveCells(t,e,i,s,n,l){if(!this.cell)return;s&&(t=this.graph.getCloneableCells(t));const r=this.cell.getParent();!n&&r&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(r,t,l)&&(n=this.graph.getDefaultParent()),s=!!s&&!this.graph.isCellLocked(n||this.graph.getDefaultParent()),this.graph.batchUpdate((()=>{const r=[];if(!s&&n&&this.removeEmptyParents){const e=new util_Dictionary.A;for(let i=0;i<t.length;i+=1)e.put(t[i],!0);for(let i=0;i<t.length;i+=1){const s=t[i].getParent();s&&!e.get(s)&&(e.put(s,!0),r.push(s))}}t=this.graph.moveCells(t,e,i,s,n,l);const a=[];for(let t=0;t<r.length;t+=1)this.shouldRemoveParent(r[t])&&a.push(r[t]);this.graph.removeCells(a,!1)})),s&&this.graph.setSelectionCells(t),this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(t[0])}shouldRemoveParent(t){const e=this.graph.view.getState(t);return null!=e&&(e.cell.isEdge()||e.cell.isVertex())&&this.graph.isCellDeletable(e.cell)&&0===e.cell.getChildCount()&&e.isTransparentState()}destroyShapes(){this.shape&&(this.shape.destroy(),this.shape=null),this.guide&&(this.guide.destroy(),this.guide=null),this.highlight&&(this.highlight.destroy(),this.highlight=null)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.panHandler),this.graph.removeListener(this.escapeHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.removeListener(this.refreshHandler),InternalEvent.A.removeListener(document,"keydown",this.keyHandler),InternalEvent.A.removeListener(document,"keyup",this.keyHandler),this.destroyShapes(),this.removeHint()}}SelectionHandler.pluginId="SelectionHandler";const handler_SelectionHandler=SelectionHandler;class PanningManager{constructor(t){this.damper=1/6,this.delay=10,this.handleMouseOut=!0,this.border=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.mouseListener={mouseDown:(t,e)=>{},mouseMove:(t,e)=>{},mouseUp:(t,e)=>{this.active&&this.stop()}},t.addMouseListener(this.mouseListener),this.mouseUpListener=()=>{this.active&&this.stop()},InternalEvent.A.addListener(document,"mouseup",this.mouseUpListener);const e=()=>(this.scrollbars=(0,styleUtils.hasScrollbars)(t.container),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop,window.setInterval((()=>{if(this.tdx-=this.dx,this.tdy-=this.dy,this.scrollbars){const e=-t.container.scrollLeft-Math.ceil(this.dx),i=-t.container.scrollTop-Math.ceil(this.dy);t.panGraph(e,i),t.setPanDx(this.scrollLeft-t.container.scrollLeft),t.setPanDy(this.scrollTop-t.container.scrollTop),t.fireEvent(new EventObject.A(InternalEvent.A.PAN))}else t.panGraph(this.getDx(),this.getDy())}),this.delay));this.isActive=()=>this.active,this.getDx=()=>Math.round(this.tdx),this.getDy=()=>Math.round(this.tdy),this.start=()=>{this.t0x=t.view.translate.x,this.t0y=t.view.translate.y,this.active=!0},this.panTo=(i,s,n=0,l=0)=>{this.active||this.start(),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop;const r=t.container;this.dx=i+n-r.scrollLeft-r.clientWidth,this.dx<0&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.handleMouseOut?this.dx=Math.max(this.dx,0):this.dx=0,0==this.dx&&(this.dx=i-r.scrollLeft,this.dx>0&&this.dx<this.border?this.dx-=this.border:this.handleMouseOut?this.dx=Math.min(0,this.dx):this.dx=0),this.dy=s+l-r.scrollTop-r.clientHeight,this.dy<0&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.handleMouseOut?this.dy=Math.max(this.dy,0):this.dy=0,0==this.dy&&(this.dy=s-r.scrollTop,this.dy>0&&this.dy<this.border?this.dy-=this.border:this.handleMouseOut?this.dy=Math.min(0,this.dy):this.dy=0),0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=e())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)},this.stop=()=>{if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdx=0,this.tdy=0,this.scrollbars)t.setPanDx(0),t.setPanDy(0),t.fireEvent(new EventObject.A(InternalEvent.A.PAN));else{const e=t.getPanDx(),i=t.getPanDy();0==e&&0==i||(t.panGraph(0,0),t.view.setTranslate(this.t0x+e/t.view.scale,this.t0y+i/t.view.scale))}},this.destroy=()=>{t.removeMouseListener(this.mouseListener),InternalEvent.A.removeListener(document,"mouseup",this.mouseUpListener)}}}const other_PanningManager=PanningManager;class PanningHandler extends EventSource.A{constructor(t){super(),this.getPanningManager=()=>this.panningManager,this.useLeftButtonForPanning=!1,this.usePopupTrigger=!0,this.ignoreCell=!1,this.previewEnabled=!0,this.useGrid=!1,this.panningEnabled=!1,this.pinchEnabled=!0,this.initialScale=0,this.maxScale=8,this.minScale=.01,this.dx=0,this.dy=0,this.startX=0,this.startY=0,this.dx0=0,this.dy0=0,this.panningTrigger=!1,this.active=!1,this.mouseDownEvent=null,this.graph=t,this.graph.addMouseListener(this),this.forcePanningHandler=(t,e)=>{const i=e.getProperty("eventName"),s=e.getProperty("event");i===InternalEvent.A.MOUSE_DOWN&&this.isForcePanningEvent(s)&&(this.start(s),this.active=!0,this.fireEvent(new EventObject.A(InternalEvent.A.PAN_START,{event:s})),s.consume())},this.graph.addListener(InternalEvent.A.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=(t,e)=>{if(this.isPinchEnabled()){const t=e.getProperty("event");(0,EventUtils.isConsumed)(t)||"gesturestart"!==t.type?"gestureend"===t.type&&0!==this.initialScale&&(this.initialScale=0):(this.initialScale=this.graph.view.scale,!this.active&&this.mouseDownEvent&&(this.start(this.mouseDownEvent),this.mouseDownEvent=null)),0!==this.initialScale&&this.zoomGraph(t)}},this.graph.addListener(InternalEvent.A.GESTURE,this.gestureHandler),this.mouseUpListener=()=>{this.active&&this.reset()},InternalEvent.A.addListener(document,"mouseup",this.mouseUpListener),this.panningManager=new other_PanningManager(t)}isActive(){return this.active||null!==this.initialScale}isPanningEnabled(){return this.panningEnabled}setPanningEnabled(t){this.panningEnabled=t}isPinchEnabled(){return this.pinchEnabled}setPinchEnabled(t){this.pinchEnabled=t}isPanningTrigger(t){const e=t.getEvent();return this.useLeftButtonForPanning&&!t.getState()&&(0,EventUtils.isLeftMouseButton)(e)||(0,EventUtils.isControlDown)(e)&&(0,EventUtils.isShiftDown)(e)||this.usePopupTrigger&&(0,EventUtils.isPopupTrigger)(e)}isForcePanningEvent(t){return this.ignoreCell||(0,EventUtils.isMultiTouchEvent)(t.getEvent())}mouseDown(t,e){this.mouseDownEvent=e,!e.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(e)&&(this.start(e),this.consumePanningTrigger(e))}start(t){this.dx0=-this.graph.container.scrollLeft,this.dy0=-this.graph.container.scrollTop,this.startX=t.getX(),this.startY=t.getY(),this.dx=0,this.dy=0,this.panningTrigger=!0}consumePanningTrigger(t){t.consume()}mouseMove(t,e){if(this.dx=e.getX()-this.startX,this.dy=e.getY()-this.startY,this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new EventObject.A(InternalEvent.A.PAN,{event:e}));else if(this.panningTrigger){const t=this.active;this.active=Math.abs(this.dx)>this.graph.getSnapTolerance()||Math.abs(this.dy)>this.graph.getSnapTolerance(),!t&&this.active&&this.fireEvent(new EventObject.A(InternalEvent.A.PAN_START,{event:e}))}(this.active||this.panningTrigger)&&e.consume()}mouseUp(t,e){if(this.active){if(0!==this.dx&&0!==this.dy){if(!this.graph.isUseScrollbarsForPanning()||!(0,styleUtils.hasScrollbars)(this.graph.container)){const{scale:t}=this.graph.getView(),e=this.graph.getView().translate;this.graph.panGraph(0,0),this.panGraph(e.x+this.dx/t,e.y+this.dy/t)}e.consume()}this.fireEvent(new EventObject.A(InternalEvent.A.PAN_END,{event:e}))}this.reset()}zoomGraph(t){let e=Math.round(this.initialScale*t.scale*100)/100;e=Math.max(this.minScale,e),e=Math.min(this.maxScale,e),this.graph.view.scale!==e&&(this.graph.zoomTo(e),InternalEvent.A.consume(t))}reset(){this.panningTrigger=!1,this.mouseDownEvent=null,this.active=!1,this.dx=0,this.dy=0}panGraph(t,e){this.graph.getView().setTranslate(t,e)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.forcePanningHandler),this.graph.removeListener(this.gestureHandler),InternalEvent.A.removeListener(document,"mouseup",this.mouseUpListener)}}PanningHandler.pluginId="PanningHandler";const handler_PanningHandler=PanningHandler,getDefaultPlugins=()=>[handler_CellEditorHandler,handler_TooltipHandler,handler_SelectionCellsHandler,handler_PopupMenuHandler,handler_ConnectionHandler,handler_SelectionHandler,handler_PanningHandler];class Graph extends EventSource.A{createCellRenderer(){return new cell_CellRenderer}createEdgeHandlerInstance(t){return new handler_EdgeHandler(t)}createEdgeSegmentHandler(t){return new handler_EdgeSegmentHandler(t)}createElbowEdgeHandler(t){return new handler_ElbowEdgeHandler(t)}createGraphDataModel(){return new view_GraphDataModel}createGraphView(){return new GraphView.A(this)}createSelectionModel(){return new view_GraphSelectionModel(this)}createStylesheet(){return new Stylesheet.n}createVertexHandler(t){return new handler_VertexHandler(t)}registerDefaults(){registerDefaultShapes(),registerDefaultStyleElements(),registerDefaultEdgeMarkers()}constructor(t,e,i=getDefaultPlugins(),s=null){super(),this.destroyed=!1,this.graphModelChangeListener=null,this.paintBackground=null,this.isConstrainedMoving=!1,this.cells=[],this.imageBundles=[],this.mouseListeners=[],this.multiplicities=[],this.plugins={},this.renderHint=null,this.dialect="svg",this.defaultOverlap=.5,this.defaultParent=null,this.backgroundImage=null,this.pageVisible=!1,this.pageBreaksVisible=!1,this.pageBreakColor="gray",this.pageBreakDashed=!0,this.minPageBreakDist=20,this.preferPageSize=!1,this.pageFormat=new Rectangle.A(...Constants.PAGE_FORMAT_A4_PORTRAIT),this.pageScale=1.5,this.enabled=!0,this.exportEnabled=!0,this.importEnabled=!0,this.ignoreScrollbars=!1,this.translateToScrollPosition=!1,this.maximumGraphBounds=null,this.minimumGraphSize=null,this.minimumContainerSize=null,this.maximumContainerSize=null,this.resizeContainer=!1,this.border=0,this.keepEdgesInForeground=!1,this.keepEdgesInBackground=!1,this.recursiveResize=!1,this.resetViewOnRootChange=!0,this.allowLoops=!1,this.defaultLoopStyle=style_EdgeStyle.Loop,this.multigraph=!0,this.minFitScale=.1,this.maxFitScale=8,this.warningImage=new image_ImageBox(`${Client.A.imageBasePath}/warning${Client.A.IS_MAC?".png":".gif"}`,16,16),this.alreadyConnectedResource="none"!=Client.A.language?"alreadyConnected":"",this.containsValidationErrorsResource="none"!=Client.A.language?"containsValidationErrors":"",this.getContainer=()=>this.container,this.getPlugin=t=>this.plugins[t],this.getCellRenderer=()=>this.cellRenderer,this.getDialect=()=>this.dialect,this.isPageVisible=()=>this.pageVisible,this.isPageBreaksVisible=()=>this.pageBreaksVisible,this.getPageBreakColor=()=>this.pageBreakColor,this.isPageBreakDashed=()=>this.pageBreakDashed,this.getMinPageBreakDist=()=>this.minPageBreakDist,this.isPreferPageSize=()=>this.preferPageSize,this.getPageFormat=()=>this.pageFormat,this.getPageScale=()=>this.pageScale,this.isExportEnabled=()=>this.exportEnabled,this.isImportEnabled=()=>this.importEnabled,this.isIgnoreScrollbars=()=>this.ignoreScrollbars,this.isTranslateToScrollPosition=()=>this.translateToScrollPosition,this.getMinimumGraphSize=()=>this.minimumGraphSize,this.setMinimumGraphSize=t=>this.minimumGraphSize=t,this.getMinimumContainerSize=()=>this.minimumContainerSize,this.setMinimumContainerSize=t=>this.minimumContainerSize=t,this.getAlreadyConnectedResource=()=>this.alreadyConnectedResource,this.getContainsValidationErrorsResource=()=>this.containsValidationErrorsResource,this.registerDefaults(),this.container=t??document.createElement("div"),this.model=e??this.createGraphDataModel(),this.cellRenderer=this.createCellRenderer(),this.setStylesheet(s??this.createStylesheet()),this.view=this.createGraphView(),this.graphModelChangeListener=(t,e)=>{this.graphModelChanged(e.getProperty("edit").changes)},this.getDataModel().addListener(InternalEvent.A.CHANGE,this.graphModelChangeListener),this.view.init(),this.sizeDidChange(),this.setSelectionModel(this.createSelectionModel()),i.forEach((t=>this.plugins[t.pluginId]=new t(this))),this.view.revalidate()}getWarningImage(){return this.warningImage}batchUpdate(t){this.getDataModel().batchUpdate(t)}getDataModel(){return this.model}getView(){return this.view}getStylesheet(){return this.stylesheet}setStylesheet(t){this.stylesheet=t}graphModelChanged(t){for(const e of t)this.processChange(e);this.updateSelection(),this.view.validate(),this.sizeDidChange()}processChange(t){if(t instanceof undoable_changes_RootChange)this.clearSelection(),this.setDefaultParent(null),t.previous&&this.removeStateForCell(t.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new EventObject.A(InternalEvent.A.ROOT));else if(t instanceof undoable_changes_ChildChange){const e=t.child.getParent();this.view.invalidate(t.child,!0,!0),e&&this.getDataModel().contains(e)&&!e.isCollapsed()||(this.view.invalidate(t.child,!0,!0),this.removeStateForCell(t.child),this.view.currentRoot==t.child&&this.home()),e!=t.previous&&(null!=e&&this.view.invalidate(e,!1,!1),null!=t.previous&&this.view.invalidate(t.previous,!1,!1))}else if(t instanceof undoable_changes_TerminalChange||t instanceof undoable_changes_GeometryChange)(t instanceof undoable_changes_TerminalChange||null==t.previous&&null!=t.geometry||null!=t.previous&&!t.previous.equals(t.geometry))&&this.view.invalidate(t.cell);else if(t instanceof undoable_changes_ValueChange)this.view.invalidate(t.cell,!1,!1);else if(t instanceof undoable_changes_StyleChange){this.view.invalidate(t.cell,!0,!0);const e=this.view.getState(t.cell);null!=e&&(e.invalidStyle=!0)}else null!=t.cell&&t.cell instanceof Cell.A&&this.removeStateForCell(t.cell)}scrollPointToVisible(t,e,i=!1,s=20){const n=this.getPlugin("PanningHandler");if(this.isTimerAutoScroll()||!this.ignoreScrollbars&&!(0,styleUtils.hasScrollbars)(this.container))this.isAllowAutoPanning()&&n&&!n.isActive()&&n.getPanningManager().panTo(t+this.getPanDx(),e+this.getPanDy());else{const n=this.container;if(t>=n.scrollLeft&&e>=n.scrollTop&&t<=n.scrollLeft+n.clientWidth&&e<=n.scrollTop+n.clientHeight){let l=n.scrollLeft+n.clientWidth-t;if(l<s){const t=n.scrollLeft;if(n.scrollLeft+=s-l,i&&t===n.scrollLeft){const t=this.view.getDrawPane().ownerSVGElement,e=n.scrollWidth+s-l;t.style.width=`${e}px`,n.scrollLeft+=s-l}}else l=t-n.scrollLeft,l<s&&(n.scrollLeft-=s-l);let r=n.scrollTop+n.clientHeight-e;if(r<s){const t=n.scrollTop;if(n.scrollTop+=s-r,t==n.scrollTop&&i){const t=this.view.getDrawPane().ownerSVGElement,e=n.scrollHeight+s-r;t.style.height=`${e}px`,n.scrollTop+=s-r}}else r=e-n.scrollTop,r<s&&(n.scrollTop-=s-r)}}}getBorderSizes(){const t=(0,styleUtils.getCurrentStyle)(this.container);return new Rectangle.A((0,styleUtils.parseCssNumber)(t.paddingLeft)+("none"!=t.borderLeftStyle?(0,styleUtils.parseCssNumber)(t.borderLeftWidth):0),(0,styleUtils.parseCssNumber)(t.paddingTop)+("none"!=t.borderTopStyle?(0,styleUtils.parseCssNumber)(t.borderTopWidth):0),(0,styleUtils.parseCssNumber)(t.paddingRight)+("none"!=t.borderRightStyle?(0,styleUtils.parseCssNumber)(t.borderRightWidth):0),(0,styleUtils.parseCssNumber)(t.paddingBottom)+("none"!=t.borderBottomStyle?(0,styleUtils.parseCssNumber)(t.borderBottomWidth):0))}getPreferredPageSize(t,e,i){const s=this.view.translate,n=this.pageFormat,l=this.pageScale,r=new Rectangle.A(0,0,Math.ceil(n.width*l),Math.ceil(n.height*l)),a=this.pageBreaksVisible?Math.ceil(e/r.width):1,o=this.pageBreaksVisible?Math.ceil(i/r.height):1;return new Rectangle.A(0,0,a*r.width+2+s.x,o*r.height+2+s.y)}fit(t=this.getBorder(),e=!1,i=0,s=!0,n=!1,l=!1,r=null){if(null!=this.container){const a=this.getBorderSizes();let o=this.container.offsetWidth-a.x-a.width-1,h=null!=r?r:this.container.offsetHeight-a.y-a.height-1,d=this.view.getGraphBounds();if(d.width>0&&d.height>0){e&&null!=d.x&&null!=d.y&&(d=d.clone(),d.width+=d.x,d.height+=d.y,d.x=0,d.y=0);const r=this.view.scale;let a=d.width/r,c=d.height/r;null!=this.backgroundImage&&(a=Math.max(a,this.backgroundImage.width-d.x/r),c=Math.max(c,this.backgroundImage.height-d.y/r));const u=(e?t:2*t)+i+1;o-=u,h-=u;let g=n?h/c:l?o/a:Math.min(o/a,h/c);if(null!=this.minFitScale&&(g=Math.max(g,this.minFitScale)),null!=this.maxFitScale&&(g=Math.min(g,this.maxFitScale)),!s)return g;if(e)this.view.scale!=g&&this.view.setScale(g);else if((0,styleUtils.hasScrollbars)(this.container)){this.view.setScale(g);const t=this.getGraphBounds();null!=t.x&&(this.container.scrollLeft=t.x),null!=t.y&&(this.container.scrollTop=t.y)}else{const e=null!=d.x?Math.floor(this.view.translate.x-d.x/r+t/g+i/2):t,s=null!=d.y?Math.floor(this.view.translate.y-d.y/r+t/g+i/2):t;this.view.scaleAndTranslate(g,e,s)}}}return this.view.scale}doResizeContainer(t,e){null!=this.maximumContainerSize&&(t=Math.min(this.maximumContainerSize.width,t),e=Math.min(this.maximumContainerSize.height,e));const i=this.container;i.style.width=`${Math.ceil(t)}px`,i.style.height=`${Math.ceil(e)}px`}createHandler(t){let e=null;if(t.cell.isEdge()){const i=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1),n=t.cell.getGeometry(),l=this.getView().getEdgeStyle(t,n&&n.points||void 0,i,s);e=this.createEdgeHandler(t,l)}else e=this.createVertexHandler(t);return e}createEdgeHandler(t,e){let i=null;return i=e==style_EdgeStyle.Loop||e==style_EdgeStyle.ElbowConnector||e==style_EdgeStyle.SideToSide||e==style_EdgeStyle.TopToBottom?this.createElbowEdgeHandler(t):e==style_EdgeStyle.SegmentConnector||e==style_EdgeStyle.OrthConnector?this.createEdgeSegmentHandler(t):this.createEdgeHandlerInstance(t),i}getCurrentRoot(){return this.view.currentRoot}getTranslateForRoot(t){return null}getChildOffsetForCell(t){return null}home(){const t=this.getCurrentRoot();null!=t&&(this.view.setCurrentRoot(null),null!=this.view.getState(t)&&this.setSelectionCell(t))}isValidRoot(t){return!!t}getGraphBounds(){return this.view.getGraphBounds()}getMaximumGraphBounds(){return this.maximumGraphBounds}refresh(t=null){t?this.view.clear(t,!1):this.view.clear(void 0,!0),this.view.validate(),this.sizeDidChange(),this.fireEvent(new EventObject.A(InternalEvent.A.REFRESH))}center(t=!0,e=!0,i=.5,s=.5){const n=this.container,l=(0,styleUtils.hasScrollbars)(this.container),r=2*this.getBorder(),a=n.clientWidth-r,o=n.clientHeight-r,h=this.getGraphBounds(),d=this.view.translate,c=this.view.scale;let u=t?a-h.width:0,g=e?o-h.height:0;if(l){h.x-=d.x,h.y-=d.y;const t=n.scrollWidth,e=n.scrollHeight;t>a&&(u=0),e>o&&(g=0),this.view.setTranslate(Math.floor(u/2-h.x),Math.floor(g/2-h.y)),n.scrollLeft=(t-a)/2,n.scrollTop=(e-o)/2}else this.view.setTranslate(t?Math.floor(d.x-h.x/c+u*i/c):d.x,e?Math.floor(d.y-h.y/c+g*s/c):d.y)}isOrthogonal(t){const e=t.style.orthogonal;if(null!=e)return e;const i=this.view.getEdgeStyle(t);return i===style_EdgeStyle.SegmentConnector||i===style_EdgeStyle.ElbowConnector||i===style_EdgeStyle.SideToSide||i===style_EdgeStyle.TopToBottom||i===style_EdgeStyle.EntityRelation||i===style_EdgeStyle.OrthConnector}getBackgroundImage(){return this.backgroundImage}setBackgroundImage(t){this.backgroundImage=t}convertValueToString(t){const e=t.getValue();if(null!=e){if((0,domUtils.isNode)(e))return e.nodeName;if("function"==typeof e.toString)return e.toString()}return""}getLinkForCell(t){return null}getBorder(){return this.border}setBorder(t){this.border=t}isResizeContainer(){return this.resizeContainer}setResizeContainer(t){this.resizeContainer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isMultigraph(){return this.multigraph}setMultigraph(t){this.multigraph=t}isAllowLoops(){return this.allowLoops}setAllowLoops(t){this.allowLoops=t}isRecursiveResize(t=null){return this.recursiveResize}setRecursiveResize(t){this.recursiveResize=t}getOverlap(t){return this.isAllowOverlapParent(t)?this.defaultOverlap:0}isAllowOverlapParent(t){return!1}getDefaultParent(){let t=this.getCurrentRoot();return t||(t=this.defaultParent,t)||(t=this.getDataModel().getRoot().getChildAt(0)),t}setDefaultParent(t){this.defaultParent=t}destroy(){this.destroyed||(this.destroyed=!0,Object.values(this.plugins).forEach((t=>t.onDestroy())),this.view.destroy(),this.model&&this.graphModelChangeListener&&(this.getDataModel().removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null))}}applyGraphMixins();class LayoutManager extends EventSource.A{constructor(t){super(),this.bubbling=!0,this.enabled=!0,this.undoHandler=(t,e)=>{this.isEnabled()&&this.beforeUndo(e.getProperty("edit"))},this.moveHandler=(t,e)=>{this.isEnabled()&&this.cellsMoved(e.getProperty("cells"),e.getProperty("event"))},this.resizeHandler=(t,e)=>{this.isEnabled()&&this.cellsResized(e.getProperty("cells"),e.getProperty("bounds"),e.getProperty("previous"))},this.setGraph(t)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isBubbling(){return this.bubbling}setBubbling(t){this.bubbling=t}getGraph(){return this.graph}setGraph(t){this.graph&&(this.graph.getDataModel().removeListener(this.undoHandler),this.graph.removeListener(this.moveHandler),this.graph.removeListener(this.resizeHandler)),this.graph=t,this.graph&&(this.graph.getDataModel().addListener(InternalEvent.A.BEFORE_UNDO,this.undoHandler),this.graph.addListener(InternalEvent.A.MOVE_CELLS,this.moveHandler),this.graph.addListener(InternalEvent.A.RESIZE_CELLS,this.resizeHandler))}hasLayout(t){return!!this.getLayout(t,InternalEvent.A.LAYOUT_CELLS)}getLayout(t,e){return null}beforeUndo(t){this.executeLayoutForCells(this.getCellsForChanges(t.changes))}cellsMoved(t,e){if(t.length>0&&e){const i=(0,styleUtils.convertPoint)(this.getGraph().container,(0,EventUtils.getClientX)(e),(0,EventUtils.getClientY)(e));for(let e=0;e<t.length;e+=1){const s=this.getLayout(t[e].getParent(),InternalEvent.A.MOVE_CELLS);s&&s.moveCell(t[e],i.x,i.y)}}}cellsResized(t=null,e=null,i=null){if(t&&e)for(let s=0;s<t.length;s+=1){const n=this.getLayout(t[s].getParent(),InternalEvent.A.RESIZE_CELLS);n&&n.resizeCell(t[s],e[s],i?.[s])}}getCellsForChanges(t){let e=[];for(const i of t){if(i instanceof undoable_changes_RootChange)return[];e=e.concat(this.getCellsForChange(i))}return e}getCellsForChange(t){return t instanceof undoable_changes_ChildChange?this.addCellsWithLayout(t.child,this.addCellsWithLayout(t.previous)):t instanceof undoable_changes_TerminalChange||t instanceof undoable_changes_GeometryChange||t instanceof undoable_changes_VisibleChange||t instanceof undoable_changes_StyleChange?this.addCellsWithLayout(t.cell):[]}addCellsWithLayout(t,e=[]){return this.addDescendantsWithLayout(t,this.addAncestorsWithLayout(t,e))}addAncestorsWithLayout(t,e=[]){return t&&(this.hasLayout(t)&&e.push(t),this.isBubbling()&&this.addAncestorsWithLayout(t.getParent(),e)),e}addDescendantsWithLayout(t,e=[]){if(t&&this.hasLayout(t))for(let i=0;i<t.getChildCount();i+=1){const s=t.getChildAt(i);this.hasLayout(s)&&(e.push(s),this.addDescendantsWithLayout(s,e))}return e}executeLayoutForCells(t){const e=(0,styleUtils.sortCells)(t,!1);this.layoutCells(e,!0),this.layoutCells(e.reverse(),!1)}layoutCells(t,e=!1){if(t.length>0){const i=this.getGraph().getDataModel();i.batchUpdate((()=>{let s=null;for(const n of t)n!==i.getRoot()&&n!==s&&(this.executeLayout(n,e),s=n);this.fireEvent(new EventObject.A(InternalEvent.A.LAYOUT_CELLS,{cells:t}))}))}}executeLayout(t,e=!1){const i=this.getLayout(t,e?InternalEvent.A.BEGIN_UPDATE:InternalEvent.A.END_UPDATE);i&&i.execute(t)}destroy(){this.setGraph(null)}}const layout_LayoutManager=LayoutManager;class Outline{constructor(t,e=null){this.sizer=null,this.selectionBorder=null,this.updateHandler=null,this.refreshHandler=null,this.panHandler=null,this.active=null,this.bounds=null,this.zoom=!1,this.startX=null,this.startY=null,this.dx0=null,this.dy0=null,this.index=null,this.outline=null,this.graphRenderHint="exact",this.enabled=!0,this.showViewport=!0,this.border=10,this.sizerSize=8,this.labelsVisible=!1,this.updateOnPan=!1,this.sizerImage=null,this.minScale=1e-4,this.suspended=!1,this.source=t,null!=e&&this.init(e)}init(t){this.outline=this.createGraph(t);const e=this.outline.graphModelChanged;this.outline.graphModelChanged=t=>{this.suspended||null==this.outline||e.apply(this.outline,[t])},this.outline.labelsVisible=this.labelsVisible,this.outline.setEnabled(!1),this.updateHandler=(t,e)=>{this.suspended||this.active||this.update()},this.source.getDataModel().addListener(InternalEvent.A.CHANGE,this.updateHandler),this.outline.addMouseListener(this);const i=this.source.getView();i.addListener(InternalEvent.A.SCALE,this.updateHandler),i.addListener(InternalEvent.A.TRANSLATE,this.updateHandler),i.addListener(InternalEvent.A.SCALE_AND_TRANSLATE,this.updateHandler),i.addListener(InternalEvent.A.DOWN,this.updateHandler),i.addListener(InternalEvent.A.UP,this.updateHandler),InternalEvent.A.addListener(this.source.container,"scroll",this.updateHandler),this.panHandler=(t,e)=>{this.updateOnPan&&this.updateHandler(t,e)},this.source.addListener(InternalEvent.A.PAN,this.panHandler),this.refreshHandler=t=>{const e=this.outline;e.setStylesheet(this.source.getStylesheet()),e.refresh()},this.source.addListener(InternalEvent.A.REFRESH,this.refreshHandler),this.bounds=new Rectangle.A(0,0,0,0),this.selectionBorder=new RectangleShape.A(this.bounds,Constants.NONE,Constants.OUTLINE_COLOR,Constants.OUTLINE_STROKEWIDTH),this.selectionBorder.dialect=this.outline.dialect,this.selectionBorder.init(this.outline.getView().getOverlayPane());const s=this.selectionBorder.node,n=t=>{const e=(0,EventUtils.getSource)(t),i=t=>{this.outline.fireMouseEvent(InternalEvent.A.MOUSE_MOVE,new InternalMouseEvent.A(t))},s=t=>{const n=this.outline;InternalEvent.A.removeGestureListeners(e,null,i,s),n.fireMouseEvent(InternalEvent.A.MOUSE_UP,new InternalMouseEvent.A(t))},n=this.outline;InternalEvent.A.addGestureListeners(e,null,i,s),n.fireMouseEvent(InternalEvent.A.MOUSE_DOWN,new InternalMouseEvent.A(t))};InternalEvent.A.addGestureListeners(this.selectionBorder.node,n);const l=this.sizer=this.createSizer(),r=l.node;l.init(this.outline.getView().getOverlayPane()),this.enabled&&(r.style.cursor="nwse-resize"),InternalEvent.A.addGestureListeners(this.sizer.node,n),s.style.display=this.showViewport?"":"none",r.style.display=s.style.display,s.style.cursor="move",this.update(!1)}createGraph(t){const e=new Graph(t,this.source.getDataModel(),getDefaultPlugins(),this.source.getStylesheet());return e.options.foldingEnabled=!1,e.autoScroll=!1,e}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setZoomEnabled(t){this.sizer.node.style.visibility=t?"visible":"hidden"}refresh(){this.update(!0)}createSizer(){const t=this.outline;if(null!=this.sizerImage){const e=new ImageShape.A(new Rectangle.A(0,0,this.sizerImage.width,this.sizerImage.height),this.sizerImage.src);return e.dialect=t.dialect,e}const e=new RectangleShape.A(new Rectangle.A(0,0,this.sizerSize,this.sizerSize),Constants.OUTLINE_HANDLE_FILLCOLOR,Constants.OUTLINE_HANDLE_STROKECOLOR);return e.dialect=t.dialect,e}getSourceContainerSize(){return new Rectangle.A(0,0,this.source.container.scrollWidth,this.source.container.scrollHeight)}getOutlineOffset(t){return null}getSourceGraphBounds(){return this.source.getGraphBounds()}update(t=!1){if(null!=this.source&&null!=this.source.container&&null!=this.outline&&null!=this.outline.container){const e=this.source.view.scale,i=this.getSourceGraphBounds(),s=new Rectangle.A(i.x/e+this.source.panDx,i.y/e+this.source.panDy,i.width/e,i.height/e),n=new Rectangle.A(0,0,this.source.container.clientWidth/e,this.source.container.clientHeight/e),l=s.clone();l.add(n);const r=this.getSourceContainerSize(),a=Math.max(r.width/e,l.width),o=Math.max(r.height/e,l.height),h=Math.max(0,this.outline.container.clientWidth-this.border),d=Math.max(0,this.outline.container.clientHeight-this.border),c=Math.min(h/a,d/o);let u=Number.isNaN(c)?this.minScale:Math.max(this.minScale,c);if(u>0){this.outline.getView().scale!==u&&(this.outline.getView().scale=u,t=!0);const e=this.outline.getView();e.currentRoot!==this.source.getView().currentRoot&&e.setCurrentRoot(this.source.getView().currentRoot);const i=this.source.view.translate;let n=i.x+this.source.panDx,l=i.y+this.source.panDy;const r=this.getOutlineOffset(u);null!=r&&(n+=r.x,l+=r.y),s.x<0&&(n-=s.x),s.y<0&&(l-=s.y),e.translate.x===n&&e.translate.y===l||(e.translate.x=n,e.translate.y=l,t=!0);const a=e.translate;u=this.source.getView().scale;const o=u/e.scale,h=1/e.scale,{container:d}=this.source;this.bounds=new Rectangle.A((a.x-i.x-this.source.panDx)/h,(a.y-i.y-this.source.panDy)/h,d.clientWidth/o,d.clientHeight/o),this.bounds.x+=this.source.container.scrollLeft*e.scale/u,this.bounds.y+=this.source.container.scrollTop*e.scale/u;const c=this.selectionBorder;let g=c.bounds;g.x===this.bounds.x&&g.y===this.bounds.y&&g.width===this.bounds.width&&g.height===this.bounds.height||(c.bounds=this.bounds,c.redraw());const p=this.sizer;g=p.bounds;const E=new Rectangle.A(this.bounds.x+this.bounds.width-g.width/2,this.bounds.y+this.bounds.height-g.height/2,g.width,g.height);g.x===E.x&&g.y===E.y&&g.width===E.width&&g.height===E.height||(p.bounds=E,"hidden"!==p.node.style.visibility&&p.redraw()),t&&this.outline.view.revalidate()}}}mouseDown(t,e){if(this.enabled&&this.showViewport){const t=(0,EventUtils.isMouseEvent)(e.getEvent())?0:this.source.tolerance,i=t>0?new Rectangle.A(e.getGraphX()-t,e.getGraphY()-t,2*t,2*t):null;this.zoom=e.isSource(this.sizer)||null!=i&&intersects(this.sizer.bounds,i),this.startX=e.getX(),this.startY=e.getY(),this.active=!0;const s=this.source.container;this.source.useScrollbarsForPanning&&(0,styleUtils.hasScrollbars)(this.source.container)?(this.dx0=s.scrollLeft,this.dy0=s.scrollTop):(this.dx0=0,this.dy0=0)}e.consume()}mouseMove(t,e){if(this.active){const t=this.bounds,i=this.sizer,s=i.node,n=this.selectionBorder,l=n.node,r=this.source,a=this.outline;l.style.display=this.showViewport?"":"none",s.style.display=l.style.display;const o=this.getTranslateForEvent(e);let h=o.x,d=o.y,c=null;if(this.zoom){const{container:e}=this.source;d=h/(e.clientWidth/e.clientHeight),c=new Rectangle.A(t.x,t.y,Math.max(1,t.width+h),Math.max(1,t.height+d)),n.bounds=c,n.redraw()}else{const{scale:e}=a.getView();c=new Rectangle.A(t.x+h,t.y+d,t.width,t.height),n.bounds=c,n.redraw(),h/=e,h*=r.getView().scale,d/=e,d*=r.getView().scale,r.panGraph(-h-this.dx0,-d-this.dy0)}const u=i.bounds;i.bounds=new Rectangle.A(c.x+c.width-u.width/2,c.y+c.height-u.height/2,u.width,u.height),"hidden"!==s.style.visibility&&i.redraw(),e.consume()}}getTranslateForEvent(t){return new Point.A(t.getX()-this.startX,t.getY()-this.startY)}mouseUp(t,e){if(this.active){const t=this.getTranslateForEvent(e);let i=t.x,s=t.y;const n=this.source,l=this.outline,r=this.selectionBorder;if(Math.abs(i)>0||Math.abs(s)>0){if(this.zoom){const t=r.bounds.width,{scale:e}=n.getView();n.zoomTo(Math.max(this.minScale,e-i*e/t),!1)}else if(!n.useScrollbarsForPanning||!(0,styleUtils.hasScrollbars)(n.container)){n.panGraph(0,0),i/=l.getView().scale,s/=l.getView().scale;const t=n.getView().translate;n.getView().setTranslate(t.x-i,t.y-s)}this.update(),e.consume()}this.index=null,this.active=!1}}destroy(){null!=this.source&&(this.source.removeListener(this.panHandler),this.source.removeListener(this.refreshHandler),this.source.getDataModel().removeListener(this.updateHandler),this.source.getView().removeListener(this.updateHandler),InternalEvent.A.removeListener(this.source.container,"scroll",this.updateHandler),this.source=null),null!=this.outline&&(this.outline.removeMouseListener(this),this.outline.destroy(),this.outline=null),null!=this.selectionBorder&&(this.selectionBorder.destroy(),this.selectionBorder=null),null!=this.sizer&&(this.sizer.destroy(),this.sizer=null)}}const other_Outline=Outline;var TemporaryCellStates=__webpack_require__(4440);class PrintPreview{constructor(t,e=null,i=null,s=null,n=0,l=0,r=null,a="Printer-friendly version",o=null){this.border=0,this.marginTop=0,this.marginBottom=0,this.x0=0,this.y0=0,this.autoOrigin=!0,this.printOverlays=!1,this.printControls=!1,this.printBackgroundImage=!1,this.backgroundColor="#ffffff",this.wnd=null,this.targetWindow=null,this.pageCount=0,this.clipping=!0,this.graph=t,this.scale=null!=e?e:1/t.pageScale,this.border=null!=s?s:0,this.pageFormat=Rectangle.A.fromRectangle(null!=i?i:t.pageFormat),this.title=a,this.x0=n,this.y0=l,this.borderColor=r,this.pageSelector=null==o||o}getWindow(){return this.wnd}getDoctype(){return""}appendGraph(t,e,i,s,n,l){this.graph=t,this.scale=null!=e?e:1/t.pageScale,this.x0=i,this.y0=s,this.open(null,null,n,l)}open(t=null,e=null,i=!1,s=!1){const n=this.graph.cellRenderer.initializeOverlay;let l=null;try{this.printOverlays&&(this.graph.cellRenderer.initializeOverlay=(t,e)=>{e.init(t.view.getDrawPane())}),this.printControls&&(this.graph.cellRenderer.initControl=(t,e,i,s)=>(e.dialect=t.view.graph.dialect,e.init(t.view.getDrawPane()),null)),this.wnd=null!=e?e:this.wnd;let n=!1;if(null==this.wnd&&(n=!0,this.wnd=window.open()),!this.wnd)throw new Error("Create new window not allowed");const r=this.wnd.document;if(n){const e=this.getDoctype();null!=e&&e.length>0&&r.writeln(e),"CSS1Compat"===document.compatMode&&r.writeln("<!DOCTYPE html>"),r.writeln("<html>"),r.writeln("<head>"),this.writeHead(r,t),r.writeln("</head>"),r.writeln('<body class="mxPage">')}const a=this.graph.getGraphBounds().clone(),o=this.graph.getView().getScale(),h=o/this.scale,d=this.graph.getView().getTranslate();this.autoOrigin||(this.x0-=d.x*this.scale,this.y0-=d.y*this.scale,a.width+=a.x,a.height+=a.y,a.x=0,a.y=0,this.border=0);const c=this.pageFormat.width-2*this.border,u=this.pageFormat.height-2*this.border;this.pageFormat.height+=this.marginTop+this.marginBottom,a.width/=h,a.height/=h;const g=Math.max(1,Math.ceil((a.width+this.x0)/c)),p=Math.max(1,Math.ceil((a.height+this.y0)/u));this.pageCount=g*p;const E=()=>{if(this.pageSelector&&(p>1||g>1)){const t=this.createPageSelector(p,g);r.body.appendChild(t)}},C=(t,e)=>{if(null!=this.borderColor&&(t.style.borderColor=this.borderColor,t.style.borderStyle="solid",t.style.borderWidth="1px"),t.style.background=this.backgroundColor,(i||e)&&(t.style.pageBreakAfter="always"),n&&Client.A.IS_EDGE)r.writeln(t.outerHTML),t.parentNode.removeChild(t);else if(Client.A.IS_EDGE){let e=r.createElement("div");e.innerHTML=t.outerHTML,e=e.getElementsByTagName("div")[0],r.body.appendChild(e),t.parentNode.removeChild(t)}else t.parentNode.removeChild(t),r.body.appendChild(t);(i||e)&&this.addPageBreak(r)},m=this.getCoverPages(this.pageFormat.width,this.pageFormat.height);if(m)for(const t of m)C(t,!0);const f=this.getAppendices(this.pageFormat.width,this.pageFormat.height);for(let t=0;t<p;t+=1){const e=t*u/this.scale-this.y0/this.scale+(a.y-d.y*o)/o;for(let i=0;i<g;i++){if(null==this.wnd)return null;const s=i*c/this.scale-this.x0/this.scale+(a.x-d.x*o)/o,n=t*g+i+1,r=new Rectangle.A(s,e,c,u);l=this.renderPage(this.pageFormat.width,this.pageFormat.height,0,0,(t=>{this.addGraphFragment(-s,-e,this.scale,n,t,r),this.printBackgroundImage&&this.insertBackgroundImage(t,-s,-e)}),n),l.setAttribute("id",`mxPage-${n}`),C(l,null!=f||t<p-1||i<g-1)}}if(f)for(const[t,e]of f.entries())C(e,t<f.length-1);n&&!s&&(this.closeDocument(),E()),this.wnd.focus()}catch(t){null!=l&&null!=l.parentNode&&l.parentNode.removeChild(l)}finally{this.graph.cellRenderer.initializeOverlay=n}return this.wnd}addPageBreak(t){const e=t.createElement("hr");e.className="mxPageBreak",t.body.appendChild(e)}closeDocument(){try{if(null!=this.wnd&&null!=this.wnd.document){const t=this.wnd.document;this.writePostfix(t),t.writeln("</body>"),t.writeln("</html>"),t.close(),InternalEvent.A.release(t.body)}}catch(t){}}writeHead(t,e){null!=this.title&&t.writeln(`<title>${this.title}</title>`),(0,domUtils.addLinkToHead)("stylesheet",`${Client.A.basePath}/css/common.css`,t),t.writeln('<style type="text/css">'),t.writeln("@media print {"),t.writeln("  * { -webkit-print-color-adjust: exact; }"),t.writeln("  table.mxPageSelector { display: none; }"),t.writeln("  hr.mxPageBreak { display: none; }"),t.writeln("}"),t.writeln("@media screen {"),t.writeln("  table.mxPageSelector { position: fixed; right: 10px; top: 10px;font-family: Arial; font-size:10pt; border: solid 1px darkgray;background: white; border-collapse:collapse; }"),t.writeln("  table.mxPageSelector td { border: solid 1px gray; padding:4px; }"),t.writeln("  body.mxPage { background: gray; }"),t.writeln("}"),null!=e&&t.writeln(e),t.writeln("</style>")}writePostfix(t){}createPageSelector(t,e){if(!this.wnd)throw new Error("Popup window not created");const i=this.wnd.document,s=i.createElement("table");s.className="mxPageSelector",s.setAttribute("border","0");const n=i.createElement("tbody");for(let s=0;s<t;s+=1){const t=i.createElement("tr");for(let n=0;n<e;n++){const l=s*e+n+1,r=i.createElement("td"),a=i.createElement("a");if(a.setAttribute("href",`#mxPage-${l}`),Client.A.IS_NS&&!Client.A.IS_SF&&!Client.A.IS_GC){const t=`let page = document.getElementById('mxPage-${l}');page.scrollIntoView(true);event.preventDefault();`;a.setAttribute("onclick",t)}(0,domUtils.write)(a,String(l)),r.appendChild(a),t.appendChild(r)}n.appendChild(t)}return s.appendChild(n),s}renderPage(t,e,i,s,n,l){let r=document.createElement("div"),a=null;try{if(0!==i||0!==s){r.style.position="relative",r.style.width=`${t}px`,r.style.height=`${e}px`,r.style.pageBreakInside="avoid";const n=document.createElement("div");n.style.position="relative",n.style.top=`${this.border}px`,n.style.left=`${this.border}px`,n.style.width=t-2*this.border+"px",n.style.height=e-2*this.border+"px",n.style.overflow="hidden";const l=document.createElement("div");l.style.position="relative",l.style.marginLeft=`${i}px`,l.style.marginTop=`${s}px`,n.appendChild(l),r.appendChild(n),document.body.appendChild(r),a=l}else{r.style.width=`${t}px`,r.style.height=`${e}px`,r.style.overflow="hidden",r.style.pageBreakInside="avoid";const i=document.createElement("div");i.style.width=t-2*this.border+"px",i.style.height=e-2*this.border+"px",i.style.overflow="hidden",i.style.top=`${this.border}px`,i.style.left=`${this.border}px`,r.appendChild(i),document.body.appendChild(r),a=i}}catch(t){throw r&&r.parentNode&&r.parentNode.removeChild(r),r=null,t}return n(a),r}getRoot(){let t=this.graph.view.currentRoot;return null==t&&(t=this.graph.getDataModel().getRoot()),t}useCssTransforms(){return!Client.A.NO_FO&&!Client.A.IS_SF}addGraphFragment(t,e,i,s,n,l){const r=this.graph.getView(),a=this.graph.container;this.graph.container=n;const o=r.getCanvas(),h=r.getBackgroundPane(),d=r.getDrawPane(),c=r.getOverlayPane(),u=i;if(this.graph.dialect===Constants.DIALECT.SVG){if(r.createSvg(),this.useCssTransforms()){const s=r.getDrawPane().parentNode;s.getAttribute("transform"),s.setAttribute("transformOrigin","0 0"),s.setAttribute("transform",`scale(${i},${i})translate(${t},${e})`),i=1,t=0,e=0}}else r.createHtml();const g=r.isEventsEnabled();r.setEventsEnabled(!1);const p=this.graph.isEnabled();this.graph.setEnabled(!1);const E=r.getTranslate();r.translate=new Point.A(t,e);const{redraw:C}=this.graph.cellRenderer,{states:m}=r,f=r.scale;if(this.clipping){const t=new Rectangle.A((l.x+E.x)*f,(l.y+E.y)*f,l.width*f/u,l.height*f/u);this.graph.cellRenderer.redraw=(e,i,s)=>{if(null!=e){const i=m.get(e.cell);if(null!=i){const e=r.getBoundingBox(i,!1);if(null!=e&&e.width>0&&e.height>0&&!(0,mathUtils.intersects)(t,e))return}}C.apply(this.graph.cellRenderer,[e,i,s])}}let y=null;try{const t=[this.getRoot()];y=new TemporaryCellStates.A(r,i,t,null,(t=>this.getLinkForCellState(t)))}catch(t){config.eo.logger.error("PrintPreview unable to generate the preview",t)}finally{let t=n.firstChild;for(;null!=t;){const e=t.nextSibling,i=t.nodeName.toLowerCase();"svg"===i?(t.style.overflow="hidden",t.style.position="relative",t.style.top=`${this.marginTop}px`,t.setAttribute("width",String(l.width)),t.setAttribute("height",String(l.height)),t.style.width="",t.style.height=""):"default"!==t.style.cursor&&"div"!==i&&t.parentNode.removeChild(t),t=e}if(this.printBackgroundImage){const t=n.getElementsByTagName("svg");t.length>0&&(t[0].style.position="absolute")}r.overlayPane.parentNode.removeChild(r.overlayPane),this.graph.setEnabled(p),this.graph.container=a,this.graph.cellRenderer.redraw=C,r.canvas=o,r.backgroundPane=h,r.drawPane=d,r.overlayPane=c,r.translate=E,y&&y.destroy(),r.setEventsEnabled(g)}}getLinkForCellState(t){return this.graph.getLinkForCell(t.cell)}insertBackgroundImage(t,e,i){const s=this.graph.backgroundImage;if(null!=s){const n=document.createElement("img");n.style.position="absolute",n.style.marginLeft=`${Math.round(e*this.scale)}px`,n.style.marginTop=`${Math.round(i*this.scale)}px`,n.setAttribute("width",String(Math.round(this.scale*s.width))),n.setAttribute("height",String(Math.round(this.scale*s.height))),n.src=s.src,t.insertBefore(n,t.firstChild)}}getCoverPages(t,e){return null}getAppendices(t,e){return null}print(t){const e=this.open(t);null!=e&&e.print()}close(){null!=this.wnd&&(this.wnd.close(),this.wnd=null)}}const other_PrintPreview=PrintPreview;class SwimlaneManager extends EventSource.A{constructor(t,e=!0,i=!0,s=!0){super(),this.enabled=!0,this.horizontal=!0,this.addEnabled=!0,this.resizeEnabled=!0,this.horizontal=e,this.addEnabled=i,this.resizeEnabled=s,this.addHandler=(t,e)=>{this.isEnabled()&&this.isAddEnabled()&&this.cellsAdded(e.getProperty("cells"))},this.resizeHandler=(t,e)=>{this.isEnabled()&&this.isResizeEnabled()&&this.cellsResized(e.getProperty("cells"))},this.setGraph(t)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isHorizontal(){return this.horizontal}setHorizontal(t){this.horizontal=t}isAddEnabled(){return this.addEnabled}setAddEnabled(t){this.addEnabled=t}isResizeEnabled(){return this.resizeEnabled}setResizeEnabled(t){this.resizeEnabled=t}getGraph(){return this.graph}setGraph(t){this.graph&&(this.graph.removeListener(this.addHandler),this.graph.removeListener(this.resizeHandler)),this.graph=t,this.graph&&(this.graph.addListener(InternalEvent.A.ADD_CELLS,this.addHandler),this.graph.addListener(InternalEvent.A.CELLS_RESIZED,this.resizeHandler))}isSwimlaneIgnored(t){return!this.getGraph().isSwimlane(t)}isCellHorizontal(t){return this.graph.isSwimlane(t)?this.graph.getCellStyle(t).horizontal??!0:!this.isHorizontal()}cellsAdded(t){t.length>0&&this.graph.batchUpdate((()=>{for(const e of t)this.isSwimlaneIgnored(e)||this.swimlaneAdded(e)}))}swimlaneAdded(t){const e=t.getParent(),i=e.getChildCount();let s=null;for(let n=0;n<i;n+=1){const i=e.getChildAt(n);if(i!==t&&!this.isSwimlaneIgnored(i)&&(s=i.getGeometry(),s))break}if(s){const i=e?this.isCellHorizontal(e):this.horizontal;this.resizeSwimlane(t,s.width,s.height,i)}}cellsResized(t){t.length>0&&this.graph.batchUpdate((()=>{for(const e of t)if(!this.isSwimlaneIgnored(e)){const t=e.getGeometry();if(t){const i=new Rectangle.A(0,0,t.width,t.height);let s=e,n=s;for(;n;){s=n,n=n.getParent();const t=this.graph.isSwimlane(n)?this.graph.getStartSize(n):new Rectangle.A;i.width+=t.width,i.height+=t.height}const l=n?this.isCellHorizontal(n):this.horizontal;this.resizeSwimlane(s,i.width,i.height,l)}}}))}resizeSwimlane(t,e,i,s){const n=this.graph.getDataModel();n.batchUpdate((()=>{const l=this.isCellHorizontal(t);if(!this.isSwimlaneIgnored(t)){let l=t.getGeometry();l&&(s&&l.height!==i||!s&&l.width!==e)&&(l=l.clone(),s?l.height=i:l.width=e,n.setGeometry(t,l))}const r=this.graph.isSwimlane(t)?this.graph.getStartSize(t):new Rectangle.A;e-=r.width,i-=r.height;const a=t.getChildCount();for(let s=0;s<a;s+=1){const n=t.getChildAt(s);this.resizeSwimlane(n,e,i,l)}}))}destroy(){this.setGraph(null)}}const layout_SwimlaneManager=SwimlaneManager;class CellAttributeChange{constructor(t,e,i){this.cell=t,this.attribute=e,this.value=i,this.previous=i}execute(){const t=this.cell.getAttribute(this.attribute);(0,Utils.isNullish)(this.previous)?this.cell.value.removeAttribute(this.attribute):this.cell.setAttribute(this.attribute,this.previous),this.previous=t}}const undoable_changes_CellAttributeChange=CellAttributeChange;var CurrentRootChange=__webpack_require__(3816);class KeyHandler{constructor(t,e=null){this.keydownHandler=null,this.graph=null,this.target=null,this.normalKeys={},this.shiftKeys={},this.controlKeys={},this.controlShiftKeys={},this.enabled=!0,null!=t&&(this.graph=t,this.target=e||document.documentElement,this.keydownHandler=t=>{this.keyDown(t)},InternalEvent.A.addListener(this.target,"keydown",this.keydownHandler))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}bindKey(t,e){this.normalKeys[t]=e}bindShiftKey(t,e){this.shiftKeys[t]=e}bindControlKey(t,e){this.controlKeys[t]=e}bindControlShiftKey(t,e){this.controlShiftKeys[t]=e}isControlDown(t){return(0,EventUtils.isControlDown)(t)}getFunction(t){return null==t||(0,EventUtils.isAltDown)(t)?null:this.isControlDown(t)?(0,EventUtils.isShiftDown)(t)?this.controlShiftKeys[t.keyCode]:this.controlKeys[t.keyCode]:(0,EventUtils.isShiftDown)(t)?this.shiftKeys[t.keyCode]:this.normalKeys[t.keyCode]}isGraphEvent(t){const e=(0,EventUtils.getSource)(t),i=this.graph?.getPlugin("CellEditorHandler");return!!(e===this.target||e.parentNode===this.target||i&&i.isEventSource(t))||(0,domUtils.isAncestorNode)(this.graph.container,e)}keyDown(t){if(this.isEnabledForEvent(t))if(27===t.keyCode)this.escape(t);else if(!this.isEventIgnored(t)){const e=this.getFunction(t);null!=e&&(e(t),InternalEvent.A.consume(t))}}isEnabledForEvent(t){return this.graph.isEnabled()&&!(0,EventUtils.isConsumed)(t)&&this.isGraphEvent(t)&&this.isEnabled()}isEventIgnored(t){return this.graph.isEditing()}escape(t){this.graph.isEscapeEnabled()&&this.graph.escape(t)}onDestroy(){null!=this.target&&null!=this.keydownHandler&&(InternalEvent.A.removeListener(this.target,"keydown",this.keydownHandler),this.keydownHandler=null),this.target=null}}const handler_KeyHandler=KeyHandler;class EditorKeyHandler{constructor(t=null){if(this.editor=null,this.handler=null,null!=t){this.editor=t;const e=this.handler=new handler_KeyHandler(t.graph),i=this.handler.escape;this.handler.escape=s=>{i.apply(e,[s]),t.hideProperties(),t.fireEvent(new EventObject.A(InternalEvent.A.ESCAPE,{event:s}))}}}bindAction(t,e,i){const s=()=>{this.editor.execute(e)};i?this.handler.bindControlKey(t,s):this.handler.bindKey(t,s)}destroy(){this.handler.onDestroy(),this.handler=null}}const editor_EditorKeyHandler=EditorKeyHandler;var EditorPopupMenu=__webpack_require__(5474),EditorToolbar=__webpack_require__(1244);class UndoManager extends EventSource.A{constructor(t=100){super(),this.size=100,this.history=[],this.indexOfNextAdd=0,this.size=t,this.clear()}isEmpty(){return 0==this.history.length}clear(){this.history=[],this.indexOfNextAdd=0,this.fireEvent(new EventObject.A(InternalEvent.A.CLEAR))}canUndo(){return this.indexOfNextAdd>0}undo(){for(;this.indexOfNextAdd>0;){const t=this.history[--this.indexOfNextAdd];if(t.undo(),t.isSignificant()){this.fireEvent(new EventObject.A(InternalEvent.A.UNDO,{edit:t}));break}}}canRedo(){return this.indexOfNextAdd<this.history.length}redo(){const t=this.history.length;for(;this.indexOfNextAdd<t;){const t=this.history[this.indexOfNextAdd++];if(t.redo(),t.isSignificant()){this.fireEvent(new EventObject.A(InternalEvent.A.REDO,{edit:t}));break}}}undoableEditHappened(t){this.trim(),this.size>0&&this.size==this.history.length&&this.history.shift(),this.history.push(t),this.indexOfNextAdd=this.history.length,this.fireEvent(new EventObject.A(InternalEvent.A.ADD,{edit:t}))}trim(){if(this.history.length>this.indexOfNextAdd){const t=this.history.splice(this.indexOfNextAdd,this.history.length-this.indexOfNextAdd);for(let e=0;e<t.length;e+=1)t[e].die()}}}const undoable_changes_UndoManager=UndoManager;class GraphLayout{constructor(t){this.useBoundingBox=!0,this.parent=null,this.graph=t}moveCell(t,e,i){}resizeCell(t,e,i){}execute(t){}getGraph(){return this.graph}getConstraint(t,e,i,s){return this.graph.getCurrentCellStyle(e)[t]}traverse({vertex:t,directed:e,func:i,edge:s,visited:n}){if(null!=i&&null!=t&&(e=null==e||e,!(n=n||new util_Dictionary.A).get(t))){n.put(t,!0);const l=i(t,s);if(null==l||l){const s=t.getEdgeCount();if(s>0)for(let l=0;l<s;l+=1){const s=t.getEdgeAt(l),r=s.getTerminal(!0)===t;if(!e||r){const t=this.graph.view.getVisibleTerminal(s,!r);this.traverse({vertex:t,directed:e,func:i,edge:s,visited:n})}}}}}isAncestor(t,e,i){if(!i)return e.getParent()===t;if(e===t)return!1;for(;null!=e&&e!==t;)e=e.getParent();return e===t}isVertexMovable(t){return this.graph.isCellMovable(t)}isVertexIgnored(t){return!t.isVertex()||!t.isVisible()}isEdgeIgnored(t){return!t.isEdge()||!t.isVisible()||null==t.getTerminal(!0)||null==t.getTerminal(!1)}setEdgeStyleEnabled(t,e){this.graph.setCellStyles("noEdgeStyle",e?"0":"1",[t])}setOrthogonalEdge(t,e){this.graph.setCellStyles("orthogonal",e?"1":"0",[t])}getParentOffset(t){const e=new Point.A;if(null!=t&&t!==this.parent&&(this.graph.getDataModel(),this.parent&&this.parent.isAncestor(t))){let i=t.getGeometry();for(;t!==this.parent;)e.x+=i.x,e.y+=i.y,i=(t=t.getParent()).getGeometry()}return e}setEdgePoints(t,e){if(null!=t){const{model:i}=this.graph;let s=t.getGeometry();if(null==s?(s=new Geometry.A,s.setRelative(!0)):s=s.clone(),null!=this.parent&&null!=e){const i=t.getParent(),s=this.getParentOffset(i);for(let t=0;t<e.length;t+=1)e[t].x=e[t].x-s.x,e[t].y=e[t].y-s.y}s.points=e,i.setGeometry(t,s)}}setVertexLocation(t,e,i){const s=this.graph.getDataModel();let n=t.getGeometry(),l=null;if(null!=n){if(l=new Rectangle.A(e,i,n.width,n.height),this.useBoundingBox){const s=this.graph.getView().getState(t);if(null!=s&&null!=s.text&&null!=s.text.boundingBox){const{scale:t}=this.graph.getView(),n=s.text.boundingBox;s.text.boundingBox.x<s.x&&(e+=(s.x-n.x)/t,l.width=n.width),s.text.boundingBox.y<s.y&&(i+=(s.y-n.y)/t,l.height=n.height)}}if(null!=this.parent){const s=t.getParent();if(null!=s&&s!==this.parent){const t=this.getParentOffset(s);e-=t.x,i-=t.y}}n.x===e&&n.y===i||(n=n.clone(),n.x=e,n.y=i,s.setGeometry(t,n))}return l}getVertexBounds(t){let e=t.getGeometry();if(this.useBoundingBox){const i=this.graph.getView().getState(t);if(null!=i&&null!=i.text&&null!=i.text.boundingBox){const{scale:t}=this.graph.getView(),s=i.text.boundingBox,n=Math.max(i.x-s.x,0)/t,l=Math.max(i.y-s.y,0)/t,r=Math.max(s.x+s.width-(i.x+i.width),0)/t,a=Math.max(s.y+s.height-(i.y+i.height),0)/t;e=new Rectangle.A(e.x-n,e.y-l,e.width+n+r,e.height+l+a)}}if(null!=this.parent){const i=t.getParent();if(e=e.clone(),null!=i&&i!==this.parent){const t=this.getParentOffset(i);e.x+=t.x,e.y+=t.y}}return new Rectangle.A(e.x,e.y,e.width,e.height)}arrangeGroups(t,e,i,s,n,l){return this.graph.updateGroupBounds(t,e,!0,i,s,n,l)}}const layout_GraphLayout=GraphLayout;class WeightedCellSorter{constructor(t,e=0){this.weightedValue=0,this.nudge=!1,this.visited=!1,this.rankIndex=null,this.cell=t,this.weightedValue=e}static compare(t,e){return null!=t&&null!=e?e.weightedValue>t.weightedValue?-1:e.weightedValue<t.weightedValue?1:e.nudge?-1:1:0}}const util_WeightedCellSorter=WeightedCellSorter;function findTreeRoots(t,e,i=!1,s=!1){const n=[];if(null!=e){let l=null,r=0;for(const a of e.getChildren())if(a.isVertex()&&a.isVisible()){const o=t.getConnections(a,i?e:null);let h=0,d=0;for(let e=0;e<o.length;e++)t.view.getVisibleTerminal(o[e],!0)==a?h++:d++;(s&&0==h&&d>0||!s&&0==d&&h>0)&&n.push(a);const c=s?d-h:h-d;c>r&&(r=c,l=a)}0==n.length&&null!=l&&n.push(l)}return n}function traverse(t=null,e=!0,i=null,s=null,n=null,l=!1){if(null!=i&&null!=t&&(e=null==e||e,l=null!=l&&l,!(n=n||new Dictionary).get(t))){n.put(t,!0);const r=i(t,s);if(null==r||r){const s=t.getEdgeCount();if(s>0)for(let r=0;r<s;r+=1){const s=t.getEdgeAt(r),a=s.getTerminal(!0)==t;e&&!l!=a||traverse(s.getTerminal(!a),e,i,s,n,l)}}}}class CompactTreeLayout extends layout_GraphLayout{constructor(t,e=!0,i=!1){super(t),this.parentX=null,this.parentY=null,this.visited={},this.horizontal=!0,this.invert=!1,this.resizeParent=!0,this.maintainParentLocation=!1,this.groupPadding=10,this.groupPaddingTop=0,this.groupPaddingRight=0,this.groupPaddingBottom=0,this.groupPaddingLeft=0,this.parentsChanged=null,this.moveTree=!1,this.levelDistance=10,this.nodeDistance=20,this.resetEdges=!0,this.prefHozEdgeSep=5,this.prefVertEdgeOff=4,this.minEdgeJetty=8,this.channelBuffer=4,this.edgeRouting=!0,this.sortEdges=!1,this.alignRanks=!1,this.maxRankHeight=[],this.root=null,this.node=null,this.horizontal=e,this.invert=i}isVertexIgnored(t){return super.isVertexIgnored(t)||0===t.getConnections().length}isHorizontal(){return this.horizontal}execute(t,e){this.parent=t;const i=this.graph.getDataModel();if(null==e)if(this.graph.getEdges(t,t.getParent(),this.invert,!this.invert,!1).length>0)this.root=t;else{const e=findTreeRoots(this.graph,t,!0,this.invert);if(e.length>0)for(let t=0;t<e.length;t+=1)if(!this.isVertexIgnored(e[t])&&this.graph.getEdges(e[t],null,this.invert,!this.invert,!1).length>0){this.root=e[t];break}}else this.root=e;if(null!=this.root){if(this.resizeParent?this.parentsChanged={}:this.parentsChanged=null,this.parentX=null,this.parentY=null,t!==this.root&&null!=t.isVertex()&&this.maintainParentLocation){const e=t.getGeometry();null!=e&&(this.parentX=e.x,this.parentY=e.y)}i.beginUpdate();try{if(this.visited={},this.node=this.dfs(this.root,t),this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0)),null!=this.node){this.layout(this.node);let e=this.graph.gridSize,s=e;if(!this.moveTree){const t=this.getVertexBounds(this.root);null!=t&&(e=t.x,s=t.y)}let n=null;if(n=this.isHorizontal()?this.horizontalLayout(this.node,e,s):this.verticalLayout(this.node,null,e,s),null!=n){let t=0,i=0;n.x<0&&(t=Math.abs(e-n.x)),n.y<0&&(i=Math.abs(s-n.y)),0===t&&0===i||this.moveNode(this.node,t,i),this.resizeParent&&this.adjustParents(),this.edgeRouting&&this.localEdgeProcessing(this.node)}if(null!=this.parentX&&null!=this.parentY){let e=t.getGeometry();null!=e&&(e=e.clone(),e.x=this.parentX,e.y=this.parentY,i.setGeometry(t,e))}}}finally{i.endUpdate()}}}moveNode(t,e,i){t.x+=e,t.y+=i,this.apply(t);let{child:s}=t;for(;null!=s;)this.moveNode(s,e,i),s=s.next}sortOutgoingEdges(t,e){const i=new util_Dictionary.A;e.sort(((e,s)=>{const n=e.getTerminal(e.getTerminal(!1)==t);let l=i.get(n);null==l&&(l=CellPath.A.create(n).split(CellPath.A.PATH_SEPARATOR),i.put(n,l));const r=s.getTerminal(s.getTerminal(!1)===t);let a=i.get(r);return null==a&&(a=CellPath.A.create(r).split(CellPath.A.PATH_SEPARATOR),i.put(r,a)),CellPath.A.compare(l,a)}))}findRankHeights(t,e){const i=this.maxRankHeight;(null==i[e]||i[e]<t.height)&&(i[e]=t.height);let{child:s}=t;for(;null!=s;)this.findRankHeights(s,e+1),s=s.next}setCellHeights(t,e){const i=this.maxRankHeight;null!=i[e]&&i[e]>t.height&&(t.height=i[e]);let{child:s}=t;for(;null!=s;)this.setCellHeights(s,e+1),s=s.next}dfs(t,e){const i=CellPath.A.create(t);let s=null;if(null!=t&&null==this.visited[i]&&!this.isVertexIgnored(t)){this.visited[i]=t,s=this.createNode(t),this.graph.getDataModel();let n=null;const l=this.graph.getEdges(t,e,this.invert,!this.invert,!1,!0),r=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(t,l);for(let t=0;t<l.length;t+=1){const i=l[t];if(!this.isEdgeIgnored(i)){this.resetEdges&&this.setEdgePoints(i,null),this.edgeRouting&&(this.setEdgeStyleEnabled(i,!1),this.setEdgePoints(i,null));const t=r.getState(i),l=null!=t?t.getVisibleTerminal(this.invert):r.getVisibleTerminal(i,this.invert),a=this.dfs(l,e);null!=a&&null!=l.getGeometry()&&(null==n?s.child=a:n.next=a,n=a)}}}return s}layout(t){let{child:e}=t;for(;null!=e;)this.layout(e),e=e.next;null!=t.child?this.attachParent(t,this.join(t)):this.layoutLeaf(t)}horizontalLayout(t,e,i,s=null){t.x+=e+t.offsetX,t.y+=i+t.offsetY,s=this.apply(t,s);const{child:n}=t;if(null!=n){s=this.horizontalLayout(n,t.x,t.y,s);let e=t.y+n.offsetY,i=n.next;for(;null!=i;)s=this.horizontalLayout(i,t.x+n.offsetX,e,s),e+=i.offsetY,i=i.next}return s}verticalLayout(t,e,i,s,n=null){t.x=t.x+i+t.offsetY,t.y=t.y+s+t.offsetX,n=this.apply(t,n);const{child:l}=t;if(null!=l){n=this.verticalLayout(l,t,t.x,t.y,n);let e=t.x+l.offsetY,i=l.next;for(;null!=i;)n=this.verticalLayout(i,t,e,t.y+l.offsetX,n),e+=i.offsetY,i=i.next}return n}attachParent(t,e){const i=this.nodeDistance+this.levelDistance,s=(e-t.width)/2-this.nodeDistance,n=s+t.width+2*this.nodeDistance-e;t.child.offsetX=i+t.height,t.child.offsetY=n,t.contour.upperHead=this.createLine(t.height,0,this.createLine(i,n,t.contour.upperHead)),t.contour.lowerHead=this.createLine(t.height,0,this.createLine(i,s,t.contour.lowerHead))}layoutLeaf(t){const e=2*this.nodeDistance;t.contour.upperTail=this.createLine(t.height+e,0),t.contour.upperHead=t.contour.upperTail,t.contour.lowerTail=this.createLine(0,-t.width-e),t.contour.lowerHead=this.createLine(t.height+e,0,t.contour.lowerTail)}join(t){const e=2*this.nodeDistance;let{child:i}=t;t.contour=i.contour;let s=i.width+e,n=s;for(i=i.next;null!=i;){const l=this.merge(t.contour,i.contour);i.offsetY=l+s,i.offsetX=0,s=i.width+e,n+=l+s,i=i.next}return n}merge(t,e){let i=0,s=0,n=0,l=t.lowerHead,r=e.upperHead;for(;null!=r&&null!=l;){const t=this.offset(i,s,r.dx,r.dy,l.dx,l.dy);s+=t,n+=t,i+r.dx<=l.dx?(i+=r.dx,s+=r.dy,r=r.next):(i-=l.dx,s-=l.dy,l=l.next)}if(null!=r){const n=this.bridge(t.upperTail,0,0,r,i,s);t.upperTail=null!=n.next?e.upperTail:n,t.lowerTail=e.lowerTail}else{const n=this.bridge(e.lowerTail,i,s,l,0,0);null==n.next&&(t.lowerTail=n)}return t.lowerHead=e.lowerHead,n}offset(t,e,i,s,n,l){let r=0;return n<=t||t+i<=0?0:(r=n*s-i*l>0?t<0?t*s/i-e:t>0?t*l/n-e:-e:n<t+i?l-(e+(n-t)*s/i):n>t+i?(i+t)*l/n-(e+s):l-(e+s),r>0?r:0)}bridge(t,e,i,s,n,l){const r=n+s.dx-e;let a=0,o=0;0===s.dx?a=s.dy:(o=r*s.dy,a=o/s.dx);const h=this.createLine(r,a,s.next);return t.next=this.createLine(0,l+s.dy-a-i,h),h}createNode(t){const e={};e.cell=t,e.x=0,e.y=0,e.width=0,e.height=0;const i=this.getVertexBounds(t);return null!=i&&(this.isHorizontal()?(e.width=i.height,e.height=i.width):(e.width=i.width,e.height=i.height)),e.offsetX=0,e.offsetY=0,e.contour={},e}apply(t,e=null){this.graph.getDataModel();const i=t.cell;let s=i.getGeometry();if(null!=i&&null!=s){if(this.isVertexMovable(i)&&(s=this.setVertexLocation(i,t.x,t.y),this.resizeParent)){const t=i.getParent(),e=CellPath.A.create(t),s=this.parentsChanged;null==s[e]&&(s[e]=t)}e=null==e?new Rectangle.A(s.x,s.y,s.width,s.height):new Rectangle.A(Math.min(e.x,s.x),Math.min(e.y,s.y),Math.max(e.x+e.width,s.x+s.width),Math.max(e.y+e.height,s.y+s.height))}return e}createLine(t,e,i=null){return{dx:t,dy:e,next:i}}adjustParents(){const t=[];for(const e in this.parentsChanged)t.push(this.parentsChanged[e]);this.arrangeGroups((0,styleUtils.sortCells)(t,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)}localEdgeProcessing(t){this.processNodeOutgoing(t);let{child:e}=t;for(;null!=e;)this.localEdgeProcessing(e),e=e.next}processNodeOutgoing(t){let{child:e}=t;const i=t.cell;let s=0;const n=[];for(;null!=e;){let t;s++,t=this.horizontal?e.y:e.x,n.push(new util_WeightedCellSorter(e,t)),e=e.next}n.sort(util_WeightedCellSorter.compare);let l=t.width;const r=(s+1)*this.prefHozEdgeSep;l>r+2*this.prefHozEdgeSep&&(l-=2*this.prefHozEdgeSep);const a=l/s;let o=a/2;l>r+2*this.prefHozEdgeSep&&(o+=this.prefHozEdgeSep);let h=this.minEdgeJetty-this.prefVertEdgeOff,d=0;const c=this.getVertexBounds(i);e=t.child;for(let t=0;t<n.length;t++){const e=n[t].cell.cell,l=this.getVertexBounds(e),r=this.graph.getEdgesBetween(i,e,!1),u=[];let g=0,p=0;for(let t=0;t<r.length;t+=1)this.horizontal?(g=c.x+c.width,p=c.y+o,u.push(new Point.A(g,p)),g=c.x+c.width+h,u.push(new Point.A(g,p)),p=l.y+l.height/2,u.push(new Point.A(g,p)),this.setEdgePoints(r[t],u)):(g=c.x+o,p=c.y+c.height,u.push(new Point.A(g,p)),p=c.y+c.height+h,u.push(new Point.A(g,p)),g=l.x+l.width/2,u.push(new Point.A(g,p)),this.setEdgePoints(r[t],u));t<s/2?h+=this.prefVertEdgeOff:t>s/2&&(h-=this.prefVertEdgeOff),o+=a,d=Math.max(d,h)}}}const layout_CompactTreeLayout=CompactTreeLayout;class StackLayout extends layout_GraphLayout{constructor(t,e=null,i=null,s=null,n=null,l=null){super(t),this.border=0,this.marginTop=0,this.marginLeft=0,this.marginRight=0,this.marginBottom=0,this.keepFirstLocation=!1,this.fill=!1,this.resizeParent=!1,this.resizeParentMax=!1,this.resizeLast=!1,this.wrap=null,this.borderCollapse=!0,this.allowGaps=!1,this.gridSize=0,this.horizontal=null==e||e,this.spacing=null!=i?i:0,this.x0=null!=s?s:0,this.y0=null!=n?n:0,this.border=null!=l?l:0}isHorizontal(){return this.horizontal}moveCell(t,e,i){const s=this.graph.getDataModel(),n=t.getParent(),l=this.isHorizontal();if(null!=t&&null!=n){let r=0,a=0;const o=n.getChildCount();let h=l?e:i;const d=this.graph.getView().getState(n);for(null!=d&&(h-=l?d.x:d.y),h/=this.graph.view.scale,r=0;r<o;r+=1){const e=n.getChildAt(r);if(e!==t){const t=e.getGeometry();if(null!=t){const e=l?t.x+t.width/2:t.y+t.height/2;if(a<=h&&e>h)break;a=e}}}let c=n.getIndex(t);c=Math.max(0,r-(r>c?1:0)),s.add(n,t,c)}}getParentSize(t){const e=this.graph.getDataModel();let i=t.getGeometry();if(null!=this.graph.container&&(null==i&&e.isLayer(t)||t===this.graph.getView().currentRoot)){const t=this.graph.container.offsetWidth-1,e=this.graph.container.offsetHeight-1;i=new Geometry.A(0,0,t,e)}return i}getLayoutCells(t){this.graph.getDataModel();const e=t.getChildCount(),i=[];for(let s=0;s<e;s+=1){const e=t.getChildAt(s);!this.isVertexIgnored(e)&&this.isVertexMovable(e)&&i.push(e)}return this.allowGaps&&i.sort(((t,e)=>{const i=t.getGeometry(),s=e.getGeometry();return this.horizontal?i.x===s.x?0:i.x>s.x&&s.x>0?1:-1:i.y===s.y?0:i.y>s.y&&s.y>0?1:-1})),i}snap(t){if(null!=this.gridSize&&this.gridSize>0&&(t=Math.max(t,this.gridSize))/this.gridSize>1){const e=t%this.gridSize;t+=e>this.gridSize/2?this.gridSize-e:-e}return t}execute(t){if(null!=t){const e=this.getParentSize(t),i=this.isHorizontal(),s=this.graph.getDataModel();let n=null;null!=e&&(n=i?e.height-this.marginTop-this.marginBottom:e.width-this.marginLeft-this.marginRight,n-=2*this.border);let l=this.x0+this.border+this.marginLeft,r=this.y0+this.border+this.marginTop;if(this.graph.isSwimlane(t)){const s=this.graph.getCellStyle(t);let a=(0,StringUtils.getNumber)(s,"startSize",Constants.DEFAULT_STARTSIZE);const o=1==(0,Utils.getValue)(s,"horizontal",!0);null!=e&&(a=o?Math.min(a,e.height):Math.min(a,e.width)),i===o&&null!=n&&(n-=a),o?r+=a:l+=a}s.beginUpdate();try{let s=0,a=null,o=0,h=null;const d=this.getLayoutCells(t);for(let t=0;t<d.length;t+=1){const e=d[t];let c=e.getGeometry();if(null!=c){c=c.clone(),null!=this.wrap&&null!=a&&(i&&a.x+a.width+c.width+2*this.spacing>this.wrap||!i&&a.y+a.height+c.height+2*this.spacing>this.wrap)&&(a=null,i?r+=s+this.spacing:l+=s+this.spacing,s=0),s=Math.max(s,i?c.height:c.width);let t=0;if(!this.borderCollapse){const i=this.graph.getCellStyle(e);t=(0,StringUtils.getNumber)(i,"strokeWidth",1)}if(null!=a){const e=o+this.spacing+Math.floor(t/2);i?c.x=this.snap((this.allowGaps?Math.max(e,c.x):e)-this.marginLeft)+this.marginLeft:c.y=this.snap((this.allowGaps?Math.max(e,c.y):e)-this.marginTop)+this.marginTop}else this.keepFirstLocation||(i?c.x=this.allowGaps&&c.x>l?Math.max(this.snap(c.x-this.marginLeft)+this.marginLeft,l):l:c.y=this.allowGaps&&c.y>r?Math.max(this.snap(c.y-this.marginTop)+this.marginTop,r):r);i?c.y=r:c.x=l,this.fill&&null!=n&&(i?c.height=n:c.width=n),i?c.width=this.snap(c.width):c.height=this.snap(c.height),this.setChildGeometry(e,c),h=e,a=c,o=i?a.x+a.width+Math.floor(t/2):a.y+a.height+Math.floor(t/2)}}this.resizeParent&&null!=e&&null!=a&&!t.isCollapsed()?this.updateParentGeometry(t,e,a):this.resizeLast&&null!=e&&null!=a&&null!=h&&(i?a.width=e.width-a.x-this.spacing-this.marginRight-this.marginLeft:a.height=e.height-a.y-this.spacing-this.marginBottom,this.setChildGeometry(h,a))}finally{s.endUpdate()}}}setChildGeometry(t,e){const i=t.getGeometry();null!=i&&e.x===i.x&&e.y===i.y&&e.width===i.width&&e.height===i.height||this.graph.getDataModel().setGeometry(t,e)}updateParentGeometry(t,e,i){const s=this.isHorizontal(),n=this.graph.getDataModel(),l=e.clone();if(s){const t=i.x+i.width+this.marginRight+this.border;this.resizeParentMax?l.width=Math.max(l.width,t):l.width=t}else{const t=i.y+i.height+this.marginBottom+this.border;this.resizeParentMax?l.height=Math.max(l.height,t):l.height=t}e.x===l.x&&e.y===l.y&&e.width===l.width&&e.height===l.height||n.setGeometry(t,l)}}const layout_StackLayout=StackLayout;var Codec=__webpack_require__(8761),CodecRegistry=__webpack_require__(1814),ObjectCodec=__webpack_require__(3456);class GenericChangeCodec extends ObjectCodec.A{constructor(t,e){super(t,["model","previous"],["cell"]),this.variable=e}afterDecode(t,e,i){return(0,domUtils.isNode)(i.cell)&&(i.cell=t.decodeCell(i.cell,!1)),i.previous=i[this.variable],i}}class CellCodec extends ObjectCodec.A{constructor(){super(new Cell.A,["children","edges","overlays","mxTransient"],["parent","source","target"]),this.setName("Cell")}isCellCodec(){return!0}isNumericAttribute(t,e,i){return"value"!==e.nodeName&&super.isNumericAttribute(t,e,i)}isExcluded(t,e,i,s){return super.isExcluded(t,e,i,s)||s&&"value"===e&&i.nodeType===Constants.NODETYPE.ELEMENT}afterEncode(t,e,i){if(null!=e.value&&e.value.nodeType===Constants.NODETYPE.ELEMENT){const s=i;(i=(0,domUtils.importNode)(t.document,e.value,!0)).appendChild(s);const n=s.getAttribute("id");i.setAttribute("id",String(n)),s.removeAttribute("id")}return i}beforeDecode(t,e,i){let s=e.cloneNode(!0);const n=this.getName();if(e.nodeName!==n){const t=e.getElementsByTagName(n)[0];null!=t&&t.parentNode===e?((0,StringUtils.removeWhitespace)(t,!0),(0,StringUtils.removeWhitespace)(t,!1),t.parentNode.removeChild(t),s=t):s=null,i.value=e.cloneNode(!0);const l=i.value.getAttribute("id");null!=l&&(i.setId(l),i.value.removeAttribute("id"))}else i.setId(e.getAttribute("id"));if(null!=s)for(let e=0;e<this.idrefs.length;e+=1){const n=this.idrefs[e],l=s.getAttribute(n);if(null!=l){s.removeAttribute(n);let e=t.objects[l]||t.lookup(l);if(null==e){const i=t.getElementById(l);null!=i&&(e=(CodecRegistry.A.codecs[i.nodeName]||this).decode(t,i))}i[n]=e}}return s}}class ModelCodec extends ObjectCodec.A{constructor(){super(new view_GraphDataModel),this.setName("GraphDataModel")}encodeObject(t,e,i){const s=t.document.createElement("root");t.encodeCell(e.getRoot(),s),i.appendChild(s)}decodeChild(t,e,i){"root"===e.nodeName?this.decodeRoot(t,e,i):this.decodeChild.apply(this,[t,e,i])}decodeRoot(t,e,i){let s=null,n=e.firstChild;for(;null!=n;){const e=t.decodeCell(n);null!=e&&null==e.getParent()&&(s=e),n=n.nextSibling}null!=s&&i.setRoot(s)}}const fieldMapping=new Map([["autosize","autoSize"]]);function convertStyleFromString(t){const e={};t.startsWith(";")&&(e.ignoreDefaultStyle=!0);const i=t.split(";").filter((([t])=>t));for(const t of i)if(t.includes("=")){const[i,s]=t.split("=");e[fieldMapping.get(i)??i]=convertToNumericIfNeeded(s)}else!e.baseStyleNames&&(e.baseStyleNames=[]),e.baseStyleNames.push(t);return e}function convertToNumericIfNeeded(t){if(!(0,mathUtils.isNumeric)(t))return t;let e=parseFloat(t);return!Number.isNaN(e)&&Number.isFinite(e)||(e=0),e}class mxCellCodec extends CellCodec{getName(){return"mxCell"}decodeAttribute(t,e,i){const s=e.nodeName;i&&"style"==s?i.style=convertStyleFromString(e.value):super.decodeAttribute(t,e,i)}}class mxGeometryCodec extends ObjectCodec.A{getName(){return"mxGeometry"}constructor(){super(new Geometry.A)}afterDecode(t,e,i){const s=i.points;if(s){const t=[];for(const e of s){const i=e;t.push(new Point.A(i.x,i.y))}i.points=t}return i}}class ChildChangeCodec extends ObjectCodec.A{constructor(){const t=void 0;super(new undoable_changes_ChildChange(t,t,t),["model","child","previousIndex"],["parent","previous"])}isReference(t,e,i,s){return!("child"!==e||s&&!t.model.contains(t.previous))||this.idrefs.indexOf(e)>=0}isExcluded(t,e,i,s){return super.isExcluded(t,e,i,s)||s&&null!=i&&("previous"===e||"parent"===e)&&!t.model.contains(i)}afterEncode(t,e,i){return this.isReference(e,"child",e.child,!0)?i.setAttribute("child",t.getId(e.child)):t.encodeCell(e.child,i),i}beforeDecode(t,e,i){if(null!=e.firstChild&&e.firstChild.nodeType===Constants.NODETYPE.ELEMENT){const s=e.cloneNode(!0);let n=s.firstChild;i.child=t.decodeCell(n,!1);let l=n.nextSibling;for(n.parentNode.removeChild(n),n=l;null!=n;){if(l=n.nextSibling,n.nodeType===Constants.NODETYPE.ELEMENT){const e=n.getAttribute("id");null==t.lookup(e)&&t.decodeCell(n)}n.parentNode.removeChild(n),n=l}return s}{const s=e.getAttribute("child");return i.child=t.getObject(s),e}}afterDecode(t,e,i){return null!=i.child&&(null!=i.child.parent&&null!=i.previous&&i.child.parent!==i.previous&&(i.previous=i.child.parent),i.child.parent=i.previous,i.previous=i.parent,i.previousIndex=i.index),i}}class GraphCodec extends ObjectCodec.A{constructor(){super(new Graph(void 0),["graphListeners","eventListeners","view","container","cellRenderer","editor","selection"])}}class GraphViewCodec extends ObjectCodec.A{constructor(){super(new GraphView.A(void 0))}encode(t,e){return this.encodeCell(t,e,e.graph.getDataModel().getRoot())}encodeCell(t,e,i){let s;const n=e.graph.getDataModel(),l=e.getState(i),r=i.getParent();if(null==r||null!=l){const a=i.getChildCount(),o=i.getGeometry();let h=null;if(r===n.getRoot()?h="layer":null==r?h="graph":i.isEdge()?h="edge":a>0&&null!=o?h="group":i.isVertex()&&(h="vertex"),null!=h){if(s=t.document.createElement(h),null!=e.graph.getLabel(i)&&(s.setAttribute("label",e.graph.getLabel(i)),e.graph.isHtmlLabel(i)&&s.setAttribute("html",!0)),null==r){const t=e.getGraphBounds();null!=t&&(s.setAttribute("x",Math.round(t.x)),s.setAttribute("y",Math.round(t.y)),s.setAttribute("width",Math.round(t.width)),s.setAttribute("height",Math.round(t.height))),s.setAttribute("scale",e.scale)}else if(null!=l&&null!=o){for(const t in l.style){let e=l.style[t];"function"==typeof e&&"object"==typeof e&&(e=StyleRegistry.A.getName(e)),null!=e&&"function"!=typeof e&&"object"!=typeof e&&s.setAttribute(t,e)}const t=l.absolutePoints;if(null!=t&&t.length>0){let e=`${Math.round(t[0].x)},${Math.round(t[0].y)}`;for(let i=1;i<t.length;i+=1)e+=` ${Math.round(t[i].x)},${Math.round(t[i].y)}`;s.setAttribute("points",e)}else s.setAttribute("x",Math.round(l.x)),s.setAttribute("y",Math.round(l.y)),s.setAttribute("width",Math.round(l.width)),s.setAttribute("height",Math.round(l.height));const e=l.absoluteOffset;null!=e&&(0!==e.x&&s.setAttribute("dx",Math.round(e.x)),0!==e.y&&s.setAttribute("dy",Math.round(e.y)))}for(let n=0;n<a;n+=1){const l=this.encodeCell(t,e,i.getChildAt(n));null!=l&&s.appendChild(l)}}}return s}}class RootChangeCodec extends ObjectCodec.A{constructor(){const t=void 0;super(new undoable_changes_RootChange(t,t),["model","previous","root"])}afterEncode(t,e,i){return t.encodeCell(e.root,i),i}beforeDecode(t,e,i){if(null!=e.firstChild&&e.firstChild.nodeType===Constants.NODETYPE.ELEMENT){let s=(e=e.cloneNode(!0)).firstChild;i.root=t.decodeCell(s,!1);let n=s.nextSibling;for(s.parentNode.removeChild(s),s=n;null!=s;)n=s.nextSibling,t.decodeCell(s),s.parentNode.removeChild(s),s=n}return e}afterDecode(t,e,i){return i.previous=i.root,i}}var StylesheetCodec=__webpack_require__(6557);class TerminalChangeCodec extends ObjectCodec.A{constructor(){const t=void 0;super(new undoable_changes_TerminalChange(t,t,t,t),["model","previous"],["cell","terminal"])}afterDecode(t,e,i){return i.previous=i.terminal,i}}let activeWindow=null;class MaxWindow extends EventSource.A{constructor(t,e,i,s,n=null,l=null,r=!0,a=!0,o=null,h){super(),this.closeImage=`${Client.A.imageBasePath}/close.gif`,this.minimizeImage=`${Client.A.imageBasePath}/minimize.gif`,this.normalizeImage=`${Client.A.imageBasePath}/normalize.gif`,this.maximizeImage=`${Client.A.imageBasePath}/maximize.gif`,this.resizeImage=`${Client.A.imageBasePath}/resize.gif`,this.visible=!1,this.minimumSize=new Rectangle.A(0,0,50,40),this.destroyOnClose=!0,null!=e&&(this.content=e,this.init(i,s,n,l,h),this.installMaximizeHandler(),this.installMinimizeHandler(),this.installCloseHandler(),this.setMinimizable(r),this.setTitle(t),a&&this.installMoveHandler(),null!=o&&null!=o.parentNode?o.parentNode.replaceChild(this.div,o):document.body.appendChild(this.div))}init(t,e,i=null,s=null,n="mxWindow"){this.div=document.createElement("div"),this.div.className=n,this.div.style.left=`${t}px`,this.div.style.top=`${e}px`,this.table=document.createElement("table"),this.table.className=n,Client.A.IS_POINTER&&(this.div.style.touchAction="none"),null!=i&&(this.div.style.width=`${i}px`,this.table.style.width=`${i}px`),null!=s&&(this.div.style.height=`${s}px`,this.table.style.height=`${s}px`);const l=document.createElement("tbody");let r=document.createElement("tr");this.title=document.createElement("td"),this.title.className=`${n}Title`,this.buttons=document.createElement("div"),this.buttons.style.position="absolute",this.buttons.style.display="inline-block",this.buttons.style.right="4px",this.buttons.style.top="5px",this.title.appendChild(this.buttons),r.appendChild(this.title),l.appendChild(r),r=document.createElement("tr"),this.td=document.createElement("td"),this.td.className=`${n}Pane`,this.contentWrapper=document.createElement("div"),this.contentWrapper.className=`${n}Pane`,this.contentWrapper.style.width="100%",this.contentWrapper.appendChild(this.content),"DIV"!==this.content.nodeName.toUpperCase()&&(this.contentWrapper.style.height="100%"),this.td.appendChild(this.contentWrapper),r.appendChild(this.td),l.appendChild(r),this.table.appendChild(l),this.div.appendChild(this.table);const a=t=>{this.activate()};InternalEvent.A.addGestureListeners(this.title,a),InternalEvent.A.addGestureListeners(this.table,a),this.hide()}setTitle(t){let e=this.title.firstChild;for(;null!=e;){const t=e.nextSibling;e.nodeType===Constants.NODETYPE.TEXT&&e.parentNode.removeChild(e),e=t}(0,domUtils.write)(this.title,t||""),this.title.appendChild(this.buttons)}setScrollable(t){(null==navigator.userAgent||navigator.userAgent.indexOf("Presto/2.5")<0)&&(this.contentWrapper.style.overflow=t?"auto":"hidden")}activate(){if(activeWindow!==this){const t=(0,styleUtils.getCurrentStyle)(this.getElement()),e=null!=t?parseInt(t.zIndex):3;if(activeWindow){const t=activeWindow.getElement();t?.style&&(t.style.zIndex=String(e))}const i=activeWindow;this.getElement().style.zIndex=String(e+1),activeWindow=this,this.fireEvent(new EventObject.A(InternalEvent.A.ACTIVATE,{previousWindow:i}))}}getElement(){return this.div}fit(){(0,styleUtils.fit)(this.div)}isResizable(){return null!=this.resize&&"none"!==this.resize.style.display}setResizable(t){if(t)if(null==this.resize){this.resize=document.createElement("img"),this.resize.style.position="absolute",this.resize.style.bottom="2px",this.resize.style.right="2px",this.resize.setAttribute("src",this.resizeImage),this.resize.style.cursor="nw-resize";let t=null,e=null,i=null,s=null;const n=n=>{this.activate(),t=(0,EventUtils.getClientX)(n),e=(0,EventUtils.getClientY)(n),i=this.div.offsetWidth,s=this.div.offsetHeight,InternalEvent.A.addGestureListeners(document,null,l,r),this.fireEvent(new EventObject.A(InternalEvent.A.RESIZE_START,{event:n})),InternalEvent.A.consume(n)},l=n=>{if(null!=t&&null!=e){const l=(0,EventUtils.getClientX)(n)-t,r=(0,EventUtils.getClientY)(n)-e;null!=i&&null!=s&&this.setSize(i+l,s+r),this.fireEvent(new EventObject.A(InternalEvent.A.RESIZE,{event:n})),InternalEvent.A.consume(n)}},r=i=>{null!=t&&null!=e&&(t=null,e=null,InternalEvent.A.removeGestureListeners(document,null,l,r),this.fireEvent(new EventObject.A(InternalEvent.A.RESIZE_END,{event:i})),InternalEvent.A.consume(i))};InternalEvent.A.addGestureListeners(this.resize,n,l,r),this.div.appendChild(this.resize)}else this.resize.style.display="inline";else null!=this.resize&&(this.resize.style.display="none")}setSize(t,e){t=Math.max(this.minimumSize.width,t),e=Math.max(this.minimumSize.height,e),this.div.style.width=`${t}px`,this.div.style.height=`${e}px`,this.table.style.width=`${t}px`,this.table.style.height=`${e}px`,this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight+"px"}setMinimizable(t){this.minimize.style.display=t?"":"none"}getMinimumSize(){return new Rectangle.A(0,0,0,this.title.offsetHeight)}installMinimizeHandler(){this.minimize=document.createElement("img"),this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.minimize.style.cursor="pointer",this.minimize.style.marginLeft="2px",this.minimize.style.display="none",this.buttons.appendChild(this.minimize);let t=!1,e=null,i=null;InternalEvent.A.addGestureListeners(this.minimize,(s=>{if(this.activate(),t)t=!1,this.minimize.setAttribute("src",this.minimizeImage),this.minimize.setAttribute("title","Minimize"),this.contentWrapper.style.display="",null!=e&&null!=i&&(this.maximize.style.display=e,this.div.style.height=i,this.table.style.height=i),null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new EventObject.A(InternalEvent.A.NORMALIZE,{event:s}));else{t=!0,this.minimize.setAttribute("src",this.normalizeImage),this.minimize.setAttribute("title","Normalize"),this.contentWrapper.style.display="none",e=this.maximize.style.display,this.maximize.style.display="none",i=this.table.style.height;const n=this.getMinimumSize();n.height>0&&(this.div.style.height=`${n.height}px`,this.table.style.height=`${n.height}px`),n.width>0&&(this.div.style.width=`${n.width}px`,this.table.style.width=`${n.width}px`),null!=this.resize&&(this.resize.style.visibility="hidden"),this.fireEvent(new EventObject.A(InternalEvent.A.MINIMIZE,{event:s}))}InternalEvent.A.consume(s)}))}setMaximizable(t){this.maximize.style.display=t?"":"none"}installMaximizeHandler(){this.maximize=document.createElement("img"),this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.maximize.style.cursor="default",this.maximize.style.marginLeft="2px",this.maximize.style.cursor="pointer",this.maximize.style.display="none",this.buttons.appendChild(this.maximize);let t=!1,e=null,i=null,s=null,n=null,l=null;const r=r=>{if(this.activate(),"none"!==this.maximize.style.display){if(t)t=!1,this.maximize.setAttribute("src",this.maximizeImage),this.maximize.setAttribute("title","Maximize"),this.contentWrapper.style.display="",null!=l&&(this.minimize.style.display=l),this.div.style.left=`${e}px`,this.div.style.top=`${i}px`,null!=n&&null!=s&&(this.div.style.height=s,this.div.style.width=n),"auto"!==(0,styleUtils.getCurrentStyle)(this.contentWrapper).overflow&&null==this.resize||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight+"px"),null!=n&&null!=s&&(this.table.style.height=s,this.table.style.width=n),null!=this.resize&&(this.resize.style.visibility=""),this.fireEvent(new EventObject.A(InternalEvent.A.NORMALIZE,{event:r}));else{t=!0,this.maximize.setAttribute("src",this.normalizeImage),this.maximize.setAttribute("title","Normalize"),this.contentWrapper.style.display="",l=this.minimize.style.display,this.minimize.style.display="none",e=parseInt(this.div.style.left),i=parseInt(this.div.style.top),s=this.table.style.height,n=this.table.style.width,this.div.style.left="0px",this.div.style.top="0px";const a=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight||0);this.div.style.width=document.body.clientWidth-2+"px",this.div.style.height=a-2+"px",this.table.style.width=document.body.clientWidth-2+"px",this.table.style.height=a-2+"px",null!=this.resize&&(this.resize.style.visibility="hidden"),"auto"!==(0,styleUtils.getCurrentStyle)(this.contentWrapper).overflow&&null==this.resize||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight+"px"),this.fireEvent(new EventObject.A(InternalEvent.A.MAXIMIZE,{event:r}))}InternalEvent.A.consume(r)}};InternalEvent.A.addGestureListeners(this.maximize,r),InternalEvent.A.addListener(this.title,"dblclick",r)}installMoveHandler(){this.title.style.cursor="move",InternalEvent.A.addGestureListeners(this.title,(t=>{const e=(0,EventUtils.getClientX)(t),i=(0,EventUtils.getClientY)(t),s=this.getX(),n=this.getY(),l=t=>{const l=(0,EventUtils.getClientX)(t)-e,r=(0,EventUtils.getClientY)(t)-i;this.setLocation(s+l,n+r),this.fireEvent(new EventObject.A(InternalEvent.A.MOVE,{event:t})),InternalEvent.A.consume(t)},r=t=>{InternalEvent.A.removeGestureListeners(document,null,l,r),this.fireEvent(new EventObject.A(InternalEvent.A.MOVE_END,{event:t})),InternalEvent.A.consume(t)};InternalEvent.A.addGestureListeners(document,null,l,r),this.fireEvent(new EventObject.A(InternalEvent.A.MOVE_START,{event:t})),InternalEvent.A.consume(t)})),Client.A.IS_POINTER&&(this.title.style.touchAction="none")}setLocation(t,e){this.div.style.left=`${t}px`,this.div.style.top=`${e}px`}getX(){return parseInt(this.div.style.left)}getY(){return parseInt(this.div.style.top)}installCloseHandler(){this.closeImg=document.createElement("img"),this.closeImg.setAttribute("src",this.closeImage),this.closeImg.setAttribute("title","Close"),this.closeImg.style.marginLeft="2px",this.closeImg.style.cursor="pointer",this.closeImg.style.display="none",this.buttons.appendChild(this.closeImg),InternalEvent.A.addGestureListeners(this.closeImg,(t=>{this.fireEvent(new EventObject.A(InternalEvent.A.CLOSE,{event:t})),this.destroyOnClose?this.destroy():this.setVisible(!1),InternalEvent.A.consume(t)}))}setImage(t){this.image=document.createElement("img"),this.image.setAttribute("src",t),this.image.setAttribute("align","left"),this.image.style.marginRight="4px",this.image.style.marginLeft="0px",this.image.style.marginTop="-2px",this.title.insertBefore(this.image,this.title.firstChild)}setClosable(t){this.closeImg.style.display=t?"":"none"}isVisible(){return null!=this.div&&"none"!==this.div.style.display}setVisible(t){null!=this.div&&this.isVisible()!==t&&(t?this.show():this.hide())}show(){this.div.style.display="",this.activate(),"auto"!=(0,styleUtils.getCurrentStyle)(this.contentWrapper).overflow&&null==this.resize||"none"==this.contentWrapper.style.display||(this.contentWrapper.style.height=this.div.offsetHeight-this.title.offsetHeight+"px"),this.fireEvent(new EventObject.A(InternalEvent.A.SHOW))}hide(){this.div.style.display="none",this.fireEvent(new EventObject.A(InternalEvent.A.HIDE))}destroy(){this.fireEvent(new EventObject.A(InternalEvent.A.DESTROY)),null!=this.div&&(InternalEvent.A.release(this.div),this.div.parentNode.removeChild(this.div),this.div=null),this.title=null,this.content=null,this.contentWrapper=null}}const popup=(t,e=!1)=>{if(e){const e=document.createElement("div");e.style.overflow="scroll",e.style.width="636px",e.style.height="460px";const i=document.createElement("pre");i.innerHTML=(0,StringUtils.htmlEntities)(t,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),e.appendChild(i);const s=document.body.clientWidth,n=Math.max(document.body.clientHeight||0,document.documentElement.clientHeight),l=new MaxWindow("Popup Window",e,s/2-320,n/2-240,640,480,!1,!0);l.setClosable(!0),l.setVisible(!0)}else if(Client.A.IS_NS){const e=window.open();if(!e)throw new Error("Permission not granted to open popup window");e.document.writeln(`<pre>${(0,StringUtils.htmlEntities)(t)}</pre`),e.document.close()}else{const e=window.open();if(!e)throw new Error("Permission not granted to open popup window");const i=e.document.createElement("pre");i.innerHTML=(0,StringUtils.htmlEntities)(t,!1).replace(/\n/g,"<br>").replace(/ /g,"&nbsp;"),e.document.body.appendChild(i)}},error=(t,e,i,s=null)=>{const n=document.createElement("div");n.style.padding="20px";const l=document.createElement("img");l.setAttribute("src",s||Utils.utils.errorImage),l.setAttribute("valign","bottom"),l.style.verticalAlign="middle",n.appendChild(l),n.appendChild(document.createTextNode(" ")),n.appendChild(document.createTextNode(" ")),n.appendChild(document.createTextNode(" ")),(0,domUtils.write)(n,t);const r=document.body.clientWidth,a=document.body.clientHeight||document.documentElement.clientHeight,o=new MaxWindow(Translations.A.get(Utils.utils.errorResource)||Utils.utils.errorResource,n,(r-e)/2,a/4,e,null,!1,!0);if(i){(0,domUtils.br)(n);const t=document.createElement("p"),e=document.createElement("button");e.setAttribute("style","float:right"),InternalEvent.A.addListener(e,"click",(t=>{o.destroy()})),(0,domUtils.write)(e,Translations.A.get(Utils.utils.closeResource)||Utils.utils.closeResource),t.appendChild(e),n.appendChild(t),(0,domUtils.br)(n),o.setClosable(!0)}return o.setVisible(!0),o},gui_MaxWindow=MaxWindow;class EditorCodec extends ObjectCodec.A{constructor(){super(new editor_Editor(void 0),["modified","lastSnapshot","ignoredChanges","undoManager","graphContainer","toolbarContainer"])}afterDecode(t,e,i){const s=e.getAttribute("defaultEdge");null!=s&&(e.removeAttribute("defaultEdge"),i.defaultEdge=i.templates[s]);const n=e.getAttribute("defaultGroup");return null!=n&&(e.removeAttribute("defaultGroup"),i.defaultGroup=i.templates[n]),i}decodeChild(t,e,i){if("Array"===e.nodeName){if("templates"===e.getAttribute("as"))return void this.decodeTemplates(t,e,i)}else if("ui"===e.nodeName)return void this.decodeUi(t,e,i);super.decodeChild.apply(this,[t,e,i])}decodeUi(t,e,i){let s=e.firstChild;for(;null!=s;){if("add"===s.nodeName){const t=s.getAttribute("as"),e=s.getAttribute("element"),n=s.getAttribute("style");let l=null;if(null!=e)l=document.getElementById(e),null!=l&&null!=n&&(l.style.cssText+=`;${n}`);else{const e=parseInt(s.getAttribute("x")),i=parseInt(s.getAttribute("y")),r=s.getAttribute("width")||null,a=s.getAttribute("height")||null;l=document.createElement("div"),null!=n&&(l.style.cssText=n),new gui_MaxWindow(Translations.A.get(t)||t,l,e,i,r?parseInt(r):null,a?parseInt(a):null,!1,!0).setVisible(!0)}if("graph"===t)i.setGraphContainer(l);else if("toolbar"===t)i.setToolbarContainer(l);else if("title"===t)i.setTitleContainer(l);else if("status"===t)i.setStatusContainer(l);else if("map"===t)throw new Error("Unimplemented")}else"resource"===s.nodeName?Translations.A.add(s.getAttribute("basename")):"stylesheet"===s.nodeName&&(0,domUtils.addLinkToHead)("stylesheet",s.getAttribute("name"));s=s.nextSibling}}decodeTemplates(t,e,i){null==i.templates&&(i.templates=[]);const s=(0,domUtils.getChildNodes)(e);for(let e=0;e<s.length;e++){const n=s[e].getAttribute("as");let l=s[e].firstChild;for(;null!=l&&1!==l.nodeType;)l=l.nextSibling;null!=l&&(i.templates[n]=t.decodeCell(l))}}}class EditorKeyHandlerCodec extends ObjectCodec.A{constructor(){super(new editor_EditorKeyHandler)}encode(t,e){return null}decode(t,e,i){if(null!=i){const{editor:s}=i;let n=e.firstChild;for(;null!=n;){if(!this.processInclude(t,n,i)&&"add"===n.nodeName){const t=n.getAttribute("as"),e=n.getAttribute("action"),s=n.getAttribute("control");i.bindAction(t,e,s)}n=n.nextSibling}}return i}}class EditorPopupMenuCodec extends ObjectCodec.A{constructor(){super(new EditorPopupMenu.A)}encode(t,e){return null}decode(t,e,i){const s=e.getElementsByTagName("include")[0];return null!=s?this.processInclude(t,s,i):null!=i&&(i.config=e),i}}var EditorToolbarCodec=__webpack_require__(1523);const registerGenericChangeCodecs=()=>{const t=void 0;CodecRegistry.A.register(new GenericChangeCodec(new undoable_changes_CellAttributeChange(t,t,t),"value")),CodecRegistry.A.register(new GenericChangeCodec(new undoable_changes_CollapseChange(t,t,t),"collapsed")),CodecRegistry.A.register(new GenericChangeCodec(new undoable_changes_GeometryChange(t,t,t),"geometry")),CodecRegistry.A.register(new GenericChangeCodec(new undoable_changes_StyleChange(t,t,t),"style")),CodecRegistry.A.register(new GenericChangeCodec(new undoable_changes_ValueChange(t,t,t),"value")),CodecRegistry.A.register(new GenericChangeCodec(new undoable_changes_VisibleChange(t,t,t),"visible"))},createObjectCodec=(t,e)=>{const i=new ObjectCodec.A(t);return i.setName(e),i};let isModelCodecsRegistered=!1;const registerModelCodecs=(t=!1)=>{isModelCodecsRegistered&&!t||(CodecRegistry.A.register(new CellCodec),CodecRegistry.A.register(new ModelCodec),CodecRegistry.A.register(createObjectCodec(new Geometry.A,"Geometry")),CodecRegistry.A.register(createObjectCodec(new Point.A,"Point")),CodecRegistry.A.register(new ObjectCodec.A({})),CodecRegistry.A.register(new ObjectCodec.A([])),CodecRegistry.A.addAlias("mxGraphModel","GraphDataModel"),CodecRegistry.A.addAlias("mxPoint","Point"),CodecRegistry.A.register(new mxCellCodec,!1),CodecRegistry.A.register(new mxGeometryCodec,!1),isModelCodecsRegistered=!0)};let isCoreCodecsRegistered=!1;const registerCoreCodecs=(t=!1)=>{isCoreCodecsRegistered&&!t||(CodecRegistry.A.register(new ChildChangeCodec),CodecRegistry.A.register(new GraphCodec),CodecRegistry.A.register(new GraphViewCodec),CodecRegistry.A.register(new RootChangeCodec),CodecRegistry.A.register(new StylesheetCodec.X),CodecRegistry.A.register(new TerminalChangeCodec),registerGenericChangeCodecs(),registerModelCodecs(t),isCoreCodecsRegistered=!0)};let isEditorCodecsRegistered=!1;const registerEditorCodecs=(t=!1)=>{isEditorCodecsRegistered&&!t||(CodecRegistry.A.register(new EditorCodec),CodecRegistry.A.register(new EditorKeyHandlerCodec),CodecRegistry.A.register(new EditorPopupMenuCodec),CodecRegistry.A.register(new EditorToolbarCodec.f),isEditorCodecsRegistered=!0)},registerAllCodecs=(t=!1)=>{registerCoreCodecs(t),registerEditorCodecs(t)};var xmlUtils=__webpack_require__(9547);class ModelXmlSerializer{constructor(t){this.dataModel=t,this.registerCodecs()}import(t){const e="string"==typeof t?(0,xmlUtils.parseXml)(t):t.ownerDocument;new Codec.A(e).decode(e.documentElement,this.dataModel)}export(t){const e=(new Codec.A).encode(this.dataModel);return t?.pretty??1?(0,xmlUtils.getPrettyXml)(e):(0,xmlUtils.getXml)(e)}registerCodecs(){registerModelCodecs()}}class MaxForm{constructor(t){this.table=document.createElement("table"),this.table.className=t,this.body=document.createElement("tbody"),this.table.appendChild(this.body)}getTable(){return this.table}addButtons(t,e){const i=document.createElement("tr");let s=document.createElement("td");i.appendChild(s),s=document.createElement("td");let n=document.createElement("button");(0,domUtils.write)(n,Translations.A.get("ok")||"OK"),s.appendChild(n),InternalEvent.A.addListener(n,"click",(()=>{t()})),n=document.createElement("button"),(0,domUtils.write)(n,Translations.A.get("cancel")||"Cancel"),s.appendChild(n),InternalEvent.A.addListener(n,"click",(()=>{e()})),i.appendChild(s),this.body.appendChild(i)}addText(t,e,i="text"){const s=document.createElement("input");return s.setAttribute("type",i),s.value=e,this.addField(t,s)}addCheckbox(t,e){const i=document.createElement("input");return i.setAttribute("type","checkbox"),this.addField(t,i),e&&(i.checked=!0),i}addTextarea(t,e,i){const s=document.createElement("textarea");return Client.A.IS_NS&&i--,s.setAttribute("rows",String(i||2)),s.value=e,this.addField(t,s)}addCombo(t,e,i){const s=document.createElement("select");return null!=i&&s.setAttribute("size",String(i)),e&&s.setAttribute("multiple","true"),this.addField(t,s)}addOption(t,e,i,s){const n=document.createElement("option");(0,domUtils.writeln)(n,e),n.setAttribute("value",i),s&&n.setAttribute("selected",String(s)),t.appendChild(n)}addField(t,e){const i=document.createElement("tr");let s=document.createElement("td");return(0,domUtils.write)(s,t),i.appendChild(s),s=document.createElement("td"),s.appendChild(e),i.appendChild(s),this.body.appendChild(i),e}}const gui_MaxForm=MaxForm;class Clipboard{static setCells(t){Clipboard.cells=t}static getCells(){return Clipboard.cells}static isEmpty(){return!Clipboard.getCells()}static cut(t,e=[]){return e=Clipboard.copy(t,e),Clipboard.insertCount=0,Clipboard.removeCells(t,e),e}static removeCells(t,e){t.removeCells(e)}static copy(t,e){e=e||t.getSelectionCells();const i=getTopmostCells(t.getExportableCells(e));return Clipboard.insertCount=1,Clipboard.setCells(t.cloneCells(i)),i}static paste(t){let e=null;if(!Clipboard.isEmpty()&&Clipboard.getCells()){e=t.getImportableCells(Clipboard.getCells());const i=Clipboard.insertCount*Clipboard.STEPSIZE,s=t.getDefaultParent();e=t.importCells(e,i,i,s),Clipboard.insertCount++,t.setSelectionCells(e)}return e}}Clipboard.STEPSIZE=10,Clipboard.insertCount=1;const util_Clipboard=Clipboard;class MaxLog{static init(){if(null==MaxLog.window&&null!=document.body){const t=`${MaxLog.consoleName} - mxGraph ${Client.A.VERSION}`,e=document.createElement("table");e.setAttribute("width","100%"),e.setAttribute("height","100%");const i=document.createElement("tbody");let s=document.createElement("tr");const n=document.createElement("td");n.style.verticalAlign="top",MaxLog.textarea=document.createElement("textarea"),MaxLog.textarea.setAttribute("wrap","off"),MaxLog.textarea.setAttribute("readOnly","true"),MaxLog.textarea.style.height="100%",MaxLog.textarea.style.resize="none",MaxLog.textarea.value=MaxLog.buffer,Client.A.IS_NS&&"BackCompat"!==document.compatMode?MaxLog.textarea.style.width="99%":MaxLog.textarea.style.width="100%",n.appendChild(MaxLog.textarea),s.appendChild(n),i.appendChild(s),s=document.createElement("tr"),MaxLog.td=document.createElement("td"),MaxLog.td.style.verticalAlign="top",MaxLog.td.setAttribute("height","30px"),s.appendChild(MaxLog.td),i.appendChild(s),e.appendChild(i),MaxLog.addButton("Info",(function(t){MaxLog.info()})),MaxLog.addButton("DOM",(function(t){const e=(0,domUtils.getInnerHtml)(document.body);MaxLog.debug(e)})),MaxLog.addButton("Trace",(function(t){MaxLog.TRACE=!MaxLog.TRACE,MaxLog.TRACE?MaxLog.debug("Tracing enabled"):MaxLog.debug("Tracing disabled")})),MaxLog.addButton("Copy",(function(t){try{(0,Utils.copyTextToClipboard)(MaxLog.textarea.value)}catch(t){alert(t)}})),MaxLog.addButton("Show",(function(t){try{popup(MaxLog.textarea.value)}catch(t){alert(t)}})),MaxLog.addButton("Clear",(function(t){MaxLog.textarea.value=""}));let l=0,r=0;if("number"==typeof window.innerWidth?(l=window.innerHeight,r=window.innerWidth):(l=document.documentElement.clientHeight||document.body.clientHeight,r=document.body.clientWidth),MaxLog.window=new gui_MaxWindow(t,e,Math.max(0,r-320),Math.max(0,l-210),300,160),MaxLog.window.setMaximizable(!0),MaxLog.window.setScrollable(!1),MaxLog.window.setResizable(!0),MaxLog.window.setClosable(!0),MaxLog.window.destroyOnClose=!1,Client.A.IS_NS&&!Client.A.IS_GC&&!Client.A.IS_SF&&"BackCompat"!==document.compatMode){const t=MaxLog.window.getElement(),e=(e,i)=>{MaxLog.textarea.style.height=`${Math.max(0,t.offsetHeight-70)}px`};MaxLog.window.addListener(InternalEvent.A.RESIZE_END,e),MaxLog.window.addListener(InternalEvent.A.MAXIMIZE,e),MaxLog.window.addListener(InternalEvent.A.NORMALIZE,e),MaxLog.textarea.style.height="92px"}}}static info(){MaxLog.writeln((0,StringUtils.toString)(navigator))}static addButton(t,e){const i=document.createElement("button");(0,domUtils.write)(i,t),InternalEvent.A.addListener(i,"click",e),MaxLog.td.appendChild(i)}static isVisible(){return null!=MaxLog.window&&MaxLog.window.isVisible()}static show(){MaxLog.setVisible(!0)}static setVisible(t){null==MaxLog.window&&MaxLog.init(),null!=MaxLog.window&&MaxLog.window.setVisible(t)}static enter(t){if(MaxLog.TRACE)return MaxLog.writeln(`Entering ${t}`),(new Date).getTime()}static leave(t,e){if(MaxLog.TRACE){const i=(0,Utils.getElapseMillisecondsMessage)(e);MaxLog.writeln(`Leaving ${t}${i}`)}}static debug(...t){MaxLog.DEBUG&&MaxLog.writeln(...t)}static trace(...t){MaxLog.TRACE&&MaxLog.writeln(...t)}static warn(...t){MaxLog.WARN&&MaxLog.writeln(...t)}static write(...t){let e="";for(let i=0;i<t.length;i+=1)e+=t[i],i<t.length-1&&(e+=" ");null!=MaxLog.textarea?(MaxLog.textarea.value=MaxLog.textarea.value+e,null!=navigator.userAgent&&navigator.userAgent.indexOf("Presto/2.5")>=0&&(MaxLog.textarea.style.visibility="hidden",MaxLog.textarea.style.visibility="visible"),MaxLog.textarea.scrollTop=MaxLog.textarea.scrollHeight):MaxLog.buffer+=e}static writeln(...t){let e="";for(let i=0;i<t.length;i+=1)e+=t[i],i<t.length-1&&(e+=" ");MaxLog.write(`${e}\n`)}}MaxLog.textarea=null,MaxLog.consoleName="Console",MaxLog.TRACE=!1,MaxLog.DEBUG=!0,MaxLog.WARN=!0,MaxLog.buffer="";const gui_MaxLog=MaxLog;var MaxXmlRequest=__webpack_require__(5673);class RubberBandHandler{constructor(t){this.first=null,this.destroyed=!1,this.dragHandler=null,this.dropHandler=null,this.x=0,this.y=0,this.width=0,this.height=0,this.defaultOpacity=20,this.enabled=!0,this.div=null,this.sharedDiv=null,this.currentX=0,this.currentY=0,this.fadeOut=!1,this.graph=t,this.graph.addMouseListener(this),this.forceRubberbandHandler=(t,e)=>{const i=e.getProperty("eventName"),s=e.getProperty("event");if(i===InternalEvent.A.MOUSE_DOWN&&this.isForceRubberbandEvent(s)){const t=(0,styleUtils.getOffset)(this.graph.container),e=(0,styleUtils.getScrollOrigin)(this.graph.container);e.x-=t.x,e.y-=t.y,this.start(s.getX()+e.x,s.getY()+e.y),s.consume(!1)}},this.graph.addListener(InternalEvent.A.FIRE_MOUSE_EVENT,this.forceRubberbandHandler),this.panHandler=()=>{this.repaint()},this.graph.addListener(InternalEvent.A.PAN,this.panHandler),this.gestureHandler=(t,e)=>{this.first&&this.reset()},this.graph.addListener(InternalEvent.A.GESTURE,this.gestureHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isForceRubberbandEvent(t){return(0,EventUtils.isAltDown)(t.getEvent())}mouseDown(t,e){if(!e.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&!e.getState()&&!(0,EventUtils.isMultiTouchEvent)(e.getEvent())){const t=(0,styleUtils.getOffset)(this.graph.container),i=(0,styleUtils.getScrollOrigin)(this.graph.container);i.x-=t.x,i.y-=t.y,this.start(e.getX()+i.x,e.getY()+i.y),e.consume(!1)}}start(t,e){this.first=new Point.A(t,e);const{container:i}=this.graph;function s(t){const e=new InternalMouseEvent.A(t),s=(0,styleUtils.convertPoint)(i,e.getX(),e.getY());return e.graphX=s.x,e.graphY=s.y,e}this.dragHandler=t=>{this.mouseMove(this.graph,s(t))},this.dropHandler=t=>{this.mouseUp(this.graph,s(t))},Client.A.IS_FF&&InternalEvent.A.addGestureListeners(document,null,this.dragHandler,this.dropHandler)}mouseMove(t,e){if(!e.isConsumed()&&this.first){const t=(0,styleUtils.getScrollOrigin)(this.graph.container),i=(0,styleUtils.getOffset)(this.graph.container);t.x-=i.x,t.y-=i.y;const s=e.getX()+t.x,n=e.getY()+t.y,l=this.first.x-s,r=this.first.y-n,a=this.graph.getEventTolerance();(this.div||Math.abs(l)>a||Math.abs(r)>a)&&(this.div||(this.div=this.createShape()),(0,domUtils.clearSelection)(),this.update(s,n),e.consume())}}createShape(){this.sharedDiv||(this.sharedDiv=document.createElement("div"),this.sharedDiv.className="mxRubberband",(0,styleUtils.setOpacity)(this.sharedDiv,this.defaultOpacity)),this.graph.container.appendChild(this.sharedDiv);const t=this.sharedDiv;return Client.A.IS_SVG&&this.fadeOut&&(this.sharedDiv=null),t}isActive(t,e){return this.div&&"none"!==this.div.style.display}mouseUp(t,e){const i=this.isActive();this.reset(),i&&(this.execute(e.getEvent()),e.consume())}execute(t){const e=new Rectangle.A(this.x,this.y,this.width,this.height);this.graph.selectRegion(e,t)}reset(){if(this.div)if(Client.A.IS_SVG&&this.fadeOut){const t=this.div;(0,styleUtils.setPrefixedStyle)(t.style,"transition","all 0.2s linear"),t.style.pointerEvents="none",t.style.opacity=String(0),window.setTimeout((()=>{t.parentNode&&t.parentNode.removeChild(t)}),200)}else this.div.parentNode&&this.div.parentNode.removeChild(this.div);InternalEvent.A.removeGestureListeners(document,null,this.dragHandler,this.dropHandler),this.dragHandler=null,this.dropHandler=null,this.currentX=0,this.currentY=0,this.first=null,this.div=null}update(t,e){this.currentX=t,this.currentY=e,this.repaint()}repaint(){if(this.div&&this.first){const t=this.currentX-this.graph.getPanDx(),e=this.currentY-this.graph.getPanDy();this.x=Math.min(this.first.x,t),this.y=Math.min(this.first.y,e),this.width=Math.max(this.first.x,t)-this.x,this.height=Math.max(this.first.y,e)-this.y;const i=0,s=0;this.div.style.left=`${this.x+i}px`,this.div.style.top=`${this.y+s}px`,this.div.style.width=`${Math.max(1,this.width)}px`,this.div.style.height=`${Math.max(1,this.height)}px`}}onDestroy(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),this.graph.removeListener(this.forceRubberbandHandler),this.graph.removeListener(this.panHandler),this.reset(),this.sharedDiv&&(this.sharedDiv=null))}}RubberBandHandler.pluginId="RubberBandHandler";const handler_RubberBandHandler=RubberBandHandler,getScaleForPageCount=(t,e,i,s=0)=>{if(t<1)return 1;const n=(i=null!=i?i:new Rectangle.A(...Constants.PAGE_FORMAT_A4_PORTRAIT)).width-2*s,l=i.height-2*s,r=e.getGraphBounds().clone(),a=e.getView().getScale();r.width/=a,r.height/=a;const o=r.width;let h=1;const d=o/r.height/(n/l),c=Math.sqrt(t),u=Math.sqrt(d);let g=c*u,p=c/u;if(g<1&&p>t){const e=p/t;p=t,g/=e}if(p<1&&g>t){const e=g/t;g=t,p/=e}let E=Math.ceil(g)*Math.ceil(p),C=0;for(;E>t;){let t=Math.floor(g)/g,e=Math.floor(p)/p;1==t&&(t=Math.floor(g-1)/g),1==e&&(e=Math.floor(p-1)/p);let i=1;if(i=t>e?t:e,g*=i,p*=i,E=Math.ceil(g)*Math.ceil(p),C++,C>10)break}return h=n*g/o,.99999*h},show=(t,e=null,i=0,s=0,n=null,l=null)=>{i=null!=i?i:0,s=null!=s?s:0,null==e?e=window.open().document:e.open();const r=t.getGraphBounds(),a=Math.ceil(i-r.x),o=Math.ceil(s-r.y);null==n&&(n=Math.ceil(r.width+i)+Math.ceil(Math.ceil(r.x)-r.x)),null==l&&(l=Math.ceil(r.height+s)+Math.ceil(Math.ceil(r.y)-r.y)),e.writeln("<html><head>");const h=document.getElementsByTagName("base");for(let t=0;t<h.length;t+=1)e.writeln((0,domUtils.getOuterHtml)(h[t]));const d=document.getElementsByTagName("link");for(let t=0;t<d.length;t+=1)e.writeln((0,domUtils.getOuterHtml)(d[t]));const c=document.getElementsByTagName("style");for(let t=0;t<c.length;t+=1)e.writeln((0,domUtils.getOuterHtml)(c[t]));e.writeln('</head><body style="margin:0px;"></body></html>'),e.close();const u=e.createElement("div");u.style.position="absolute",u.style.overflow="hidden",u.style.width=`${n}px`,u.style.height=`${l}px`;const g=e.createElement("div");if(g.style.position="absolute",g.style.left=`${a}px`,g.style.top=`${o}px`,t.container&&t.view.drawPane){let i=t.container.firstChild,s=null;for(;null!=i;){const e=i.cloneNode(!0);i==t.view.drawPane.ownerSVGElement?(u.appendChild(e),s=e):g.appendChild(e),i=i.nextSibling}e.body.appendChild(u),null!=g.firstChild&&e.body.appendChild(g),null!=s&&(s.style.minWidth="",s.style.minHeight="",s.firstChild&&s.firstChild.setAttribute("transform",`translate(${a},${o})`)),(0,styleUtils.removeCursors)(e.body)}return e},printScreen=t=>{const e=window.open();if(!e)return;t.getGraphBounds(),show(t,e.document);const i=()=>{e.focus(),e.print(),e.close()};Client.A.IS_GC?e.setTimeout(i,500):i()};class Editor extends EventSource.A{constructor(t){super(),this.onInit=null,this.lastSnapshot=null,this.ignoredChanges=null,this.rubberband=null,this.isActive=null,this.destroyed=!1,this.askZoomResource="none"!==Client.A.language?"askZoom":"",this.lastSavedResource="none"!==Client.A.language?"lastSaved":"",this.currentFileResource="none"!==Client.A.language?"currentFile":"",this.propertiesResource="none"!==Client.A.language?"properties":"",this.tasksResource="none"!==Client.A.language?"tasks":"",this.helpResource="none"!==Client.A.language?"help":"",this.outlineResource="none"!==Client.A.language?"outline":"",this.outline=null,this.graphRenderHint=null,this.toolbar=null,this.status=null,this.popupHandler=null,this.undoManager=null,this.keyHandler=null,this.actions={},this.dblClickAction="edit",this.swimlaneRequired=!1,this.disableContextMenu=!0,this.insertFunction=null,this.forcedInserting=!1,this.templates=null,this.defaultEdge=null,this.defaultEdgeStyle=null,this.defaultGroup=null,this.groupBorderSize=null,this.filename=null,this.linefeed="&#xa;",this.postParameterName="xml",this.escapePostData=!0,this.urlPost=null,this.urlImage=null,this.horizontalFlow=!1,this.layoutDiagram=!1,this.swimlaneSpacing=0,this.maintainSwimlanes=!1,this.layoutSwimlanes=!1,this.cycleAttributeValues=[],this.cycleAttributeIndex=0,this.cycleAttributeName="fillColor",this.tasks=null,this.tasksWindowImage=null,this.tasksTop=20,this.help=null,this.helpWindowImage=null,this.urlHelp=null,this.helpWidth=300,this.helpHeight=260,this.propertiesWidth=240,this.propertiesHeight=null,this.movePropertiesDialog=!1,this.validating=!1,this.modified=!1,this.actions={},this.addActions(),null!=document.body&&(this.cycleAttributeValues=[],this.popupHandler=new EditorPopupMenu.A,this.undoManager=new undoable_changes_UndoManager,this.graph=this.createGraph(),this.toolbar=this.createToolbar(),this.keyHandler=new editor_EditorKeyHandler(this),this.configure(t),this.graph.swimlaneIndicatorColorAttribute=this.cycleAttributeName,null!=this.onInit&&this.onInit())}isModified(){return this.modified}setModified(t){this.modified=t}addActions(){this.addAction("save",(t=>{t.save()})),this.addAction("print",(t=>{new other_PrintPreview(t.graph,1).open()})),this.addAction("show",(t=>{show(t.graph,null,10,10)})),this.addAction("exportImage",(t=>{const e=t.getUrlImage();if(null==e||Client.A.IS_LOCAL)t.execute("show");else{const i=(0,xmlUtils.getViewXml)(t.graph,1),s=(0,xmlUtils.getXml)(i,"\n");(0,MaxXmlRequest.tA)(e,`${t.postParameterName}=${encodeURIComponent(s)}`,document,"_blank")}})),this.addAction("refresh",(t=>{t.graph.refresh()})),this.addAction("cut",(t=>{t.graph.isEnabled()&&util_Clipboard.cut(t.graph)})),this.addAction("copy",(t=>{t.graph.isEnabled()&&util_Clipboard.copy(t.graph)})),this.addAction("paste",(t=>{t.graph.isEnabled()&&util_Clipboard.paste(t.graph)})),this.addAction("delete",(t=>{t.graph.isEnabled()&&t.graph.removeCells()})),this.addAction("group",(t=>{t.graph.isEnabled()&&t.graph.setSelectionCell(t.groupCells())})),this.addAction("ungroup",(t=>{t.graph.isEnabled()&&t.graph.setSelectionCells(t.graph.ungroupCells())})),this.addAction("removeFromParent",(t=>{t.graph.isEnabled()&&t.graph.removeCellsFromParent()})),this.addAction("undo",(t=>{t.graph.isEnabled()&&t.undo()})),this.addAction("redo",(t=>{t.graph.isEnabled()&&t.redo()})),this.addAction("zoomIn",(t=>{t.graph.zoomIn()})),this.addAction("zoomOut",(t=>{t.graph.zoomOut()})),this.addAction("actualSize",(t=>{t.graph.zoomActual()})),this.addAction("fit",(t=>{t.graph.fit()})),this.addAction("showProperties",((t,e)=>{t.showProperties(e)})),this.addAction("selectAll",(t=>{t.graph.isEnabled()&&t.graph.selectAll()})),this.addAction("selectNone",(t=>{t.graph.isEnabled()&&t.graph.clearSelection()})),this.addAction("selectVertices",(t=>{t.graph.isEnabled()&&t.graph.selectVertices()})),this.addAction("selectEdges",(t=>{t.graph.isEnabled()&&t.graph.selectEdges()})),this.addAction("edit",((t,e)=>{t.graph.isEnabled()&&t.graph.isCellEditable(e)&&t.graph.startEditingAtCell(e)})),this.addAction("toBack",((t,e)=>{t.graph.isEnabled()&&t.graph.orderCells(!0)})),this.addAction("toFront",((t,e)=>{t.graph.isEnabled()&&t.graph.orderCells(!1)})),this.addAction("enterGroup",((t,e)=>{t.graph.enterGroup(e)})),this.addAction("exitGroup",(t=>{t.graph.exitGroup()})),this.addAction("home",(t=>{t.graph.home()})),this.addAction("selectPrevious",(t=>{t.graph.isEnabled()&&t.graph.selectPreviousCell()})),this.addAction("selectNext",(t=>{t.graph.isEnabled()&&t.graph.selectNextCell()})),this.addAction("selectParent",(t=>{t.graph.isEnabled()&&t.graph.selectParentCell()})),this.addAction("selectChild",(t=>{t.graph.isEnabled()&&t.graph.selectChildCell()})),this.addAction("collapse",(t=>{t.graph.isEnabled()&&t.graph.foldCells(!0)})),this.addAction("collapseAll",(t=>{if(t.graph.isEnabled()){const e=t.graph.getChildVertices();t.graph.foldCells(!0,!1,e)}})),this.addAction("expand",(t=>{t.graph.isEnabled()&&t.graph.foldCells(!1)})),this.addAction("expandAll",(t=>{if(t.graph.isEnabled()){const e=t.graph.getChildVertices();t.graph.foldCells(!1,!1,e)}})),this.addAction("bold",(t=>{t.graph.isEnabled()&&t.graph.toggleCellStyleFlags("fontStyle",Constants.FONT.BOLD)})),this.addAction("italic",(t=>{t.graph.isEnabled()&&t.graph.toggleCellStyleFlags("fontStyle",Constants.FONT.ITALIC)})),this.addAction("underline",(t=>{t.graph.isEnabled()&&t.graph.toggleCellStyleFlags("fontStyle",Constants.FONT.UNDERLINE)})),this.addAction("alignCellsLeft",(t=>{t.graph.isEnabled()&&t.graph.alignCells(Constants.ALIGN.LEFT)})),this.addAction("alignCellsCenter",(t=>{t.graph.isEnabled()&&t.graph.alignCells(Constants.ALIGN.CENTER)})),this.addAction("alignCellsRight",(t=>{t.graph.isEnabled()&&t.graph.alignCells(Constants.ALIGN.RIGHT)})),this.addAction("alignCellsTop",(t=>{t.graph.isEnabled()&&t.graph.alignCells(Constants.ALIGN.TOP)})),this.addAction("alignCellsMiddle",(t=>{t.graph.isEnabled()&&t.graph.alignCells(Constants.ALIGN.MIDDLE)})),this.addAction("alignCellsBottom",(t=>{t.graph.isEnabled()&&t.graph.alignCells(Constants.ALIGN.BOTTOM)})),this.addAction("alignFontLeft",(t=>{t.graph.setCellStyles("align",Constants.ALIGN.LEFT)})),this.addAction("alignFontCenter",(t=>{t.graph.isEnabled()&&t.graph.setCellStyles("align",Constants.ALIGN.CENTER)})),this.addAction("alignFontRight",(t=>{t.graph.isEnabled()&&t.graph.setCellStyles("align",Constants.ALIGN.RIGHT)})),this.addAction("alignFontTop",(t=>{t.graph.isEnabled()&&t.graph.setCellStyles("verticalAlign",Constants.ALIGN.TOP)})),this.addAction("alignFontMiddle",(t=>{t.graph.isEnabled()&&t.graph.setCellStyles("verticalAlign",Constants.ALIGN.MIDDLE)})),this.addAction("alignFontBottom",(t=>{t.graph.isEnabled()&&t.graph.setCellStyles("verticalAlign",Constants.ALIGN.BOTTOM)})),this.addAction("zoom",(t=>{const e=100*t.graph.getView().scale,i=prompt(Translations.A.get(t.askZoomResource)||t.askZoomResource,String(e));if(i){const e=parseFloat(i)/100;isNaN(e)||t.graph.getView().setScale(e)}})),this.addAction("toggleTasks",(t=>{null!=t.tasks?t.tasks.setVisible(!t.tasks.isVisible()):t.showTasks()})),this.addAction("toggleHelp",(t=>{null!=t.help?t.help.setVisible(!t.help.isVisible()):t.showHelp()})),this.addAction("toggleOutline",(t=>{null==t.outline?t.showOutline():t.outline.setVisible(!t.outline.isVisible())})),this.addAction("toggleConsole",(t=>{gui_MaxLog.setVisible(!gui_MaxLog.isVisible())}))}configure(t){null!=t&&(new Codec.A(t.ownerDocument).decode(t,this),this.resetHistory())}resetFirstTime(){document.cookie="mxgraph=seen; expires=Fri, 27 Jul 2001 02:47:11 UTC; path=/"}resetHistory(){this.lastSnapshot=(new Date).getTime(),this.undoManager.clear(),this.ignoredChanges=0,this.setModified(!1)}addAction(t,e){this.actions[t]=e}execute(t,e=null,i=null){const s=this.actions[t];if(null!=s)try{const t=[this,e,i];s.apply(this,t)}catch(e){throw error(`Cannot execute ${t}: ${e.message}`,280,!0),e}else error(`Cannot find action ${t}`,280,!0)}addTemplate(t,e){this.templates[t]=e}getTemplate(t){return this.templates[t]}createGraph(){const t=new Graph(void 0);t.setTooltips(!0),t.setPanning(!0),this.installDblClickHandler(t),this.installUndoHandler(t),this.installDrillHandler(t),this.installChangeHandler(t),this.installInsertHandler(t);const e=t.getPlugin("PopupMenuHandler");e&&(e.factoryMethod=(t,e,i)=>this.createPopupMenu(t,e,i));const i=t.getPlugin("ConnectionHandler");return i&&(i.factoryMethod=(t,e)=>this.createEdge(t,e)),this.createSwimlaneManager(t),this.createLayoutManager(t),t}createSwimlaneManager(t){const e=new layout_SwimlaneManager(t,!1);return e.isHorizontal=()=>this.horizontalFlow,e.isEnabled=()=>this.maintainSwimlanes,e}createLayoutManager(t){const e=new layout_LayoutManager(t);return e.getLayout=e=>{let i=null;return this.graph.getDataModel(),null!=e.getParent()&&(this.layoutSwimlanes&&t.isSwimlane(e)?(null==this.swimlaneLayout&&(this.swimlaneLayout=this.createSwimlaneLayout()),i=this.swimlaneLayout):this.layoutDiagram&&(t.isValidRoot(e)||null==e.getParent().getParent())&&(null==this.diagramLayout&&(this.diagramLayout=this.createDiagramLayout()),i=this.diagramLayout)),i},e}setGraphContainer(t){null==this.graph.container&&(this.graph.init(t),this.rubberband=new handler_RubberBandHandler(this.graph),this.disableContextMenu&&InternalEvent.A.disableContextMenu(t))}installDblClickHandler(t){t.addListener(InternalEvent.A.DOUBLE_CLICK,((e,i)=>{const s=i.getProperty("cell");null!=s&&t.isEnabled()&&null!=this.dblClickAction&&(this.execute(this.dblClickAction,s),i.consume())}))}installUndoHandler(t){const e=(t,e)=>{const i=e.getProperty("edit");this.undoManager.undoableEditHappened(i)};t.getDataModel().addListener(InternalEvent.A.UNDO,e),t.getView().addListener(InternalEvent.A.UNDO,e);const i=(e,i)=>{const{changes:s}=i.getProperty("edit");t.setSelectionCells(t.getSelectionCellsForChanges(s))};this.undoManager.addListener(InternalEvent.A.UNDO,i),this.undoManager.addListener(InternalEvent.A.REDO,i)}installDrillHandler(t){const e=t=>{this.fireEvent(new EventObject.A(InternalEvent.A.ROOT))};t.getView().addListener(InternalEvent.A.DOWN,e),t.getView().addListener(InternalEvent.A.UP,e)}installChangeHandler(t){t.getDataModel().addListener(InternalEvent.A.CHANGE,((e,i)=>{this.setModified(!0),1==this.validating&&t.validateGraph();const{changes:s}=i.getProperty("edit");for(let t=0;t<s.length;t+=1){const e=s[t];if(e instanceof undoable_changes_RootChange||e instanceof undoable_changes_ValueChange&&e.cell===this.graph.model.root||e instanceof undoable_changes_CellAttributeChange&&e.cell===this.graph.model.root){this.fireEvent(new EventObject.A(InternalEvent.A.ROOT));break}}}))}installInsertHandler(t){const e={mouseDown:(t,e)=>{null==this.insertFunction||e.isPopupTrigger()||!this.forcedInserting&&null!=e.getState()||(this.graph.clearSelection(),this.insertFunction(e.getEvent(),e.getCell()),this.isActive=!0,e.consume())},mouseMove:(t,e)=>{this.isActive&&e.consume()},mouseUp:(t,e)=>{this.isActive&&(this.isActive=!1,e.consume())}};t.addMouseListener(e)}createDiagramLayout(){const t=this.graph.gridSize,e=new layout_StackLayout(this.graph,!this.horizontalFlow,this.swimlaneSpacing,2*t,2*t);return e.isVertexIgnored=t=>!e.graph.isSwimlane(t),e}createSwimlaneLayout(){return new layout_CompactTreeLayout(this.graph,this.horizontalFlow)}createToolbar(){return new EditorToolbar.t(null,this)}setToolbarContainer(t){this.toolbar.init(t)}setStatusContainer(t){null==this.status&&(this.status=t,this.addListener(InternalEvent.A.SAVE,(()=>{const t=(new Date).toLocaleString();this.setStatus(`${Translations.A.get(this.lastSavedResource)||this.lastSavedResource}: ${t}`)})),this.addListener(InternalEvent.A.OPEN,(()=>{this.setStatus(`${Translations.A.get(this.currentFileResource)||this.currentFileResource}: ${this.filename}`)})))}setStatus(t){null!=this.status&&null!=t&&(this.status.innerHTML=t)}setTitleContainer(t){this.addListener(InternalEvent.A.ROOT,(e=>{t.innerHTML=this.getTitle()}))}treeLayout(t,e){null!=t&&new layout_CompactTreeLayout(this.graph,e).execute(t)}getTitle(){let t="";const{graph:e}=this;let i=e.getCurrentRoot();for(;null!=i&&null!=i.getParent().getParent();)e.isValidRoot(i)&&(t=` > ${e.convertValueToString(i)}${t}`),i=i.getParent();return this.getRootTitle()+t}getRootTitle(){const t=this.graph.getDataModel().getRoot();return this.graph.convertValueToString(t)}undo(){this.undoManager.undo()}redo(){this.undoManager.redo()}groupCells(){const t=null!=this.groupBorderSize?this.groupBorderSize:this.graph.gridSize;return this.graph.groupCells(this.createGroup(),t)}createGroup(){return cloneCell(this.defaultGroup)}open(t){if(null!=t){const e=(0,MaxXmlRequest.Hh)(t).getXml();this.readGraphModel(e.documentElement),this.filename=t,this.fireEvent(new EventObject.A(InternalEvent.A.OPEN,{filename:t}))}}readGraphModel(t){new ModelXmlSerializer(this.graph.getDataModel()).import(t),this.resetHistory()}save(t=null,e=this.linefeed){if(null!=(t=t||this.getUrlPost())&&t.length>0){const i=this.writeGraphModel(e);this.postDiagram(t,i),this.setModified(!1)}this.fireEvent(new EventObject.A(InternalEvent.A.SAVE,{url:t}))}postDiagram(t,e){this.escapePostData&&(e=encodeURIComponent(e)),(0,MaxXmlRequest.bE)(t,`${this.postParameterName}=${e}`,(i=>{this.fireEvent(new EventObject.A(InternalEvent.A.POST,{request:i,url:t,data:e}))}))}writeGraphModel(t){return new ModelXmlSerializer(this.graph.getDataModel()).export({pretty:!1})}getUrlPost(){return this.urlPost}getUrlImage(){return this.urlImage}swapStyles(t,e){const i=this.graph.getStylesheet().styles[e];this.graph.getView().getStylesheet().putCellStyle(e,this.graph.getStylesheet().styles[t]),this.graph.getStylesheet().putCellStyle(t,i),this.graph.refresh()}showProperties(t=null){if(null==(t=t||this.graph.getSelectionCell())&&null==(t=this.graph.getCurrentRoot())&&(t=this.graph.getDataModel().getRoot()),null!=t){this.graph.stopEditing(!0);const e=(0,styleUtils.getOffset)(this.graph.container);let i=e.x+10,{y:s}=e;if(null==this.properties||this.movePropertiesDialog){const e=this.graph.getCellBounds(t);null!=e&&(i+=e.x+Math.min(200,e.width),s+=e.y)}else i=this.properties.getX(),s=this.properties.getY();this.hideProperties();const n=this.createProperties(t);null!=n&&(this.properties=new gui_MaxWindow(Translations.A.get(this.propertiesResource)||this.propertiesResource,n,i,s,this.propertiesWidth,this.propertiesHeight,!1),this.properties.setVisible(!0))}}isPropertiesVisible(){return null!=this.properties}createProperties(t){const e=this.graph.getDataModel(),i=t.getValue();if((0,domUtils.isNode)(i)){const s=new gui_MaxForm("properties");s.addText("ID",t.getId()).setAttribute("readonly","true");let n=null,l=null,r=null,a=null,o=null;t.isVertex()&&(n=t.getGeometry(),null!=n&&(l=s.addText("top",n.y),r=s.addText("left",n.x),a=s.addText("width",n.width),o=s.addText("height",n.height)));const h=t.getStyle(),d=s.addText("Style",h||""),c=i.attributes,u=[];for(let t=0;t<c.length;t+=1){const e=c[t].value;u.push(s.addTextarea(c[t].nodeName,e,"label"===c[t].nodeName?4:2))}const g=()=>{this.hideProperties(),e.beginUpdate();try{null!=n&&null!=r&&null!=l&&null!=a&&null!=o&&(n=n.clone(),n.x=parseFloat(r.value),n.y=parseFloat(l.value),n.width=parseFloat(a.value),n.height=parseFloat(o.value),e.setGeometry(t,n)),d.value.length>0?e.setStyle(t,d.value):e.setStyle(t,{});for(let i=0;i<c.length;i+=1){const s=new undoable_changes_CellAttributeChange(t,c[i].nodeName,u[i].value);e.execute(s)}this.graph.isAutoSizeCell(t)&&this.graph.updateCellSize(t)}finally{e.endUpdate()}},p=()=>{this.hideProperties()};return s.addButtons(g,p),s.table}return null}hideProperties(){null!=this.properties&&(this.properties.destroy(),this.properties=null)}showTasks(){if(null==this.tasks){const t=document.createElement("div");t.style.padding="4px",t.style.paddingLeft="20px";const e=document.body.clientWidth,i=new gui_MaxWindow(Translations.A.get(this.tasksResource)||this.tasksResource,t,e-220,this.tasksTop,200);i.setClosable(!0),i.destroyOnClose=!1;const s=e=>{InternalEvent.A.release(t),t.innerHTML="",this.createTasks(t)};this.graph.getDataModel().addListener(InternalEvent.A.CHANGE,s),this.graph.getSelectionModel().addListener(InternalEvent.A.CHANGE,s),this.graph.addListener(InternalEvent.A.ROOT,s),null!=this.tasksWindowImage&&i.setImage(this.tasksWindowImage),this.tasks=i,this.createTasks(t)}this.tasks.setVisible(!0)}refreshTasks(t){if(null!=this.tasks){const t=this.tasks.content;InternalEvent.A.release(t),t.innerHTML="",this.createTasks(t)}}createTasks(t){}showHelp(t=null){if(null==this.help){const t=document.createElement("iframe");t.setAttribute("src",Translations.A.get("urlHelp")||this.urlHelp),t.setAttribute("height","100%"),t.setAttribute("width","100%"),t.setAttribute("frameBorder","0"),t.style.backgroundColor="white";const e=document.body.clientWidth,i=document.body.clientHeight||document.documentElement.clientHeight,s=new gui_MaxWindow(Translations.A.get(this.helpResource)||this.helpResource,t,(e-this.helpWidth)/2,(i-this.helpHeight)/3,this.helpWidth,this.helpHeight);if(s.setMaximizable(!0),s.setClosable(!0),s.destroyOnClose=!1,s.setResizable(!0),null!=this.helpWindowImage&&s.setImage(this.helpWindowImage),Client.A.IS_NS){const e=e=>{const i=s.div.offsetHeight;t.setAttribute("height",i-26+"px")};s.addListener(InternalEvent.A.RESIZE_END,e),s.addListener(InternalEvent.A.MAXIMIZE,e),s.addListener(InternalEvent.A.NORMALIZE,e),s.addListener(InternalEvent.A.SHOW,e)}this.help=s}this.help.setVisible(!0)}showOutline(){if(null==this.outline){const t=document.createElement("div");t.style.overflow="hidden",t.style.position="relative",t.style.width="100%",t.style.height="100%",t.style.background="white",t.style.cursor="move";const e=new gui_MaxWindow(Translations.A.get(this.outlineResource)||this.outlineResource,t,600,480,200,200,!1),i=new other_Outline(this.graph,t);e.setClosable(!0),e.setResizable(!0),e.destroyOnClose=!1,e.addListener(InternalEvent.A.RESIZE_END,(()=>{i.update()})),this.outline=e,this.outline.Outline=i}this.outline.setVisible(!0),this.outline.outline.update(!0)}setMode(t){const e=this.graph.getPlugin("PanningHandler");"select"===t?(e&&(e.useLeftButtonForPanning=!1),this.graph.setConnectable(!1)):"connect"===t?(e&&(e.useLeftButtonForPanning=!1),this.graph.setConnectable(!0)):"pan"===t&&(e&&(e.useLeftButtonForPanning=!0),this.graph.setConnectable(!1))}createPopupMenu(t,e,i){this.popupHandler.createMenu(this,t,e,i)}createEdge(t,e){let i;if(null!=this.defaultEdge)i=cloneCell(this.defaultEdge);else{i=new Cell.A(""),i.setEdge(!0);const t=new Geometry.A;t.relative=!0,i.setGeometry(t)}const s=this.getEdgeStyle();return null!=s&&i.setStyle(s),i}getEdgeStyle(){return this.defaultEdgeStyle}consumeCycleAttribute(t){return null!=this.cycleAttributeValues&&this.cycleAttributeValues.length>0&&this.graph.isSwimlane(t)?this.cycleAttributeValues[this.cycleAttributeIndex++%this.cycleAttributeValues.length]:null}cycleAttribute(t){if(null!=this.cycleAttributeName){const e=this.consumeCycleAttribute(t);null!=e&&t.setStyle(`${t.getStyle()};${this.cycleAttributeName}=${e}`)}}addVertex(t,e,i,s){const n=this.graph.getDataModel();for(;null!=t&&!this.graph.isValidDropTarget(t);)t=t.getParent();t=null!=t?t:this.graph.getSwimlaneAt(i,s);const{scale:l}=this.graph.getView();let r=e.getGeometry();const a=t.getGeometry();if(this.graph.isSwimlane(e)&&!this.graph.swimlaneNesting)t=null;else{if(null==t&&this.swimlaneRequired)return null;if(null!=t&&null!=a){const e=this.graph.getView().getState(t);if(null!=e){if(i-=e.origin.x*l,s-=e.origin.y*l,this.graph.isConstrainedMoving){const{width:t}=r,{height:n}=r;let l=e.x+e.width;i+t>l&&(i-=i+t-l),l=e.y+e.height,s+n>l&&(s-=s+n-l)}}else null!=a&&(i-=a.x*l,s-=a.y*l)}}r=r.clone(),r.x=this.graph.snap(i/l-this.graph.getView().translate.x-this.graph.gridSize/2),r.y=this.graph.snap(s/l-this.graph.getView().translate.y-this.graph.gridSize/2),e.setGeometry(r),null==t&&(t=this.graph.getDefaultParent()),this.cycleAttribute(e),this.fireEvent(new EventObject.A(InternalEvent.A.BEFORE_ADD_VERTEX,{vertex:e,parent:t})),n.beginUpdate();try{null!=(e=this.graph.addCell(e,t))&&(this.graph.constrainChild(e),this.fireEvent(new EventObject.A(InternalEvent.A.ADD_VERTEX,{vertex:e})))}finally{n.endUpdate()}return null!=e&&(this.graph.setSelectionCell(e),this.graph.scrollCellToVisible(e),this.fireEvent(new EventObject.A(InternalEvent.A.AFTER_ADD_VERTEX,{vertex:e}))),e}destroy(){this.destroyed||(this.destroyed=!0,null!=this.tasks&&this.tasks.destroy(),null!=this.outline&&this.outline.destroy(),null!=this.properties&&this.properties.destroy(),null!=this.keyHandler&&this.keyHandler.destroy(),null!=this.rubberband&&this.rubberband.onDestroy(),null!=this.toolbar&&this.toolbar.destroy(),null!=this.graph&&this.graph.destroy(),this.status=null,this.templates=null)}}const editor_Editor=Editor;class CellTracker extends cell_CellMarker{constructor(t,e,i=null){super(t,e),this.destroyed=!1,this.graph.addMouseListener(this),i&&(this.getCell=i)}mouseDown(t,e){}mouseMove(t,e){this.isEnabled()&&this.process(e)}mouseUp(t,e){}destroy(){this.destroyed||(this.destroyed=!0,this.graph.removeMouseListener(this),super.destroy())}}const cell_CellTracker=CellTracker;class VertexHandle{constructor(t,e="default",i=null,s=null){this.dependencies=["snap","cells"],this.cursor="default",this.image=null,this.ignoreGrid=!1,this.active=!0,this.graph=t.view.graph,this.state=t,this.cursor=e,this.image=i,this.shape=s,this.init()}getPosition(t){return new Point.A}setPosition(t,e,i){}execute(t){}copyStyle(t){this.graph.setCellStyles(t,this.state.style[t],[this.state.cell])}processEvent(t){const{scale:e}=this.graph.view,i=this.graph.view.translate;let s=new Point.A(t.getGraphX()/e-i.x,t.getGraphY()/e-i.y);null!=this.shape&&null!=this.shape.bounds&&(s.x-=this.shape.bounds.width/e/4,s.y-=this.shape.bounds.height/e/4);const n=-(0,mathUtils.toRadians)(this.getRotation()),l=-(0,mathUtils.toRadians)(this.getTotalRotation())-n;s=this.flipPoint(this.rotatePoint(this.snapPoint(this.rotatePoint(s,n),this.ignoreGrid||!this.graph.isGridEnabledEvent(t.getEvent())),l)),this.setPosition(this.state.getPaintBounds(),s,t),this.redraw()}positionChanged(){null!=this.state.text&&this.state.text.apply(this.state),null!=this.state.shape&&this.state.shape.apply(this.state),this.graph.cellRenderer.redraw(this.state,!0)}getRotation(){return null!=this.state.shape?this.state.shape.getRotation():0}getTotalRotation(){return null!=this.state.shape?this.state.shape.getShapeRotation():0}init(){const t=this.isHtmlRequired();this.image?(this.shape=new ImageShape.A(new Rectangle.A(0,0,this.image.width,this.image.height),this.image.src),this.shape.preserveImageAspect=!1):this.shape||(this.shape=this.createShape(t)),this.initShape(t)}createShape(t){const e=HandleConfig.size,i=new Rectangle.A(0,0,e,e);return new RectangleShape.A(i,HandleConfig.fillColor,HandleConfig.strokeColor)}initShape(t){const e=this.shape;t&&e.isHtmlAllowed()?(e.dialect=Constants.DIALECT.STRICTHTML,e.init(this.graph.container)):(e.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,this.cursor&&e.init(this.graph.getView().getOverlayPane())),InternalEvent.A.redirectMouseEvents(e.node,this.graph,this.state),e.node.style.cursor=this.cursor}redraw(){if(this.shape&&this.state.shape){let t=this.getPosition(this.state.getPaintBounds());if(t){const e=(0,mathUtils.toRadians)(this.getTotalRotation());t=this.rotatePoint(this.flipPoint(t),e);const{scale:i}=this.graph.view,s=this.graph.view.translate,n=this.shape.bounds;n.x=Math.floor((t.x+s.x)*i-n.width/2),n.y=Math.floor((t.y+s.y)*i-n.height/2),this.shape.redraw()}}}isHtmlRequired(){return!!this.state.text&&this.state.text.node.parentNode===this.graph.container}rotatePoint(t,e){const i=this.state.getCellBounds(),s=new Point.A(i.getCenterX(),i.getCenterY()),n=Math.cos(e),l=Math.sin(e);return(0,mathUtils.getRotatedPoint)(t,n,l,s)}flipPoint(t){if(this.state.shape){const e=this.state.getCellBounds();this.state.shape.flipH&&(t.x=2*e.x+e.width-t.x),this.state.shape.flipV&&(t.y=2*e.y+e.height-t.y)}return t}snapPoint(t,e){return e||(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t}setVisible(t){this.shape&&this.shape.node&&(this.shape.node.style.display=t?"":"none")}reset(){this.setVisible(!0),this.state.style=this.graph.getCellStyle(this.state.cell),this.positionChanged()}destroy(){this.shape&&(this.shape.destroy(),this.shape=null)}}const cell_VertexHandle=VertexHandle;class CircleLayout extends layout_GraphLayout{constructor(t,e=100){super(t),this.moveCircle=!1,this.x0=0,this.y0=0,this.resetEdges=!0,this.disableEdgeStyle=!0,this.radius=e}execute(t){this.graph.batchUpdate((()=>{let e=0,i=null,s=null;const n=[],l=t.getChildCount();for(let r=0;r<l;r+=1){const l=t.getChildAt(r);if(this.isVertexIgnored(l))this.isEdgeIgnored(l)||(this.resetEdges&&this.graph.resetEdge(l),this.disableEdgeStyle&&this.setEdgeStyleEnabled(l,!1));else{n.push(l);const t=this.getVertexBounds(l);i=null==i?t.y:Math.min(i,t.y),s=null==s?t.x:Math.min(s,t.x),e=Math.max(e,Math.max(t.width,t.height))}}const r=this.getRadius(n.length,e);this.moveCircle&&(s=this.x0,i=this.y0),this.circle(n,r,s,i)}))}getRadius(t,e){return Math.max(t*e/Math.PI,this.radius)}circle(t,e,i,s){const n=t.length,l=2*Math.PI/n;t.forEach(((t,n)=>{this.isVertexMovable(t)&&this.setVertexLocation(t,Math.round(i+e+e*Math.sin(n*l)),Math.round(s+e+e*Math.cos(n*l)))}))}}const layout_CircleLayout=CircleLayout;class CompositeLayout extends layout_GraphLayout{constructor(t,e,i){super(t),this.layouts=e,this.master=i}moveCell(t,e,i){null!=this.master?this.master.moveCell.apply(this.master,[t,e,i]):this.layouts[0].moveCell.apply(this.layouts[0],[t,e,i])}execute(t){this.graph.batchUpdate((()=>{for(let e=0;e<this.layouts.length;e+=1)this.layouts[e].execute.apply(this.layouts[e],[t])}))}}const layout_CompositeLayout=CompositeLayout;class EdgeLabelLayout extends layout_GraphLayout{constructor(t,e){super(t)}execute(t){const{view:e}=this.graph,i=(this.graph.getDataModel(),[]),s=[],n=t.getChildCount();for(let l=0;l<n;l+=1){const n=t.getChildAt(l),r=e.getState(n);null!=r&&(this.isVertexIgnored(n)?this.isEdgeIgnored(n)||i.push(r):s.push(r))}this.placeLabels(s,i)}placeLabels(t,e){this.graph.batchUpdate((()=>{for(let i=0;i<e.length;i+=1){const s=e[i];if(null!=s&&null!=s.text&&null!=s.text.boundingBox)for(let e=0;e<t.length;e+=1){const i=t[e];null!=i&&this.avoid(s,i)}}}))}avoid(t,e){const i=this.graph.getDataModel(),s=t.text.boundingBox;if((0,mathUtils.intersects)(s,e)){const n=-s.y-s.height+e.y,l=-s.y+e.y+e.height;let r=Math.abs(n)<Math.abs(l)?n:l;const a=-s.x-s.width+e.x,o=-s.x+e.x+e.width;let h=Math.abs(a)<Math.abs(o)?a:o;Math.abs(h)<Math.abs(r)?r=0:h=0;let d=t.cell.getGeometry();null!=d&&(d=d.clone(),null!=d.offset?(d.offset.x+=h,d.offset.y+=r):d.offset=new Point.A(h,r),i.setGeometry(t.cell,d))}}}const layout_EdgeLabelLayout=EdgeLabelLayout;class MxFastOrganicLayout extends layout_GraphLayout{constructor(t){super(t),this.useInputOrigin=!0,this.resetEdges=!0,this.disableEdgeStyle=!0,this.forceConstant=50,this.forceConstantSquared=0,this.minDistanceLimit=2,this.maxDistanceLimit=500,this.minDistanceLimitSquared=4,this.initialTemp=200,this.temperature=0,this.maxIterations=0,this.iteration=0,this.vertexArray=[],this.dispX=[],this.dispY=[],this.cellLocation=[],this.radius=[],this.radiusSquared=[],this.isMoveable=[],this.neighbours={},this.indices={},this.allowedToRun=!0}isVertexIgnored(t){return super.isVertexIgnored(t)||0===this.graph.getConnections(t).length}execute(t){this.vertexArray=[];let e=this.graph.getChildVertices(t);for(let t=0;t<e.length;t+=1)this.isVertexIgnored(e[t])||this.vertexArray.push(e[t]);const i=this.useInputOrigin?this.graph.getBoundingBoxFromGeometry(this.vertexArray):null,s=this.vertexArray.length;this.indices={},this.dispX=[],this.dispY=[],this.cellLocation=[],this.isMoveable=[],this.neighbours={},this.radius=[],this.radiusSquared=[],this.forceConstant<.001&&(this.forceConstant=.001),this.forceConstantSquared=this.forceConstant*this.forceConstant;for(let t=0;t<this.vertexArray.length;t+=1){const e=this.vertexArray[t];this.cellLocation[t]=[];const i=ObjectIdentity.A.get(e);this.indices[i]=t;const s=this.getVertexBounds(e),{width:n}=s,{height:l}=s,{x:r}=s,{y:a}=s;this.cellLocation[t][0]=r+n/2,this.cellLocation[t][1]=a+l/2,this.radius[t]=Math.min(n,l),this.radiusSquared[t]=this.radius[t]*this.radius[t]}this.graph.batchUpdate((()=>{for(let i=0;i<s;i+=1){this.dispX[i]=0,this.dispY[i]=0,this.isMoveable[i]=this.isVertexMovable(this.vertexArray[i]);const s=this.graph.getConnections(this.vertexArray[i],t);e=this.graph.getOpposites(s,this.vertexArray[i]),this.neighbours[i]=[];for(let t=0;t<e.length;t+=1){this.resetEdges&&this.graph.resetEdge(s[t]),this.disableEdgeStyle&&this.setEdgeStyleEnabled(s[t],!1);const n=ObjectIdentity.A.get(e[t]),l=this.indices[n];this.neighbours[i][t]=null!=l?l:i}}for(this.temperature=this.initialTemp,0===this.maxIterations&&(this.maxIterations=20*Math.sqrt(s)),this.iteration=0;this.iteration<this.maxIterations;this.iteration+=1){if(!this.allowedToRun)return;this.calcRepulsion(),this.calcAttraction(),this.calcPositions(),this.reduceTemperature()}let n=null,l=null;for(let t=0;t<this.vertexArray.length;t+=1){const e=this.vertexArray[t];if(this.isVertexMovable(e)){const i=this.getVertexBounds(e);if(null!=i){this.cellLocation[t][0]-=i.width/2,this.cellLocation[t][1]-=i.height/2;const s=this.graph.snap(Math.round(this.cellLocation[t][0])),r=this.graph.snap(Math.round(this.cellLocation[t][1]));this.setVertexLocation(e,s,r),n=null==n?s:Math.min(n,s),l=null==l?r:Math.min(l,r)}}}let r=1-(n||0),a=1-(l||0);null!=i&&(r+=i.x,a+=i.y),this.graph.moveCells(this.vertexArray,r,a)}))}calcPositions(){for(let t=0;t<this.vertexArray.length;t+=1)if(this.isMoveable[t]){let e=Math.sqrt(this.dispX[t]*this.dispX[t]+this.dispY[t]*this.dispY[t]);e<.001&&(e=.001);const i=this.dispX[t]/e*Math.min(e,this.temperature),s=this.dispY[t]/e*Math.min(e,this.temperature);this.dispX[t]=0,this.dispY[t]=0,this.cellLocation[t][0]+=i,this.cellLocation[t][1]+=s}}calcAttraction(){for(let t=0;t<this.vertexArray.length;t+=1)for(let e=0;e<this.neighbours[t].length;e+=1){const i=this.neighbours[t][e];if(t!==i&&this.isMoveable[t]&&this.isMoveable[i]){const e=this.cellLocation[t][0]-this.cellLocation[i][0],s=this.cellLocation[t][1]-this.cellLocation[i][1];let n=e*e+s*s-this.radiusSquared[t]-this.radiusSquared[i];n<this.minDistanceLimitSquared&&(n=this.minDistanceLimitSquared);const l=Math.sqrt(n),r=n/this.forceConstant,a=e/l*r,o=s/l*r;this.dispX[t]-=a,this.dispY[t]-=o,this.dispX[i]+=a,this.dispY[i]+=o}}}calcRepulsion(){const t=this.vertexArray.length;for(let e=0;e<t;e+=1)for(let i=e;i<t;i+=1){if(!this.allowedToRun)return;if(i!==e&&this.isMoveable[e]&&this.isMoveable[i]){let t=this.cellLocation[e][0]-this.cellLocation[i][0],s=this.cellLocation[e][1]-this.cellLocation[i][1];0===t&&(t=.01+Math.random()),0===s&&(s=.01+Math.random());const n=Math.sqrt(t*t+s*s);let l=n-this.radius[e]-this.radius[i];if(l>this.maxDistanceLimit)continue;l<this.minDistanceLimit&&(l=this.minDistanceLimit);const r=this.forceConstantSquared/l,a=t/n*r,o=s/n*r;this.dispX[e]+=a,this.dispY[e]+=o,this.dispX[i]-=a,this.dispY[i]-=o}}}reduceTemperature(){this.temperature=this.initialTemp*(1-this.iteration/this.maxIterations)}}const FastOrganicLayout=MxFastOrganicLayout;class ParallelEdgeLayout extends layout_GraphLayout{constructor(t){super(t),this.spacing=20,this.checkOverlap=!1}execute(t,e=null){const i=this.findParallels(t,e);this.graph.batchUpdate((()=>{for(const t in i){const e=i[t];e.length>1&&this.layout(e)}}))}findParallels(t,e=null){const i=[],s=t=>{if(!this.isEdgeIgnored(t)){const e=this.getEdgeId(t);null!=e&&(null==i[e]&&(i[e]=[]),i[e].push(t))}};if(null!=e)for(let t=0;t<e.length;t+=1)s(e[t]);else{this.graph.getDataModel();const e=t.getChildCount();for(let i=0;i<e;i+=1)s(t.getChildAt(i))}return i}getEdgeId(t){const e=this.graph.getView();let i=e.getVisibleTerminal(t,!0),s=e.getVisibleTerminal(t,!1),n="";if(null!=i&&null!=s){if(i=ObjectIdentity.A.get(i),s=ObjectIdentity.A.get(s),this.checkOverlap){const e=this.graph.view.getState(t);if(null!=e&&null!=e.absolutePoints){const t=[];for(let i=0;i<e.absolutePoints.length;i+=1){const s=e.absolutePoints[i];null!=s&&t.push(s.x,s.y)}n=t.join(",")}}return(i>s?`${s}-${i}`:`${i}-${s}`)+n}return null}layout(t){const e=t[0],i=this.graph.getView(),s=(this.graph.getDataModel(),i.getVisibleTerminal(e,!0).getGeometry()),n=i.getVisibleTerminal(e,!1).getGeometry();let l,r;if(s===n){l=s.x+s.width+this.spacing,r=s.y+s.height/2;for(let e=0;e<t.length;e+=1)this.route(t[e],l,r),l+=this.spacing}else if(null!=s&&null!=n){const e=s.x+s.width/2,i=s.y+s.height/2,a=n.x+n.width/2-e,o=n.y+n.height/2-i,h=Math.sqrt(a*a+o*o);if(h>0){l=e+a/2,r=i+o/2;const s=o*this.spacing/h,n=a*this.spacing/h;l+=s*(t.length-1)/2,r-=n*(t.length-1)/2;for(let e=0;e<t.length;e+=1)this.route(t[e],l,r),l-=s,r+=n}}}route(t,e,i){this.graph.isCellMovable(t)&&this.setEdgePoints(t,[new Point.A(e,i)])}}const layout_ParallelEdgeLayout=ParallelEdgeLayout;class PartitionLayout extends layout_GraphLayout{constructor(t,e=!0,i=0,s=0){super(t),this.resizeVertices=!0,this.horizontal=null==e||e,this.spacing=i||0,this.border=s||0}isHorizontal(){return this.horizontal}moveCell(t,e,i){const s=this.graph.getDataModel(),n=t.getParent();if(null!=t&&null!=n){let i=0,l=0;const r=n.getChildCount();for(i=0;i<r;i+=1){const t=n.getChildAt(i),s=this.getVertexBounds(t);if(null!=s){const t=s.x+s.width/2;if(l<e&&t>e)break;l=t}}let a=n.getIndex(t);a=Math.max(0,i-(i>a?1:0)),s.add(n,t,a)}}execute(t){const e=this.isHorizontal(),i=this.graph.getDataModel();let s=t.getGeometry();if(null!=this.graph.container&&(null==s&&i.isLayer(t)||t===this.graph.getView().currentRoot)){const t=this.graph.container.offsetWidth-1,e=this.graph.container.offsetHeight-1;s=new Rectangle.A(0,0,t,e)}if(null!=s){const n=[],l=t.getChildCount();for(let e=0;e<l;e+=1){const i=t.getChildAt(e);!this.isVertexIgnored(i)&&this.isVertexMovable(i)&&n.push(i)}const r=n.length;if(r>0){let l=this.border,a=this.border,o=e?s.height:s.width;o-=2*this.border;const h=this.graph.isSwimlane(t)?this.graph.getStartSize(t):new Rectangle.A;o-=e?h.height:h.width,l+=h.width,a+=h.height;const d=this.border+(r-1)*this.spacing,c=e?(s.width-l-d)/r:(s.height-a-d)/r;if(c>0){i.beginUpdate();try{for(let t=0;t<r;t+=1){const s=n[t];let r=s.getGeometry();null!=r&&(r=r.clone(),r.x=l,r.y=a,e?(this.resizeVertices&&(r.width=c,r.height=o),l+=c+this.spacing):(this.resizeVertices&&(r.height=c,r.width=o),a+=c+this.spacing),i.setGeometry(s,r))}}finally{i.endUpdate()}}}}}}const layout_PartitionLayout=PartitionLayout;class RadialTreeLayout extends CompactTreeLayout{constructor(t){super(t,!1),this.centerX=null,this.centerY=null,this.angleOffset=.5,this.rootx=0,this.rooty=0,this.levelDistance=120,this.nodeDistance=10,this.autoRadius=!1,this.sortEdges=!1,this.rowMinX={},this.rowMaxX={},this.rowMinCenX={},this.rowMaxCenX={},this.rowRadi={},this.row=[]}isVertexIgnored(t){return super.isVertexIgnored(t)||0===this.graph.getConnections(t).length}execute(t,e=null){this.parent=t,this.useBoundingBox=!1,this.edgeRouting=!1,super.execute(t,e||void 0);let i=null;const s=this.getVertexBounds(this.root);this.centerX=s.x+s.width/2,this.centerY=s.y+s.height/2;for(const t in this.visited){const e=this.getVertexBounds(this.visited[t]);i=null!=i?i:e.clone(),i.add(e)}this.calcRowDims([this.node],0);let n=0,l=0;for(let t=0;t<this.row.length;t+=1){const e=(this.centerX-this.rowMinX[t]-this.nodeDistance)/this.rowRadi[t],i=(this.rowMaxX[t]-this.centerX-this.nodeDistance)/this.rowRadi[t];n=Math.max(n,e),l=Math.max(l,i)}for(let t=0;t<this.row.length;t+=1){const e=this.centerX-this.nodeDistance-n*this.rowRadi[t],i=this.centerX+this.nodeDistance+l*this.rowRadi[t]-e;for(let s=0;s<this.row[t].length;s++){const n=this.row[t][s],l=this.getVertexBounds(n.cell),r=(l.x+l.width/2-e)/i,a=2*Math.PI*r;n.theta=a}}for(let t=this.row.length-2;t>=0;t--){const e=this.row[t];for(let t=0;t<e.length;t++){const i=e[t];let{child:s}=i,n=0,l=0;for(;null!=s;)l+=s.theta,n++,s=s.next;if(n>0){const s=l/n;if(s>i.theta&&t<e.length-1){const n=e[t+1].theta;i.theta=Math.min(s,n-Math.PI/10)}else if(s<i.theta&&t>0){const n=e[t-1].theta;i.theta=Math.max(s,n+Math.PI/10)}}}}for(let t=0;t<this.row.length;t+=1)for(let e=0;e<this.row[t].length;e++){const i=this.row[t][e],s=this.getVertexBounds(i.cell);this.setVertexLocation(i.cell,this.centerX-s.width/2+this.rowRadi[t]*Math.cos(i.theta),this.centerY-s.height/2+this.rowRadi[t]*Math.sin(i.theta))}}calcRowDims(t,e){if(null==t||0===t.length)return;this.rowMinX[e]=this.centerX,this.rowMaxX[e]=this.centerX,this.rowMinCenX[e]=this.centerX,this.rowMaxCenX[e]=this.centerX,this.row[e]=[];let i=!1;for(let s=0;s<t.length;s+=1){let n=null!=t[s]?t[s].child:null;for(;null!=n;){const{cell:t}=n,s=this.getVertexBounds(t);this.rowMinX[e]=Math.min(s.x,this.rowMinX[e]),this.rowMaxX[e]=Math.max(s.x+s.width,this.rowMaxX[e]),this.rowMinCenX[e]=Math.min(s.x+s.width/2,this.rowMinCenX[e]),this.rowMaxCenX[e]=Math.max(s.x+s.width/2,this.rowMaxCenX[e]),this.rowRadi[e]=s.y-this.getVertexBounds(this.root).y,null!=n.child&&(i=!0),this.row[e].push(n),n=n.next}}i&&this.calcRowDims(this.row[e],e+1)}}const layout_RadialTreeLayout=RadialTreeLayout,HierarchicalEdgeStyle={ORTHOGONAL:1,POLYLINE:2,STRAIGHT:3,CURVE:4},datatypes_HierarchicalEdgeStyle=HierarchicalEdgeStyle;class GraphAbstractHierarchyCell extends Cell.A{constructor(){super(),this.swimlaneIndex=null,this.maxRank=-1,this.minRank=-1,this.width=0,this.height=0,this.nextLayerConnectedCells=null,this.previousLayerConnectedCells=null,this.x=[],this.y=[],this.temp=[]}isEdge(){return!1}isVertex(){return!1}setX(t,e){this.isVertex()?this.x[0]=e:this.isEdge()&&(this.x[t-this.minRank-1]=e)}getX(t){return this.isVertex()?this.x[0]:this.isEdge()?this.x[t-this.minRank-1]:0}setY(t,e){this.isVertex()?this.y[0]=e:this.isEdge()&&(this.y[t-this.minRank-1]=e)}}const datatypes_GraphAbstractHierarchyCell=GraphAbstractHierarchyCell;class GraphHierarchyNode extends datatypes_GraphAbstractHierarchyCell{constructor(t){super(),this.ids=[],this.hashCode=!1,this.cell=t,this.id=ObjectIdentity.A.get(t),this.connectsAsTarget=[],this.connectsAsSource=[]}getRankValue(t){return this.maxRank}getNextLayerConnectedCells(t){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells={},this.nextLayerConnectedCells[0]=[];for(let e=0;e<this.connectsAsTarget.length;e+=1){const i=this.connectsAsTarget[e];-1===i.maxRank||i.maxRank===t+1?this.nextLayerConnectedCells[0].push(i.source):this.nextLayerConnectedCells[0].push(i)}}return this.nextLayerConnectedCells[0]}getPreviousLayerConnectedCells(t){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[],this.previousLayerConnectedCells[0]=[];for(let e=0;e<this.connectsAsSource.length;e+=1){const i=this.connectsAsSource[e];-1===i.minRank||i.minRank===t-1?this.previousLayerConnectedCells[0].push(i.target):this.previousLayerConnectedCells[0].push(i)}}return this.previousLayerConnectedCells[0]}isVertex(){return!0}getGeneralPurposeVariable(t){return this.temp[0]}setGeneralPurposeVariable(t,e){this.temp[0]=e}isAncestor(t){if(null!=t&&null!=this.hashCode&&null!=t.hashCode&&this.hashCode.length<t.hashCode.length){if(this.hashCode===t.hashCode)return!0;if(null==this.hashCode||null==this.hashCode)return!1;for(let e=0;e<this.hashCode.length;e+=1)if(this.hashCode[e]!==t.hashCode[e])return!1;return!0}return!1}getCoreCell(){return this.cell}}const datatypes_GraphHierarchyNode=GraphHierarchyNode;class GraphHierarchyEdge extends datatypes_GraphAbstractHierarchyCell{constructor(t){super(),this.source=null,this.target=null,this.isReversed=!1,this.edges=t,this.ids=[];for(let e=0;e<t.length;e+=1)this.ids.push(ObjectIdentity.A.get(t[e]))}invert(){const t=this.source;this.source=this.target,this.target=t,this.isReversed=!this.isReversed}getNextLayerConnectedCells(t){if(null==this.nextLayerConnectedCells){this.nextLayerConnectedCells=[];for(let t=0;t<this.temp.length;t+=1)this.nextLayerConnectedCells[t]=[],t===this.temp.length-1?this.nextLayerConnectedCells[t].push(this.source):this.nextLayerConnectedCells[t].push(this)}return this.nextLayerConnectedCells[t-this.minRank-1]}getPreviousLayerConnectedCells(t){if(null==this.previousLayerConnectedCells){this.previousLayerConnectedCells=[];for(let t=0;t<this.temp.length;t+=1)this.previousLayerConnectedCells[t]=[],0===t?this.previousLayerConnectedCells[t].push(this.target):this.previousLayerConnectedCells[t].push(this)}return this.previousLayerConnectedCells[t-this.minRank-1]}isEdge(){return!0}getGeneralPurposeVariable(t){return this.temp[t-this.minRank-1]}setGeneralPurposeVariable(t,e){this.temp[t-this.minRank-1]=e}getCoreCell(){return this.edges.length>0?this.edges[0]:null}}const datatypes_GraphHierarchyEdge=GraphHierarchyEdge;class GraphHierarchyModel{constructor(t,e,i,s,n){this.ranks=null,this.roots=null,this.parent=null,this.dfsCount=0,this.SOURCESCANSTARTRANK=1e8,this.tightenToSource=!1;const l=t.getGraph();this.tightenToSource=n,this.roots=i,this.parent=s,this.vertexMapper=new util_Dictionary.A,this.edgeMapper=new util_Dictionary.A,this.maxRank=0;const r={};null==e&&(e=l.getChildVertices(s)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(t,e,r);for(let i=0;i<e.length;i+=1){const e=r[i].connectsAsSource;for(let s=0;s<e.length;s++){const n=e[s],l=n.edges;if(null!=l&&l.length>0){const e=l[0];let s=t.getVisibleTerminal(e,!1),a=this.vertexMapper.get(s);r[i]===a&&(s=t.getVisibleTerminal(e,!0),a=this.vertexMapper.get(s)),null!=a&&r[i]!==a&&(n.target=a,0===a.connectsAsTarget.length&&(a.connectsAsTarget=[]),a.connectsAsTarget.indexOf(n)<0&&a.connectsAsTarget.push(n))}}r[i].temp[0]=1}}createInternalCells(t,e,i){const s=t.getGraph();for(let n=0;n<e.length;n+=1){i[n]=new datatypes_GraphHierarchyNode(e[n]),this.vertexMapper.put(e[n],i[n]);const l=t.getEdges(e[n]);i[n].connectsAsSource=[];for(let r=0;r<l.length;r++){const a=t.getVisibleTerminal(l[r],!1);if(a!==e[n]&&a.isVertex()&&!t.isVertexIgnored(a)){const l=t.getEdgesBetween(e[n],a,!1),r=t.getEdgesBetween(e[n],a,!0);if(null!=l&&l.length>0&&null==this.edgeMapper.get(l[0])&&2*r.length>=l.length){const e=new datatypes_GraphHierarchyEdge(l);for(let i=0;i<l.length;i++){const n=l[i];this.edgeMapper.put(n,e),s.resetEdge(n),t.disableEdgeStyle&&(t.setEdgeStyleEnabled(n,!1),t.setOrthogonalEdge(n,!0))}e.source=i[n],i[n].connectsAsSource.indexOf(e)<0&&i[n].connectsAsSource.push(e)}}}i[n].temp[0]=0}}initialRank(){const t=[];if(null!=this.roots)for(let e=0;e<this.roots.length;e+=1){const i=this.vertexMapper.get(this.roots[e]);null!=i&&t.push(i)}const e=this.vertexMapper.getValues();for(let t=0;t<e.length;t+=1)e[t].temp[0]=-1;const i=t.slice();for(;t.length>0;){const e=t[0],i=e.connectsAsTarget,s=e.connectsAsSource;let n=!0,l=this.SOURCESCANSTARTRANK;for(let t=0;t<i.length;t+=1){const e=i[t];if(5270620!==e.temp[0]){n=!1;break}{const t=e.source;l=Math.min(l,t.temp[0]-1)}}if(n){if(e.temp[0]=l,this.maxRank=Math.min(this.maxRank,l),null!=s)for(let e=0;e<s.length;e+=1){const i=s[e];i.temp[0]=5270620;const n=i.target;-1===n.temp[0]&&(t.push(n),n.temp[0]=-2)}t.shift()}else{const i=t.shift();if(t.push(e),i===e&&1===t.length)break}}for(let t=0;t<e.length;t+=1)e[t].temp[0]-=this.maxRank;for(let t=0;t<i.length;t+=1){const e=i[t];let s=0;const n=e.connectsAsSource;for(let t=0;t<n.length;t++){const i=n[t].target;e.temp[0]=Math.max(s,i.temp[0]+1),s=e.temp[0]}}this.maxRank=this.SOURCESCANSTARTRANK-this.maxRank}fixRanks(){const t={};this.ranks=[];for(let e=0;e<this.maxRank+1;e+=1)t[e]=[],this.ranks.push(t[e]);let e=null;if(null!=this.roots){const t=this.roots;e=[];for(let i=0;i<t.length;i+=1){const s=t[i],n=this.vertexMapper.get(s);e[i]=n}}this.visit(((e,i,s,n,l)=>{if(0==l&&i.maxRank<0&&i.minRank<0&&(t[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=t[i.maxRank].length-1),null!=e&&null!=s&&e.maxRank-i.maxRank>1){s.maxRank=e.maxRank,s.minRank=i.maxRank,s.temp=[],s.x=[],s.y=[];for(let e=s.minRank+1;e<s.maxRank;e+=1)t[e].push(s),s.setGeneralPurposeVariable(e,t[e].length-1)}}),e,!1,null)}visit(t,e,i,s=null){if(null!=e){for(let n=0;n<e.length;n+=1){const l=e[n];null!=l&&(null==s&&(s={}),i?(l.hashCode=[],l.hashCode[0]=this.dfsCount,l.hashCode[1]=n,this.extendedDfs(null,l,null,t,s,l.hashCode,n,0)):this.dfs(null,l,null,t,s,0))}this.dfsCount++}}dfs(t,e,i,s,n,l){if(null!=e){const r=e.id;if(null==n[r]){n[r]=e,s(t,e,i,l,0);const a=e.connectsAsSource.slice();for(let t=0;t<a.length;t+=1){const i=a[t],r=i.target;this.dfs(e,r,i,s,n,l+1)}}else s(t,e,i,l,1)}}extendedDfs(t,e,i,s,n,l,r,a){if(null!=e){if(null!=t&&(null==e.hashCode||e.hashCode[0]!=t.hashCode[0])){const i=t.hashCode.length+1;e.hashCode=t.hashCode.slice(),e.hashCode[i-1]=r}const l=e.id;if(null==n[l]){n[l]=e,s(t,e,i,a,0);const r=e.connectsAsSource.slice();for(let t=0;t<r.length;t+=1){const i=r[t],l=i.target;this.extendedDfs(e,l,i,s,n,e.hashCode,t,a+1)}}else s(t,e,i,a,1)}}}const hierarchical_GraphHierarchyModel=GraphHierarchyModel;class HierarchicalLayoutStage{}const hierarchical_HierarchicalLayoutStage=HierarchicalLayoutStage;class MinimumCycleRemover extends hierarchical_HierarchicalLayoutStage{constructor(t){super(),this.layout=t}execute(t){const e=this.layout.getDataModel(),i={},s=e.vertexMapper.getValues(),n={};for(let t=0;t<s.length;t+=1)n[s[t].id]=s[t];let l=null;if(null!=e.roots){const t=e.roots;l=[];for(let i=0;i<t.length;i+=1)l[i]=e.vertexMapper.get(t[i])}e.visit(((t,e,s,l,r)=>{e.isAncestor(t)&&(s.invert(),(0,arrayUtils.TF)(s,t.connectsAsSource),t.connectsAsTarget.push(s),(0,arrayUtils.TF)(s,e.connectsAsTarget),e.connectsAsSource.push(s)),i[e.id]=e,delete n[e.id]}),l,!0,null);const r=(0,cloneUtils.clone)(i,null,!0);e.visit(((t,e,s,l,r)=>{e.isAncestor(t)&&(s.invert(),(0,arrayUtils.TF)(s,t.connectsAsSource),e.connectsAsSource.push(s),t.connectsAsTarget.push(s),(0,arrayUtils.TF)(s,e.connectsAsTarget)),i[e.id]=e,delete n[e.id]}),Object.values(n),!0,r)}}const hierarchical_MinimumCycleRemover=MinimumCycleRemover;class MedianCellSorter{constructor(){this.medianValue=0,this.cell=!1}compare(t,e){return null!=t&&null!=e?e.medianValue>t.medianValue?-1:e.medianValue<t.medianValue?1:0:0}}const util_MedianCellSorter=MedianCellSorter;class MedianHybridCrossingReduction extends hierarchical_HierarchicalLayoutStage{constructor(t){super(),this.maxIterations=24,this.nestedBestRanks=null,this.currentBestCrossings=0,this.iterationsWithoutImprovement=0,this.maxNoImprovementIterations=2,this.layout=t}execute(t){const e=this.layout.getDataModel();let i=e.ranks;this.nestedBestRanks=[];for(let t=0;t<i.length;t+=1)this.nestedBestRanks[t]=i[t].slice();let s=0,n=this.calculateCrossings(e);for(let t=0;t<this.maxIterations&&s<this.maxNoImprovementIterations;t++){this.weightedMedian(t,e),this.transpose(t,e);const l=this.calculateCrossings(e);if(l<n){n=l,s=0;for(let t=0;t<this.nestedBestRanks.length;t+=1){const e=i[t];for(let i=0;i<e.length;i+=1){const s=e[i];this.nestedBestRanks[t][s.getGeneralPurposeVariable(t)]=s}}}else{s+=1;for(let t=0;t<this.nestedBestRanks.length;t+=1){const e=i[t];for(let i=0;i<e.length;i+=1)e[i].setGeneralPurposeVariable(t,i)}}if(0===n)break}i=[];const l=[];for(let t=0;t<e.maxRank+1;t+=1)l[t]=[],i[t]=l[t];for(let t=0;t<this.nestedBestRanks.length;t+=1)for(let e=0;e<this.nestedBestRanks[t].length;e+=1)l[t].push(this.nestedBestRanks[t][e]);e.ranks=i}calculateCrossings(t){const e=t.ranks.length;let i=0;for(let s=1;s<e;s+=1)i+=this.calculateRankCrossing(s,t);return i}calculateRankCrossing(t,e){let i=0;const s=e.ranks,n=s[t],l=s[t-1],r=[];for(let e=0;e<n.length;e+=1){const i=n[e],s=i.getGeneralPurposeVariable(t),l=i.getPreviousLayerConnectedCells(t),a=[];for(let e=0;e<l.length;e+=1){const i=l[e].getGeneralPurposeVariable(t-1);a.push(i)}a.sort(((t,e)=>t-e)),r[s]=a}let a=[];for(let t=0;t<r.length;t++)a=a.concat(r[t]);let o=1;for(;o<l.length;)o<<=1;const h=2*o-1;o-=1;const d=[];for(let t=0;t<h;++t)d[t]=0;for(let t=0;t<a.length;t+=1){let e=a[t]+o;for(++d[e];e>0;)e%2&&(i+=d[e+1]),e=e-1>>1,++d[e]}return i}transpose(t,e){let i=!0,s=0;for(;i&&s++<10;){const n=t%2==1&&s%2==1;i=!1;const l=e.ranks;for(let t=0;t<l.length;t+=1){const e=l[t],s=[];for(let i=0;i<e.length;i++){const n=e[i];let l=n.getGeneralPurposeVariable(t);l<0&&(l=i),s[l]=n}let r=null,a=null,o=null,h=null,d=null,c=null,u=null,g=null,p=null,E=null;for(let l=0;l<e.length-1;l++){if(0===l){p=s[l],r=p.getNextLayerConnectedCells(t),a=p.getPreviousLayerConnectedCells(t),d=[],c=[];for(let e=0;e<r.length;e++)d[e]=r[e].getGeneralPurposeVariable(t+1);for(let e=0;e<a.length;e++)c[e]=a[e].getGeneralPurposeVariable(t-1)}else r=o,a=h,d=u,c=g,p=E;E=s[l+1],o=E.getNextLayerConnectedCells(t),h=E.getPreviousLayerConnectedCells(t),u=[],g=[];for(let e=0;e<o.length;e++)u[e]=o[e].getGeneralPurposeVariable(t+1);for(let e=0;e<h.length;e++)g[e]=h[e].getGeneralPurposeVariable(t-1);let e=0,C=0;for(let t=0;t<d.length;t+=1)for(let i=0;i<u.length;i+=1)d[t]>u[i]&&(e+=1),d[t]<u[i]&&(C+=1);for(let t=0;t<c.length;t+=1)for(let i=0;i<g.length;i+=1)c[t]>g[i]&&(e+=1),c[t]<g[i]&&(C+=1);if(C<e||C===e&&n){const e=p.getGeneralPurposeVariable(t);p.setGeneralPurposeVariable(t,E.getGeneralPurposeVariable(t)),E.setGeneralPurposeVariable(t,e),o=r,h=a,u=d,g=c,E=p,n||(i=!0)}}}}}weightedMedian(t,e){const i=t%2==0;if(i)for(let t=e.maxRank-1;t>=0;t-=1)this.medianRank(t,i);else for(let t=1;t<e.maxRank;t+=1)this.medianRank(t,i)}medianRank(t,e){const i=this.nestedBestRanks,s=i[t].length,n=[],l={};for(let r=0;r<s;r+=1){const s=i[t][r],a=new util_MedianCellSorter;a.cell=s;const o=e?s.getNextLayerConnectedCells(t):s.getPreviousLayerConnectedCells(t),h=e?t+1:t-1;null!=o&&0!==o.length?(a.medianValue=this.medianValue(o,h),n.push(a)):l[s.getGeneralPurposeVariable(t)]=!0}n.sort((new util_MedianCellSorter).compare);for(let e=0;e<s;e+=1)null==l[e]&&n.shift().cell.setGeneralPurposeVariable(t,e)}medianValue(t,e){const i=[];let s=0;for(let n=0;n<t.length;n+=1){const l=t[n];i[s++]=l.getGeneralPurposeVariable(e)}if(i.sort(((t,e)=>t-e)),s%2==1)return i[Math.floor(s/2)];if(2===s)return(i[0]+i[1])/2;const n=s/2,l=i[n-1]-i[0],r=i[s-1]-i[n];return(i[n-1]*r+i[n]*l)/(l+r)}}const hierarchical_MedianHybridCrossingReduction=MedianHybridCrossingReduction;class CoordinateAssignment extends hierarchical_HierarchicalLayoutStage{constructor(t,e=30,i=100,s,n,l=10){super(),this.intraCellSpacing=30,this.interRankCellSpacing=100,this.parallelEdgeSpacing=10,this.maxIterations=8,this.prefHozEdgeSep=5,this.prefVertEdgeOff=2,this.minEdgeJetty=12,this.channelBuffer=4,this.jettyPositions=null,this.orientation=Constants.DIRECTION.NORTH,this.limitX=null,this.currentXDelta=null,this.widestRank=null,this.rankTopY=null,this.rankBottomY=null,this.widestRankValue=null,this.rankWidths=null,this.rankY=null,this.fineTuning=!0,this.nextLayerConnectedCache=null,this.previousLayerConnectedCache=null,this.groupPadding=10,this.layout=t,this.intraCellSpacing=e,this.interRankCellSpacing=i,this.orientation=s,this.initialX=n,this.parallelEdgeSpacing=l}printStatus(){const t=this.layout.getDataModel().ranks,e=config.eo.logger;e.show(),e.info("======Coord assignment debug=======");for(let i=0;i<t.length;i++){const s=t[i].map((t=>String(t.getGeneralPurposeVariable(i)))).join("  ");e.info(`Rank ${i} : ${s}`)}e.info("====================================")}execute(t){this.jettyPositions=Object();const e=this.layout.getDataModel();this.currentXDelta=0,this.initialCoords(this.layout.getGraph(),e),this.fineTuning&&this.minNode(e);let i=1e8;if(this.fineTuning)for(let t=0;t<this.maxIterations;t+=1){0!==t&&(this.medianPos(t,e),this.minNode(e));const s=e.ranks;if(this.currentXDelta<i){for(let t=0;t<s.length;t++){const e=s[t];for(let i=0;i<e.length;i++){const s=e[i];s.setX(t,s.getGeneralPurposeVariable(t))}}i=this.currentXDelta}else for(let t=0;t<s.length;t++){const e=s[t];for(let i=0;i<e.length;i++){const s=e[i];s.setGeneralPurposeVariable(t,s.getX(t))}}this.minPath(this.layout.getGraph(),e),this.currentXDelta=0}this.setCellLocations(this.layout.getGraph(),e)}minNode(t){const e=[],i=new util_Dictionary.A,s=[];for(let n=0;n<=t.maxRank;n+=1){s[n]=t.ranks[n];for(let t=0;t<s[n].length;t+=1){const l=s[n][t],r=new util_WeightedCellSorter(l,n);r.rankIndex=t,r.visited=!0,e.push(r),i.put(l,r)}}const n=10*e.length;let l=0;for(;e.length>0&&l<=n;){const t=e.shift(),n=t.cell,r=t.weightedValue,a=parseInt(String(t.rankIndex)),o=n.getNextLayerConnectedCells(r),h=n.getPreviousLayerConnectedCells(r),d=o.length,c=h.length,u=this.medianXValue(o,r+1),g=this.medianXValue(h,r-1),p=d+c,E=n.getGeneralPurposeVariable(r);let C=E;p>0&&(C=(u*d+g*c)/p);let m=!1;if(C<E-1)if(0===a)n.setGeneralPurposeVariable(r,C),m=!0;else{const t=s[r][a-1];let e=t.getGeneralPurposeVariable(r);e=e+t.width/2+this.intraCellSpacing+n.width/2,e<C?(n.setGeneralPurposeVariable(r,C),m=!0):e<n.getGeneralPurposeVariable(r)-1&&(n.setGeneralPurposeVariable(r,e),m=!0)}else if(C>E+1)if(a===s[r].length-1)n.setGeneralPurposeVariable(r,C),m=!0;else{const t=s[r][a+1];let e=t.getGeneralPurposeVariable(r);e=e-t.width/2-this.intraCellSpacing-n.width/2,e>C?(n.setGeneralPurposeVariable(r,C),m=!0):e>n.getGeneralPurposeVariable(r)+1&&(n.setGeneralPurposeVariable(r,e),m=!0)}if(m){for(let t=0;t<o.length;t+=1){const s=o[t],n=i.get(s);null!=n&&0==n.visited&&(n.visited=!0,e.push(n))}for(let t=0;t<h.length;t+=1){const s=h[t],n=i.get(s);null!=n&&0==n.visited&&(n.visited=!0,e.push(n))}}t.visited=!1,l+=1}}medianPos(t,e){if(t%2==0)for(let t=e.maxRank;t>0;t--)this.rankMedianPosition(t-1,e,t);else for(let t=0;t<e.maxRank-1;t++)this.rankMedianPosition(t+1,e,t)}rankMedianPosition(t,e,i){const s=e.ranks[t],n=[],l={};for(let e=0;e<s.length;e+=1){const r=s[e];n[e]=new util_WeightedCellSorter(r),n[e].rankIndex=e,l[r.id]=n[e];let a=null;a=i<t?r.getPreviousLayerConnectedCells(t):r.getNextLayerConnectedCells(t),n[e].weightedValue=this.calculatedWeightedValue(r,a)}n.sort(util_WeightedCellSorter.compare);for(let e=0;e<n.length;e+=1){let r=0;const a=n[e].cell;let o=null,h=0;o=i<t?a.getPreviousLayerConnectedCells(t).slice():a.getNextLayerConnectedCells(t).slice(),null!=o&&(r=o.length,h=r>0?this.medianXValue(o,i):a.getGeneralPurposeVariable(t));let d=0,c=-1e8;for(let i=n[e].rankIndex-1;i>=0;){const e=l[s[i].id];if(null!=e){const s=e.cell;e.visited?(c=s.getGeneralPurposeVariable(t)+s.width/2+this.intraCellSpacing+d+a.width/2,i=-1):(d+=s.width+this.intraCellSpacing,i--)}}let u=0,g=1e8;for(let i=n[e].rankIndex+1;i<n.length;){const e=l[s[i].id];if(null!=e){const s=e.cell;e.visited?(g=s.getGeneralPurposeVariable(t)-s.width/2-this.intraCellSpacing-u-a.width/2,i=n.length):(u+=s.width+this.intraCellSpacing,i++)}}h>=c&&h<=g?a.setGeneralPurposeVariable(t,h):h<c?(a.setGeneralPurposeVariable(t,c),this.currentXDelta=this.currentXDelta+c-h):h>g&&(a.setGeneralPurposeVariable(t,g),this.currentXDelta=this.currentXDelta+h-g),n[e].visited=!0}}calculatedWeightedValue(t,e){let i=0;for(let s=0;s<e.length;s+=1){const n=e[s];t.isVertex()&&n.isVertex()?i+=1:t.isEdge()&&n.isEdge()?i+=8:i+=2}return i}medianXValue(t,e){if(0===t.length)return 0;const i=[];for(let s=0;s<t.length;s+=1)i[s]=t[s].getGeneralPurposeVariable(e);if(i.sort(((t,e)=>t-e)),t.length%2==1)return i[Math.floor(t.length/2)];const s=t.length/2;return(i[s-1]+i[s])/2}initialCoords(t,e){this.calculateWidestRank(t,e);for(let i=this.widestRank;i>=0;i--)i<e.maxRank&&this.rankCoordinates(i,t,e);for(let i=this.widestRank+1;i<=e.maxRank;i+=1)i>0&&this.rankCoordinates(i,t,e)}rankCoordinates(t,e,i){const s=i.ranks[t];let n=0,l=this.initialX+(this.widestRankValue-this.rankWidths[t])/2,r=!1;for(let e=0;e<s.length;e+=1){const i=s[e];if(i.isVertex()){const t=this.layout.getVertexBounds(i.cell);null!=t?this.orientation===Constants.DIRECTION.NORTH||this.orientation===Constants.DIRECTION.SOUTH?(i.width=t.width,i.height=t.height):(i.width=t.height,i.height=t.width):r=!0,n=Math.max(n,i.height)}else if(i.isEdge()){let t=1;null!=i.edges?t=i.edges.length:config.eo.logger.warn("edge.edges is null"),i.width=(t-1)*this.parallelEdgeSpacing}l+=i.width/2,i.setX(t,l),i.setGeneralPurposeVariable(t,l),l+=i.width/2,l+=this.intraCellSpacing}r&&config.eo.logger.warn("At least one cell has no bounds")}calculateWidestRank(t,e){let i=-this.interRankCellSpacing,s=0;this.rankWidths=[],this.rankY=[];for(let t=e.maxRank;t>=0;t-=1){let n=0;const l=e.ranks[t];let r=this.initialX,a=!1;for(let e=0;e<l.length;e+=1){const i=l[e];if(i.isVertex()){const t=this.layout.getVertexBounds(i.cell);null!=t?this.orientation===Constants.DIRECTION.NORTH||this.orientation===Constants.DIRECTION.SOUTH?(i.width=t.width,i.height=t.height):(i.width=t.height,i.height=t.width):a=!0,n=Math.max(n,i.height)}else if(i.isEdge()){let t=1;null!=i.edges?t=i.edges.length:config.eo.logger.warn("edge.edges is null"),i.width=(t-1)*this.parallelEdgeSpacing}r+=i.width/2,i.setX(t,r),i.setGeneralPurposeVariable(t,r),r+=i.width/2,r+=this.intraCellSpacing,r>this.widestRankValue&&(this.widestRankValue=r,this.widestRank=t),this.rankWidths[t]=r}a&&config.eo.logger.warn("At least one cell has no bounds"),this.rankY[t]=i;const o=n/2+s/2+this.interRankCellSpacing;s=n,this.orientation===Constants.DIRECTION.NORTH||this.orientation===Constants.DIRECTION.WEST?i+=o:i-=o;for(let e=0;e<l.length;e+=1)l[e].setY(t,i)}}minPath(t,e){const i=e.edgeMapper.getValues();for(let t=0;t<i.length;t++){const s=i[t];if(s.maxRank-s.minRank-1<1)continue;let n=s.getGeneralPurposeVariable(s.minRank+1),l=!0,r=0;for(let t=s.minRank+2;t<s.maxRank;t+=1){const e=s.getGeneralPurposeVariable(t);n!==e?(l=!1,n=e):r+=1}if(!l){let t=0,i=0;const n=[],l=[];let a=0,o=s.getGeneralPurposeVariable(s.minRank+1);for(a=s.minRank+1;a<s.maxRank-1;a+=1){const i=s.getX(a+1);o===i||this.repositionValid(e,s,a+1,o)?(n[a-s.minRank-1]=o,t+=1):(n[a-s.minRank-1]=i,o=i)}o=s.getX(a);for(let t=s.maxRank-1;t>s.minRank+1;t--){const n=s.getX(t-1);o===n||this.repositionValid(e,s,t-1,o)?(l[t-s.minRank-2]=o,i+=1):(l[t-s.minRank-2]=s.getX(t-1),o=n)}if(i>r||t>r)if(i>=t)for(let t=s.maxRank-2;t>s.minRank;t--)s.setX(t,l[t-s.minRank-1]);else if(t>i)for(let t=s.minRank+2;t<s.maxRank;t+=1)s.setX(t,n[t-s.minRank-2])}}}repositionValid(t,e,i,s){const n=t.ranks[i];let l=-1;for(let t=0;t<n.length;t+=1)if(e===n[t]){l=t;break}if(l<0)return!1;const r=e.getGeneralPurposeVariable(i);if(s<r){if(0===l)return!0;const t=n[l-1];let r=t.getGeneralPurposeVariable(i);return r=r+t.width/2+this.intraCellSpacing+e.width/2,r<=s}if(s>r){if(l===n.length-1)return!0;const t=n[l+1];let r=t.getGeneralPurposeVariable(i);return r=r-t.width/2-this.intraCellSpacing-e.width/2,r>=s}return!0}setCellLocations(t,e){this.rankTopY=[],this.rankBottomY=[];const i=e.ranks;for(let t=0;t<i.length;t+=1)this.rankTopY[t]=Number.MAX_VALUE,this.rankBottomY[t]=-Number.MAX_VALUE;const s=e.vertexMapper.getValues();for(let t=0;t<s.length;t+=1)this.setVertexLocation(s[t]);this.layout.edgeStyle!==datatypes_HierarchicalEdgeStyle.ORTHOGONAL&&this.layout.edgeStyle!==datatypes_HierarchicalEdgeStyle.POLYLINE&&this.layout.edgeStyle!==datatypes_HierarchicalEdgeStyle.CURVE||this.localEdgeProcessing(e);const n=e.edgeMapper.getValues();for(let t=0;t<n.length;t+=1)this.setEdgePosition(n[t])}localEdgeProcessing(t){const e=t.ranks;for(let t=0;t<e.length;t+=1){const i=e[t];for(let s=0;s<i.length;s+=1){const n=i[s];if(n.isVertex()){let i=n.getPreviousLayerConnectedCells(t),s=t-1;for(let l=0;l<2;l+=1){if(s>-1&&s<e.length&&null!=i&&i.length>0){const t=[];for(let e=0;e<i.length;e++){const n=new util_WeightedCellSorter(i[e],i[e].getX(s));t.push(n)}t.sort(util_WeightedCellSorter.compare);let e=n.x[0]-n.width/2,r=e+n.width,a=0,o=0;const h=[];for(let e=0;e<t.length;e++){const i=t[e].cell;let s;if(i.isVertex()){s=0===l?n.connectsAsSource:n.connectsAsTarget;for(let t=0;t<s.length;t+=1)s[t].source!==i&&s[t].target!==i||(a+=s[t].edges.length,o+=1,h.push(s[t]))}else a+=i.edges.length,o+=1,h.push(i)}const d=(a+1)*this.prefHozEdgeSep;n.width>d+2*this.prefHozEdgeSep&&(e+=this.prefHozEdgeSep,r-=this.prefHozEdgeSep);const c=(r-e)/a;let u=e+c/2,g=this.minEdgeJetty-this.prefVertEdgeOff,p=0;for(let t=0;t<h.length;t++){const e=h[t].edges.length,i=this.jettyPositions;let s=i[h[t].ids[0]];null==s&&(s=[],i[h[t].ids[0]]=s),t<a/2?g+=this.prefVertEdgeOff:t>a/2&&(g-=this.prefVertEdgeOff);for(let t=0;t<e;t+=1)s[4*t+2*l]=u,u+=c,s[4*t+2*l+1]=g;p=Math.max(p,g)}}i=n.getNextLayerConnectedCells(t),s=t+1}}}}}setEdgePosition(t){let e=0;if(101207!==t.temp[0]){let{maxRank:i}=t,{minRank:s}=t;i===s&&(i=t.source.maxRank,s=t.target.minRank);let n=0;const l=this.jettyPositions[t.ids[0]],r=t.isReversed?t.target.cell:t.source.cell,{graph:a}=this.layout,o=this.orientation===Constants.DIRECTION.EAST||this.orientation===Constants.DIRECTION.SOUTH;for(let h=0;h<t.edges.length;h+=1){const d=t.edges[h],c=this.layout.getVisibleTerminal(d,!0),u=[];let g=t.isReversed;if(c!==r&&(g=!g),null!=l){const e=g?2:0,r=this.rankBottomY,h=this.rankTopY;let p=g?o?r[s]:h[s]:o?h[i]:r[i],E=l[4*n+1+e];g!==o&&(E=-E),p+=E;let C=l[4*n+e];const m=d.getTerminal(!0);if(this.layout.isPort(m)&&m.getParent()===c){const e=a.view.getState(m);C=null!=e?e.x:c.geometry.x+t.source.width*m.geometry.x}this.orientation===Constants.DIRECTION.NORTH||this.orientation===Constants.DIRECTION.SOUTH?(u.push(new Point.A(C,p)),this.layout.edgeStyle===datatypes_HierarchicalEdgeStyle.CURVE&&u.push(new Point.A(C,p+E))):(u.push(new Point.A(p,C)),this.layout.edgeStyle===datatypes_HierarchicalEdgeStyle.CURVE&&u.push(new Point.A(p+E,C)))}let p=t.x.length-1,E=-1,C=-1,m=t.maxRank-1;g&&(p=0,E=t.x.length,C=1,m=t.minRank+1);for(let i=p;t.maxRank!==t.minRank&&i!==E;i+=C){const s=t.x[i]+e,n=this.rankTopY,l=this.rankBottomY;let r=(n[m]+l[m+1])/2,a=(n[m-1]+l[m])/2;if(g){const t=r;r=a,a=t}this.orientation===Constants.DIRECTION.NORTH||this.orientation===Constants.DIRECTION.SOUTH?(u.push(new Point.A(s,r)),u.push(new Point.A(s,a))):(u.push(new Point.A(r,s)),u.push(new Point.A(a,s))),this.limitX=Math.max(this.limitX,s),m+=C}if(null!=l){const e=g?2:0,r=this.rankTopY,h=this.rankBottomY,c=g?o?r[i]:h[i]:o?h[s]:r[s];let p=l[4*n+3-e];g!==o&&(p=-p);const E=c-p;let C=l[4*n+2-e];const m=d.getTerminal(!1),f=this.layout.getVisibleTerminal(d,!1);if(this.layout.isPort(m)&&m.getParent()===f){const e=a.view.getState(m);C=null!=e?e.x:f.geometry.x+t.target.width*m.geometry.x}this.orientation===Constants.DIRECTION.NORTH||this.orientation===Constants.DIRECTION.SOUTH?(this.layout.edgeStyle===datatypes_HierarchicalEdgeStyle.CURVE&&u.push(new Point.A(C,E-p)),u.push(new Point.A(C,E))):(this.layout.edgeStyle===datatypes_HierarchicalEdgeStyle.CURVE&&u.push(new Point.A(E-p,C)),u.push(new Point.A(E,C)))}t.isReversed&&this.processReversedEdge(t,d),this.layout.setEdgePoints(d,u),e=0===e?this.parallelEdgeSpacing:e>0?-e:-e+this.parallelEdgeSpacing,n++}t.temp[0]=101207}}setVertexLocation(t){const e=t.cell,i=t.x[0]-t.width/2,s=t.y[0]-t.height/2,n=this.rankTopY,l=this.rankBottomY;n[t.minRank]=Math.min(n[t.minRank],s),l[t.minRank]=Math.max(l[t.minRank],s+t.height),this.orientation===Constants.DIRECTION.NORTH||this.orientation===Constants.DIRECTION.SOUTH?this.layout.setVertexLocation(e,i,s):this.layout.setVertexLocation(e,s,i),this.limitX=Math.max(this.limitX,i+t.width)}processReversedEdge(t,e){}}const hierarchical_CoordinateAssignment=CoordinateAssignment;class HierarchicalLayout extends layout_GraphLayout{constructor(t,e=Constants.DIRECTION.NORTH,i=!0){super(t),this.parentX=null,this.parentY=null,this.roots=null,this.resizeParent=!1,this.maintainParentLocation=!1,this.moveParent=!1,this.parentBorder=0,this.intraCellSpacing=30,this.interRankCellSpacing=100,this.interHierarchySpacing=60,this.parallelEdgeSpacing=10,this.orientation=Constants.DIRECTION.NORTH,this.fineTuning=!0,this.tightenToSource=!0,this.disableEdgeStyle=!0,this.traverseAncestors=!0,this.model=null,this.edgesCache=new util_Dictionary.A,this.edgeSourceTermCache=new util_Dictionary.A,this.edgesTargetTermCache=new util_Dictionary.A,this.edgeStyle=datatypes_HierarchicalEdgeStyle.POLYLINE,this.orientation=e,this.deterministic=i}getDataModel(){return this.model}execute(t,e=null){if(this.parent=t,this.edgesCache=new util_Dictionary.A,this.edgeSourceTermCache=new util_Dictionary.A,this.edgesTargetTermCache=new util_Dictionary.A,null==e||e instanceof Array||(e=[e]),null==e&&null==t)return;if(this.parentX=null,this.parentY=null,t!==this.graph.getDataModel().root&&null!=t.isVertex()&&this.maintainParentLocation){const e=t.getGeometry();null!=e&&(this.parentX=e.x,this.parentY=e.y)}if(null!=e){const i=[];for(let s=0;s<e.length;s+=1)(null==t||t.isAncestor(e[s]))&&e[s].isVertex()&&i.push(e[s]);this.roots=i}const{model:i}=this.graph;i.batchUpdate((()=>{if(this.run(t),this.resizeParent&&!t.isCollapsed()&&this.graph.updateGroupBounds([t],this.parentBorder,this.moveParent),null!=this.parentX&&null!=this.parentY){let e=t.getGeometry();null!=e&&(e=e.clone(),e.x=this.parentX,e.y=this.parentY,i.setGeometry(t,e))}}))}findRoots(t,e){const i=[];if(null!=t&&null!=e){const{model:t}=this.graph;let s=null,n=-1e5;for(const t in e){const l=e[t];if(l.isVertex()&&l.isVisible()){const t=this.getEdges(l);let e=0,r=0;for(let i=0;i<t.length;i++)this.getVisibleTerminal(t[i],!0)===l?e++:r++;0===r&&e>0&&i.push(l);const a=e-r;a>n&&(n=a,s=l)}}0===i.length&&null!=s&&i.push(s)}return i}getEdges(t){const e=this.edgesCache.get(t);if(null!=e)return e;const{model:i}=this.graph;let s=[];const n=t.isCollapsed(),l=t.getChildCount();for(let e=0;e<l;e+=1){const i=t.getChildAt(e);this.isPort(i)?s=s.concat(i.getEdges(!0,!0)):!n&&i.isVisible()||(s=s.concat(i.getEdges(!0,!0)))}s=s.concat(t.getEdges(!0,!0));const r=[];for(let e=0;e<s.length;e+=1){const i=this.getVisibleTerminal(s[e],!0),n=this.getVisibleTerminal(s[e],!1);(i===n||i!==n&&(n===t&&(null==this.parent||this.isAncestor(this.parent,i,this.traverseAncestors))||i===t&&(null==this.parent||this.isAncestor(this.parent,n,this.traverseAncestors))))&&r.push(s[e])}return this.edgesCache.put(t,r),r}getVisibleTerminal(t,e){let i;i=e?this.edgeSourceTermCache:this.edgesTargetTermCache;const s=i.get(t);if(null!=s)return s;const n=this.graph.view.getState(t);let l=null!=n?n.getVisibleTerminal(e):this.graph.view.getVisibleTerminal(t,e);return null==l&&(l=null!=n?n.getVisibleTerminal(e):this.graph.view.getVisibleTerminal(t,e)),null!=l&&(this.isPort(l)&&(l=l.getParent()),i.put(t,l)),l}run(t){const e=[],i={};if(null==this.roots&&null!=t){const s=Object();this.filterDescendants(t,s),this.roots=[];let n=!0;for(const t in s)if(null!=s[t]){n=!1;break}for(;!n;){const l=this.findRoots(t,s);for(let t=0;t<l.length;t+=1){const n=Object();e.push(n),this.traverse({vertex:l[t],directed:!0,edge:null,allVertices:i,currentComp:n,hierarchyVertices:e,filledVertexSet:s,func:null,visited:null})}for(let t=0;t<l.length;t+=1)this.roots.push(l[t]);n=!0;for(const t in s)if(null!=s[t]){n=!1;break}}}else{const t=this.roots;for(let s=0;s<t.length;s+=1){const n=Object();e.push(n),this.traverse({vertex:t[s],directed:!0,edge:null,allVertices:i,currentComp:n,hierarchyVertices:e,filledVertexSet:null,func:null,visited:null})}}let s=0;for(let i=0;i<e.length;i+=1){const n=e[i],l=[];for(const t in n)l.push(n[t]);this.model=new hierarchical_GraphHierarchyModel(this,l,this.roots,t,this.tightenToSource),this.cycleStage(t),this.layeringStage(),this.crossingStage(t),s=this.placementStage(s,t)}}filterDescendants(t,e){const{model:i}=this.graph;if(t.isVertex()&&t!==this.parent&&t.isVisible()&&(e[ObjectIdentity.A.get(t)]=t),this.traverseAncestors||t===this.parent&&t.isVisible()){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=t.getChildAt(s);this.isPort(i)||this.filterDescendants(i,e)}}}isPort(t){return null!=t&&null!=t.geometry&&t.geometry.relative}getEdgesBetween(t,e,i){i=null!=i&&i;const s=this.getEdges(t),n=[];for(let l=0;l<s.length;l+=1){const r=this.getVisibleTerminal(s[l],!0),a=this.getVisibleTerminal(s[l],!1);(r===t&&a===e||!i&&r===e&&a===t)&&n.push(s[l])}return n}traverse({vertex:t,directed:e,allVertices:i,currentComp:s,hierarchyVertices:n,filledVertexSet:l}){if(null!=t&&null!=i){const r=ObjectIdentity.A.get(t);if(null!=i[r]||null!=l&&null==l[r]){if(null==s[r])for(let t=0;t<n.length;t+=1){const e=n[t];if(null!=e[r]){for(const t in e)s[t]=e[t];return n.splice(t,1),s}}}else{null==s[r]&&(s[r]=t),null==i[r]&&(i[r]=t),null!==l&&delete l[r];const a=this.getEdges(t),o=[];for(let e=0;e<a.length;e+=1)o[e]=this.getVisibleTerminal(a[e],!0)==t;for(let t=0;t<a.length;t+=1)if(!e||o[t]){const r=this.getVisibleTerminal(a[t],!o[t]);let h=1;for(let e=0;e<a.length;e++)if(e!==t){const t=o[e];this.getVisibleTerminal(a[e],!t)===r&&(t?h++:h--)}h>=0&&(s=this.traverse({vertex:r,directed:e,edge:a[t],allVertices:i,currentComp:s,hierarchyVertices:n,filledVertexSet:l,func:null,visited:null}))}}}return s}cycleStage(t){new hierarchical_MinimumCycleRemover(this).execute(t)}layeringStage(){const t=this.model;t.initialRank(),t.fixRanks()}crossingStage(t){new hierarchical_MedianHybridCrossingReduction(this).execute(t)}placementStage(t,e){const i=new hierarchical_CoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,t,this.parallelEdgeSpacing);return i.fineTuning=this.fineTuning,i.execute(e),i.limitX+this.interHierarchySpacing}}const layout_HierarchicalLayout=HierarchicalLayout;class SwimlaneModel{constructor(t,e,i,s,n){this.ranks=[],this.dfsCount=0,this.SOURCESCANSTARTRANK=1e8,this.tightenToSource=!1,this.ranksPerGroup=null;const l=t.getGraph();this.tightenToSource=n,this.roots=i,this.parent=s,this.vertexMapper=new util_Dictionary.A,this.edgeMapper=new util_Dictionary.A,this.maxRank=0;const r=[];null==e&&(e=l.getChildVertices(s)),this.maxRank=this.SOURCESCANSTARTRANK,this.createInternalCells(t,e,r);for(let i=0;i<e.length;i+=1){const e=r[i].connectsAsSource;for(let s=0;s<e.length;s++){const n=e[s],l=n.edges;if(null!=l&&l.length>0){const e=l[0];let s=t.getVisibleTerminal(e,!1),a=this.vertexMapper.get(s);r[i]==a&&(s=t.getVisibleTerminal(e,!0),a=this.vertexMapper.get(s)),null!=a&&r[i]!==a&&(n.target=a,0==a.connectsAsTarget.length&&(a.connectsAsTarget=[]),a.connectsAsTarget.indexOf(n)<0&&a.connectsAsTarget.push(n))}}r[i].temp[0]=1}}createInternalCells(t,e,i){const s=t.getGraph(),n=t.swimlanes;for(let l=0;l<e.length;l+=1){i[l]=new datatypes_GraphHierarchyNode(e[l]),this.vertexMapper.put(e[l],i[l]),i[l].swimlaneIndex=-1;for(let t=0;t<n.length;t+=1)if(e[l].getParent()===n[t]){i[l].swimlaneIndex=t;break}const r=t.getEdges(e[l]);i[l].connectsAsSource=[];for(let n=0;n<r.length;n+=1){const a=t.getVisibleTerminal(r[n],!1);if(a!==e[l]&&a.isVertex()&&!t.isVertexIgnored(a)){const n=t.getEdgesBetween(e[l],a,!1),r=t.getEdgesBetween(e[l],a,!0);if(null!=n&&n.length>0&&null==this.edgeMapper.get(n[0])&&2*r.length>=n.length){const e=new datatypes_GraphHierarchyEdge(n);for(let i=0;i<n.length;i+=1){const l=n[i];this.edgeMapper.put(l,e),s.resetEdge(l),t.disableEdgeStyle&&(t.setEdgeStyleEnabled(l,!1),t.setOrthogonalEdge(l,!0))}e.source=i[l],i[l].connectsAsSource.indexOf(e)<0&&i[l].connectsAsSource.push(e)}}}i[l].temp[0]=0}}initialRank(){this.ranksPerGroup=[];const t=[],e={};if(null!=this.roots)for(let i=0;i<this.roots.length;i+=1){const s=this.vertexMapper.get(this.roots[i]);this.maxChainDfs(null,s,null,e,0),null!=s&&t.push(s)}const i={},s={};for(let t=this.ranksPerGroup.length-1;t>=0;t--)t===this.ranksPerGroup.length-1?i[t]=0:i[t]=s[t+1]+1,s[t]=i[t]+this.ranksPerGroup[t];this.maxRank=s[0];const n=this.vertexMapper.getValues();for(let t=0;t<n.length;t+=1)n[t].temp[0]=-1;for(t.slice();t.length>0;){const e=t[0],i=e.connectsAsTarget,n=e.connectsAsSource;let l=!0,r=s[0];for(let t=0;t<i.length;t+=1){const e=i[t];if(5270620!==e.temp[0]){l=!1;break}{const t=e.source;r=Math.min(r,t.temp[0]-1)}}if(l){if(r>s[e.swimlaneIndex]&&(r=s[e.swimlaneIndex]),e.temp[0]=r,null!=n)for(let e=0;e<n.length;e+=1){const i=n[e];i.temp[0]=5270620;const s=i.target;-1===s.temp[0]&&(t.push(s),s.temp[0]=-2)}t.shift()}else{const i=t.shift();if(t.push(e),i===e&&1===t.length)break}}}maxChainDfs(t,e,i,s,n){if(null!=e){const t=CellPath.A.create(e.cell);if(null==s[t]){s[t]=e;const i=e.swimlaneIndex,l=this.ranksPerGroup;(null==l[i]||l[i]<n)&&(l[i]=n);const r=e.connectsAsSource.slice();for(let t=0;t<r.length;t+=1){const i=r[t],l=i.target;e.swimlaneIndex<l.swimlaneIndex?this.maxChainDfs(e,l,i,(0,cloneUtils.clone)(s,null,!0),0):e.swimlaneIndex===l.swimlaneIndex&&this.maxChainDfs(e,l,i,(0,cloneUtils.clone)(s,null,!0),n+1)}}}}fixRanks(){const t=[];this.ranks=[];for(let e=0;e<this.maxRank+1;e+=1)t[e]=[],this.ranks[e]=t[e];let e=null;if(null!=this.roots){const t=this.roots;e=[];for(let i=0;i<t.length;i+=1){const s=t[i],n=this.vertexMapper.get(s);e[i]=n}}this.visit(((e,i,s,n,l)=>{if(0===l&&i.maxRank<0&&i.minRank<0&&(t[i.temp[0]].push(i),i.maxRank=i.temp[0],i.minRank=i.temp[0],i.temp[0]=t[i.maxRank].length-1),null!=e&&null!=s&&e.maxRank-i.maxRank>1){s.maxRank=e.maxRank,s.minRank=i.maxRank,s.temp=[],s.x=[],s.y=[];for(let e=s.minRank+1;e<s.maxRank;e+=1)t[e].push(s),s.setGeneralPurposeVariable(e,t[e].length-1)}}),e,!1,null)}visit(t,e,i,s){if(null!=e){for(let n=0;n<e.length;n+=1){const l=e[n];null!=l&&(null==s&&(s={}),i?(l.hashCode=[],l.hashCode[0]=this.dfsCount,l.hashCode[1]=n,this.extendedDfs(null,l,null,t,s,l.hashCode,n,0)):this.dfs(null,l,null,t,s,0))}this.dfsCount+=1}}dfs(t,e,i,s,n,l){if(null!=e){const r=e.id;if(null==n[r]){n[r]=e,s(t,e,i,l,0);const a=e.connectsAsSource.slice();for(let t=0;t<a.length;t+=1){const i=a[t],r=i.target;this.dfs(e,r,i,s,n,l+1)}}else s(t,e,i,l,1)}}extendedDfs(t,e,i,s,n,l,r,a){if(null!=e){if(null!=t&&(null==e.hashCode||e.hashCode[0]!==t.hashCode[0])){const i=t.hashCode.length+1;e.hashCode=t.hashCode.slice(),e.hashCode[i-1]=r}const l=e.id;if(null==n[l]){n[l]=e,s(t,e,i,a,0);const r=e.connectsAsSource.slice(),o=e.connectsAsTarget.slice();for(let t=0;t<r.length;t+=1){const i=r[t],l=i.target;e.swimlaneIndex<=l.swimlaneIndex&&this.extendedDfs(e,l,i,s,n,e.hashCode,t,a+1)}for(let t=0;t<o.length;t+=1){const i=o[t],l=i.source;e.swimlaneIndex<l.swimlaneIndex&&this.extendedDfs(e,l,i,s,n,e.hashCode,t,a+1)}}else s(t,e,i,a,1)}}}const hierarchical_SwimlaneModel=SwimlaneModel;class SwimlaneOrdering extends hierarchical_HierarchicalLayoutStage{constructor(t){super(),this.layout=t}execute(t){const e=this.layout.getDataModel(),i={},s=(0,cloneUtils.clone)(e.vertexMapper,null,!0);let n=null;if(null!=e.roots){const t=e.roots;n=[];for(let i=0;i<t.length;i+=1)n[i]=e.vertexMapper.get(t[i])}e.visit(((t,e,n,l,r)=>{const a=null!=t&&t.swimlaneIndex===e.swimlaneIndex&&e.isAncestor(t),o=null!=t&&null!=n&&t.swimlaneIndex<e.swimlaneIndex&&n.source===e;a?(n.invert(),(0,arrayUtils.TF)(n,t.connectsAsSource),e.connectsAsSource.push(n),t.connectsAsTarget.push(n),(0,arrayUtils.TF)(n,e.connectsAsTarget)):o&&(n.invert(),(0,arrayUtils.TF)(n,t.connectsAsTarget),e.connectsAsTarget.push(n),t.connectsAsSource.push(n),(0,arrayUtils.TF)(n,e.connectsAsSource));const h=CellPath.A.create(e.cell);i[h]=e,delete s[h]}),n,!0,null)}}const hierarchical_SwimlaneOrdering=SwimlaneOrdering;class SwimlaneLayout extends layout_GraphLayout{constructor(t,e,i=!0){super(t),this.parentX=null,this.parentY=null,this.roots=null,this.swimlanes=null,this.dummyVertexWidth=50,this.resizeParent=!1,this.maintainParentLocation=!1,this.moveParent=!1,this.parentBorder=30,this.intraCellSpacing=30,this.interRankCellSpacing=100,this.interHierarchySpacing=60,this.parallelEdgeSpacing=10,this.orientation=Constants.DIRECTION.NORTH,this.fineTuning=!0,this.tightenToSource=!0,this.disableEdgeStyle=!0,this.traverseAncestors=!0,this.model=null,this.edgesCache=new util_Dictionary.A,this.edgeSourceTermCache=new util_Dictionary.A,this.edgesTargetTermCache=new util_Dictionary.A,this.edgeStyle=datatypes_HierarchicalEdgeStyle.POLYLINE,this.orientation=null!=e?e:Constants.DIRECTION.NORTH,this.deterministic=null==i||i}getDataModel(){return this.model}execute(t,e=null){this.parent=t;const{model:i}=this.graph;if(this.edgesCache=new util_Dictionary.A,this.edgeSourceTermCache=new util_Dictionary.A,this.edgesTargetTermCache=new util_Dictionary.A,null==e||e.length<1)return;if(null==t&&(t=e[0].getParent()),this.parentX=null,this.parentY=null,t!==this.graph.getDataModel().root&&null!=t.isVertex()&&this.maintainParentLocation){const e=t.getGeometry();null!=e&&(this.parentX=e.x,this.parentY=e.y)}this.swimlanes=e;const s=[];for(let t=0;t<e.length;t+=1){const i=this.graph.getChildCells(e[t]);if(null==i||0===i.length){const i=this.graph.insertVertex(e[t],null,null,0,0,this.dummyVertexWidth,0);s.push(i)}}i.beginUpdate();try{if(this.run(t),this.resizeParent&&!t.isCollapsed()&&this.graph.updateGroupBounds([t],this.parentBorder,this.moveParent),null!=this.parentX&&null!=this.parentY){let e=t.getGeometry();null!=e&&(e=e.clone(),e.x=this.parentX,e.y=this.parentY,i.setGeometry(t,e))}this.graph.removeCells(s)}finally{i.endUpdate()}}updateGroupBounds(){const t=[],e=this.model;for(const i in e.edgeMapper){const s=e.edgeMapper[i];for(let e=0;e<s.edges.length;e+=1)t.push(s.edges[e])}let i=this.graph.getBoundingBoxFromGeometry(t,!0);const s=[],n=this.swimlanes;for(let t=0;t<n.length;t+=1){const e=n[t],l=e.getGeometry();if(null!=l){const n=this.graph.getChildCells(e),r=this.graph.isSwimlane(e)?this.graph.getStartSize(e):new Rectangle.A,a=this.graph.getBoundingBoxFromGeometry(n);s[t]=a;const o=a.y+l.y-r.height-this.parentBorder,h=a.y+l.y+a.height;if(null==i)i=new Rectangle.A(0,o,0,h-o);else{i.y=Math.min(i.y,o);const t=Math.max(i.y+i.height,h);i.height=t-i.y}}}for(let t=0;t<n.length;t+=1){const e=n[t],l=e.getGeometry();if(null!=l){const n=this.graph.getChildCells(e),r=this.graph.isSwimlane(e)?this.graph.getStartSize(e):new Rectangle.A,a=l.clone(),o=0===t?this.parentBorder:this.interRankCellSpacing/2,h=r.width+o,d=s[t].x-h,c=i.y-this.parentBorder;a.x+=d,a.y=c,a.width=s[t].width+h+this.interRankCellSpacing/2,a.height=i.height+r.height+2*this.parentBorder,this.graph.model.setGeometry(e,a),this.graph.moveCells(n,-d,l.y-c)}}}findRoots(t,e){const i=[];if(null!=t&&null!=e){const{model:s}=this.graph;let n=null,l=-1e5;for(const s in e){const r=e[s];if(null!=r&&r.isVertex()&&r.isVisible()&&t.isAncestor(r)){const e=this.getEdges(r);let s=0,a=0;for(let i=0;i<e.length;i++){const n=this.getVisibleTerminal(e[i],!0);if(n===r){const n=this.getVisibleTerminal(e[i],!1);t.isAncestor(n)&&(s+=1)}else t.isAncestor(n)&&(a+=1)}0===a&&s>0&&i.push(r);const o=s-a;o>l&&(l=o,n=r)}}0===i.length&&null!=n&&i.push(n)}return i}getEdges(t){const e=this.edgesCache.get(t);if(null!=e)return e;let i=[];const s=t.isCollapsed(),n=t.getChildCount();for(let e=0;e<n;e+=1){const n=t.getChildAt(e);this.isPort(n)?i=i.concat(n.getEdges(!0,!0)):!s&&n.isVisible()||(i=i.concat(n.getEdges(!0,!0)))}i=i.concat(t.getEdges(!0,!0));const l=[];for(let e=0;e<i.length;e+=1){const s=this.getVisibleTerminal(i[e],!0),n=this.getVisibleTerminal(i[e],!1);(s===n||s!==n&&(n===t&&(null==this.parent||this.graph.isValidAncestor(s,this.parent,this.traverseAncestors))||s===t&&(null==this.parent||this.graph.isValidAncestor(n,this.parent,this.traverseAncestors))))&&l.push(i[e])}return this.edgesCache.put(t,l),l}getVisibleTerminal(t,e){let i=this.edgesTargetTermCache;e&&(i=this.edgeSourceTermCache);const s=i.get(t);if(null!=s)return s;const n=this.graph.view.getState(t);let l=null!=n?n.getVisibleTerminal(e):this.graph.view.getVisibleTerminal(t,e);return null==l&&(l=null!=n?n.getVisibleTerminal(e):this.graph.view.getVisibleTerminal(t,e)),null!=l&&(this.isPort(l)&&(l=l.getParent()),i.put(t,l)),l}run(t){const e=[],i={};if(null!=this.swimlanes&&this.swimlanes.length>0&&null!=t){const t={};for(let e=0;e<this.swimlanes.length;e+=1)this.filterDescendants(this.swimlanes[e],t);this.roots=[];let s=!0;for(const e in t)if(null!=t[e]){s=!1;break}let n=0;for(;!s&&n<this.swimlanes.length;){const l=this.findRoots(this.swimlanes[n],t);if(0!==l.length){for(let s=0;s<l.length;s+=1){const r=Object();e.push(r),this.traverse({vertex:l[s],directed:!0,edge:null,allVertices:i,currentComp:r,hierarchyVertices:e,filledVertexSet:t,swimlaneIndex:n,func:null,visited:null})}for(let t=0;t<l.length;t+=1)this.roots.push(l[t]);s=!0;for(const e in t)if(null!=t[e]){s=!1;break}}else n++}}else{const t=this.roots;for(let s=0;s<t.length;s+=1){const n=Object();e.push(n),this.traverse({vertex:t[s],directed:!0,edge:null,allVertices:i,currentComp:n,hierarchyVertices:e,filledVertexSet:null,swimlaneIndex:s,func:null,visited:null})}}const s=[];for(const t in i)s.push(i[t]);this.model=new hierarchical_SwimlaneModel(this,s,this.roots,t,this.tightenToSource),this.cycleStage(t),this.layeringStage(),this.crossingStage(t),this.placementStage(0,t)}filterDescendants(t,e){const{model:i}=this.graph;if(t.isVertex()&&t!==this.parent&&t.getParent()!==this.parent&&t.isVisible()&&(e[ObjectIdentity.A.get(t)]=t),this.traverseAncestors||t===this.parent&&t.isVisible()){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=t.getChildAt(s);this.isPort(i)||this.filterDescendants(i,e)}}}isPort(t){return!!t.geometry.relative}getEdgesBetween(t,e,i=!1){const s=this.getEdges(t),n=[];for(let l=0;l<s.length;l+=1){const r=this.getVisibleTerminal(s[l],!0),a=this.getVisibleTerminal(s[l],!1);(r===t&&a===e||!i&&r===e&&a===t)&&n.push(s[l])}return n}traverse({vertex:t,directed:e,allVertices:i,currentComp:s,hierarchyVertices:n,filledVertexSet:l,swimlaneIndex:r}){if(null!=t&&null!=i){const a=ObjectIdentity.A.get(t);if(null!=i[a]||null!=l&&null==l[a]){if(null==s[a])for(let t=0;t<n.length;t+=1){const e=n[t];if(null!=e[a]){for(const t in e)s[t]=e[t];return n.splice(t,1),s}}}else{null==s[a]&&(s[a]=t),null==i[a]&&(i[a]=t),null!==l&&delete l[a];const o=this.getEdges(t);for(let a=0;a<o.length;a+=1){let h=this.getVisibleTerminal(o[a],!0);const d=h===t;d&&(h=this.getVisibleTerminal(o[a],!1));let c=0;for(c=0;c<this.swimlanes.length&&!this.swimlanes[c].isAncestor(h);c++);c>=this.swimlanes.length||(c>r||(!e||d)&&c===r)&&(s=this.traverse({vertex:h,directed:e,edge:o[a],allVertices:i,currentComp:s,hierarchyVertices:n,filledVertexSet:l,swimlaneIndex:c,func:null,visited:null}))}}}return s}cycleStage(t){new hierarchical_SwimlaneOrdering(this).execute(t)}layeringStage(){const t=this.model;t.initialRank(),t.fixRanks()}crossingStage(t){new hierarchical_MedianHybridCrossingReduction(this).execute(t)}placementStage(t,e){const i=new hierarchical_CoordinateAssignment(this,this.intraCellSpacing,this.interRankCellSpacing,this.orientation,t,this.parallelEdgeSpacing);return i.fineTuning=this.fineTuning,i.execute(e),i.limitX+this.interHierarchySpacing}}const layout_SwimlaneLayout=SwimlaneLayout;var StencilShape=__webpack_require__(3201),gestureUtils=__webpack_require__(5309),logger=__webpack_require__(5981);class Animation extends EventSource.A{constructor(t=20){super(),this.thread=null,this.delay=t}isRunning(){return null!=this.thread}startAnimation(){null==this.thread&&(this.thread=window.setInterval(this.updateAnimation.bind(this),this.delay))}updateAnimation(){this.fireEvent(new EventObject.A(InternalEvent.A.EXECUTE))}stopAnimation(){null!=this.thread&&(window.clearInterval(this.thread),this.thread=null,this.fireEvent(new EventObject.A(InternalEvent.A.DONE)))}}const animate_Animation=Animation;class Effects{static animateChanges(t,e,i){const s=10;let n=0;const l=()=>{let a=!1;for(let i=0;i<e.length;i+=1){const l=e[i];if(l instanceof undoable_changes_GeometryChange||l instanceof undoable_changes_TerminalChange||l instanceof undoable_changes_ValueChange||l instanceof undoable_changes_ChildChange||l instanceof undoable_changes_StyleChange){const e=t.getView().getState(l.cell||l.child,!1);if(null!=e)if(a=!0,l.constructor!==undoable_changes_GeometryChange||l.cell.isEdge())(0,styleUtils.setOpacity)(e.shape.node,100*n/s);else{const{scale:i}=t.getView(),r=l.geometry,a=l.previous,o=(r.x-a.x)*i,h=(r.y-a.y)*i,d=(r.width-a.width)*i,c=(r.height-a.height)*i;0===n?(e.x-=o,e.y-=h,e.width-=d,e.height-=c):(e.x+=o/s,e.y+=h/s,e.width+=d/s,e.height+=c/s),t.cellRenderer.redraw(e),Effects.cascadeOpacity(t,l.cell,100*n/s)}}}n<s&&a?(n++,window.setTimeout(l,r)):null!=i&&i()},r=30;l()}static cascadeOpacity(t,e,i){const s=e.getChildCount();for(let n=0;n<s;n+=1){const s=e.getChildAt(n),l=t.getView().getState(s);null!=l&&((0,styleUtils.setOpacity)(l.shape.node,i),Effects.cascadeOpacity(t,s,i))}const n=e.getEdges();if(null!=n)for(let e=0;e<n.length;e+=1){const s=t.getView().getState(n[e]);null!=s&&(0,styleUtils.setOpacity)(s.shape.node,i)}}static fadeOut(t,e,i,s,n,l){s=s||40,n=n||30;let r=e||100;if((0,styleUtils.setOpacity)(t,r),l||null==l){const e=()=>{r=Math.max(r-s,0),(0,styleUtils.setOpacity)(t,r),r>0?window.setTimeout(e,n):(t.style.visibility="hidden",i&&t.parentNode&&t.parentNode.removeChild(t))};window.setTimeout(e,n)}else t.style.visibility="hidden",i&&t.parentNode&&t.parentNode.removeChild(t)}}const animate_Effects=Effects;class CellStatePreview{constructor(t){this.count=0,this.deltas=new util_Dictionary.A,this.graph=t}isEmpty(){return 0===this.count}moveState(t,e,i,s=!0,n=!0){let l=this.deltas.get(t.cell);return null==l?(l={point:new Point.A(e,i),state:t},this.deltas.put(t.cell,l),this.count++):s?(l.point.x+=e,l.point.y+=i):(l.point.x=e,l.point.y=i),n&&this.addEdges(t),l.point}show(t=null){this.deltas.visit(((t,e)=>{this.translateState(e.state,e.point.x,e.point.y)})),this.deltas.visit(((e,i)=>{this.revalidateState(i.state,i.point.x,i.point.y,t)}))}translateState(t,e,i){if(null!=t){if(t.cell.isVertex()){t.view.updateCellState(t);const s=t.cell.getGeometry();0===e&&0===i||null==s||s.relative&&null==this.deltas.get(t.cell)||(t.x+=e,t.y+=i)}for(const s of t.cell.getChildren())this.translateState(t.view.getState(s),e,i)}}revalidateState(t,e,i,s=null){t.cell.isEdge()&&t.view.updateCellState(t);const n=t.cell.getGeometry(),l=t.view.getState(t.cell.getParent());0===e&&0===i||null==n||!n.relative||!t.cell.isVertex()||null!=l&&!l.cell.isVertex()&&null==this.deltas.get(t.cell)||(t.x+=e,t.y+=i),this.graph.cellRenderer.redraw(t),null!=s&&s(t);for(const n of t.cell.getChildren())this.revalidateState(this.graph.view.getState(n),e,i,s)}addEdges(t){const e=t.cell.getEdgeCount();for(let i=0;i<e;i+=1){const e=t.view.getState(t.cell.getEdgeAt(i));null!=e&&this.moveState(e,0,0)}}}const cell_CellStatePreview=CellStatePreview;class Morphing extends animate_Animation{constructor(t,e=6,i=1.5,s){super(s),this.step=0,this.cells=null,this.graph=t,this.steps=e,this.ease=i}updateAnimation(){super.updateAnimation();const t=new cell_CellStatePreview(this.graph);if(null!=this.cells)for(const e of this.cells)this.animateCell(e,t,!1);else this.animateCell(this.graph.getDataModel().getRoot(),t,!0);this.show(t),(t.isEmpty()||this.step++>=this.steps)&&this.stopAnimation()}show(t){t.show()}animateCell(t,e,i=!1){const s=this.graph.getView().getState(t);let n=null;if(null!=s&&(n=this.getDelta(s),t.isVertex()&&(0!=n.x||0!=n.y))){const t=this.graph.view.getTranslate(),i=this.graph.view.getScale();n.x+=t.x*i,n.y+=t.y*i,e.moveState(s,-n.x/this.ease,-n.y/this.ease)}if(i&&!this.stopRecursion(s,n)){const s=t.getChildCount();for(let n=0;n<s;n+=1)this.animateCell(t.getChildAt(n),e,i)}}stopRecursion(t=null,e=null){return null!=e&&(0!=e.x||0!=e.y)}getDelta(t){const e=this.getOriginForCell(t.cell),i=this.graph.getView().getTranslate(),s=this.graph.getView().getScale(),n=t.x/s-i.x,l=t.y/s-i.y;return new Point.A((e.x-n)*s,(e.y-l)*s)}getOriginForCell(t=null){let e=null;if(null!=t){const i=t.getParent(),s=t.getGeometry();if(e=this.getOriginForCell(i),null!=s&&null!=i)if(s.relative){const t=i.getGeometry();null!=t&&(e.x+=s.x*t.width,e.y+=s.y*t.height)}else e.x+=s.x,e.y+=s.y}if(null==e){const t=this.graph.view.getTranslate();e=new Point.A(-t.x,-t.y)}return e}}const animate_Morphing=Morphing;var AbstractCanvas2D=__webpack_require__(3473);class XmlCanvas2D extends AbstractCanvas2D.A{constructor(t){super(),this.textEnabled=!0,this.compressed=!0,this.root=t,this.writeDefaults()}writeDefaults(){let t;t=this.createElement("fontfamily"),t.setAttribute("family",Constants.DEFAULT_FONTFAMILY),this.root.appendChild(t),t=this.createElement("fontsize"),t.setAttribute("size",String(Constants.DEFAULT_FONTSIZE)),this.root.appendChild(t),t=this.createElement("shadowcolor"),t.setAttribute("color",config.m5.shadowColor),this.root.appendChild(t),t=this.createElement("shadowalpha"),t.setAttribute("alpha",String(config.m5.shadowOpacity)),this.root.appendChild(t),t=this.createElement("shadowoffset"),t.setAttribute("dx",String(config.m5.shadowOffsetX)),t.setAttribute("dy",String(config.m5.shadowOffsetY)),this.root.appendChild(t)}format(t){return"string"==typeof t?parseFloat(parseFloat(t).toFixed(2)):parseFloat(t.toFixed(2))}createElement(t){return this.root.ownerDocument.createElement(t)}save(){this.compressed&&super.save(),this.root.appendChild(this.createElement("save"))}restore(){this.compressed&&super.restore(),this.root.appendChild(this.createElement("restore"))}scale(t){const e=this.createElement("scale");e.setAttribute("scale",String(t)),this.root.appendChild(e)}translate(t,e){const i=this.createElement("translate");i.setAttribute("dx",String(this.format(t))),i.setAttribute("dy",String(this.format(e))),this.root.appendChild(i)}rotate(t,e,i,s,n){const l=this.createElement("rotate");(0!==t||e||i)&&(l.setAttribute("theta",String(this.format(t))),l.setAttribute("flipH",e?"1":"0"),l.setAttribute("flipV",i?"1":"0"),l.setAttribute("cx",String(this.format(s))),l.setAttribute("cy",String(this.format(n))),this.root.appendChild(l))}setAlpha(t){if(this.compressed){if(this.state.alpha===t)return;super.setAlpha(t)}const e=this.createElement("alpha");e.setAttribute("alpha",String(this.format(t))),this.root.appendChild(e)}setFillAlpha(t){if(this.compressed){if(this.state.fillAlpha===t)return;super.setFillAlpha(t)}const e=this.createElement("fillalpha");e.setAttribute("alpha",String(this.format(t))),this.root.appendChild(e)}setStrokeAlpha(t){if(this.compressed){if(this.state.strokeAlpha===t)return;super.setStrokeAlpha(t)}const e=this.createElement("strokealpha");e.setAttribute("alpha",String(this.format(t))),this.root.appendChild(e)}setFillColor(t=null){if(t===Constants.NONE&&(t=null),this.compressed){if(this.state.fillColor===t)return;super.setFillColor(t)}const e=this.createElement("fillcolor");e.setAttribute("color",null!=t?t:Constants.NONE),this.root.appendChild(e)}setGradient(t,e,i,s,n,l,r,a=1,o=1){if(null!=t&&null!=e){super.setGradient(t,e,i,s,n,l,r,a,o);const h=this.createElement("gradient");h.setAttribute("c1",t),h.setAttribute("c2",e),h.setAttribute("x",String(this.format(i))),h.setAttribute("y",String(this.format(s))),h.setAttribute("w",String(this.format(n))),h.setAttribute("h",String(this.format(l))),null!=r&&h.setAttribute("direction",r),null!=a&&h.setAttribute("alpha1",String(a)),null!=o&&h.setAttribute("alpha2",String(o)),this.root.appendChild(h)}}setStrokeColor(t=null){if(t===Constants.NONE&&(t=null),this.compressed){if(this.state.strokeColor===t)return;super.setStrokeColor(t)}const e=this.createElement("strokecolor");e.setAttribute("color",null!=t?t:Constants.NONE),this.root.appendChild(e)}setStrokeWidth(t){if(this.compressed){if(this.state.strokeWidth===t)return;super.setStrokeWidth(t)}const e=this.createElement("strokewidth");e.setAttribute("width",String(this.format(t))),this.root.appendChild(e)}setDashed(t,e){if(this.compressed){if(this.state.dashed===t)return;super.setDashed(t,e)}const i=this.createElement("dashed");i.setAttribute("dashed",t?"1":"0"),null!=e&&i.setAttribute("fixDash",e?"1":"0"),this.root.appendChild(i)}setDashPattern(t){if(this.compressed){if(this.state.dashPattern===t)return;super.setDashPattern(t)}const e=this.createElement("dashpattern");e.setAttribute("pattern",t),this.root.appendChild(e)}setLineCap(t){if(this.compressed){if(this.state.lineCap===t)return;super.setLineCap(t)}const e=this.createElement("linecap");e.setAttribute("cap",t),this.root.appendChild(e)}setLineJoin(t){if(this.compressed){if(this.state.lineJoin===t)return;super.setLineJoin(t)}const e=this.createElement("linejoin");e.setAttribute("join",t),this.root.appendChild(e)}setMiterLimit(t){if(this.compressed){if(this.state.miterLimit===t)return;super.setMiterLimit(t)}const e=this.createElement("miterlimit");e.setAttribute("limit",String(t)),this.root.appendChild(e)}setFontColor(t=null){if(this.textEnabled){if(t===Constants.NONE&&(t=null),this.compressed){if(this.state.fontColor===t)return;super.setFontColor(t)}const e=this.createElement("fontcolor");e.setAttribute("color",null!=t?t:Constants.NONE),this.root.appendChild(e)}}setFontBackgroundColor(t=null){if(this.textEnabled){if(t===Constants.NONE&&(t=null),this.compressed){if(this.state.fontBackgroundColor===t)return;super.setFontBackgroundColor(t)}const e=this.createElement("fontbackgroundcolor");e.setAttribute("color",null!=t?t:Constants.NONE),this.root.appendChild(e)}}setFontBorderColor(t=null){if(this.textEnabled){if(t===Constants.NONE&&(t=null),this.compressed){if(this.state.fontBorderColor===t)return;super.setFontBorderColor(t)}const e=this.createElement("fontbordercolor");e.setAttribute("color",null!=t?t:Constants.NONE),this.root.appendChild(e)}}setFontSize(t){if(this.textEnabled){if(this.compressed){if(this.state.fontSize===t)return;super.setFontSize(t)}const e=this.createElement("fontsize");e.setAttribute("size",String(t)),this.root.appendChild(e)}}setFontFamily(t){if(this.textEnabled){if(this.compressed){if(this.state.fontFamily===t)return;super.setFontFamily(t)}const e=this.createElement("fontfamily");e.setAttribute("family",t),this.root.appendChild(e)}}setFontStyle(t=0){if(this.textEnabled){if(null==t&&(t=0),this.compressed){if(this.state.fontStyle===t)return;super.setFontStyle(t)}const e=this.createElement("fontstyle");e.setAttribute("style",String(t)),this.root.appendChild(e)}}setShadow(t){if(this.compressed){if(this.state.shadow===t)return;super.setShadow(t)}const e=this.createElement("shadow");e.setAttribute("enabled",t?"1":"0"),this.root.appendChild(e)}setShadowColor(t=null){if(this.compressed){if(t===Constants.NONE&&(t=null),this.state.shadowColor===t)return;super.setShadowColor(t)}const e=this.createElement("shadowcolor");e.setAttribute("color",null!=t?t:Constants.NONE),this.root.appendChild(e)}setShadowAlpha(t){if(this.compressed){if(this.state.shadowAlpha===t)return;super.setShadowAlpha(t)}const e=this.createElement("shadowalpha");e.setAttribute("alpha",String(t)),this.root.appendChild(e)}setShadowOffset(t,e){if(this.compressed){if(this.state.shadowDx===t&&this.state.shadowDy===e)return;super.setShadowOffset(t,e)}const i=this.createElement("shadowoffset");i.setAttribute("dx",String(t)),i.setAttribute("dy",String(e)),this.root.appendChild(i)}rect(t,e,i,s){const n=this.createElement("rect");n.setAttribute("x",String(this.format(t))),n.setAttribute("y",String(this.format(e))),n.setAttribute("w",String(this.format(i))),n.setAttribute("h",String(this.format(s))),this.root.appendChild(n)}roundrect(t,e,i,s,n,l){const r=this.createElement("roundrect");r.setAttribute("x",String(this.format(t))),r.setAttribute("y",String(this.format(e))),r.setAttribute("w",String(this.format(i))),r.setAttribute("h",String(this.format(s))),r.setAttribute("dx",String(this.format(n))),r.setAttribute("dy",String(this.format(l))),this.root.appendChild(r)}ellipse(t,e,i,s){const n=this.createElement("ellipse");n.setAttribute("x",String(this.format(t))),n.setAttribute("y",String(this.format(e))),n.setAttribute("w",String(this.format(i))),n.setAttribute("h",String(this.format(s))),this.root.appendChild(n)}image(t,e,i,s,n,l=!0,r=!1,a=!1){n=this.converter.convert(n);const o=this.createElement("image");o.setAttribute("x",String(this.format(t))),o.setAttribute("y",String(this.format(e))),o.setAttribute("w",String(this.format(i))),o.setAttribute("h",String(this.format(s))),o.setAttribute("src",n),o.setAttribute("aspect",l?"1":"0"),o.setAttribute("flipH",r?"1":"0"),o.setAttribute("flipV",a?"1":"0"),this.root.appendChild(o)}updateText(){}begin(){this.root.appendChild(this.createElement("begin")),this.lastX=0,this.lastY=0}end(){}moveTo(t,e){const i=this.createElement("move");i.setAttribute("x",String(this.format(t))),i.setAttribute("y",String(this.format(e))),this.root.appendChild(i),this.lastX=t,this.lastY=e}lineTo(t,e){const i=this.createElement("line");i.setAttribute("x",String(this.format(t))),i.setAttribute("y",String(this.format(e))),this.root.appendChild(i),this.lastX=t,this.lastY=e}quadTo(t,e,i,s){const n=this.createElement("quad");n.setAttribute("x1",String(this.format(t))),n.setAttribute("y1",String(this.format(e))),n.setAttribute("x2",String(this.format(i))),n.setAttribute("y2",String(this.format(s))),this.root.appendChild(n),this.lastX=i,this.lastY=s}curveTo(t,e,i,s,n,l){const r=this.createElement("curve");r.setAttribute("x1",String(this.format(t))),r.setAttribute("y1",String(this.format(e))),r.setAttribute("x2",String(this.format(i))),r.setAttribute("y2",String(this.format(s))),r.setAttribute("x3",String(this.format(n))),r.setAttribute("y3",String(this.format(l))),this.root.appendChild(r),this.lastX=n,this.lastY=l}close(){this.root.appendChild(this.createElement("close"))}text(t,e,i,s,n,l=null,r=null,a=null,o=null,h=null,d=null,c=null,u=null){if(this.textEnabled&&null!=n){(0,domUtils.isNode)(n)&&(n=(0,domUtils.getOuterHtml)(n));const g=this.createElement("text");g.setAttribute("x",String(this.format(t))),g.setAttribute("y",String(this.format(e))),g.setAttribute("w",String(this.format(i))),g.setAttribute("h",String(this.format(s))),g.setAttribute("str",n),null!=l&&g.setAttribute("align",l),null!=r&&g.setAttribute("valign",r),g.setAttribute("wrap",a?"1":"0"),null==o&&(o=""),g.setAttribute("format",o),null!=h&&g.setAttribute("overflow",h),null!=d&&g.setAttribute("clip",d?"1":"0"),null!=c&&g.setAttribute("rotation",String(c)),null!=u&&g.setAttribute("dir",u),this.root.appendChild(g)}}stroke(){this.root.appendChild(this.createElement("stroke"))}fill(){this.root.appendChild(this.createElement("fill"))}fillAndStroke(){this.root.appendChild(this.createElement("fillstroke"))}}const canvas_XmlCanvas2D=XmlCanvas2D,linkAction=(t,e,i,s,n=0)=>domHelpers_link(t,e,(()=>{i.execute(s)}),n),linkInvoke=(t,e,i,s,n,l=0)=>domHelpers_link(t,e,(()=>{i[s](n)}),l),domHelpers_link=(t,e,i,s=0)=>{const n=document.createElement("span");return n.style.color="blue",n.style.textDecoration="underline",n.style.cursor="pointer",n.style.paddingLeft=`${s}px`,InternalEvent.A.addListener(n,"click",i),(0,domUtils.write)(n,e),null!=t&&t.appendChild(n),n},domHelpers_button=(t,e,i=null)=>{const s=(i=null!=i?i:document).createElement("button");return(0,domUtils.write)(s,t),InternalEvent.A.addListener(s,"click",(t=>{e(t)})),s};var DragSource=__webpack_require__(3538);class MaxLogAsLogger{enter(t){return gui_MaxLog.enter(t)}leave(t,e){gui_MaxLog.leave(t,e)}show(){gui_MaxLog.show()}info(t){gui_MaxLog.writeln(t)}debug(t){gui_MaxLog.debug(t)}error(t,...e){const i=e?.map((t=>String(t)));gui_MaxLog.writeln(`[ERROR] ${t}`,...i)}trace(t){gui_MaxLog.trace(t)}warn(t){gui_MaxLog.warn(t)}}var MaxToolbar=__webpack_require__(5015);class ImageBundle{constructor(t=!1){this.images={},this.alt=t}putImage(t,e,i){this.images[t]={value:e,fallback:i}}getImage(t){let e=null;if(t){const i=this.images[t];i&&(e=this.alt?i.fallback:i.value)}return e}}const image_ImageBundle=ImageBundle;class ImageExport{constructor(){this.includeOverlays=!1}drawState(t,e){t&&(this.visitStatesRecursive(t,e,this.drawCellState.bind(this)),this.includeOverlays&&this.visitStatesRecursive(t,e,this.drawOverlays.bind(this)))}visitStatesRecursive(t,e,i){if(t){i(t,e);const s=t.view.graph,n=t.cell.getChildCount();for(let l=0;l<n;l+=1){const n=s.view.getState(t.cell.getChildAt(l));n&&this.visitStatesRecursive(n,e,i)}}}getLinkForCellState(t,e){return null}drawCellState(t,e){const i=this.getLinkForCellState(t,e);i&&e.setLink(i),this.drawShape(t,e),this.drawText(t,e),i&&e.setLink(null)}drawShape(t,e){t.shape instanceof Shape.A&&t.shape.checkBounds()&&(e.save(),t.shape.beforePaint(e),t.shape.paint(e),t.shape.afterPaint(e),e.restore())}drawText(t,e){t.text&&t.text.checkBounds()&&(e.save(),t.text.beforePaint(e),t.text.paint(e),t.text.afterPaint(e),e.restore())}drawOverlays(t,e){null!=t.overlays&&t.overlays.visit(((t,i)=>{i instanceof Shape.A&&i.paint(e)}))}}const image_ImageExport=ImageExport;var UrlConverter=__webpack_require__(6126);class AutoSaveManager extends EventSource.A{constructor(t){super(),this.graph=null,this.autoSaveDelay=10,this.autoSaveThrottle=2,this.autoSaveThreshold=5,this.ignoredChanges=0,this.lastSnapshot=0,this.enabled=!0,this.changeHandler=(t,e)=>{this.isEnabled()&&this.graphModelChanged(e.getProperty("edit").changes)},this.setGraph(t)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}setGraph(t){null!=this.graph&&this.graph.getDataModel().removeListener(this.changeHandler),this.graph=t,null!=this.graph&&this.graph.getDataModel().addListener(InternalEvent.A.CHANGE,this.changeHandler)}save(){}graphModelChanged(t){const e=((new Date).getTime()-this.lastSnapshot)/1e3;e>this.autoSaveDelay||this.ignoredChanges>=this.autoSaveThreshold&&e>this.autoSaveThrottle?(this.save(),this.reset()):this.ignoredChanges++}reset(){this.lastSnapshot=(new Date).getTime(),this.ignoredChanges=0}destroy(){this.setGraph(null)}}const other_AutoSaveManager=AutoSaveManager;class Multiplicity{constructor(t,e,i,s,n,l,r,a,o,h=!0){this.validNeighborsAllowed=!0,this.source=t,this.type=e,this.attr=i,this.value=s,this.min=n??0,this.max=l??Number.MAX_VALUE,this.validNeighbors=r,this.countError=Translations.A.get(a)||a,this.typeError=Translations.A.get(o)||o,this.validNeighborsAllowed=h}check(t,e,i,s,n,l){let r="";return(this.source&&this.checkTerminal(t,i,e)||!this.source&&this.checkTerminal(t,s,e))&&(null!=this.countError&&(this.source&&(0===this.max||n>=this.max)||!this.source&&(0===this.max||l>=this.max))&&(r+=`${this.countError}\n`),null!=this.validNeighbors&&null!=this.typeError&&this.validNeighbors.length>0)&&(this.checkNeighbors(t,e,i,s)||(r+=`${this.typeError}\n`)),r.length>0?r:null}checkNeighbors(t,e,i,s){const n=i.getValue(),l=s.getValue();let r=!this.validNeighborsAllowed;const a=this.validNeighbors;for(let e=0;e<a.length;e++){if(this.source&&this.checkType(t,l,a[e])){r=this.validNeighborsAllowed;break}if(!this.source&&this.checkType(t,n,a[e])){r=this.validNeighborsAllowed;break}}return r}checkTerminal(t,e,i){const s=i?.getValue()??null;return this.checkType(t,s,this.type,this.attr,this.value)}checkType(t,e,i,s,n){return null!=e&&("string"!=typeof e&&"nodeType"in e&&!Number.isNaN(e.nodeType)?(0,domUtils.isNode)(e,i,s,n):e===i)}}const other_Multiplicity=Multiplicity;return window.mxg=lib_namespaceObject,__webpack_exports__})()));